

















<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
<title>WITNESS | DEFENSE — Client Onboarding Portal</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

<!-- Fonts for your existing design -->
<link href="https://fonts.googleapis.com/css2?family=Rationale&family=Share:ital,wght@0,400;0,700;1,400;1,700&family=Stardos+Stencil:wght@400;700&display=swap" rel="stylesheet">

<!-- Fonts for the tactical UI -->
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&family=Rajdhani:wght@400;500;600;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">

<style>
:root {
  --shadow-strong: rgba(0,0,0,0.95);
  --shadow-soft: rgba(0,0,0,0.6);
  --stage-w: 100%;
  --banner-tip: 4%;
  --maroon: #561420;
  --gold-soft: #b79b6c;
  --bronze: #6c613b;
  --bronze-hover: #6c613b;
  --eggshell: #f0eade;
  --card-bg-top: #2a2a2a;
  --card-bg-btm: #1a1a1a;
  --red-x: #ff0000;
  --charcoal: #111;
  --charcoal-light: #1c1c1c;
  --charcoal-lighter: #2a2a2a;
  --tactical-red: #ff2a2a;
  --tactical-blue: #00a8ff;
  --hud-green: #00ff88;
  --ammo-gold: #ffaa00;
  --glow-red: rgba(255, 42, 42, 0.6);
  --glow-blue: rgba(0, 168, 255, 0.6);
  --silver-white: #f0f0f0;
  --silver-light: #d0d0d0;
  --silver-medium: #c0c0c0;
  --silver-bright: #f8f8f8;
  --tactical-green: #00ff88;      /* ADDED */
  --tactical-gray: #1a1a1a; 
  --tactical-bronze: #8a7b4d; /* Added missing variable */
}

/* ==== BASE ==== */
* {
    box-sizing: border-box;
}

body {
    font-family: "Share", serif;
    margin: 0;
    background: linear-gradient(180deg, #1a1a1a 0%, #2a2a2a 40%, #3a3a3a 100%);
    color: var(--eggshell);
    padding: 0 8px 70px; /* Bottom nav space */
    -webkit-text-size-adjust: 100%;
}

.stage {
    width: min(100%, var(--stage-w));
    margin: 0 auto;
}

/* ==== CARD SPACING & SHADOWS ==== */
.card,
.notes-card,
.course-card,
.recommendation-card,
.phase-card,
.drill-card,
.drill-card-modal,
.waivers-card,
.note-item,
.course-overview-item,
.course-detail-item,
.battle-bag-item,
.cartridge-type,
.bang-bag-package,
.instructor-snapshot,
.client-info,
.progress-card,
.legal-card,
.battle-bag-card,
.battle-badge-card {
    margin-bottom: 25px;
    position: relative;
    box-shadow: 
        0 10px 25px rgba(0, 0, 0, 0.5), 
        0 6px 15px rgba(0, 0, 0, 0.3),
        0 2px 8px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.card:hover,
.notes-card:hover,
.course-card:hover,
.recommendation-card:hover,
.phase-card:hover,
.drill-card:hover,
.drill-card-modal:hover,
.waivers-card:hover,
.note-item:hover,
.course-overview-item:hover,
.course-detail-item:hover,
.battle-bag-item:hover,
.cartridge-type:hover,
.bang-bag-package:hover,
.instructor-snapshot:hover,
.client-info:hover,
.progress-card:hover,
.legal-card:hover,
.battle-bag-card:hover,
.battle-badge-card:hover {
    transform: translateY(-5px);
    box-shadow: 
        0 15px 35px rgba(0, 0, 0, 0.6),
        0 8px 20px rgba(0, 0, 0, 0.4),
        0 3px 12px rgba(0, 0, 0, 0.25),
        inset 0 1px 0 rgba(255, 255, 255, 0.07);
}

/* Grid spacing */
.class-grid,
.intake-grid,
.course-cards,
.drills-cards-container,
.recommendation-cards,
.drills-grid,
.drill-cards-container {
    gap: 25px;
}

/* Panel spacing */
.panel-body {
    padding-top: 15px;
    padding-bottom: 10px;
}

/* Waivers card */
.waivers-card {
    margin: 25px 0;
}

/* ==== HAMBURGER MENU ==== */
.hamburger-menu {
    position: fixed;
    top: 10px;
    left: 10px;
    z-index: 1001;
    cursor: pointer;
    width: 32px;
    height: 32px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    padding: 5px;
    background: var(--bronze);
    border-radius: 4px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.7);
}

.hamburger-menu span {
    display: block;
    height: 3px;
    width: 100%;
    background-color: var(--eggshell);
    border-radius: 2px;
    transition: all 0.3s ease;
}

.menu-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.85);
    z-index: 1002;
    display: none;
    justify-content: center;
    align-items: center;
}

.menu-content {
    background: linear-gradient(180deg, var(--charcoal-light), var(--charcoal));
    border: 1px solid var(--bronze);
    border-radius: 8px;
    padding: 20px;
    width: 80%;
    max-width: 300px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.7);
}

.menu-content h3 {
    font-family: "Stardos Stencil", serif;
    color: var(--gold-soft);
    text-align: center;
    margin-top: 0;
    margin-bottom: 15px;
}

.menu-btn {
    display: block;
    width: 100%;
    padding: 12px;
    margin: 8px 0;
    background: linear-gradient(135deg, var(--bronze), var(--charcoal-light));
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-family: "Rationale", sans-serif;
    font-weight: bold;
    transition: all 0.3s ease;
}

.menu-btn:hover {
    background: linear-gradient(135deg, var(--gold-soft), var(--bronze));
    transform: translateY(-2px);
}

.close-menu {
    position: absolute;
    top: 10px;
    right: 10px;
    background: none;
    border: none;
    color: var(--gold-soft);
    font-size: 24px;
    cursor: pointer;
}

/* ==== BOTTOM NAVIGATION ==== */
.bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    display: flex;
    justify-content: space-around;
    align-items: center;
    background: linear-gradient(180deg, var(--charcoal-light), var(--charcoal));
    border-top: 1px solid var(--bronze);
    padding: 10px 0;
    z-index: 1000;
    box-shadow: 
        0 -3px 15px rgba(0, 0, 0, 0.8),
        0 -1px 3px rgba(183, 155, 108, 0.15);
    backdrop-filter: blur(8px);
}

.nav-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    flex: 1;
    max-width: 20%;
    padding: 6px 0;
    position: relative;
    overflow: hidden;
}

.nav-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%) scaleX(0);
    width: 40px;
    height: 3px;
    background: linear-gradient(90deg, transparent, var(--gold-soft), transparent);
    border-radius: 0 0 2px 2px;
    transition: transform 0.3s ease;
}

.nav-item img,
.nav-item svg {
    width: 28px;
    height: 28px;
    margin-bottom: 4px;
    filter: drop-shadow(0 2px 3px rgba(0, 0, 0, 0.8));
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.nav-item.center img,
.nav-item.center svg {
    width: 44px;
    height: 44px;
    margin-top: -10px;
    filter: drop-shadow(0 3px 6px rgba(0, 0, 0, 0.9));
}

.nav-item span {
    font-size: 11px;
    color: var(--eggshell);
    text-align: center;
    transition: all 0.3s ease;
    font-weight: 500;
    letter-spacing: 0.3px;
}

.nav-item.active::before {
    transform: translateX(-50%) scaleX(1);
}

.nav-item.active {
    transform: translateY(-4px);
}

.nav-item.active img,
.nav-item.active svg {
    filter: drop-shadow(0 0 8px rgba(183, 155, 108, 0.8));
    transform: scale(1.1);
}

.nav-item.active span {
    color: var(--gold-soft);
    font-weight: 700;
    text-shadow: 0 1px 2px rgba(183, 155, 108, 0.3);
}

/* ==== APP SECTIONS ==== */
.app-section {
    display: none;
    animation: fadeIn 0.3s ease-out;
}

.app-section.active {
    display: block;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* ==== TITLE PANEL ==== */
.title-panel {
    position: relative;
    overflow: hidden;
    margin: 18px auto 24px;
    padding: 24px 16px;
    text-align: center;
    background: #000;
    color: #fff;
    width: min(96%, var(--stage-w));
    border-radius: 8px;
    box-shadow: 
        0 6px 20px var(--shadow-strong),
        0 15px 35px var(--shadow-soft),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
}

.title-panel::before {
    content: "";
    position: absolute;
    inset: 0;
    opacity: 0.8;
    z-index: 0;
    background: linear-gradient(
        115deg,
        #000 0%,
        #111 20%,
        #6b6b6b 46%,
        #d6d6d6 52%,
        #6b6b6b 58%,
        #111 80%,
        #000 100%
    );
    background-size: 400% 400%;
    animation: metallicShine 8s linear infinite;
}

@keyframes metallicShine {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

.title-inner {
    position: relative;
    z-index: 1;
}

.logo img {
    width: 190px;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.9));
    transition: transform 0.3s ease;
}

.logo:hover img {
    transform: scale(1.02);
}

.title-text {
    font-family: "Stardos Stencil", serif;
    font-size: 34px;
    margin: 12px 0 8px;
    text-shadow: 
        0 2px 4px rgba(0, 0, 0, 0.9),
        0 0 15px rgba(255, 255, 255, 0.1);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    letter-spacing: 0.5px;
}

.subtitle {
    font-family: "Rationale", sans-serif;
    font-size: 19px;
    margin-top: 8px;
    color: var(--gold-soft);
    text-shadow: 
        0 1px 2px rgba(0, 0, 0, 0.9),
        0 0 10px rgba(183, 155, 108, 0.2);
    letter-spacing: 0.6px;
    font-weight: 500;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.divider {
    border: none;
    height: 2px;
    width: 88%;
    margin: 14px auto;
    background: linear-gradient(
        to right,
        transparent 0%,
        var(--bronze) 12%,
        var(--gold-soft) 50%,
        var(--bronze) 88%,
        transparent 100%
    );
    clip-path: polygon(0 50%, 3% 0, 97% 0, 100% 50%, 97% 100%, 3% 100%);
    filter: drop-shadow(0 1px 1px rgba(0, 0, 0, 0.7));
}

.sub-subtitle {
    font-size: 15px;
    line-height: 1.5;
    margin-top: 10px;
    color: var(--eggshell);
    text-align: center;
    opacity: 0.9;
    max-width: 90%;
    margin-left: auto;
    margin-right: auto;
}

/* ==== BUTTONS ==== */
.controls {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
    margin: 20px auto 12px;
    width: min(100%, var(--stage-w));
}

.btn {
    position: relative;
    cursor: pointer;
    border: none;
    border-radius: 8px;
    padding: 12px 20px;
    background: linear-gradient(145deg, #444, #0a0a0a);
    color: #fff;
    font: 600 14px "Share", serif;
    text-shadow: 0 2px 3px #000;
    box-shadow: 
        0 5px 15px var(--shadow-strong),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    overflow: hidden;
    isolation: isolate;
    flex: 1 1 auto;
    min-width: 130px;
    border: 1px solid rgba(108, 97, 59, 0.3);
}

.btn:active {
    transform: translateY(2px);
    box-shadow: 
        0 2px 8px var(--shadow-strong),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
}

.btn::after {
    content: "";
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(
        90deg,
        transparent,
        rgba(255, 255, 255, 0.2),
        transparent
    );
    transform: skewX(-20deg);
    transition: left 0.6s ease;
    pointer-events: none;
}

.btn:hover {
    background: linear-gradient(145deg, #5a5a5a, #1a1a1a);
    border-color: var(--bronze);
    transform: translateY(-2px);
    box-shadow: 
        0 8px 25px rgba(0, 0, 0, 0.9),
        0 0 0 1px rgba(183, 155, 108, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.15);
}

.btn:hover::after {
    left: 100%;
}

/* ==== BANNERS ==== */
.banner {
    position: relative;
    cursor: pointer;
    min-height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 10px 32px;
    margin: 20px auto 12px;
    width: min(98%, var(--stage-w));
    font-family: "Stardos Stencil", serif;
    font-size: clamp(15px, 4.2vw, 16px);
    font-weight: 700;
    color: var(--silver-white);
    text-shadow: 
        0 2px 4px rgba(0, 0, 0, 0.9),
        0 0 8px rgba(255, 255, 255, 0.1);
    background: linear-gradient(
        145deg,
        var(--charcoal-light) 0%,
        var(--charcoal) 50%,
        var(--charcoal-light) 100%
    );
    -webkit-clip-path: polygon(
        var(--banner-tip) 0,
        calc(100% - var(--banner-tip)) 0,
        100% 50%,
        calc(100% - var(--banner-tip)) 100%,
        var(--banner-tip) 100%,
        0 50%
    );
    clip-path: polygon(
        var(--banner-tip) 0,
        calc(100% - var(--banner-tip)) 0,
        100% 50%,
        calc(100% - var(--banner-tip)) 100%,
        var(--banner-tip) 100%,
        0 50%
    );
    box-shadow: 
        0 4px 12px var(--shadow-strong),
        0 12px 28px var(--shadow-soft),
        0 0 0 1px rgba(183, 155, 108, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.08);
    border: 1px solid var(--bronze);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.banner::before {
    content: "";
    position: absolute;
    inset: 0;
    opacity: 0;
    pointer-events: none;
    background: linear-gradient(
        120deg,
        rgba(255, 255, 255, 0) 0%,
        rgba(255, 255, 255, 0.15) 50%,
        rgba(255, 255, 255, 0) 100%
    );
    background-size: 300% 300%;
    background-position: 0% 50%;
    transition: opacity 0.4s ease;
}

.banner:hover {
    transform: translateY(-2px);
    box-shadow: 
        0 6px 20px rgba(0, 0, 0, 0.8),
        0 15px 35px rgba(0, 0, 0, 0.5),
        0 0 0 1px rgba(183, 155, 108, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
    border-color: var(--gold-soft);
}

.banner:hover::before {
    opacity: 0.6;
    animation: shimmer 1.8s linear infinite;
}

@keyframes shimmer {
    0% { background-position: -100% 50%; }
    100% { background-position: 200% 50%; }
}

/* ==== PANEL CONTAINERS ==== */
.track-body {
    display: none;
    padding: 0;
    animation: slideDown 0.3s ease-out;
}

.banner.open + .track-body {
    display: block;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* ==== PANEL HEADERS ==== */
.panel {
    margin: 12px 0;
}

.panel-header {
    position: relative;
    cursor: pointer;
    display: flex;
    align-items: center;
    padding: 16px 48px 16px 20px;
    font-family: "Rationale", sans-serif;
    font-weight: 700;
    color: #fff;
    text-shadow: 
        -1px -1px 0 #2a2a2a,
        1px -1px 0 #2a2a2a,
        -1px 1px 0 #2a2a2a,
        1px 1px 0 #2a2a2a,
        0 2px 2px rgba(0, 0, 0, 0.9),
        0 3px 5px rgba(0, 0, 0, 0.8);
    overflow: hidden;
    box-shadow: 
        0 5px 15px var(--shadow-strong),
        0 15px 30px var(--shadow-soft),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
    background: linear-gradient(
        145deg,
        var(--charcoal-light) 0%,
        var(--charcoal) 100%
    );
    border: 1px solid rgba(108, 97, 59, 0.4);
    border-radius: 4px;
    user-select: none;
    transition: all 0.3s ease;
}

.panel-header::before {
    content: "▶";
    position: absolute;
    right: 20px;
    color: var(--gold-soft);
    font-size: 14px;
    transition: transform 0.3s ease;
}

.panel-header.open::before {
    transform: rotate(90deg);
}

.panel-header::after {
    content: "";
    position: absolute;
    inset: 0;
    opacity: 0;
    background: linear-gradient(
        120deg,
        rgba(255, 255, 255, 0) 0%,
        rgba(255, 255, 255, 0.12) 50%,
        rgba(255, 255, 255, 0) 100%
    );
    background-size: 300% 300%;
    background-position: 0% 50%;
    transition: opacity 0.4s ease;
}

.panel-header:hover {
    transform: translateY(-2px);
    box-shadow: 
        0 8px 25px rgba(0, 0, 0, 0.9),
        0 20px 40px rgba(0, 0, 0, 0.6),
        inset 0 1px 0 rgba(255, 255, 255, 0.08);
    border-color: rgba(183, 155, 108, 0.6);
}

.panel-header:hover::after {
    opacity: 0.7;
    animation: shimmer 2s linear infinite;
}

.panel-header * {
    position: relative;
    z-index: 1;
}

/* ==== PANEL BODY & CARDS ==== */
.panel-body {
    display: none;
    padding: 20px;
    background: linear-gradient(180deg, #1a1a1a, #111);
    box-shadow: 
        inset 0 1px 0 rgba(255, 255, 255, 0.06),
        inset 0 -1px 0 rgba(0, 0, 0, 0.8);
    border-radius: 0 0 4px 4px;
    animation: fadeIn 0.4s ease-out;
}

.panel-header.open + .panel-body {
    display: block;
}

/* ==== CARD LAYOUTS ==== */
.class-grid,
.intake-grid {
    display: flex;
    flex-direction: column;
    gap: 18px;
}

.card,
.notes-card {
    background: linear-gradient(
        145deg,
        var(--card-bg-top) 0%,
        var(--card-bg-btm) 100%
    );
    border: 1px solid rgba(45, 45, 45, 0.8);
    padding: 20px;
    margin: 0;
    border-radius: 6px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    width: 100%;
    box-shadow: 
        0 4px 12px rgba(0, 0, 0, 0.4),
        0 1px 2px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.03);
}

.card:hover,
.notes-card:hover {
    transform: translateY(-4px);
    border-color: rgba(183, 155, 108, 0.4);
    box-shadow: 
        0 8px 25px rgba(0, 0, 0, 0.6),
        0 3px 10px rgba(0, 0, 0, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
}

.card.compact {
    padding: 16px 18px;
}

.card.compact p {
    margin: 0.5rem 0;
}

/* ==== TYPOGRAPHY ==== */
.subhead {
    margin: 0 0 14px;
    font-family: "Rationale", sans-serif;
    font-weight: 700;
    color: var(--gold-soft);
    text-shadow: 
        0 2px 4px rgba(0, 0, 0, 0.9),
        0 0 10px rgba(183, 155, 108, 0.2);
    font-size: 17px;
    letter-spacing: 0.5px;
    border-bottom: 1px solid rgba(183, 155, 108, 0.3);
    padding-bottom: 8px;
}

.card p,
.card span,
.checks li span,
.notes-card textarea,
.notes-card .hint {
    color: var(--eggshell);
    text-shadow: 0 2px 3px rgba(0, 0, 0, 0.8);
    line-height: 1.6;
    margin: 10px 0;
    font-size: 15px;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(5px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* ==== CHECKBOXES ==== */
.chk {
    appearance: none;
    width: 32px;
    height: 32px;
    cursor: pointer;
    border: 2px solid var(--gold-soft);
    background: #1a1a1a;
    box-shadow: 
        0 3px 6px rgba(0, 0, 0, 0.8),
        inset 0 1px 0 rgba(255, 255, 255, 0.15);
    display: inline-block;
    vertical-align: middle;
    border-radius: 4px;
    margin: 0;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

.chk:checked {
    background: #1a1a1a url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='28' height='28' viewBox='0 0 28 28'%3E%3Cpath fill='none' stroke='%23ff0000' stroke-width='5.5' d='M6,6 L22,22 M22,6 L6,22'/%3E%3C/svg%3E") no-repeat center center;
    background-size: 22px 22px;
    border: 2px solid var(--red-x);
    box-shadow: 
        0 6px 12px rgba(0, 0, 0, 0.9),
        0 0 8px rgba(255, 0, 0, 0.3);
}

/* ==== NOTES CARD ==== */
.notes-card {
    display: flex;
    flex-direction: column;
    padding: 20px;
    margin-bottom: 25px;
    gap: 16px;
}

.notes-card textarea {
    width: 100%;
    flex-grow: 1;
    min-height: 180px;
    resize: vertical;
    border: 1px solid rgba(58, 58, 58, 0.8);
    padding: 16px;
    background: linear-gradient(180deg, #0f0f0f 0%, #161616 100%);
    color: var(--eggshell);
    font-family: "Share", serif;
    font-size: 15px;
    line-height: 1.6;
    border-radius: 4px;
    box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.5);
    transition: all 0.3s ease;
}

.notes-card textarea:focus {
    outline: none;
    border: 1px solid var(--gold-soft);
    box-shadow: 
        inset 0 2px 8px rgba(0, 0, 0, 0.6),
        0 0 0 2px rgba(183, 155, 108, 0.2);
}

.notes-card .subhead.footer-note {
    font-size: 13px;
    color: var(--gold-soft);
    text-transform: uppercase;
    text-align: left;
    margin: 0;
    letter-spacing: 0.8px;
}

.notes-card .hint {
    font-size: 12px;
    color: var(--gold-soft);
    opacity: 0.8;
    font-style: italic;
    margin: 0;
}

/* ==== CLEAR ALL BUTTON ==== */
.reset-wrap {
    display: flex;
    justify-content: center;
    margin: 25px auto 10px;
    width: min(100%, var(--stage-w));
}

.btn-reset {
    position: relative;
    cursor: pointer;
    border: none;
    border-radius: 8px;
    padding: 14px 24px;
    background: linear-gradient(145deg, #3a0b16, #22060e);
    color: #fff;
    font: 600 15px "Share", serif;
    text-shadow: 0 1px 2px #000;
    box-shadow: 
        0 5px 15px var(--shadow-strong),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    overflow: hidden;
    width: 100%;
    max-width: 320px;
    border: 1px solid rgba(86, 20, 32, 0.6);
}

.btn-reset:active {
    transform: translateY(2px);
}

.btn-reset::after {
    content: "";
    position: absolute;
    top: 0;
    left: -100%;
    width: 60%;
    height: 100%;
    background: linear-gradient(
        90deg,
        transparent,
        rgba(255, 255, 255, 0.3),
        transparent
    );
    transform: skewX(-20deg);
    opacity: 0;
    transition: left 0.5s ease, opacity 0.3s ease;
    pointer-events: none;
}

.btn-reset:hover {
    background: linear-gradient(145deg, #5a1520, #3a0b16);
    transform: translateY(-2px);
    box-shadow: 
        0 8px 25px rgba(0, 0, 0, 0.9),
        0 0 0 1px rgba(255, 0, 0, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.15);
}

.btn-reset:hover::after {
    left: 100%;
    opacity: 1;
}

/* ==== FOOTER ==== */
footer {
    text-align: center;
    padding: 20px 0 25px;
    color: var(--gold-soft);
    font-size: 13px;
    margin-top: 30px;
    border-top: 1px solid rgba(108, 97, 59, 0.3);
}

footer img {
    width: 55px;
    margin-top: 10px;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.8));
    transition: transform 0.3s ease;
}

footer img:hover {
    transform: scale(1.05);
}

/* ==== CARD STYLES (UNIFIED SPACING) ==== */
.card,
.notes-card,
.course-card,
.recommendation-card,
.phase-card,
.drill-card,
.drill-card-modal,
.waivers-card,
.note-item,
.course-overview-item,
.course-detail-item,
.battle-bag-item,
.cartridge-type,
.bang-bag-package,
.instructor-snapshot,
.client-info,
.progress-card,
.legal-card,
.battle-bag-card,
.battle-badge-card {
    margin-bottom: 25px;
    padding: 20px;
    position: relative;
    overflow: hidden;
    background: linear-gradient(145deg, #2a2a2a 0%, #1c1c1c 100%);
    color: var(--eggshell);
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
    border-radius: 6px;
    border: 1px solid rgba(45, 45, 45, 0.8);
    box-shadow: 
        0 4px 12px rgba(0, 0, 0, 0.4),
        0 1px 3px rgba(0, 0, 0, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.03);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Consistent hover effect for all cards */
.card:hover,
.notes-card:hover,
.course-card:hover,
.recommendation-card:hover,
.phase-card:hover,
.drill-card:hover,
.drill-card-modal:hover,
.waivers-card:hover,
.note-item:hover,
.course-overview-item:hover,
.course-detail-item:hover,
.battle-bag-item:hover,
.cartridge-type:hover,
.bang-bag-package:hover,
.instructor-snapshot:hover,
.client-info:hover,
.progress-card:hover,
.legal-card:hover,
.battle-bag-card:hover,
.battle-badge-card:hover {
    transform: translateY(-4px);
    border-color: rgba(183, 155, 108, 0.5);
    box-shadow: 
        0 8px 25px rgba(0, 0, 0, 0.6),
        0 3px 10px rgba(0, 0, 0, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
}

/* Metallic shimmer effect */
.card::before,
.notes-card::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(
        120deg,
        rgba(17, 17, 17, 0.1) 0%,
        rgba(238, 238, 238, 0.4) 25%,
        rgba(255, 255, 255, 0.6) 50%,
        rgba(238, 238, 238, 0.4) 75%,
        rgba(17, 17, 17, 0.1) 100%
    );
    background-size: 300% 300%;
    opacity: 0;
    z-index: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
}

.card:hover::before,
.notes-card:hover::before {
    opacity: 0.25;
    animation: metallicShine 2.5s linear infinite;
}

/* Keep content above shimmer */
.card > *,
.notes-card > * {
    position: relative;
    z-index: 1;
}

@keyframes metallicShine {
    0% { background-position: -100% 50%; }
    100% { background-position: 200% 50%; }
}

/* ==== SUBHEAD STYLES (UNIFIED) ==== */
.subhead {
    margin: 0 0 16px;
    font-family: "Rationale", sans-serif;
    font-weight: 700;
    color: var(--gold-soft);
    text-shadow: 
        0 2px 4px rgba(0, 0, 0, 0.9),
        0 0 10px rgba(183, 155, 108, 0.2);
    font-size: 17px;
    letter-spacing: 0.5px;
    border-bottom: 1px solid rgba(183, 155, 108, 0.3);
    padding-bottom: 10px;
}

/* ==== PANEL HEADER ENGRAVED EFFECT ==== */
.panel .panel-header {
    font-family: "Rationale", sans-serif;
    text-transform: uppercase;
    font-weight: 500;
    font-size: 16px;
    letter-spacing: 1.2px;
    color: var(--gold-soft);
    text-shadow: 
        0 1px 0 #000,
        0 -1px 0 #333,
        1px 1px 3px rgba(0, 0, 0, 0.9),
        -1px -1px 1px rgba(255, 255, 255, 0.15);
    background: linear-gradient(180deg, #2a2a2a 0%, #111 100%);
    padding: 16px 44px 16px 20px;
    margin-bottom: 0;
}

/* ==== COMPACT CARD VARIANT ==== */
.card.compact {
    padding: 16px 18px;
}

.card.compact p {
    margin: 0.5rem 0;
}

/* ==== GRID CONTAINERS (UNIFIED GAPS) ==== */
.class-grid,
.intake-grid,
.course-cards,
.drills-cards-container,
.recommendation-cards,
.drills-grid,
.drill-cards-container {
    gap: 25px;
}

/* ==== LESSON FLOW TABLES ==== */
.lesson-flow-table {
    width: 100%;
    overflow-x: auto;
    margin: 16px 0;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: thin;
    scrollbar-color: #000 #1a1a1a;
}

.lesson-flow-table::-webkit-scrollbar {
    height: 8px;
}

.lesson-flow-table::-webkit-scrollbar-track {
    background: #1a1a1a;
    border-radius: 4px;
}

.lesson-flow-table::-webkit-scrollbar-thumb {
    background: #000;
    border-radius: 4px;
    border: 1px solid #333;
}

.lesson-flow-table table {
    width: 100%;
    border-collapse: collapse;
    min-width: 620px;
    background: linear-gradient(180deg, #1a1a1a, #111);
}

.lesson-flow-table th,
.lesson-flow-table td {
    padding: 12px 16px;
    text-align: left;
    border: 1px solid rgba(51, 51, 51, 0.8);
    font-size: 14px;
}

.lesson-flow-table th {
    background: linear-gradient(180deg, #2a2a2a, #1a1a1a);
    color: var(--gold-soft);
    font-weight: bold;
    font-family: "Rationale", sans-serif;
    font-size: 15px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    position: sticky;
    top: 0;
    z-index: 10;
}

.lesson-flow-table tr:nth-child(even) {
    background: rgba(255, 255, 255, 0.03);
}

.lesson-flow-table tr:hover {
    background: rgba(255, 255, 255, 0.08);
}

/* ==== EXTENDED DRILLS TOGGLE ==== */
.extended-drills-toggle {
    display: flex;
    justify-content: center;
    margin: 20px 0;
}

.extended-drills-toggle button {
    background: linear-gradient(145deg, var(--red-x), #3a0b16);
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 6px;
    cursor: pointer;
    font-family: "Rationale", sans-serif;
    font-weight: bold;
    font-size: 15px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    width: 100%;
    max-width: 320px;
    border: 1px solid rgba(255, 0, 0, 0.3);
    box-shadow: 
        0 4px 12px rgba(0, 0, 0, 0.6),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
}

.extended-drills-toggle button:hover {
    background: linear-gradient(145deg, #ff3333, #4a0f1c);
    transform: translateY(-2px);
    box-shadow: 
        0 6px 20px rgba(0, 0, 0, 0.8),
        0 0 0 1px rgba(255, 0, 0, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.15);
}

.extended-drills-toggle button:active {
    transform: translateY(1px);
}

/* ==== EXTENDED DRILLS WINDOW ==== */
.extended-drills-window {
    display: none;
    background: linear-gradient(180deg, #1a1a1a, #111);
    border: 1px solid rgba(51, 51, 51, 0.8);
    padding: 20px;
    margin: 20px 0;
    border-radius: 6px;
    box-shadow: 
        0 6px 20px rgba(0, 0, 0, 0.6),
        inset 0 1px 0 rgba(255, 255, 255, 0.03);
}

.extended-drills-window.open {
    display: block;
    animation: slideDown 0.3s ease-out;
}

.extended-drills-window .subhead {
    color: var(--red-x);
    margin-bottom: 16px;
    text-shadow: 0 0 8px rgba(255, 0, 0, 0.3);
}

/* ==== CONTENT HIGHLIGHTS ==== */
.cwl-highlight {
    color: var(--red-x);
    font-weight: bold;
    text-shadow: 0 0 5px rgba(255, 0, 0, 0.3);
}

/* ==== FORM INPUTS ==== */
input[type="text"],
input[type="email"],
input[type="tel"],
input[type="date"],
input[type="number"],
textarea,
select {
    background: linear-gradient(180deg, #3a3a3a, #2a2a2a);
    border: 1px solid rgba(85, 85, 85, 0.8);
    color: var(--eggshell);
    padding: 12px 16px;
    border-radius: 4px;
    font-size: 15px;
    font-family: "Share", serif;
    width: 100%;
    transition: all 0.3s ease;
    box-shadow: inset 0 2px 6px rgba(0, 0, 0, 0.4);
}

input[type="text"]:focus,
input[type="email"]:focus,
input[type="tel"]:focus,
input[type="date"]:focus,
input[type="number"]:focus,
textarea:focus,
select:focus {
    outline: none;
    border-color: var(--gold-soft);
    box-shadow: 
        inset 0 2px 6px rgba(0, 0, 0, 0.5),
        0 0 0 2px rgba(183, 155, 108, 0.2);
}

textarea {
    min-height: 120px;
    resize: vertical;
    line-height: 1.6;
}

/* ==== ANIMATIONS ==== */
@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* ==== FORM INPUT CONSISTENCY ==== */
.form-input,
.form-textarea,
.form-select {
    background: linear-gradient(180deg, #3a3a3a, #2a2a2a);
    border: 1px solid rgba(85, 85, 85, 0.8);
    color: var(--eggshell);
    padding: 12px 16px;
    border-radius: 4px;
    font-size: 15px;
    font-family: "Share", serif;
    width: 100%;
    transition: all 0.3s ease;
    box-shadow: inset 0 2px 6px rgba(0, 0, 0, 0.4);
}

.form-input:focus,
.form-textarea:focus,
.form-select:focus {
    outline: none;
    border-color: var(--gold-soft);
    box-shadow: 
        inset 0 2px 6px rgba(0, 0, 0, 0.5),
        0 0 0 2px rgba(183, 155, 108, 0.2);
}

/* ==== COURSES SECTION ==== */
.course-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 25px;
    margin-bottom: 25px;
}

.course-card {
    background: linear-gradient(145deg, #2c2c2c 0%, #1f1f1f 100%);
    border: 1px solid rgba(192, 192, 192, 0.8);
    border-radius: 8px;
    overflow: hidden;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    padding: 0;
    margin: 0;
}

.course-card:hover {
    transform: translateY(-6px);
    border-color: var(--gold-soft);
    box-shadow: 
        0 15px 35px rgba(0, 0, 0, 0.7),
        0 0 0 1px rgba(183, 155, 108, 0.4),
        0 0 30px rgba(183, 155, 108, 0.25);
}

/* ==== COURSE CARD HEADER ==== */
.course-card-header {
    background: linear-gradient(135deg, var(--charcoal), var(--charcoal-light));
    padding: 22px 28px 18px;
    border-bottom: 1px solid rgba(192, 192, 192, 0.8);
    position: relative;
    overflow: hidden;
    margin: 0;
    width: 100%;
}

.course-card-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 20px;
    right: 20px;
    height: 3px;
    background: linear-gradient(90deg, 
        transparent 0%, 
        var(--red-x) 20%, 
        var(--gold-soft) 50%, 
        var(--red-x) 80%, 
        transparent 100%
    );
    opacity: 0.7;
    filter: drop-shadow(0 0 4px rgba(255, 0, 0, 0.3));
}

.course-card-title {
    font-family: "Stardos Stencil", serif;
    font-size: 21px;
    color: var(--red-x);
    margin: 0 0 8px;
    text-shadow: 
        0 2px 4px rgba(0, 0, 0, 0.9),
        0 0 15px rgba(255, 0, 0, 0.25);
    letter-spacing: 0.6px;
    line-height: 1.3;
    padding: 0;
    text-align: center;
}

.course-card-subtitle {
    font-family: "Rationale", sans-serif;
    font-size: 15px;
    color: var(--gold-soft);
    margin: 0;
    text-shadow: 
        0 1px 2px rgba(0, 0, 0, 0.8),
        0 0 10px rgba(183, 155, 108, 0.15);
    font-weight: 500;
    opacity: 0.9;
    padding: 0;
    text-align: center;
}

/* ==== COURSE CARD BODY ==== */
.course-card-body { 
    padding: 22px 28px;
    background: linear-gradient(145deg, #2c2c2c 0%, #1f1f1f 100%);
    margin: 0;
    border: none;
}

.course-features {
    list-style: none;
    padding: 0;
    margin: 0 0 22px 0;
}

.course-features li {
    padding: 10px 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.08);
    display: flex;
    align-items: center;
    color: #f0f0f0;
    font-size: 15px;
    line-height: 1.6;
    position: relative;
    transition: all 0.3s ease;
}

.course-features li:last-child { 
    border-bottom: none; 
}

.course-features li:hover {
    color: white;
    padding-left: 6px;
    border-bottom-color: rgba(255, 255, 255, 0.15);
}

/* Checkmark styling */
.course-features li::before {
    content: "✓";
    color: var(--bronze);
    font-weight: 900;
    margin-right: 14px;
    font-size: 20px;
    min-width: 24px;
    display: inline-block;
    transition: all 0.3s ease;
}

.course-features li:nth-child(odd)::before {
    color: #ffffff;
    text-shadow: 
        0 0 6px rgba(0, 0, 0, 0.8),
        0 1px 0 rgba(255, 255, 255, 0.3);
}

.course-features li:nth-child(even)::before {
    color: #ffffff;
    text-shadow: 
        0 0 8px rgba(255, 255, 255, 0.9),
        0 1px 0 #000,
        0 -1px 0 rgba(0, 0, 0, 0.5);
}

/* Gradient overlay effect */
.course-features li::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(
        to right,
        rgba(0, 0, 0, 0.6) 0%,
        rgba(0, 0, 0, 0.3) 15%,
        rgba(255, 255, 255, 0.1) 30%,
        rgba(255, 255, 255, 0.15) 50%,
        rgba(255, 255, 255, 0.1) 70%,
        rgba(0, 0, 0, 0.3) 85%,
        rgba(0, 0, 0, 0.6) 100%
    );
    opacity: 0.4;
    pointer-events: none;
    z-index: 0;
    transition: opacity 0.3s ease;
}

.course-card:hover .course-features li::after {
    opacity: 0.6;
}

.course-features li > * {
    position: relative;
    z-index: 1;
}

/* ==== COURSE ACTION ROW ==== */
.course-action-row {
    display: flex;
    align-items: center;
    gap: 16px;
    margin-top: 22px;
    padding-top: 18px;
    border-top: 1px solid rgba(192, 192, 192, 0.8);
    position: relative;
}

/* ==== COURSE PROGRESS WHEEL ==== */
.course-progress-wrapper {
    position: relative;
    width: 55px;
    height: 55px;
    flex-shrink: 0;
    order: 1;
    pointer-events: none;
}

.course-progress-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1;
    pointer-events: none;
}

/* 3D Tactical Progress Wheel */
.course-card .tactical-progress-wheel {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background: radial-gradient(
        circle at 30% 30%,
        #455831 0%,
        #3a4a2a 15%,
        #2c3a1f 40%,
        #1e2615 70%,
        #0a0a0a 100%
    );
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    border: 3px solid;
    border-color: #1a1a1a #000 #000 #1a1a1a;
    box-shadow: 
        inset 2px 2px 6px rgba(0, 0, 0, 0.8),
        inset -2px -2px 6px rgba(255, 255, 255, 0.05),
        3px 3px 9px rgba(0, 0, 0, 0.7),
        -1px -1px 4px rgba(255, 255, 255, 0.03),
        0 0 0 1px #333,
        0 0 18px rgba(255, 0, 0, calc(var(--progress, 0) / 200));
    pointer-events: none;
}

/* Center Cap */
.course-card .tactical-progress-wheel::before {
    content: '';
    position: absolute;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: radial-gradient(
        circle at 30% 30%,
        #8a8a8a 0%,
        #6b6b6b 25%,
        #4a4a4a 50%,
        #2a2a2a 75%,
        #1a1a1a 100%
    );
    z-index: 1;
    border: 2px solid;
    border-color: #555 #222 #222 #555;
    box-shadow: 
        inset -1px -1px 4px rgba(255, 255, 255, 0.15),
        inset 1px 1px 4px rgba(0, 0, 0, 0.8),
        0 0 0 1px #333,
        0 1px 3px rgba(0, 0, 0, 0.6),
        0 0 10px rgba(255, 0, 0, 0.2);
    pointer-events: none;
}

/* Red Ribbon */
.course-card .tactical-progress-wheel::after {
    content: '';
    position: absolute;
    top: -3px;
    left: -3px;
    right: -3px;
    bottom: -3px;
    border-radius: 50%;
    background: conic-gradient(
        var(--red-x) 0deg, 
        var(--red-x) var(--progress, 0deg), 
        transparent var(--progress, 0deg), 
        transparent 360deg
    );
    -webkit-mask: radial-gradient(
        circle,
        transparent 55%,
        black 56%,
        black 82%,
        transparent 83%
    );
    mask: radial-gradient(
        circle,
        transparent 55%,
        black 56%,
        black 82%,
        transparent 83%
    );
    z-index: 0;
    box-shadow: 
        inset 0 0 0 1px rgba(0, 0, 0, 0.9),
        0 0 0 1px rgba(0, 0, 0, 0.9),
        inset 0 1px 0 rgba(255, 255, 255, 0.15),
        inset 0 -1px 0 rgba(0, 0, 0, 0.8);
    filter: drop-shadow(0 0 2px rgba(255, 0, 0, 0.3))
            drop-shadow(0 0 4px rgba(255, 0, 0, calc(var(--progress, 0) / 100)));
    pointer-events: none;
    transition: filter 0.5s ease;
}

/* Percentage Text */
.course-card .tactical-progress-percentage {
    position: relative;
    z-index: 2;
    font-family: "Rationale", sans-serif;
    font-size: 13px;
    font-weight: bold;
    color: #ffffff;
    text-shadow: 
        1px 1px 0 #000,
        2px 2px 2px rgba(0, 0, 0, 0.7),
        -1px -1px 0 rgba(255, 255, 255, 0.2),
        0 0 10px rgba(255, 0, 0, calc(var(--progress, 0) / 50)),
        0 0 18px rgba(255, 0, 0, calc(var(--progress, 0) / 100));
    letter-spacing: 0.5px;
    pointer-events: none;
}

/* ==== COURSE BUTTON ==== */
.course-card .open-course-modal {
    flex: 1;
    position: relative;
    z-index: 10;
    cursor: pointer;
    pointer-events: auto;
    background: #000;
    border: 1px solid rgba(192, 192, 192, 0.8);
    color: #fff;
    font-family: "Rationale", sans-serif;
    font-weight: bold;
    text-transform: uppercase;
    letter-spacing: 1px;
    padding: 12px 20px;
    border-radius: 6px;
    font-size: 14px;
    min-height: 44px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 
        0 4px 12px rgba(0, 0, 0, 0.5),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
}

.course-card .open-course-modal:hover {
    background: #111;
    border-color: var(--red-x);
    color: var(--red-x);
    transform: translateY(-2px);
    box-shadow: 
        0 6px 20px rgba(0, 0, 0, 0.6),
        0 0 0 1px rgba(255, 0, 0, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.15);
}

/* ==== RESPONSIVE ==== */
@media (max-width: 768px) {
    .course-cards {
        grid-template-columns: 1fr;
        gap: 20px;
    }
    
    .course-card-header {
        padding: 20px 24px 16px;
    }
    
    .course-card-body {
        padding: 20px 24px;
    }
    
    .course-action-row {
        flex-direction: column;
        gap: 16px;
    }
    
    .course-progress-wrapper {
        margin: 0 auto;
    }
    
    .course-card-title {
        font-size: 20px;
    }
    
    .course-card-subtitle {
        font-size: 14px;
    }
}

/* ==== ANIMATIONS ==== */
.course-card .tactical-progress-wheel[style*="--progress"]:not([style*="--progress: 0deg"])::after {
    animation: ribbon-glow 2s infinite;
}

@keyframes ribbon-glow {
    0%, 100% { 
        filter: drop-shadow(0 0 2px rgba(255, 0, 0, 0.3))
                drop-shadow(0 0 4px rgba(255, 0, 0, 0.2));
    }
    50% { 
        filter: drop-shadow(0 0 4px rgba(255, 0, 0, 0.6))
                drop-shadow(0 0 8px rgba(255, 0, 0, 0.4));
    }
}

/* ==== BUTTON STYLES ==== */
.course-card .open-course-modal {
    flex: 1;
    position: relative;
    z-index: 10;
    cursor: pointer;
    pointer-events: auto;
    background: #000;
    border: 1px solid rgba(192, 192, 192, 0.8);
    color: #fff;
    font-family: "Rationale", sans-serif;
    font-weight: bold;
    text-transform: uppercase;
    letter-spacing: 1px;
    padding: 12px 20px;
    border-radius: 6px;
    font-size: 14px;
    min-height: 44px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 
        0 4px 12px rgba(0, 0, 0, 0.5),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
}

.course-card .open-course-modal:hover {
    background: #111;
    border-color: var(--red-x);
    color: var(--red-x);
    transform: translateY(-2px);
    box-shadow: 
        0 6px 20px rgba(0, 0, 0, 0.6),
        0 0 0 1px rgba(255, 0, 0, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.15);
}

/* ==== RESPONSIVE DESIGN ==== */
@media (max-width: 768px) {
    .course-cards {
        grid-template-columns: 1fr;
        gap: 20px;
    }
    
    .course-card-header {
        padding: 20px 24px 16px;
    }
    
    .course-card-body {
        padding: 20px 24px;
    }
    
    .course-action-row {
        flex-direction: column;
        gap: 16px;
    }
    
    .course-progress-wrapper {
        width: 55px;
        height: 55px;
        margin: 0 auto;
    }
    
    .course-card .tactical-progress-percentage {
        font-size: 13px;
    }
}

@media (max-width: 480px) {
    .course-card-header {
        padding: 18px 20px 14px;
    }
    
    .course-card-body {
        padding: 18px 20px;
    }
    
    .course-card-title {
        font-size: 19px;
    }
    
    .course-card-subtitle {
        font-size: 14px;
    }
}

/* ==== METALLIC SHIMMER EFFECTS ==== */
.course-card-header::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(120deg, 
        rgba(17, 17, 17, 0.1) 0%,
        rgba(238, 238, 238, 0.4) 25%,
        rgba(255, 255, 255, 0.6) 50%,
        rgba(238, 238, 238, 0.4) 75%,
        rgba(17, 17, 17, 0.1) 100%
    );
    background-size: 300% 300%;
    opacity: 0;
    z-index: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
}

.course-card:hover .course-card-header::before {
    opacity: 0.25;
    animation: metallicShine 2.5s linear infinite;
}

.course-card-header > * {
    position: relative;
    z-index: 1;
}

.course-features li:nth-child(even) {
    position: relative;
    overflow: hidden;
}

.course-features li:nth-child(even)::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(120deg, 
        rgba(17, 17, 17, 0.1) 0%,
        rgba(238, 238, 238, 0.3) 25%,
        rgba(255, 255, 255, 0.5) 50%,
        rgba(238, 238, 238, 0.3) 75%,
        rgba(17, 17, 17, 0.1) 100%
    );
    background-size: 300% 300%;
    opacity: 0;
    z-index: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
}

.course-card:hover .course-features li:nth-child(even)::before {
    opacity: 0.2;
    animation: metallicShine 2.5s linear infinite;
}

.course-features li:nth-child(even) > * {
    position: relative;
    z-index: 1;
}

@keyframes metallicShine {
    0% { background-position: -100% 50%; }
    100% { background-position: 200% 50%; }
}

/* ==== LAYOUT GRIDS ==== */
@media (min-width: 768px) {
    .intake-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }
    
    .card.q1,
    .card.q8,
    .notes-card {
        grid-column: 1 / -1;
        background: rgba(25, 25, 25, 0.85);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 
            0 8px 25px rgba(0, 0, 0, 0.5),
            0 4px 15px rgba(0, 0, 0, 0.4),
            inset 0 1px 0 rgba(255, 255, 255, 0.05);
    }
    
    .two-col {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 16px;
    }
}

/* ==== SMALL SCREEN OPTIMIZATIONS ==== */
@media (max-width: 360px) {
    .title-text {
        font-size: 28px;
    }
    
    .subtitle {
        font-size: 16px;
    }
    
    .btn {
        min-width: 110px;
        font-size: 13px;
        padding: 10px 14px;
    }
    
    .banner {
        font-size: 14px;
        min-height: 30px;
        padding: 8px 20px;
    }
}

/* ==== NOTIFICATION MESSAGES ==== */
#clear-message {
    display: none;
    position: fixed;
    bottom: 25px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0, 0, 0, 0.9);
    color: #fff;
    padding: 12px 24px;
    border-radius: 6px;
    font-family: 'Share', serif;
    font-size: 14px;
    box-shadow: 
        0 6px 20px rgba(0, 0, 0, 0.8),
        0 0 0 1px rgba(183, 155, 108, 0.3);
    z-index: 1000;
    opacity: 0;
    transition: opacity 0.3s ease;
    backdrop-filter: blur(8px);
    border: 1px solid rgba(108, 97, 59, 0.4);
}

/* ==== PROGRESS CARDS ==== */
.progress-card {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    padding: 22px;
    margin-bottom: 25px;
}

.progress-wheel-container {
    position: relative;
    width: 120px;
    height: 120px;
    margin: 18px 0;
}

.progress-wheel {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background: conic-gradient(
        var(--red-x) 0deg, 
        var(--red-x) var(--progress, 0deg), 
        var(--charcoal-lighter) var(--progress, 0deg), 
        var(--charcoal-lighter) 360deg
    );
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    box-shadow: 
        0 6px 20px rgba(0, 0, 0, 0.7),
        inset 0 2px 4px rgba(0, 0, 0, 0.5);
}

.progress-wheel::before {
    content: '';
    position: absolute;
    width: 90px;
    height: 90px;
    background: linear-gradient(180deg, var(--card-bg-top), var(--card-bg-btm));
    border-radius: 50%;
    z-index: 1;
    box-shadow: inset 0 2px 6px rgba(0, 0, 0, 0.6);
}

.progress-percentage {
    position: relative;
    z-index: 2;
    font-family: "Rationale", sans-serif;
    font-size: 24px;
    font-weight: bold;
    color: var(--eggshell);
    text-shadow: 
        0 2px 4px rgba(0, 0, 0, 0.9),
        0 0 10px rgba(255, 0, 0, 0.3);
}

.progress-title {
    font-family: "Rationale", sans-serif;
    font-weight: 700;
    color: var(--gold-soft);
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.9);
    font-size: 18px;
    margin-bottom: 12px;
}

.progress-text {
    color: var(--eggshell);
    text-shadow: 0 2px 3px rgba(0, 0, 0, 0.8);
    line-height: 1.6;
    margin: 10px 0;
    font-size: 14px;
}

.progress-note {
    color: var(--gold-soft);
    font-size: 13px;
    margin-top: 12px;
    font-style: italic;
    opacity: 0.9;
}

/* ==== GRADING SYSTEM ==== */
.grading-toggle {
    display: flex;
    justify-content: center;
    margin: 20px 0;
}

.grading-toggle button {
    background: linear-gradient(145deg, var(--bronze), var(--charcoal-light));
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 6px;
    cursor: pointer;
    font-family: "Rationale", sans-serif;
    font-weight: bold;
    font-size: 15px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    width: 100%;
    max-width: 320px;
    border: 1px solid rgba(108, 97, 59, 0.5);
    box-shadow: 
        0 4px 12px rgba(0, 0, 0, 0.6),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
}

.grading-toggle button:hover {
    background: linear-gradient(145deg, var(--gold-soft), var(--bronze));
    transform: translateY(-2px);
    box-shadow: 
        0 6px 20px rgba(0, 0, 0, 0.8),
        0 0 0 1px rgba(183, 155, 108, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.15);
}

.grading-window {
    display: none;
    background: linear-gradient(180deg, #1a1a1a, #111);
    border: 1px solid rgba(108, 97, 59, 0.6);
    padding: 22px;
    margin: 20px 0;
    border-radius: 6px;
    box-shadow: 
        0 6px 20px rgba(0, 0, 0, 0.7),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
}

.grading-window.open {
    display: block;
    animation: slideDown 0.3s ease-out;
}

.grading-window .subhead {
    color: var(--gold-soft);
    margin-bottom: 18px;
    text-align: center;
    text-shadow: 0 0 8px rgba(183, 155, 108, 0.3);
}

/* ==== SKILLS LIST ==== */
.skills-list {
    margin-bottom: 22px;
}

.skill-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 0;
    border-bottom: 1px solid rgba(51, 51, 51, 0.8);
}

.skill-item:last-child {
    border-bottom: none;
}

.skill-name {
    flex: 1;
    color: var(--eggshell);
    font-size: 15px;
    font-weight: 500;
}

.rating-buttons {
    display: flex;
    gap: 10px;
}

.rating-btn {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    border: 2px solid rgba(108, 97, 59, 0.8);
    background: #1a1a1a;
    color: var(--eggshell);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 13px;
    font-weight: bold;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 
        0 3px 8px rgba(0, 0, 0, 0.6),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
}

.rating-btn:hover {
    background: var(--bronze);
    transform: scale(1.1);
    box-shadow: 
        0 4px 12px rgba(108, 97, 59, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.15);
}

.rating-btn.selected {
    background: var(--red-x);
    border-color: var(--red-x);
    color: white;
    transform: scale(1.1);
    box-shadow: 
        0 0 15px rgba(255, 0, 0, 0.6),
        0 4px 12px rgba(0, 0, 0, 0.6);
}

/* ==== GRADING ACTIONS ==== */
.grading-actions {
    display: flex;
    justify-content: space-between;
    margin-top: 22px;
    gap: 12px;
}

.grading-actions button {
    flex: 1;
    padding: 12px 18px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-family: "Rationale", sans-serif;
    font-weight: bold;
    font-size: 14px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    text-transform: uppercase;
    letter-spacing: 0.8px;
}

.btn-close {
    background: linear-gradient(145deg, #444, #111);
    color: #fff;
    border: 1px solid rgba(192, 192, 192, 0.3);
}

.btn-save {
    background: linear-gradient(145deg, var(--bronze), var(--charcoal-light));
    color: white;
    border: 1px solid rgba(108, 97, 59, 0.5);
}

.btn-email {
    background: linear-gradient(145deg, var(--red-x), #3a0b16);
    color: white;
    border: 1px solid rgba(255, 0, 0, 0.4);
}

.btn-close:hover,
.btn-save:hover,
.btn-email:hover {
    transform: translateY(-2px);
    box-shadow: 
        0 6px 20px rgba(0, 0, 0, 0.7),
        0 0 0 1px rgba(255, 255, 255, 0.1);
}

.btn-close:hover {
    border-color: rgba(192, 192, 192, 0.6);
}

.btn-save:hover {
    border-color: rgba(183, 155, 108, 0.6);
}

.btn-email:hover {
    border-color: rgba(255, 0, 0, 0.7);
}

/* ==== DRILLS CONTENT ==== */
.drills-content {
    margin: 25px 0;
    padding: 22px;
    background: linear-gradient(145deg, #1a1a1a, #111);
    border: 1px solid rgba(51, 51, 51, 0.8);
    border-radius: 6px;
    box-shadow: 
        0 4px 12px rgba(0, 0, 0, 0.5),
        inset 0 1px 0 rgba(255, 255, 255, 0.03);
}

.drills-content .subhead {
    color: var(--gold-soft);
    margin-bottom: 18px;
    text-shadow: 0 0 8px rgba(183, 155, 108, 0.2);
}

/* ==== FULL COURSE WINDOW ==== */
.full-course-toggle {
    display: flex;
    justify-content: center;
    margin: 25px 0;
}

.full-course-toggle button {
    background: linear-gradient(145deg, var(--bronze), var(--charcoal-light));
    color: white;
    border: none;
    padding: 14px 28px;
    border-radius: 6px;
    cursor: pointer;
    font-family: "Rationale", sans-serif;
    font-weight: bold;
    font-size: 15px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    width: 100%;
    max-width: 340px;
    border: 1px solid rgba(108, 97, 59, 0.5);
    box-shadow: 
        0 4px 12px rgba(0, 0, 0, 0.6),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
}

.full-course-toggle button:hover {
    background: linear-gradient(145deg, var(--gold-soft), var(--bronze));
    transform: translateY(-3px);
    box-shadow: 
        0 8px 24px rgba(0, 0, 0, 0.8),
        0 0 0 1px rgba(183, 155, 108, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.15);
}

.full-course-toggle button:active {
    transform: translateY(1px);
}

.full-course-window {
    display: none;
    background: linear-gradient(145deg, #1a1a1a, #111);
    border: 1px solid rgba(108, 97, 59, 0.6);
    padding: 24px;
    margin: 25px 0;
    border-radius: 6px;
    box-shadow: 
        0 8px 28px rgba(0, 0, 0, 0.7),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
    max-height: 75vh;
    overflow-y: auto;
    animation: slideDown 0.4s ease-out;
}

.full-course-window.open {
    display: block;
}

.full-course-window .subhead {
    color: var(--eggshell);
    margin-bottom: 20px;
    text-align: center;
    font-size: 18px;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.9);
}

.full-course-window .lesson-flow-table {
    margin: 22px 0;
}

/* ==== GEAR CHECKLIST ==== */
.gear-checklist {
    margin: 25px 0;
}

.gear-checklist .subhead {
    color: var(--red-x);
    margin-bottom: 18px;
    text-shadow: 0 0 10px rgba(255, 0, 0, 0.3);
}

.gear-checklist ul {
    list-style: none;
    padding: 0;
    margin: 0 0 22px 0;
}

.gear-checklist li {
    padding: 10px 0;
    border-bottom: 1px solid rgba(40, 40, 40, 0.8);
    display: flex;
    align-items: center;
    color: var(--eggshell);
    gap: 14px;
    font-size: 15px;
    transition: all 0.3s ease;
    position: relative;
}

.gear-checklist li:hover {
    color: #fff;
    padding-left: 6px;
    border-bottom-color: rgba(255, 255, 255, 0.1);
}

.gear-checklist li:last-child {
    border-bottom: none;
}

.gear-checklist li::before {
    content: "✓";
    color: var(--bronze);
    font-weight: 900;
    margin-right: 12px;
    font-size: 16px;
    min-width: 24px;
    text-shadow: 0 0 6px rgba(108, 97, 59, 0.5);
    transition: all 0.3s ease;
}

.gear-checklist li:hover::before {
    color: var(--gold-soft);
    transform: scale(1.1);
}

/* ==== COURSE OVERVIEW ==== */
.course-overview {
    margin: 25px 0;
}

.course-overview .subhead {
    color: var(--gold-soft);
    margin-bottom: 20px;
    text-shadow: 0 0 10px rgba(183, 155, 108, 0.2);
}

.course-overview-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 20px;
    margin-bottom: 25px;
}

.course-overview-item {
    background: linear-gradient(145deg, #2a2a2a, #1c1c1c);
    border: 1px solid rgba(45, 45, 45, 0.8);
    padding: 20px;
    border-radius: 6px;
    text-align: center;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 
        0 4px 12px rgba(0, 0, 0, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.03);
}

.course-overview-item:hover {
    transform: translateY(-4px);
    border-color: rgba(183, 155, 108, 0.5);
    box-shadow: 
        0 8px 24px rgba(0, 0, 0, 0.6),
        0 0 0 1px rgba(183, 155, 108, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
}

.course-overview-item .label {
    font-size: 14px;
    color: var(--gold-soft);
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    font-weight: 500;
}

.course-overview-item .value {
    font-size: 20px;
    font-weight: bold;
    color: var(--eggshell);
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
}

/* ==== INSTRUCTOR SNAPSHOT ==== */
.instructor-snapshot {
    background: linear-gradient(145deg, #2a2a2a, #1c1c1c);
    border: 1px solid rgba(45, 45, 45, 0.8);
    padding: 24px;
    margin: 25px auto;
    border-radius: 6px;
    max-width: 640px;
    box-shadow: 
        0 6px 20px rgba(0, 0, 0, 0.6),
        inset 0 1px 0 rgba(255, 255, 255, 0.03);
}

.instructor-snapshot .subhead {
    color: var(--gold-soft);
    margin-bottom: 20px;
    text-align: center;
    text-shadow: 0 0 10px rgba(183, 155, 108, 0.2);
}

.instructor-details {
    display: flex;
    flex-direction: column;
    gap: 14px;
}

.instructor-detail {
    display: flex;
    align-items: center;
    color: var(--eggshell);
    font-size: 15px;
    padding: 6px 0;
    position: relative;
}

.instructor-detail::before {
    content: "✓";
    color: var(--bronze);
    font-weight: 900;
    margin-right: 14px;
    font-size: 16px;
    min-width: 24px;
    text-shadow: 0 0 6px rgba(108, 97, 59, 0.5);
}

/* ==== PRINT BUTTON ==== */
.print-btn {
    background: linear-gradient(145deg, var(--bronze), var(--charcoal-light));
    color: white;
    border: none;
    padding: 14px 28px;
    border-radius: 6px;
    cursor: pointer;
    font-family: "Rationale", sans-serif;
    font-weight: bold;
    font-size: 15px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    margin: 25px auto;
    display: block;
    width: 100%;
    max-width: 340px;
    border: 1px solid rgba(108, 97, 59, 0.5);
    box-shadow: 
        0 4px 12px rgba(0, 0, 0, 0.6),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
    text-transform: uppercase;
    letter-spacing: 1px;
}

.print-btn:hover {
    background: linear-gradient(145deg, var(--gold-soft), var(--bronze));
    transform: translateY(-3px);
    box-shadow: 
        0 8px 24px rgba(0, 0, 0, 0.8),
        0 0 0 1px rgba(183, 155, 108, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.15);
}

.print-btn:active {
    transform: translateY(1px);
}

/* ==== ANIMATIONS ==== */
@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-15px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* ==== RESPONSIVE DESIGN ==== */
@media (max-width: 768px) {
    .drills-content {
        padding: 20px;
        margin: 20px 0;
    }
    
    .full-course-window {
        padding: 20px;
        margin: 20px 0;
    }
    
    .course-overview-grid {
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 16px;
    }
    
    .course-overview-item {
        padding: 18px;
    }
    
    .instructor-snapshot {
        padding: 20px;
        margin: 20px 16px;
    }
    
    .full-course-toggle button,
    .print-btn {
        max-width: 300px;
        padding: 12px 24px;
    }
}

@media (max-width: 480px) {
    .course-overview-grid {
        grid-template-columns: 1fr;
        gap: 14px;
    }
    
    .instructor-detail {
        font-size: 14px;
    }
    
    .full-course-window .subhead {
        font-size: 16px;
    }
}

/* ==== PROGRESS BARS ==== */
.progress-bar-container {
    margin: 20px 0;
}

.progress-label {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
    font-family: "Rationale", sans-serif;
    font-size: 15px;
    color: var(--eggshell);
}

.progress-percent {
    font-weight: bold;
    color: var(--gold-soft);
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.7);
}

.progress-bar {
    width: 100%;
    height: 22px;
    background: rgba(40, 40, 40, 0.9);
    border-radius: 12px;
    overflow: hidden;
    position: relative;
    border: 1px solid rgba(108, 97, 59, 0.4);
    box-shadow: 
        inset 0 2px 8px rgba(0, 0, 0, 0.6),
        0 2px 4px rgba(0, 0, 0, 0.4);
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--red-x), #ff3333);
    border-radius: 12px;
    transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 
        inset 0 1px 0 rgba(255, 255, 255, 0.2),
        inset 0 -1px 0 rgba(0, 0, 0, 0.5),
        0 0 15px rgba(255, 0, 0, 0.3);
    position: relative;
    overflow: hidden;
}

.progress-fill::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(
        90deg,
        transparent,
        rgba(255, 255, 255, 0.2),
        transparent
    );
    animation: progressShine 2s infinite;
}

@keyframes progressShine {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}

/* ==== DRILLS CHECKLIST ==== */
.drills-checklist {
    margin: 25px 0;
}

.drills-checklist .subhead {
    color: var(--red-x);
    margin-bottom: 18px;
    text-shadow: 0 0 10px rgba(255, 0, 0, 0.3);
}

.drills-checklist ul {
    list-style: none;
    padding: 0;
    margin: 0 0 22px 0;
}

.drills-checklist li {
    padding: 12px 0;
    border-bottom: 1px solid rgba(40, 40, 40, 0.8);
    display: flex;
    align-items: center;
    color: var(--eggshell);
    gap: 16px;
    font-size: 15px;
    transition: all 0.3s ease;
    position: relative;
}

.drills-checklist li:hover {
    color: #fff;
    padding-left: 8px;
    border-bottom-color: rgba(255, 255, 255, 0.1);
}

.drills-checklist li:last-child {
    border-bottom: none;
}

/* ==== NOTES SECTION ==== */
.notes-section {
    margin: 25px 0;
}

.notes-section .subhead {
    color: var(--gold-soft);
    margin-bottom: 20px;
    text-shadow: 0 0 10px rgba(183, 155, 108, 0.2);
}

.notes-list {
    margin-bottom: 25px;
}

.note-item {
    background: linear-gradient(145deg, #2a2a2a, #1c1c1c);
    border: 1px solid rgba(45, 45, 45, 0.8);
    padding: 20px;
    margin-bottom: 18px;
    border-radius: 6px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 
        0 4px 12px rgba(0, 0, 0, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.03);
}

.note-item:hover {
    transform: translateY(-3px);
    border-color: rgba(183, 155, 108, 0.5);
    box-shadow: 
        0 8px 24px rgba(0, 0, 0, 0.6),
        0 0 0 1px rgba(183, 155, 108, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
}

.note-date {
    font-size: 13px;
    color: var(--gold-soft);
    margin-bottom: 12px;
    font-weight: 500;
    letter-spacing: 0.5px;
}

.note-content {
    color: var(--eggshell);
    line-height: 1.6;
    font-size: 15px;
}

/* ==== CLIENT INFO ==== */
.client-info {
    margin: 25px 0;
    padding: 22px;
    background: linear-gradient(145deg, #2a2a2a, #1c1c1c);
    border: 1px solid rgba(45, 45, 45, 0.8);
    border-radius: 6px;
    box-shadow: 
        0 4px 12px rgba(0, 0, 0, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.03);
}

.client-info .subhead {
    color: var(--gold-soft);
    margin-bottom: 20px;
    text-shadow: 0 0 10px rgba(183, 155, 108, 0.2);
}

.client-info-form {
    display: grid;
    grid-template-columns: 1fr;
    gap: 18px;
}

@media (min-width: 768px) {
    .client-info-form {
        grid-template-columns: 1fr 1fr;
    }
}

.form-group {
    display: flex;
    flex-direction: column;
}

.form-group label {
    margin-bottom: 8px;
    color: var(--eggshell);
    font-size: 14px;
    font-weight: 500;
    letter-spacing: 0.3px;
}

.form-group input {
    padding: 14px 16px;
    border: 1px solid rgba(85, 85, 85, 0.8);
    border-radius: 6px;
    background: linear-gradient(180deg, #3a3a3a, #2a2a2a);
    color: var(--eggshell);
    font-family: "Share", serif;
    font-size: 15px;
    transition: all 0.3s ease;
    box-shadow: inset 0 2px 6px rgba(0, 0, 0, 0.4);
}

.form-group input:focus {
    outline: none;
    border-color: var(--gold-soft);
    box-shadow: 
        inset 0 2px 6px rgba(0, 0, 0, 0.5),
        0 0 0 2px rgba(183, 155, 108, 0.2);
}

/* ==== SAVE NOTES BUTTON ==== */
.save-notes-btn {
    background: linear-gradient(145deg, var(--bronze), var(--charcoal-light));
    color: white;
    border: none;
    padding: 14px 28px;
    border-radius: 6px;
    cursor: pointer;
    font-family: "Rationale", sans-serif;
    font-weight: bold;
    font-size: 15px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    margin: 15px 0;
    width: 100%;
    max-width: 240px;
    border: 1px solid rgba(108, 97, 59, 0.5);
    box-shadow: 
        0 4px 12px rgba(0, 0, 0, 0.6),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
    text-transform: uppercase;
    letter-spacing: 1px;
}

.save-notes-btn:hover {
    background: linear-gradient(145deg, var(--gold-soft), var(--bronze));
    transform: translateY(-3px);
    box-shadow: 
        0 8px 24px rgba(0, 0, 0, 0.8),
        0 0 0 1px rgba(183, 155, 108, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.15);
}

.save-notes-btn:active {
    transform: translateY(1px);
}

/* ==== COURSE DETAILS COMPACT ==== */
.course-details-compact {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 14px;
    margin-bottom: 20px;
}

.course-detail-item {
    background: linear-gradient(145deg, #2a2a2a, #1c1c1c);
    border: 1px solid rgba(45, 45, 45, 0.8);
    padding: 16px;
    border-radius: 6px;
    text-align: center;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 
        0 4px 12px rgba(0, 0, 0, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.03);
}

.course-detail-item:hover {
    transform: translateY(-3px);
    border-color: rgba(183, 155, 108, 0.5);
    box-shadow: 
        0 8px 20px rgba(0, 0, 0, 0.6),
        0 0 0 1px rgba(183, 155, 108, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
}

.course-detail-label {
    font-size: 13px;
    color: var(--gold-soft);
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    font-weight: 500;
}

.course-detail-value {
    font-size: 16px;
    font-weight: bold;
    color: var(--eggshell);
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
}

/* ==== COURSE SELECTION MODAL ==== */
.course-selection-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.92);
    backdrop-filter: blur(15px);
    z-index: 1003;
    justify-content: center;
    align-items: center;
    animation: modalFade 0.4s ease-out;
}

@keyframes modalFade {
    from { opacity: 0; }
    to { opacity: 1; }
}

.course-selection-content {
    background: linear-gradient(145deg, var(--charcoal-light), var(--charcoal));
    border: 1px solid rgba(108, 97, 59, 0.8);
    border-radius: 8px;
    padding: 24px;
    width: 85%;
    max-width: 320px;
    box-shadow: 
        0 20px 50px rgba(0, 0, 0, 0.9),
        0 0 0 1px rgba(183, 155, 108, 0.3);
}

.course-selection-content h3 {
    font-family: "Stardos Stencil", serif;
    color: var(--gold-soft);
    text-align: center;
    margin-top: 0;
    margin-bottom: 20px;
    font-size: 20px;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.9);
}

.course-option {
    display: block;
    width: 100%;
    padding: 14px 20px;
    margin: 10px 0;
    background: linear-gradient(145deg, var(--bronze), var(--charcoal-light));
    color: white;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-family: "Rationale", sans-serif;
    font-weight: bold;
    font-size: 15px;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    text-align: center;
    border: 1px solid rgba(108, 97, 59, 0.5);
    box-shadow: 
        0 4px 12px rgba(0, 0, 0, 0.6),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
}

.course-option:hover {
    background: linear-gradient(145deg, var(--gold-soft), var(--bronze));
    transform: translateY(-3px);
    box-shadow: 
        0 8px 24px rgba(0, 0, 0, 0.8),
        0 0 0 1px rgba(183, 155, 108, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.15);
}

.close-course-selection {
    position: absolute;
    top: 12px;
    right: 12px;
    background: none;
    border: none;
    color: var(--gold-soft);
    font-size: 28px;
    cursor: pointer;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: all 0.3s ease;
}

.close-course-selection:hover {
    color: var(--red-x);
    background: rgba(255, 255, 255, 0.1);
    transform: scale(1.1);
}

/* ===== COURSE MODAL STYLES ===== */
.course-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.85);
    z-index: 1004;
    justify-content: center;
    align-items: center;
    overflow-y: auto;
}

.course-modal-content {
    background: linear-gradient(180deg, var(--charcoal-light), var(--charcoal));
    border: 1px solid var(--bronze);
    border-radius: 8px;
    padding: 20px;
    width: 90%;
    max-width: 800px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 5px 15px rgba(0,0,0,0.7);
    position: relative;
}

.close-course-modal {
    position: absolute;
    top: 10px;
    right: 10px;
    background: none;
    border: none;
    color: var(--gold-soft);
    font-size: 24px;
    cursor: pointer;
    z-index: 1005;
}

.course-modal-actions {
    display: flex;
    justify-content: space-between;
    margin-top: 20px;
    gap: 10px;
}

.course-modal-actions button {
    flex: 1;
    padding: 12px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-family: "Rationale", sans-serif;
    font-weight: bold;
    transition: all 0.3s ease;
}

.btn-save-progress {
    background: linear-gradient(135deg, var(--bronze), var(--charcoal-light));
    color: white;
}

.btn-save-progress:hover {
    background: linear-gradient(135deg, var(--gold-soft), var(--bronze));
    transform: translateY(-2px);
}

/* ===== COURSE TITLE CONTAINER (MODAL SPECIFIC) ==== */
.course-title-container {
    background: linear-gradient(145deg, #2a2a2a 0%, #161616 100%);
    border: 1px solid rgba(255, 0, 0, 0.15);
    border-radius: 6px;
    margin: 0 0 20px 0;
    padding: 24px 28px;
    text-align: center;
    position: relative;
    overflow: hidden;
    box-shadow: 
        0 6px 30px rgba(0, 0, 0, 0.7),
        inset 0 1px 0 rgba(255, 255, 255, 0.08),
        0 4px 12px rgba(0, 0, 0, 0.4);
    width: 100%;
}

.course-title-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, 
        transparent, 
        var(--red-x), 
        var(--gold-soft),
        var(--red-x),
        transparent
    );
    opacity: 0.6;
}

.course-modal-title {
    color: var(--red-x);
    font-family: "Stardos Stencil", serif;
    font-size: 26px;
    text-shadow: 
        0 2px 8px rgba(0, 0, 0, 0.95),
        0 0 20px rgba(255, 0, 0, 0.3);
    letter-spacing: 0.8px;
    line-height: 1.3;
    margin: 0 0 12px 0;
    padding: 0;
}

.course-modal-subtitle {
    color: var(--gold-soft);
    font-family: "Rationale", sans-serif;
    font-size: 18px;
    margin: 14px 0 0 0;
    padding: 14px 0 0 0;
    border-top: 1px solid rgba(183, 155, 108, 0.25);
    text-shadow: 0 1px 5px rgba(0, 0, 0, 0.95);
    line-height: 1.4;
    letter-spacing: 0.5px;
}

/* ===== COURSE DETAILS (MODAL SPECIFIC) ==== */
.course-modal-details {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 14px;
    margin-bottom: 24px;
    width: 100%;
}

.course-modal-detail-item {
    background: linear-gradient(145deg, #2a2a2a 0%, #161616 100%);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 6px;
    padding: 18px;
    text-align: center;
    transition: all 0.3s cubic-bezier(0.165, 0.84, 0.44, 1);
    position: relative;
    overflow: hidden;
    box-shadow: 
        0 4px 15px rgba(0, 0, 0, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.05),
        0 3px 10px rgba(0, 0, 0, 0.3);
}

.course-modal-detail-item:hover {
    border-color: rgba(255, 0, 0, 0.25);
    transform: translateY(-3px);
    box-shadow: 
        0 8px 25px rgba(0, 0, 0, 0.5),
        0 0 0 1px rgba(255, 0, 0, 0.15),
        inset 0 1px 0 rgba(255, 255, 255, 0.08);
}

.course-modal-detail-label {
    color: var(--gold-soft);
    font-family: "Rationale", sans-serif;
    font-size: 13px;
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 1px;
    font-weight: 500;
    position: relative;
    padding-bottom: 8px;
}

.course-modal-detail-label::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 20%;
    right: 20%;
    height: 1px;
    background: linear-gradient(90deg, 
        transparent, 
        var(--gold-soft), 
        transparent
    );
    opacity: 0.4;
}

.course-modal-detail-value {
    color: var(--eggshell);
    font-family: "Share", serif;
    font-size: 16px;
    font-weight: bold;
    text-shadow: 0 1px 4px rgba(0, 0, 0, 0.95);
}

/* ===== MODAL CARDS ==== */
.course-modal-grid {
    display: flex;
    flex-direction: column;
    gap: 22px;
    width: 100%;
    max-width: 100%;
    margin-bottom: 12px;
}

.course-modal-card {
    background: linear-gradient(145deg, #2a2a2a 0%, #161616 100%);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 6px;
    padding: 26px;
    transition: all 0.3s cubic-bezier(0.165, 0.84, 0.44, 1);
    position: relative;
    overflow: hidden;
    box-shadow: 
        0 6px 30px rgba(0, 0, 0, 0.6),
        inset 0 1px 0 rgba(255, 255, 255, 0.05),
        0 4px 15px rgba(0, 0, 0, 0.4);
    display: flex;
    flex-direction: column;
    width: 100%;
}

.course-modal-card:hover {
    border-color: rgba(255, 0, 0, 0.2);
    transform: translateY(-3px);
    box-shadow: 
        0 10px 35px rgba(0, 0, 0, 0.7),
        inset 0 1px 0 rgba(255, 255, 255, 0.08),
        0 5px 20px rgba(0, 0, 0, 0.5);
}

.course-modal-card .modal-subhead {
    color: var(--gold-soft);
    font-family: "Rationale", sans-serif;
    font-size: 20px;
    margin: 0 0 20px 0;
    padding-bottom: 14px;
    border-bottom: 1px solid rgba(183, 155, 108, 0.3);
    text-transform: uppercase;
    letter-spacing: 1.2px;
    position: relative;
}

.course-modal-card .modal-subhead::after {
    content: '';
    position: absolute;
    bottom: -1px;
    left: 0;
    width: 45px;
    height: 2px;
    background: var(--red-x);
    box-shadow: 0 0 15px rgba(255, 0, 0, 0.5);
}

.course-modal-checks {
    list-style: none;
    padding: 0;
    margin: 0;
    flex: 1;
}

.course-modal-checks li {
    display: flex;
    align-items: flex-start;
    margin-bottom: 16px;
    padding-bottom: 16px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.06);
    position: relative;
    padding-left: 16px;
}

.course-modal-checks li::before {
    content: '▪';
    position: absolute;
    left: 0;
    color: var(--red-x);
    font-size: 14px;
    opacity: 0.8;
    text-shadow: 0 0 5px rgba(255, 0, 0, 0.5);
}

.course-modal-checks li:last-child {
    border-bottom: none;
    margin-bottom: 0;
}

.course-modal-checks .modal-chk {
    margin-right: 16px;
    margin-top: 4px;
    flex-shrink: 0;
    cursor: pointer;
}

.course-modal-checks span {
    color: var(--eggshell);
    font-family: "Share", serif;
    font-size: 16px;
    line-height: 1.6;
    flex: 1;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.8);
}

/* ===== RESPONSIVE MODAL STYLES ==== */
@media (max-width: 768px) {
    .red-arrow-indicator {
        width: 44px;
        height: 44px;
        font-size: 24px;
        bottom: 24px;
        right: 24px;
    }
    
    .course-title-container {
        padding: 20px 24px;
    }
    
    .course-modal-title {
        font-size: 22px;
    }
    
    .course-modal-subtitle {
        font-size: 16px;
        margin-top: 12px;
        padding-top: 12px;
    }
    
    .course-modal-details {
        grid-template-columns: 1fr;
        gap: 12px;
    }
    
    .course-modal-card {
        padding: 22px;
    }
    
    .course-modal-card .modal-subhead {
        font-size: 18px;
        margin-bottom: 18px;
        padding-bottom: 12px;
    }
    
    .course-modal-checks li {
        margin-bottom: 14px;
        padding-bottom: 14px;
    }
    
    .course-modal-checks span {
        font-size: 15px;
    }
}

@media (max-width: 480px) {
    .red-arrow-indicator {
        width: 40px;
        height: 40px;
        font-size: 22px;
        bottom: 20px;
        right: 20px;
    }
    
    .course-title-container {
        padding: 18px 20px;
    }
    
    .course-modal-title {
        font-size: 20px;
    }
    
    .course-modal-subtitle {
        font-size: 15px;
    }
    
    .course-modal-card {
        padding: 20px;
    }
}
/* ===== ENHANCED TABLE WITH LENGTH ===== */
.lesson-flow-table {
    flex: 1;
    display: flex;
    flex-direction: column;
    width: 100%;
    position: relative;
    min-height: 380px;
    max-height: 65vh;
}

.lesson-flow-table .table-container {
    overflow-x: auto;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    margin: 0 -4px;
    padding: 0 4px;
    width: calc(100% + 8px);
    height: 100%;
    position: relative;
    scrollbar-width: thin;
    scrollbar-color: var(--red-x) rgba(20, 20, 20, 0.35);
}

.lesson-flow-table .table-container::-webkit-scrollbar {
    width: 6px;
    height: 6px;
}

.lesson-flow-table .table-container::-webkit-scrollbar-track {
    background: rgba(20, 20, 20, 0.35);
    border-radius: 2px;
}

.lesson-flow-table .table-container::-webkit-scrollbar-thumb {
    background: linear-gradient(135deg, var(--red-x), #ff3333);
    border-radius: 2px;
    opacity: 1;
}

.lesson-flow-table table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    font-size: 15px;
    table-layout: fixed;
    min-width: 680px;
}

.lesson-flow-table thead {
    background: linear-gradient(180deg, #161616 0%, #2a2a2a 100%);
    border-bottom: 2px solid var(--red-x);
    position: sticky;
    top: 0;
    z-index: 10;
}

.lesson-flow-table th {
    color: var(--gold-soft);
    font-family: "Rationale", sans-serif;
    font-weight: bold;
    padding: 16px 14px;
    text-align: left;
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 1.2px;
    border-right: 1px solid rgba(255, 255, 255, 0.05);
    white-space: nowrap;
}

.lesson-flow-table th:first-child {
    width: 30%;
}

.lesson-flow-table th:nth-child(2) {
    width: 15%;
}

.lesson-flow-table th:nth-child(3) {
    width: 20%;
}

.lesson-flow-table th:last-child {
    width: 35%;
    border-right: none;
}

.lesson-flow-table td {
    color: var(--eggshell);
    font-family: "Share", serif;
    padding: 16px 14px;
    line-height: 1.6;
    vertical-align: top;
    border-right: 1px solid rgba(255, 255, 255, 0.03);
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.lesson-flow-table td:last-child {
    border-right: none;
}

.lesson-flow-table tbody tr:nth-child(even) {
    background: rgba(30, 30, 30, 0.3);
}

.lesson-flow-table tbody tr:nth-child(odd) {
    background: rgba(25, 25, 25, 0.2);
}

.lesson-flow-table tbody tr:hover {
    background: rgba(183, 155, 108, 0.1);
    transform: translateX(2px);
    transition: all 0.2s ease;
}

/* ===== ENHANCED NOTES CARD ===== */
.notes-card {
    background: linear-gradient(180deg, #2a2a2a 0%, #161616 100%);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 3px;
    padding: 26px;
    display: flex;
    flex-direction: column;
    width: 100%;
    position: relative;
    overflow: hidden;
    box-shadow: 
        0 6px 30px rgba(0, 0, 0, 0.6),
        inset 0 1px 0 rgba(255, 255, 255, 0.05),
        0 4px 15px rgba(0, 0, 0, 0.4);
    min-height: 280px;
    flex: 1;
}

.notes-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z' fill='%23222222' fill-opacity='0.1' fill-rule='evenodd'/%3E%3C/svg%3E");
    opacity: 0.3;
    pointer-events: none;
}

.notes-card .subhead {
    color: var(--gold-soft);
    font-family: "Rationale", sans-serif;
    font-size: 20px;
    margin: 0 0 20px 0;
    padding-bottom: 14px;
    border-bottom: 1px solid rgba(183, 155, 108, 0.3);
    text-transform: uppercase;
    letter-spacing: 1.3px;
    position: relative;
    z-index: 1;
}

.notes-card textarea {
    background: rgba(12, 12, 12, 0.7);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 2px;
    color: var(--eggshell);
    font-family: "Share", serif;
    font-size: 16px;
    padding: 20px;
    flex: 1;
    resize: none;
    margin-bottom: 20px;
    min-height: 200px;
    position: relative;
    z-index: 1;
    box-shadow: inset 0 2px 15px rgba(0, 0, 0, 0.5);
    line-height: 1.6;
}

.notes-card textarea:focus {
    outline: none;
    border-color: var(--red-x);
    background: rgba(15, 15, 15, 0.8);
    box-shadow: 
        inset 0 2px 15px rgba(0, 0, 0, 0.6),
        0 0 0 1px rgba(255, 0, 0, 0.2);
}

.save-notes-btn {
    background: linear-gradient(180deg, #2a2a2a 0%, #161616 100%);
    border: 1px solid rgba(183, 155, 108, 0.3);
    border-radius: 2px;
    color: var(--gold-soft);
    font-family: "Rationale", sans-serif;
    padding: 18px;
    cursor: pointer;
    font-size: 16px;
    transition: all 0.3s cubic-bezier(0.165, 0.84, 0.44, 1);
    margin-bottom: 14px;
    text-transform: uppercase;
    letter-spacing: 1.3px;
    position: relative;
    z-index: 1;
    box-shadow: 
        0 4px 15px rgba(0, 0, 0, 0.45),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
}

.save-notes-btn:hover {
    background: linear-gradient(180deg, #2f2f2f 0%, #1b1b1b 100%);
    border-color: rgba(183, 155, 108, 0.5);
    transform: translateY(-3px);
    box-shadow: 
        0 6px 20px rgba(183, 155, 108, 0.25),
        inset 0 1px 0 rgba(255, 255, 255, 0.08);
}

.hint {
    color: rgba(255, 255, 255, 0.4);
    font-family: "Share", serif;
    font-size: 12px;
    text-align: center;
    font-style: italic;
    position: relative;
    z-index: 1;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.9);
    letter-spacing: 0.5px;
}

/* ===== MODAL ACTIONS ===== */
.course-modal-actions {
    background: linear-gradient(180deg, #2a2a2a 0%, #161616 100%);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 3px;
    box-shadow: 
        0 6px 30px rgba(0, 0, 0, 0.6),
        inset 0 1px 0 rgba(255, 255, 255, 0.05),
        0 4px 15px rgba(0, 0, 0, 0.4);
    margin: 20px 0 0 0;
    padding: 18px;
    width: 100%;
}

.course-modal-actions button {
    background: linear-gradient(180deg, #2a2a2a 0%, #161616 100%);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 2px;
    width: 100%;
    padding: 16px;
    cursor: pointer;
    font-family: "Rationale", sans-serif;
    font-weight: bold;
    font-size: 16px;
    transition: all 0.3s cubic-bezier(0.165, 0.84, 0.44, 1);
    text-transform: uppercase;
    letter-spacing: 2.5px;
    color: var(--eggshell);
    box-shadow: 
        0 4px 15px rgba(0, 0, 0, 0.45),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
}

.course-modal-actions button:hover {
    background: linear-gradient(180deg, #2f2f2f 0%, #1b1b1b 100%);
    border-color: var(--red-x);
    color: var(--red-x);
    transform: translateY(-3px);
    box-shadow: 
        0 6px 25px rgba(255, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.08);
}

.close-course-modal {
    display: none;
}

/* ===== MOBILE OPTIMIZATIONS ===== */
@media (max-width: 768px) {
    .course-modal-content {
        width: 92%;
        height: 90vh;
        max-height: 90vh;
        border-radius: 12px;
    }
    
    .course-snap-section {
        padding: 20px;
    }
    
    .snap-inner-container {
        gap: 16px;
        max-height: 84vh;
        padding: 5px 0;
        padding-bottom: 60px;
    }
    
    .red-arrow-indicator {
        bottom: 22px;
        right: 22px;
        width: 46px;
        height: 46px;
        font-size: 24px;
        border-radius: 10px;
    }
    
    .course-title-container {
        padding: 18px 20px;
        margin-bottom: 14px;
    }
    
    .title-text {
        font-size: 22px;
    }
    
    .course-subtitle {
        font-size: 16px;
        margin-top: 10px;
        padding-top: 10px;
    }
    
    .course-details-compact {
        gap: 10px;
        margin-bottom: 16px;
    }
    
    .course-detail-item {
        padding: 14px;
    }
    
    .card {
        padding: 20px;
        max-height: 72vh;
        overflow-y: auto;
    }
    
    .card .subhead {
        font-size: 18px;
    }
    
    .checks span {
        font-size: 14px;
    }
    
    .lesson-flow-table {
        min-height: 320px;
        max-height: 60vh;
    }
    
    .lesson-flow-table .table-container {
        margin: 0 -8px;
        padding: 0 8px;
        width: calc(100% + 16px);
    }
    
    .lesson-flow-table table {
        font-size: 14px;
        min-width: 700px;
    }
    
    .lesson-flow-table th,
    .lesson-flow-table td {
        padding: 14px 12px;
    }
    
    .lesson-flow-table th {
        font-size: 13px;
    }
    
    .notes-card {
        padding: 20px;
        min-height: 240px;
    }
    
    .notes-card textarea {
        font-size: 15px;
        min-height: 180px;
        padding: 18px;
    }
    
    .save-notes-btn {
        padding: 16px;
        font-size: 15px;
    }
    
    .course-modal-actions {
        padding: 16px;
    }
    
    .course-modal-actions button {
        padding: 15px;
        font-size: 15px;
    }
}

@media (max-width: 480px) {
    .course-modal-content {
        width: 94%;
        height: 92vh;
        border-radius: 10px;
    }
    
    .course-snap-section {
        padding: 16px;
    }
    
    .red-arrow-indicator {
        bottom: 18px;
        right: 18px;
        width: 42px;
        height: 42px;
        font-size: 22px;
        border-radius: 8px;
    }
    
    .course-title-container {
        padding: 16px 18px;
    }
    
    .title-text {
        font-size: 20px;
    }
    
    .course-subtitle {
        font-size: 15px;
    }
    
    .course-details-compact {
        grid-template-columns: 1fr;
        gap: 8px;
    }
    
    .course-detail-item {
        padding: 12px;
    }
    
    .card {
        padding: 18px;
    }
    
    .lesson-flow-table table {
        min-width: 720px;
    }
}
/* ===== MOBILE OPTIMIZATIONS ===== */
@media (max-width: 768px) {
    .course-modal-content {
        width: 92%;
        height: 90vh;
        max-height: 90vh;
        border-radius: 12px;
    }
    
    .course-snap-section {
        padding: 20px;
    }
    
    .snap-inner-container {
        gap: 16px;
        max-height: 84vh;
        padding: 5px 0;
        padding-bottom: 60px;
    }
    
    .red-arrow-indicator {
        bottom: 20px;
        right: 20px;
        width: 42px;
        height: 42px;
        font-size: 24px;
        border-radius: 10px;
    }
    
    .course-title-container {
        padding: 18px 20px;
        margin-bottom: 14px;
    }
    
    .title-text {
        font-size: 22px;
    }
    
    .course-subtitle {
        font-size: 16px;
        margin-top: 10px;
        padding-top: 10px;
    }
    
    .course-details-compact {
        gap: 10px;
        margin-bottom: 16px;
    }
    
    .course-detail-item {
        padding: 12px;
    }
    
    .card {
        padding: 18px;
        max-height: 72vh;
        overflow-y: auto;
    }
    
    .lesson-flow-table .table-container {
        margin: 0 -8px;
        padding: 0 8px;
        width: calc(100% + 16px);
    }
    
    .lesson-flow-table table {
        font-size: 13px;
        min-width: 660px;
    }
    
    .lesson-flow-table th,
    .lesson-flow-table td {
        padding: 12px 10px;
    }
    
    .notes-card {
        padding: 20px;
        min-height: 220px;
    }
    
    .notes-card textarea {
        font-size: 14px;
        min-height: 150px;
        padding: 16px;
    }
    
    .save-notes-btn {
        padding: 14px;
        font-size: 14px;
    }
}

@media (max-width: 480px) {
    .course-modal-content {
        width: 94%;
        height: 92vh;
        border-radius: 10px;
    }
    
    .red-arrow-indicator {
        bottom: 18px;
        right: 18px;
        width: 38px;
        height: 38px;
        font-size: 22px;
    }
    
    .course-title-container {
        padding: 16px 18px;
    }
    
    .title-text {
        font-size: 20px;
    }
}
/* ===== MOBILE OPTIMIZATIONS ===== */
@media (max-width: 768px) {
    .course-snap-section {
        padding: 10px 15px;
    }
    
    .snap-inner-container {
        gap: 6px;
    }
    
    .course-title-container {
        padding: 10px 12px;
        margin-bottom: 6px;
    }
    
    .title-text {
        font-size: 18px;
        margin-bottom: 4px;
    }
    
    .course-subtitle {
        font-size: 13px;
        margin-top: 4px;
        padding-top: 4px;
    }
    
    .course-details-compact {
        gap: 4px;
        margin-bottom: 6px;
    }
    
    .course-detail-item {
        padding: 6px;
    }
    
    .class-grid {
        gap: 6px;
    }
    
    .card {
        padding: 10px;
        max-height: calc(65vh - 120px);
    }
    
    .card .subhead {
        font-size: 14px;
        margin-bottom: 8px;
        padding-bottom: 6px;
    }
    
    .checks li {
        margin-bottom: 3px;
        padding-bottom: 3px;
    }
    
    .checks span {
        font-size: 11px;
        line-height: 1.2;
    }
    
    .course-snap-section:nth-child(2) .lesson-flow-table {
        flex: 0 0 65%;
        min-height: 65vh;
        max-height: 65vh;
    }
    
    .course-snap-section:last-child .notes-card {
        flex: 0 0 65%;
        min-height: 65vh;
        max-height: 65vh;
    }
    
    .scroll-indicator {
        width: 36px;
        height: 36px;
        font-size: 20px;
        bottom: 15px;
        right: 15px;
    }
}

/* ===== CLIENT ONBOARDING SPECIFIC STYLES ===== */
.waiver-section {
    margin-bottom: 20px;
}

.waiver-section .subhead {
    color: var(--red-x);
    margin-bottom: 10px;
}

.waiver-section p {
    margin: 10px 0;
    line-height: 1.6;
}

.waiver-section ul {
    margin: 10px 0;
    padding-left: 20px;
}

.waiver-section li {
    margin: 8px 0;
}

.waiver-content {
    max-height: 200px;
    overflow-y: auto;
    padding: 10px;
    border: 1px solid #555;
    margin-bottom: 15px;
    background: #1a1a1a;
    font-size: 14px;
    line-height: 1.4;
}

.waiver-checkbox {
    display: flex;
    align-items: center;
    gap: 10px;
    margin: 15px 0;
}

.waiver-checkbox input[type="checkbox"] {
    width: 24px;
    height: 24px;
}

.waiver-checkbox label {
    font-weight: bold;
    color: var(--gold-soft);
}

/* ===== EMAIL BUTTONS ===== */
.email-btn {
    background: linear-gradient(135deg, var(--red-x), #3a0b16);
    color: white;
    border: none;
    padding: 10px 18px;
    border-radius: 4px;
    cursor: pointer;
    font-family: "Rationale", sans-serif;
    font-weight: bold;
    transition: all 0.3s ease;
    width: 100%;
    max-width: 300px;
    margin: 10px 0;
}

.email-btn:hover {
    background: linear-gradient(135deg, #ff3333, #4a0f1c);
    transform: translateY(-2px);
}

/* ===== PROGRESS BAR ===== */
.progress-container {
    margin: 20px 0;
    background-color: var(--charcoal);
    border-radius: 4px;
    overflow: hidden;
    height: 8px;
}

.progress-bar {
    height: 100%;
    background: linear-gradient(90deg, var(--bronze), var(--bronze-light));
    width: 0%;
    transition: width 0.5s ease;
}

/* ===== CHECK ALL FUNCTIONALITY ===== */
.check-all-container {
    display: flex;
    align-items: center;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid var(--bronze);
}

.check-all-label {
    font-family: "Rationale", sans-serif;
    font-weight: bold;
    color: var(--bronze);
    margin-left: 10px;
    font-size: 16px;
}

.check-all-checkbox {
    width: 32px !important;
    height: 32px !important;
    min-width: 32px !important;
    min-height: 32px !important;
}

/* ===== SCROLLABLE TABLE CONTAINERS ===== */
.scrollable-table-container {
    max-height: 300px;
    overflow-y: auto;
    border: 1px solid var(--charcoal-lighter);
    border-radius: 4px;
    margin: 10px 0;
}

.scrollable-table-container table {
    margin: 0;
}

.scrollable-table-container th {
    position: sticky;
    top: 0;
    background: var(--charcoal-light);
    z-index: 10;
}

/* ===== BOTTOM ACTIONS ===== */
.bottom-actions {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    justify-content: center;
    margin: 10px auto;
    width: min(100%, var(--stage-w));
}

.bottom-divider {
    border: none;
    height: 2px;
    width: 90%;
    margin: 20px auto;
    background: linear-gradient(to right, transparent 0%, #000 12%, #000 88%, transparent 100%);
    clip-path: polygon(0 50%, 4% 0, 96% 0, 100% 50%, 96% 100%, 4% 100%);
}

/* ===== MODAL STYLES ===== */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    z-index: 1000;
    justify-content: center;
    align-items: center;
}

.modal-content {
    background: linear-gradient(145deg, #1c1c1c 0%, #0f0f0f 100%);
    padding: 25px;
    border-radius: 8px;
    width: 90%;
    max-width: 500px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.9);
    border: 1px solid var(--bronze);
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    border-bottom: 1px solid var(--bronze);
    padding-bottom: 10px;
}

.modal-title {
    font-family: "Stardos Stencil", serif;
    font-size: 20px;
    color: var(--bronze);
    margin: 0;
}

.close-modal {
    background: none;
    border: none;
    color: var(--eggshell);
    font-size: 24px;
    cursor: pointer;
    line-height: 1;
}

.modal-body { margin-bottom: 20px; }
.modal-footer {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
}

/* ===== SAVE NOTIFICATION STYLES ===== */
.save-notification {
    animation: slideIn 0.3s ease-out;
}
@keyframes slideIn {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}
.save-notification.success { border-left: 4px solid #4CAF50; }
.save-notification.error { border-left: 4px solid var(--maroon); }

/* ===== DRILLS MODAL - TRANSLUCENT BLACK GLASS ===== */
.drills-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(8, 8, 8, 0.42) !important; /* 82% dark glass */
    backdrop-filter: blur(15px) !important;
    z-index: 1006;
    justify-content: center;
    align-items: center;
    animation: modal-fade 0.4s ease-out !important;
}

.drills-modal-content {
    /* TRANSPARENT CONTAINER with glass border */
    background: transparent !important; /* KEY: Completely transparent */
    border: 1px solid rgba(192, 192, 192, 0.25) !important;
    border-radius: 14px;
    box-shadow: 
        0 25px 60px rgba(0, 0, 0, 0.8),
        0 10px 30px rgba(0, 0, 0, 0.6) !important;
    padding: 0 !important;
    width: 95%;
    max-width: 1200px;
    max-height: 85vh;
    overflow-y: auto;
    animation: modal-scale 0.45s cubic-bezier(0.175, 0.885, 0.32, 1.275) !important;
}

/* ===== HEADERS - GLASS PANELS ===== */
.drills-modal .title-text {
    /* Glass panel at top */
    background: rgba(22, 22, 22, 0.65) !important; /* 85% glass */
    backdrop-filter: blur(15px) !important;
    -webkit-backdrop-filter: blur(15px) !important;
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
    border-radius: 14px 14px 0 0;
    margin: 0 !important;
    padding: 30px 30px 15px 30px !important;
    color: var(--red-x) !important;
    font-family: "Stardos Stencil", serif !important;
    font-size: 32px !important;
    text-align: center;
}

.drills-modal .subtitle {
    /* Glass panel subtitle */
    background: rgba(20, 20, 20, 0.8) !important; /* 80% glass */
    backdrop-filter: blur(10px) !important;
    -webkit-backdrop-filter: blur(10px) !important;
    border: 1px solid rgba(255, 255, 255, 0.08) !important;
    margin: 0 0 20px 0 !important;
    padding: 15px 30px !important;
    color: var(--gold-soft) !important;
    font-family: "Rationale", sans-serif !important;
    font-size: 20px !important;
    text-align: center;
}


/* ===== DRILLS GRID - TRANSLUCENT GLASS PANEL ===== */
.drills-grid {
    /* Glass panel that sits in the transparent hole */
    background: rgba(20, 20, 20, 0.01) !important; /* 70% glass */
    backdrop-filter: blur(20px) saturate(180%) !important;
    -webkit-backdrop-filter: blur(20px) saturate(180%) !important;
    border: 1px solid rgba(255, 255, 255, 0.12) !important;
    border-radius: 12px;
    box-shadow: 
        inset 0 1px 0 rgba(255, 255, 255, 0.04),
        inset 0 0 30px rgba(0, 0, 0, 0.5),
        0 0 0 1px rgba(0, 0, 0, 0.6) !important;
    
 /* Grid layout WITH MARGINS */
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: 25px;
    margin: 20px 30px 30px 30px !important; /* ADD MARGINS HERE */
    padding: 25px;
}

/* ===== BUTTONS CONTAINER - GLASS PANEL ===== */
.drills-buttons-container {
    /* Glass panel matching the grid */
    background: rgba(20, 20, 20, 0.7) !important; /* 70% glass - SAME AS GRID */
    backdrop-filter: blur(20px) saturate(180%) !important;
    -webkit-backdrop-filter: blur(20px) saturate(180%) !important;
    border: 1px solid rgba(255, 255, 255, 0.12) !important;
    border-radius: 12px;
    box-shadow: 
        inset 0 1px 0 rgba(255, 255, 255, 0.04),
        inset 0 0 30px rgba(0, 0, 0, 0.5) !important;
    
    display: flex;
    gap: 20px;
    margin: 0 auto 40px auto;
    padding: 20px;
    justify-content: center;
    align-items: center;
    width: calc(100% - 60px);
    max-width: 500px;
}

/* ===== DRILL CARDS - TRANSLUCENT ON GLASS ===== */
.drill-card-modal {
    /* Cards on glass panel */
    background: rgba(25, 25, 25, 0.75) !important; /* 75% glass */
    backdrop-filter: blur(15px) saturate(160%) !important;
    -webkit-backdrop-filter: blur(15px) saturate(160%) !important;
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
    border-radius: 10px;
    box-shadow: 
        0 10px 25px rgba(0, 0, 0, 0.5),
        0 5px 15px rgba(0, 0, 0, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.04) !important;
    transition: all 0.3s ease;
}

.drill-card-modal:hover {
    background: rgba(30, 30, 30, 0.85) !important;
    border: 1px solid rgba(255, 255, 255, 0.15) !important;
    backdrop-filter: blur(20px) saturate(180%) !important;
    transform: translateY(-3px);
    box-shadow: 
        0 15px 35px rgba(0, 0, 0, 0.6),
        0 8px 20px rgba(0, 0, 0, 0.5),
        inset 0 1px 0 rgba(255, 255, 255, 0.06) !important;
}

/* Keep your existing button styles... */
.drill-details li:last-child {
    border-bottom: none;
}

.drill-details li strong {
    color: var(--gold-soft);
    font-weight: bold;
    margin-right: 12px;
    min-width: 85px;
    display: inline-block;
    font-size: 14px;
    text-shadow: 0 1px 1px rgba(0,0,0,0.8);
}

/* FOOTER WITH ACTION BUTTON */
.drill-card-footer {
    padding: 15px 0 0 0;
    border-top: 1px solid rgba(192,192,192,0.2);
    margin-top: auto;
}

.drill-card-modal-btn {
    background: #000 !important;
    border: 1px solid #c0c0c0 !important;
    color: #fff !important;
    font-family: "Rationale", sans-serif !important;
    font-weight: bold !important;
    text-transform: uppercase !important;
    letter-spacing: 1.5px !important;
    padding: 12px 20px !important;
    border-radius: 6px !important;
    font-size: 14px !important;
    width: 100%;
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
    z-index: 2;
}

.drill-card-modal-btn:hover {
    background: #111 !important;
    border-color: var(--red-x) !important;
    color: var(--red-x) !important;
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(255,0,0,0.2);
}

.drill-card-modal-btn:active {
    transform: translateY(0);
}

/* Add shine effect on hover */
.drill-card-modal-btn::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg,
        transparent,
        rgba(255,255,255,0.1),
        transparent
    );
    transition: left 0.6s ease;
    z-index: -1;
}

.drill-card-modal-btn:hover::after {
    left: 100%;
}

/* ===== ENHANCED PHASE CARDS FOR DRILLS SECTION ===== */
.drills-cards-container .phase-card {
    background: #050505 !important;
    background: linear-gradient(
        145deg, 
        #030303 0%, 
        #0a0a0a 25%, 
        #111111 50%, 
        #0a0a0a 75%, 
        #030303 100%
    ) !important;
    border: 1px solid #c0c0c0 !important;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 
        0 10px 30px rgba(0,0,0,0.6),
        0 1px 0 rgba(255,255,255,0.1);
    transition: all 0.4s ease;
    padding: 0 !important;
    margin-bottom: 30px !important; /* ADD THIS */
}

.drills-cards-container .phase-card:hover {
    transform: translateY(-8px);
    box-shadow: 
        0 20px 40px rgba(0,0,0,0.8),
        0 0 0 1px var(--gold-soft),
        0 0 30px rgba(183, 155, 108, 0.3);
    border-color: var(--gold-soft);
}

.drills-cards-container .phase-card-header {
    background: transparent !important;
    padding: 20px 20px 12px 20px !important;
    border-bottom: 1px solid rgba(192,192,192,0.3) !important;
    position: relative;
    margin: 0 !important;
    width: 100% !important;
}

/* Add accent line */
.drills-cards-container .phase-card-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 25px;
    right: 25px;
    height: 2px;
    background: linear-gradient(90deg, 
        transparent 0%, 
        var(--red-x) 20%, 
        var(--gold-soft) 50%, 
        var(--red-x) 80%, 
        transparent 100%
    );
    opacity: 0.6;
}

.drills-cards-container .phase-card-title {
    font-family: "Stardos Stencil", serif;
    font-size: 20px !important;
    color: var(--red-x) !important;
    margin: 0 0 6px 0;
    text-shadow: 0 2px 4px rgba(0,0,0,0.9) !important;
    letter-spacing: 0.5px;
    padding: 0 !important;
    text-align: center;
}

.drills-cards-container .phase-card-subtitle {
    font-family: "Rationale", sans-serif;
    font-size: 15px !important;
    color: var(--gold-soft) !important;
    margin: 0;
    text-shadow: 0 1px 2px rgba(0,0,0,0.8) !important;
    padding: 0 !important;
    text-align: center;
    opacity: 0.9;
}

.drills-cards-container .phase-card-content {
    background: transparent !important;
    padding: 15px 25px !important;
    border: none !important;
    margin: 0 !important;
}

.drills-cards-container .phase-card-features {
    list-style: none;
    padding: 0;
    margin: 0 0 20px 0;
}

.drills-cards-container .phase-card-features li {
    padding: 8px 0;
    border-bottom: 1px solid rgba(255,255,255,0.07);
    color: #f0f0f0;
    font-size: 16px;
}

.drills-cards-container .phase-card-features li:last-child {
    border-bottom: none;
}

/* Progress section */
.drills-cards-container .phase-card-footer {
    background: transparent !important;
    padding: 20px 25px !important;
    border-top: 1px solid rgba(192,192,192,0.2) !important;
    margin: 0 !important;
}

/* Phase progress wheel - MOVED TO ABOVE VIEW DRILLS BUTTON */
.drills-cards-container .phase-card-footer .phase-progress-wheel {
    display: flex;
    justify-content: center;
    align-items: center;
    margin: 0 auto 15px auto !important;
    padding: 0 !important;
    background: transparent !important;
    border: none !important;
    min-height: 50px;
    width: 100%;
}

/* ==== EXPLICIT GRID CELL ASSIGNMENTS ==== */

/* Progress Bars → Top-Left (row 1, col 1) */
.phase-progress-bars-vertical {
    grid-area: 1 / 1 / 2 / 2 !important; /* row-start / col-start / row-end / col-end */
}

/* Wheel → Top-Right (row 1, col 2) */
.phase-card-progress {
    grid-area: 1 / 2 / 2 / 3 !important;
}

/* DYNAMIC Button → Bottom-Left (row 2, col 1) */
.dynamic-ds-btn {
    grid-area: 2 / 1 / 3 / 2 !important;
}

/* VIEW DRILLS Button → Bottom-Right (row 2, col 2) */
.phase-card-btn {
    grid-area: 2 / 2 / 3 / 3 !important;
}

/* RESPONSIVE */
@media (max-width: 768px) {
    .drills-grid {
        grid-template-columns: 1fr;
        margin: 0 20px 30px 20px;
        gap: 20px;
    }
    
    .drills-modal .title-text {
        font-size: 26px !important;
        padding: 25px 25px 10px 25px;
    }
    
    .drills-modal .subtitle {
        font-size: 18px !important;
        margin-bottom: 25px !important;
    }
}
/* ===== STAGE DRILL MODAL - TRANSLUCENT BLACK GLASS ===== */
.stage-drill-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(8, 8, 8, 0.42) !important; /* 42% dark glass - SAME as .drills-modal */
    backdrop-filter: blur(15px) !important;
    z-index: 1008;
    justify-content: center;
    align-items: center;
    overflow-y: auto;
    animation: modal-fade 0.4s ease-out !important;
}

.stage-drill-modal-content {
    /* TRANSPARENT CONTAINER - SAME as .drills-modal-content */
    background: transparent !important;
    border: 1px solid rgba(192, 192, 192, 0.25) !important;
    border-radius: 14px;
    box-shadow: 
        0 25px 60px rgba(0, 0, 0, 0.8),
        0 10px 30px rgba(0, 0, 0, 0.6) !important;
    padding: 0 !important;
    width: 90%;
    max-width: 700px;
    max-height: 85vh;
    overflow-y: auto;
    animation: modal-scale 0.45s cubic-bezier(0.175, 0.885, 0.32, 1.275) !important;
}

/* ===== HEADERS - SAME GLASS PANELS ===== */
.stage-drill-modal .title-text {
    /* Glass panel - SAME as drills modal header */
    background: rgba(22, 22, 22, 0.65) !important; /* 65% glass - SAME as drills */
    backdrop-filter: blur(15px) !important;
    -webkit-backdrop-filter: blur(15px) !important;
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
    border-radius: 14px 14px 0 0;
    margin: 0 !important;
    padding: 25px 25px 15px 25px !important;
    color: var(--red-x) !important;
    font-family: "Stardos Stencil", serif !important;
    font-size: 24px !important;
    text-align: center;
    text-shadow: 0 2px 4px rgba(0,0,0,0.9) !important;
}

.stage-drill-modal .subtitle {
    /* Glass panel - SAME as drills modal subtitle */
    background: rgba(20, 20, 20, 0.8) !important; /* 80% glass - SAME as drills */
    backdrop-filter: blur(10px) !important;
    -webkit-backdrop-filter: blur(10px) !important;
    border: 1px solid rgba(255, 255, 255, 0.08) !important;
    border-radius: 0 0 12px 12px;
    margin: 0 0 20px 0 !important;
    padding: 12px 25px 15px 25px !important;
    color: var(--gold-soft) !important;
    font-family: "Rationale", sans-serif !important;
    font-size: 16px !important;
    text-align: center;
}

/* ===== STEPS CONTAINER - SAME GLASS AS DRILLS GRID ===== */
.stage-drill-steps {
    /* Glass panel - SAME specs as .drills-grid */
    background: rgba(20, 20, 20, 0.01) !important; /* 1% glass - SAME as .drills-grid */
    backdrop-filter: blur(20px) saturate(180%) !important;
    -webkit-backdrop-filter: blur(20px) saturate(180%) !important;
    border: 1px solid rgba(255, 255, 255, 0.12) !important;
    border-radius: 12px;
    box-shadow: 
        inset 0 1px 0 rgba(255, 255, 255, 0.04),
        inset 0 0 30px rgba(0, 0, 0, 0.5),
        0 0 0 1px rgba(0, 0, 0, 0.6) !important;
    margin: 20px 30px 30px 30px !important; /* SAME margins as .drills-grid */
    padding: 25px;
}

.step-item {
    /* Glass cards - SAME as .drill-card-modal */
    background: rgba(25, 25, 25, 0.75) !important; /* 75% glass - SAME as drill cards */
    backdrop-filter: blur(15px) saturate(160%) !important;
    -webkit-backdrop-filter: blur(15px) saturate(160%) !important;
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
    border-radius: 8px;
    padding: 15px 20px;
    margin-bottom: 12px;
    color: var(--eggshell);
    line-height: 1.5;
    transition: all 0.3s ease;
    box-shadow: 
        0 4px 12px rgba(0, 0, 0, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.03) !important;
}

.step-item:hover {
    background: rgba(30, 30, 30, 0.85) !important;
    border: 1px solid rgba(183, 155, 108, 0.3) !important;
    backdrop-filter: blur(20px) saturate(180%) !important;
    transform: translateY(-2px);
    box-shadow: 
        0 8px 20px rgba(183, 155, 108, 0.15),
        inset 0 1px 0 rgba(255, 255, 255, 0.05) !important;
}

.step-description {
    font-size: 15px;
    color: var(--eggshell);
    font-family: "Share", serif;
    margin: 0;
    padding: 0;
}

/* ===== ACTIONS - SAME GLASS AS DRILLS BUTTONS CONTAINER ===== */
.stage-drill-actions {
    /* Glass panel - SAME as .drills-buttons-container */
    background: rgba(20, 20, 20, 0.7) !important; /* 70% glass - SAME as buttons container */
    backdrop-filter: blur(20px) saturate(180%) !important;
    -webkit-backdrop-filter: blur(20px) saturate(180%) !important;
    border: 1px solid rgba(255, 255, 255, 0.12) !important;
    border-radius: 12px;
    box-shadow: 
        inset 0 1px 0 rgba(255, 255, 255, 0.04),
        inset 0 0 30px rgba(0, 0, 0, 0.5) !important;
    display: flex;
    justify-content: space-between;
    margin: 0 30px 40px 30px !important; /* SAME margins */
    gap: 15px;
    padding: 20px;
}

.stage-drill-actions button {
    /* Glass buttons - matching theme */
    background: rgba(30, 30, 30, 0.8) !important;
    backdrop-filter: blur(10px) !important;
    -webkit-backdrop-filter: blur(10px) !important;
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
    border-radius: 8px;
    flex: 1;
    padding: 14px;
    cursor: pointer;
    font-family: "Rationale", sans-serif;
    font-weight: bold;
    font-size: 16px;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: white;
    box-shadow: 
        inset 0 1px 0 rgba(255, 255, 255, 0.05),
        0 4px 8px rgba(0, 0, 0, 0.3) !important;
}

.btn-close:hover,
.btn-assess:hover {
    backdrop-filter: blur(15px) !important;
    transform: translateY(-2px);
    box-shadow: 
        0 6px 15px rgba(0, 0, 0, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.08) !important;
}

.btn-close:hover {
    border-color: rgba(255, 0, 0, 0.3) !important;
    color: var(--red-x);
}

.btn-assess:hover {
    border-color: rgba(183, 155, 108, 0.5) !important;
    color: var(--gold-bright);
}

/* Close button - glass circle */
.close-stage-drill-modal {
    position: absolute;
    top: 20px;
    right: 20px;
    background: rgba(30, 30, 30, 0.8) !important;
    backdrop-filter: blur(10px) !important;
    -webkit-backdrop-filter: blur(10px) !important;
    border: 1px solid rgba(255, 255, 255, 0.15) !important;
    color: var(--gold-soft);
    font-size: 28px;
    cursor: pointer;
    z-index: 1009;
    width: 44px;
    height: 44px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    box-shadow: 
        0 4px 12px rgba(0, 0, 0, 0.5),
        inset 0 1px 0 rgba(255, 255, 255, 0.05) !important;
}

.close-stage-drill-modal:hover {
    background: rgba(40, 40, 40, 0.9) !important;
    border-color: rgba(255, 0, 0, 0.4) !important;
    color: var(--red-x);
    transform: scale(1.1);
    backdrop-filter: blur(15px) !important;
    box-shadow: 
        0 6px 20px rgba(255, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.08) !important;
}

/* ===== PROGRESS INDICATOR ===== */
.stage-progress {
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 15px;
    z-index: 1010;
    background: rgba(20, 20, 20, 0.9);
    padding: 15px 25px;
    border-radius: 25px;
    border: 1px solid rgba(183, 155, 108, 0.2);
}

.stage-progress-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.2);
    transition: all 0.3s ease;
    cursor: pointer;
}

.stage-progress-dot.active {
    background: var(--red-x);
    transform: scale(1.3);
    box-shadow: 0 0 15px rgba(255, 0, 0, 0.6);
}

/* ===== CLOSE BUTTON ===== */
.close-stage-modal {
    position: fixed;
    top: 30px;
    right: 30px;
    width: 50px;
    height: 50px;
    background: rgba(30, 30, 30, 0.8);
    border: 1px solid rgba(183, 155, 108, 0.2);
    border-radius: 50%;
    color: var(--eggshell);
    font-size: 24px;
    cursor: pointer;
    z-index: 1010;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.close-stage-modal:hover {
    background: rgba(255, 0, 0, 0.2);
    border-color: var(--red-x);
    color: var(--red-x);
    transform: rotate(90deg);
}

/* ===== RESPONSIVE ADJUSTMENTS ===== */

@media (max-width: 1024px) {
    .stage-section {
        padding: 50px 30px;
        gap: 30px;
    }
    
    .stage-title {
        font-size: 2.6rem;
    }
    
    .stage-subtitle {
        font-size: 1.3rem;
    }
    
    .stage-drill-steps {
        gap: 18px;
    }
    
    .step-item {
        padding: 22px 26px;
    }
}

@media (max-width: 768px) {
    .stage-section {
        padding: 40px 20px;
        gap: 25px;
        height: 100dvh;
        min-height: 100dvh;
    }
    
    .stage-header {
        padding: 20px 0;
    }
    
    .stage-title {
        font-size: 2.2rem;
        margin-bottom: 15px;
    }
    
    .stage-title-divider {
        width: 150px;
        margin-bottom: 20px;
    }
    
    .stage-subtitle {
        font-size: 1.1rem;
        padding: 0 20px;
    }
    
    .stage-drill-steps {
        gap: 15px;
    }
    
    .step-item {
        padding: 20px 24px;
    }
    
    .step-description {
        font-size: 1.1rem;
    }
    
    .stage-actions {
        flex-direction: column;
        align-items: center;
        gap: 15px;
        padding: 20px 0;
    }
    
    .stage-action-btn {
        width: 100%;
        max-width: 300px;
        padding: 16px 30px;
        font-size: 1.1rem;
    }
    
    .stage-progress {
        bottom: 20px;
        padding: 12px 20px;
    }
    
    .close-stage-modal {
        top: 20px;
        right: 20px;
        width: 45px;
        height: 45px;
        font-size: 22px;
    }
}

@media (max-width: 480px) {
    .stage-section {
        padding: 30px 15px;
        gap: 20px;
    }
    
    .stage-title {
        font-size: 1.8rem;
    }
    
    .stage-subtitle {
        font-size: 1rem;
    }
    
    .step-item {
        padding: 18px 22px;
    }
    
    .step-description {
        font-size: 1rem;
    }
    
    .stage-action-btn {
        max-width: 280px;
        padding: 14px 25px;
        font-size: 1rem;
    }
    
    .close-stage-modal {
        top: 15px;
        right: 15px;
        width: 40px;
        height: 40px;
        font-size: 20px;
    }
}

/* SKILLS ASSESSMENT MODAL */
.skills-assessment-modal {
    display:none;position:fixed;top:0;left:0;width:100%;height:100%;
    background:rgba(8,8,8,0.42)!important;backdrop-filter:blur(15px)!important;
    z-index:1010;justify-content:center;align-items:center;overflow-y:auto;
    animation:modal-fade .4s ease-out!important;
}

.skills-assessment-modal-content {
    background:transparent!important;border:none!important;box-shadow:none!important;
    padding:0!important;width:90%;max-width:700px;max-height:85vh;overflow-y:auto;
    animation:modal-scale .45s cubic-bezier(0.175,0.885,0.32,1.275)!important;
}

/* HEADERS */
.skills-assessment-modal .title-text {
    background:rgba(22,22,22,0.65)!important;backdrop-filter:blur(15px)!important;
    border:1px solid rgba(255,255,255,0.1)!important;border-radius:14px 14px 0 0;
    margin:0!important;padding:25px 25px 15px!important;
    color:var(--red-x)!important;font-family:"Stardos Stencil",serif;
    font-size:24px;text-align:center;text-shadow:0 2px 4px rgba(0,0,0,0.8);
}

.skills-assessment-modal .subtitle {
    background:rgba(20,20,20,0.8)!important;backdrop-filter:blur(10px)!important;
    border:1px solid rgba(255,255,255,0.08)!important;border-radius:0 0 12px 12px;
    margin:0 0 20px!important;padding:12px 25px 15px!important;
    color:var(--gold-soft)!important;font-family:"Rationale",sans-serif;
    font-size:16px;text-align:center;
}

/* SKILLS LIST */
.skills-list {
    background:transparent!important;backdrop-filter:none!important;border:none!important;
    box-shadow:none!important;margin:0 15px 30px!important;padding:0!important;
    display:flex;flex-direction:column;gap:15px;
}

/* SKILL PILLS - FULLY WRAPPED */
.skill-assessment-item {
    background:rgba(25,25,25,0.75)!important;backdrop-filter:blur(15px) saturate(160%)!important;
    border:1px solid rgba(255,255,255,0.1)!important;border-radius:10px!important;
    padding:16px 25px!important;display:flex;justify-content:space-between;
    align-items:center;transition:all .3s ease;width:100%;
    box-shadow:0 4px 12px rgba(0,0,0,0.4),inset 0 1px 0 rgba(255,255,255,0.03)!important;
}

/* SKILL NAME - TIGHT SPACING */
.skill-name {flex:1;color:var(--eggshell);font-weight:bold;font-size:15px;
    font-family:"Share",serif;display:flex;align-items:center;gap:4px!important;}

.skill-number {color:#9fa09d!important;font-weight:bold;font-family:"Share Tech Mono",monospace;
    font-size:15px;min-width:22px;text-align:center;}

.skill-name-text {
    display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;
    overflow:hidden;text-overflow:ellipsis;line-height:1.3;max-height:2.6em;
    margin-right:25px!important;
}

/* RATING BUBBLES */
.rating-bubbles {display:flex;gap:8px!important;}

.rating-bubble {
    width:34px!important;height:34px!important;border-radius:50%;
    border:2px solid rgba(183,155,108,0.5)!important;
    background:rgba(15,15,15,0.8)!important;backdrop-filter:blur(6px)!important;
    color:var(--eggshell)!important;cursor:pointer;display:flex;
    align-items:center;justify-content:center;font-size:14px!important;
    font-weight:bold;font-family:"Rationale",sans-serif;transition:all .3s ease;
    box-shadow:0 3px 8px rgba(0,0,0,0.7),0 1px 3px rgba(0,0,0,0.5),
        inset 0 1px 1px rgba(255,255,255,0.1),inset 0 -1px 1px rgba(0,0,0,0.8)!important;
}

.rating-bubble:hover {
    background:rgba(183,155,108,0.4)!important;border-color:var(--gold-soft)!important;
    color:white!important;transform:scale(1.12) translateY(-1px);
    backdrop-filter:blur(8px)!important;
    box-shadow:0 5px 15px rgba(183,155,108,0.5),0 2px 6px rgba(0,0,0,0.6),
        inset 0 1px 1px rgba(255,255,255,0.15),inset 0 -1px 1px rgba(0,0,0,0.7)!important;
}

.rating-bubble.selected {
    background:rgba(255,0,0,0.7)!important;backdrop-filter:blur(12px)!important;
    border-color:var(--red-x)!important;color:white!important;
    transform:scale(1.08) translateY(-1px);
    box-shadow:0 0 20px rgba(255,0,0,0.7),0 3px 10px rgba(0,0,0,0.6),
        inset 0 1px 1px rgba(255,255,255,0.2),inset 0 -1px 1px rgba(0,0,0,0.6)!important;
}

/* ===== PROGRESS INDICATOR - GLASS PANEL ===== */
.real-time-progress {
    /* Glass panel - like steps container */
    background: rgba(20, 20, 20, 0.7) !important;
    backdrop-filter: blur(15px) saturate(180%) !important;
    -webkit-backdrop-filter: blur(15px) saturate(180%) !important;
    border: 1px solid rgba(255, 255, 255, 0.12) !important;
    border-radius: 12px;
    box-shadow: 
        inset 0 1px 0 rgba(255, 255, 255, 0.04),
        inset 0 0 20px rgba(0, 0, 0, 0.4) !important;
    padding: 20px;
    margin: 20px 30px 30px 30px !important;
}

.progress-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
    font-family: "Rationale", sans-serif;
    font-size: 16px;
    color: var(--eggshell);
}

.progress-header strong {
    color: var(--red-x);
    font-size: 18px;
}

.progress-note {
    font-size: 14px;
    color: var(--gold-soft);
    font-style: italic;
}

/* ===== SKILLS LIST - NO BORDER, PILLS EXTEND ===== */
.skills-list {
    /* REMOVE border and background - just spacing container */
    background: transparent !important;
    backdrop-filter: none !important;
    -webkit-backdrop-filter: none !important;
    border: none !important;
    box-shadow: none !important;
    
    margin: 0 15px 30px 15px !important; /* Reduced side margins */
    padding: 0 !important; /* REMOVE padding - let pills extend */
    display: flex;
    flex-direction: column;
    gap: 12px;
}

/* ===== INDIVIDUAL SKILL PILLS - EXTENDED ===== */
.skill-assessment-item {
    /* TRANSLUCENT GLASS PILL - now full width */
    background: rgba(25, 25, 25, 0.75) !important;
    backdrop-filter: blur(15px) saturate(160%) !important;
    -webkit-backdrop-filter: blur(15px) saturate(160%) !important;
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
    border-radius: 10px !important;
    padding: 16px 25px !important;
    display: flex;
    flex-direction: column; /* Changed to column layout */
    gap: 12px; /* Space between skill info and rating bubbles */
    transition: all 0.3s ease;
    box-shadow: 
        0 4px 12px rgba(0, 0, 0, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.03) !important;
    
    /* Pills now extend to full width of container */
    width: 100%;
}
.skill-assessment-item:hover {
    background: rgba(30, 30, 30, 0.85) !important;
    border: 1px solid rgba(183, 155, 108, 0.25) !important;
    backdrop-filter: blur(20px) saturate(180%) !important;
    transform: translateY(-2px);
    box-shadow: 
        0 8px 20px rgba(183, 155, 108, 0.15),
        inset 0 1px 0 rgba(255, 255, 255, 0.05) !important;
}

/* ===== SKILL HEADER (Number + Name) - TOP SECTION ===== */
.skill-header {
    display: flex;
    align-items: flex-start; /* Align to top */
    gap: 10px;
    width: 100%;
}

/* Skill number styling */
.skill-number {
    color: #9fa09d !important;
    font-weight: bold;
    font-family: "Share Tech Mono", monospace;
    font-size: 15px;
    min-width: 24px;
    text-align: left;
    line-height: 1.3;
    margin-top: 2px; /* Slight vertical alignment adjustment */
}

/* Skill name styling */
.skill-name {
    flex: 1;
    color: var(--eggshell);
    font-weight: bold;
    font-size: 15px;
    font-family: "Share", serif;
    line-height: 1.3;
}

/* Force skill names to stack on two lines max */
.skill-name-text {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    text-overflow: ellipsis;
    line-height: 1.3;
    max-height: 2.6em;
}

/* ===== RATING BUBBLES - BOTTOM SECTION ===== */
.rating-container {
    width: 100%;
    display: flex;
    justify-content: flex-start; /* Align bubbles to left */
    padding-top: 4px; /* Small separation from skill name */
}

.rating-bubbles {
    display: flex;
    gap: 6px;
}

.rating-bubble {
    /* ENHANCED 3D GLASS BUBBLES */
    width: 34px !important;
    height: 34px !important;
    border-radius: 50%;
    border: 2px solid rgba(183, 155, 108, 0.5) !important;
    background: rgba(15, 15, 15, 0.8) !important;
    backdrop-filter: blur(6px) !important;
    -webkit-backdrop-filter: blur(6px) !important;
    color: var(--eggshell) !important;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px !important;
    font-weight: bold;
    font-family: "Rationale", sans-serif;
    transition: all 0.3s ease;
    
    /* ENHANCED 3D SHADOW - darker, tighter spread */
    box-shadow: 
        0 3px 8px rgba(0, 0, 0, 0.7),
        0 1px 3px rgba(0, 0, 0, 0.5),
        inset 0 1px 1px rgba(255, 255, 255, 0.1),
        inset 0 -1px 1px rgba(0, 0, 0, 0.8) !important;
    
    /* 3D depth effect */
    position: relative;
}

.rating-bubble::before {
    content: '';
    position: absolute;
    top: 1px;
    left: 1px;
    right: 1px;
    bottom: 1px;
    border-radius: 50%;
    background: radial-gradient(
        circle at 30% 30%,
        rgba(255, 255, 255, 0.15) 0%,
        transparent 50%
    );
    pointer-events: none;
}

.rating-bubble:hover {
    background: rgba(183, 155, 108, 0.4) !important;
    border-color: var(--gold-soft) !important;
    color: white !important;
    transform: scale(1.12) translateY(-1px);
    backdrop-filter: blur(8px) !important;
    
    box-shadow: 
        0 5px 15px rgba(183, 155, 108, 0.5),
        0 2px 6px rgba(0, 0, 0, 0.6),
        inset 0 1px 1px rgba(255, 255, 255, 0.15),
        inset 0 -1px 1px rgba(0, 0, 0, 0.7) !important;
}

.rating-bubble.selected {
    background: rgba(255, 0, 0, 0.7) !important;
    backdrop-filter: blur(12px) !important;
    border-color: var(--red-x) !important;
    color: white !important;
    transform: scale(1.08) translateY(-1px);
    
    box-shadow: 
        0 0 20px rgba(255, 0, 0, 0.7),
        0 3px 10px rgba(0, 0, 0, 0.6),
        inset 0 1px 1px rgba(255, 255, 255, 0.2),
        inset 0 -1px 1px rgba(0, 0, 0, 0.6) !important;
}

.rating-bubble.selected::after {
    content: '';
    position: absolute;
    top: -2px;
    left: -2px;
    right: -2px;
    bottom: -2px;
    border-radius: 50%;
    background: radial-gradient(
        circle at center,
        rgba(255, 0, 0, 0.3) 0%,
        transparent 70%
    );
    pointer-events: none;
    z-index: -1;
}
/* ===== SKILLS ASSESSMENT ACTIONS - MATCHING OTHER MODALS ===== */
.skills-assessment-actions {
    background: rgba(20, 20, 20, 0.7) !important;
    backdrop-filter: blur(20px) saturate(180%) !important;
    -webkit-backdrop-filter: blur(20px) saturate(180%) !important;
    border: 1px solid rgba(255, 255, 255, 0.12) !important;
    border-radius: 12px;
    box-shadow: 
        inset 0 1px 0 rgba(255, 255, 255, 0.04),
        inset 0 0 30px rgba(0, 0, 0, 0.5) !important;
    display: flex;
    justify-content: center; /* CENTERED like drills modal */
    margin: 0 auto 40px auto !important; /* Auto margins for centering */
    gap: 20px;
    padding: 20px;
    width: calc(100% - 60px); /* Same width calculation */
    max-width: 500px; /* Same max-width */
}

.btn-save-assessment {
    /* Glass button - MATCHING other modal buttons */
    background: #000 !important;
    border: 1px solid #c0c0c0 !important;
    color: #fff !important;
    font-family: "Rationale", sans-serif !important;
    font-weight: bold !important;
    text-transform: uppercase !important;
    letter-spacing: 1.5px !important;
    padding: 14px 28px !important;
    border-radius: 6px !important;
    font-size: 16px !important;
    cursor: pointer;
    transition: all 0.3s ease;
    width: 200px;
    height: 50px;
    display: flex; /* Removed text-align: center to prevent conflict */
    align-items: center;
    justify-content: center;
    position: relative;
    overflow: hidden;
    backdrop-filter: none !important;
    box-shadow: none !important;
}

.btn-save-assessment:hover {
    /* Hover effect - SAME as other buttons */
    background: #111 !important;
    border-color: var(--red-x) !important;
    color: var(--red-x) !important;
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(255,0,0,0.2) !important;
}

.btn-save-assessment:active {
    transform: translateY(0);
}

/* Add shine effect - SAME as other buttons */
.btn-save-assessment::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg,
        transparent,
        rgba(255,255,255,0.1),
        transparent
    );
    transition: left 0.6s ease;
    z-index: -1;
}

.btn-save-assessment:hover::after {
    left: 100%;
}

/* Progress animation */
@keyframes progress-pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
}

#phase-progress.updating {
    animation: progress-pulse 0.5s ease;
    color: var(--red-x) !important;
}

/* ===== DYNAMIC ANALYSIS MODAL ===== */
.dynamic-analysis-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(8, 8, 8, 0.42) !important;
    backdrop-filter: blur(15px) !important;
    z-index: 1014;
    justify-content: center;
    align-items: center;
    overflow-y: auto;
    animation: modal-fade 0.4s ease-out !important;
}

.dynamic-analysis-modal-content {
    background: transparent !important;
    border: 1px solid rgba(192, 192, 192, 0.25) !important;
    border-radius: 14px;
    box-shadow: 
        0 25px 60px rgba(0, 0, 0, 0.8),
        0 10px 30px rgba(0, 0, 0, 0.6) !important;
    padding: 0 !important;
    width: 95%;
    max-width: 1200px;
    max-height: 90vh;
    overflow-y: auto;
    animation: modal-scale 0.45s cubic-bezier(0.175, 0.885, 0.32, 1.275) !important;
}

.dynamic-analysis-modal .title-text {
    background: rgba(22, 22, 22, 0.65) !important;
    backdrop-filter: blur(15px) !important;
    border: 1px solid rgba(255, 255, 255, 0.1) !important;
    border-radius: 14px 14px 0 0;
    margin: 0 !important;
    padding: 18px 25px 10px 25px !important; /* Less padding */
    color: var(--red-x) !important;
    font-family: "Stardos Stencil", serif !important;
    font-size: 26px !important; /* Smaller font */
    text-align: center;
}

.dynamic-analysis-modal .subtitle {
    background: rgba(20, 20, 20, 0.8) !important;
    backdrop-filter: blur(10px) !important;
    border: 1px solid rgba(255, 255, 255, 0.08) !important;
    border-radius: 0 0 12px 12px;
    margin: 0 0 15px 0 !important; /* Less margin below */
    padding: 8px 25px 10px 25px !important; /* Less padding */
    color: var(--gold-soft) !important;
    font-family: "Rationale", sans-serif !important;
    font-size: 16px !important;
    text-align: center;
}

.dynamic-analysis-grid {
    background: rgba(20, 20, 20, 0.01) !important;
    backdrop-filter: blur(20px) saturate(180%) !important;
    border: 1px solid rgba(255, 255, 255, 0.12) !important;
    border-radius: 12px;
    box-shadow: 
        inset 0 1px 0 rgba(255, 255, 255, 0.04),
        inset 0 0 30px rgba(0, 0, 0, 0.5),
        0 0 0 1px rgba(0, 0, 0, 0.6) !important;
    
    /* KEEP ALL THESE - they're essential for horizontal scroll */
    display: flex !important;
    overflow-x: auto !important;
    flex-wrap: nowrap !important;
    gap: 25px;
    scroll-snap-type: x mandatory !important;
    scroll-behavior: smooth !important;
    
    /* JUST ADD THESE 2 LINES TO FIX THE CENTERING ISSUE */
    scroll-padding-inline: 30px !important;
    justify-content: flex-start !important;
    
    margin: 15px 30px 25px 30px !important; /* Less top margin */
    padding: 25px;
    
    width: calc(100% - 60px);
    max-width: 100%;
    box-sizing: border-box;
}

/* ===== DYNAMIC ANALYSIS CARDS - HORIZONTAL LAYOUT FOR EXISTING HTML ===== */

.dynamic-analysis-card {
    background: 
        linear-gradient(
            145deg,
            #404040 0%,
            #484848 30%,
            #404040 70%,
            #383838 100%
        ),
        linear-gradient(
            to bottom,
            rgba(0, 0, 0, 0.4) 0%,
            rgba(0, 0, 0, 0.2) 30%,
            rgba(0, 0, 0, 0.1) 70%,
            rgba(0, 0, 0, 0.3) 100%
        ) !important;
    
    background-blend-mode: overlay, multiply !important;
    backdrop-filter: blur(8px) saturate(140%) !important;
    border: 1.5px solid #585858 !important;
    border-top: 1.5px solid #686868 !important;
    border-left: 1.5px solid #686858 !important;
    border-radius: 12px;
    padding: 16px;
    
    box-shadow: 
        0 6px 20px rgba(0, 0, 0, 0.4),
        0 4px 12px rgba(0, 0, 0, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.1),
        inset 0 1px 4px rgba(255, 255, 255, 0.08),
        inset 0 -1px 4px rgba(0, 0, 0, 0.3),
        inset 0 0 20px rgba(0, 0, 0, 0.2),
        0 0 0 1px rgba(30, 30, 30, 0.8) !important;
    
    width: 320px !important;
    min-width: 320px !important;
    box-sizing: border-box;
    position: relative;
    flex: 0 0 auto !important;
    scroll-snap-align: start !important;
}

.dynamic-analysis-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(
        to bottom,
        rgba(0, 0, 0, 0.25) 0%,
        rgba(0, 0, 0, 0.1) 20%,
        rgba(0, 0, 0, 0) 50%,
        rgba(0, 0, 0, 0.15) 80%,
        rgba(0, 0, 0, 0.3) 100%
    ) !important;
    border-radius: 11px;
    pointer-events: none;
    z-index: 1;
}

.drill-card-header {
    text-align: center;
    margin-bottom: 14px;
    padding-bottom: 10px;
    border-bottom: 1.5px solid #585858;
    position: relative;
    z-index: 2;
}

.drill-card-title {
    font-family: "Stardos Stencil", serif;
    font-size: 17px;
    color: #ffffff !important;
    margin: 0 0 4px 0;
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
    letter-spacing: 0.4px;
    position: relative;
    z-index: 2;
}

.drill-card-subtitle {
    font-family: "Rationale", sans-serif;
    font-size: 12px;
    color: #d0d0d0 !important;
    margin: 0;
    font-weight: 500;
    position: relative;
    z-index: 2;
}

.drill-total-score {
    text-align: center;
    margin: 14px 0;
    padding: 12px;
    
    background: 
        linear-gradient(
            135deg,
            #383838 0%,
            #404040 100%
        ),
        linear-gradient(
            to bottom,
            rgba(0, 0, 0, 0.4) 0%,
            rgba(0, 0, 0, 0.2) 50%,
            rgba(0, 0, 0, 0.3) 100%
        ) !important;
    
    background-blend-mode: overlay, multiply !important;
    border-radius: 8px;
    border: 1.5px solid #585858;
    position: relative;
    z-index: 2;
    
    box-shadow: 
        inset 0 1px 0 rgba(255, 255, 255, 0.08),
        inset 0 -1px 0 rgba(0, 0, 0, 0.4),
        inset 0 0 15px rgba(0, 0, 0, 0.3),
        0 3px 8px rgba(0, 0, 0, 0.3) !important;
}

.total-score-label {
    font-family: "Rationale", sans-serif;
    font-size: 11px;
    color: #ffffff !important;
    margin-bottom: 6px;
    text-transform: uppercase;
    letter-spacing: 1.2px;
    font-weight: 500;
    position: relative;
    z-index: 2;
}

.total-score-value {
    font-family: "Share Tech Mono", monospace;
    font-size: 24px;
    font-weight: bold;
    color: #fe0100 !important;
    text-shadow: 
        0 0 10px rgba(254, 1, 0, 0.5),
        0 1px 4px rgba(0, 0, 0, 0.5);
    letter-spacing: 0.8px;
    position: relative;
    z-index: 2;
}

/* ===== HORIZONTAL PROGRESS BARS - CONSISTENT ACROSS DEVICES ===== */
.skill-bars-container {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-top: 16px;
    width: 100%;
    position: relative;
    z-index: 2;
}

/* Horizontal row layout */
.skill-bar-column {
    display: flex;
    flex-direction: row !important;
    align-items: center;
    gap: 12px;
    width: 100% !important;
    max-width: 100% !important;
    margin-bottom: 8px;
}

/* REORDERED: Number → Name → Progress Bar → Percentage */
.skill-number {
    font-family: "Share Tech Mono", monospace;
    font-size: 12px;
    color: #fe0100 !important;
    font-weight: bold;
    min-width: 24px;
    text-align: left;
    margin-bottom: 0;
    margin-right: 8px;
    order: 1; /* Number first */
}

.skill-name-vertical {
    writing-mode: horizontal-tb !important;
    transform: none !important;
    font-family: "Rationale", sans-serif;
    font-size: 12px;
    color: #ffffff !important;
    margin-top: 0;
    height: auto;
    padding-left: 0;
    text-align: left;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    min-width: 80px;
    flex-shrink: 0;
    order: 2; /* Name second */
}

/* LONG AND THIN PROGRESS BARS - CONSISTENT SIZE */
.skill-bar-vertical {
    flex: 1;
    height: 14px !important; /* LONG AND THIN - SAME ON ALL DEVICES */
    min-width: 150px;
    background: #2a2a2a !important;
    border: 2px solid #444 !important;
    border-radius: 7px !important;
    position: relative !important;
    overflow: hidden !important;
    order: 3; /* Progress bar third */
    
    box-shadow: 
        inset 0 1px 4px rgba(0, 0, 0, 0.8),
        0 2px 6px rgba(0, 0, 0, 0.6) !important;
}

.skill-bar-fill {
    position: absolute !important;
    top: 0 !important;
    left: 0 !important;
    width: var(--fill-width, 0%) !important;
    height: 100% !important;
    
    background: linear-gradient(
        90deg,
        #fe0100 0%,
        #ff2a28 50%,
        #fe0100 100%
    ) !important;
    
    box-shadow: 
        inset 0 1px 3px rgba(255, 255, 255, 0.3),
        inset 0 -1px 3px rgba(0, 0, 0, 0.4),
        0 0 8px rgba(254, 1, 0, 0.5) !important;
    
    transition: width 0.3s ease !important;
}

.skill-percentage {
    font-family: "Share Tech Mono", monospace;
    font-size: 12px;
    color: #ffffff !important;
    min-width: 35px;
    text-align: right;
    font-weight: bold;
    margin-bottom: 0;
    order: 4; /* Percentage last (on the right) */
}

/* ===== FIX RESPONSIVE DESIGN - REMOVE VERTICAL CODE ===== */

/* Tablet and Mobile (768px and below) - UPDATED */
@media (max-width: 768px) {
    .dynamic-analysis-grid {
        margin: 15px 15px 20px 15px !important;
        padding: 20px 15px !important;
        width: calc(100% - 30px) !important;
        gap: 20px;
    }
    
    .dynamic-analysis-card {
        padding: 18px;
        border-radius: 12px;
        width: 320px !important;
        min-width: 320px !important;
        max-width: 320px !important;
    }
    
    .skill-bars-container {
        gap: 10px !important;
    }
    
    /* REMOVED VERTICAL CODE - KEEP HORIZONTAL */
    .skill-bar-column {
        max-width: 100% !important;
        padding: 0;
    }
    
    /* KEEP PROGRESS BARS LONG AND THIN */
    .skill-bar-vertical {
        height: 14px !important; /* SAME HEIGHT - NOT VERTICAL */
        width: auto !important; /* NOT 20px */
        min-width: 120px;
    }
    
    /* KEEP NAMES HORIZONTAL */
    .skill-name-vertical {
        height: auto !important; /* NOT 120px */
        font-size: 12px !important;
        padding-left: 0;
        white-space: nowrap !important;
        max-width: none;
        line-height: normal !important;
    }
    
    .drill-card-title {
        font-size: 17px;
    }
    
    .drill-card-subtitle {
        font-size: 12px;
    }
    
    .total-score-value {
        font-size: 24px;
    }
    
    .dynamic-analysis-modal .title-text {
        font-size: 18px !important;
        padding: 18px 20px 10px 20px;
    }
    
    .dynamic-analysis-modal .subtitle {
        font-size: 12px !important;
        padding: 8px 20px 12px 20px;
    }
}

/* Small Mobile (480px and below) - UPDATED */
@media (max-width: 480px) {
    .dynamic-analysis-grid {
        margin: 10px 10px 15px 10px !important;
        padding: 15px 10px !important;
        width: calc(100% - 20px) !important;
        gap: 15px;
    }
    
    .dynamic-analysis-card {
        padding: 16px;
        width: 300px !important;
        min-width: 300px !important;
        max-width: 300px !important;
    }
    
    .skill-bars-container {
        gap: 8px !important;
    }
    
    /* KEEP HORIZONTAL - REMOVE VERTICAL */
    .skill-bar-column {
        max-width: 100% !important;
    }
    
    /* PROGRESS BARS STAY LONG AND THIN */
    .skill-bar-vertical {
        height: 12px !important; /* Still thin, just slightly smaller */
        width: auto !important; /* NOT 18px */
        min-width: 100px;
    }
    
    /* NAMES STAY HORIZONTAL */
    .skill-name-vertical {
        height: auto !important; /* NOT 100px */
        font-size: 11px !important;
        max-width: none;
        white-space: nowrap;
    }
    
    .skill-number {
        font-size: 11px;
        min-width: 20px;
    }
    
    .skill-percentage {
        font-size: 11px;
        min-width: 30px;
    }
    
    .dynamic-analysis-actions {
        padding: 15px;
        width: calc(100% - 40px);
        max-width: 500px;
    }
    
    .nav-arrow-btn {
        width: 40px;
        height: 40px;
    }
}

/* Extra Small (380px and below) */
@media (max-width: 380px) {
    .dynamic-analysis-card {
        width: 280px !important;
        min-width: 280px !important;
        max-width: 280px !important;
        padding: 14px;
    }
    
    .skill-bar-vertical {
        min-width: 80px;
        height: 10px !important; /* Still thin */
    }
}
/* ===== ACTION SECTION - CENTERED & TIGHTENED ===== */
.dynamic-analysis-actions {
    background: rgba(20, 20, 20, 0.85) !important;
    backdrop-filter: blur(20px) saturate(180%) !important;
    border: 1px solid rgba(255, 255, 255, 0.12) !important;
    border-radius: 10px;
    box-shadow: 
        inset 0 1px 0 rgba(255, 255, 255, 0.04),
        inset 0 0 20px rgba(0, 0, 0, 0.5) !important;
    margin: 10px auto 20px auto !important; /* REDUCED MARGIN */
    padding: 16px 20px; /* REDUCED PADDING */
    width: calc(100% - 40px); /* WIDER RELATIVE TO CARD */
    max-width: 500px;

    display: flex;
    justify-content: center; /* CENTERED CONTENT */
    align-items: center;
    gap: 15px; /* SPACE BETWEEN ARROWS AND BUTTON */
}

/* Arrow buttons - smaller and closer */
.nav-arrow-btn {
    background: rgba(25, 25, 25, 0.9) !important;
    border: 1px solid rgba(183, 155, 108, 0.3) !important;
    color: var(--gold-soft) !important;
    width: 38px; /* SMALLER */
    height: 38px; /* SMALLER */
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    flex-shrink: 0;
    font-size: 13px;
}

.nav-arrow-btn:hover:not(:disabled) {
    background: rgba(35, 35, 35, 0.95) !important;
    border-color: var(--gold-soft) !important;
    transform: translateY(-1px);
    box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
}

.nav-arrow-btn:disabled {
    opacity: 0.3;
    cursor: not-allowed;
}

/* Close button - centered and tighter */
.btn-close {
    background: rgba(254, 1, 0, 0.15) !important;
    border: 2px solid #fe0100 !important;
    color: #fe0100 !important;
    padding: 10px 24px;
    border-radius: 6px;
    font-family: "Rationale", sans-serif;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    letter-spacing: 0.5px;
    min-width: 140px;
    text-align: center;
    order: 0; /* Ensures it stays in the middle */
}

.btn-close:hover {
    background: rgba(254, 1, 0, 0.25) !important;
    box-shadow: 0 0 15px rgba(254, 1, 0, 0.4);
    transform: translateY(-1px);
}

/* ===== RESPONSIVE ADJUSTMENTS ===== */
@media (max-width: 768px) {
    .dynamic-analysis-actions {
        margin: 8px auto 16px auto !important; /* TIGHTER */
        padding: 14px 18px;
        width: calc(100% - 30px);
        gap: 12px;
    }
    
    .nav-arrow-btn {
        width: 36px;
        height: 36px;
        font-size: 12px;
    }
    
    .btn-close {
        padding: 9px 20px;
        font-size: 13px;
        min-width: 130px;
    }
}

@media (max-width: 480px) {
    .dynamic-analysis-actions {
        margin: 6px auto 12px auto !important; /* EVEN TIGHTER */
        padding: 12px 15px;
        width: calc(100% - 20px);
        gap: 10px;
    }
    
    .nav-arrow-btn {
        width: 34px;
        height: 34px;
        font-size: 11px;
    }
    
    .btn-close {
        padding: 8px 18px;
        font-size: 12px;
        min-width: 120px;
    }
}

@media (max-width: 380px) {
    .dynamic-analysis-actions {
        padding: 10px 12px;
        gap: 8px;
    }
    
    .nav-arrow-btn {
        width: 32px;
        height: 32px;
    }
    
    .btn-close {
        padding: 7px 16px;
        font-size: 11px;
        min-width: 110px;
    }
}
/* ===== LEGAL CARDS STYLES ===== */
.legal-cards-section {
    margin: 20px 0;
}

.legal-cards-container {
    display: flex;
    overflow-x: auto;
    gap: 15px;
    padding: 10px 5px;
    scrollbar-width: thin;
    scrollbar-color: var(--red-x) var(--charcoal);
    -webkit-overflow-scrolling: touch;
}

.legal-cards-container::-webkit-scrollbar {
    height: 8px;
}

.legal-cards-container::-webkit-scrollbar-track {
    background: var(--charcoal);
    border-radius: 4px;
}

.legal-cards-container::-webkit-scrollbar-thumb {
    background: var(--red-x);
    border-radius: 4px;
}

.legal-card {
    flex: 0 0 auto;
    width: 280px;
    background: white;
    border: 2px solid var(--charcoal);
    border-radius: 8px;
    overflow: hidden;
    transition: all 0.3s ease;
}

.legal-card:hover {
    transform: translateY(-5px);
}

.legal-card-header {
    background: var(--charcoal);
    padding: 15px;
    text-align: center;
}

.legal-card-title {
    font-family: "Stardos Stencil", serif;
    font-size: 18px;
    color: var(--red-x);
    margin: 0;
}

.legal-card-body {
    padding: 15px;
    color: #000;
}

.legal-card-features {
    list-style: none;
    padding: 0;
    margin: 0 0 15px 0;
}

.legal-card-features li {
    padding: 8px 0;
    border-bottom: 1px solid #1a1a1a;
    display: flex;
    align-items: center;
    color: #000;
    font-size: 14px;
}

.legal-card-features li:last-child {
    border-bottom: none;
}

.legal-card-features li::before {
    content: "✓";
    color: var(--gold-soft);
    font-weight: bold;
    margin-right: 10px;
    font-size: 16px;
}

.legal-card-actions {
    display: flex;
    justify-content: center;
    margin-top: 10px;
}

.btn-legal {
    background: linear-gradient(135deg, var(--red-x), #3a0b16);
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
    font-family: "Rationale", sans-serif;
    font-weight: bold;
    transition: all 0.3s ease;
    width: 100%;
}

.btn-legal:hover {
    background: linear-gradient(135deg, #ff3333, #4a0f1c);
    transform: translateY(-2px);
}
/* ===== LEGAL MODAL STYLES ===== */
.legal-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.85);
    z-index: 1012;
    justify-content: center;
    align-items: center;
    overflow-y: auto;
}

.legal-modal-content {
    background: linear-gradient(180deg, var(--charcoal-light), var(--charcoal));
    border: 1px solid var(--bronze);
    border-radius: 8px;
    padding: 20px;
    width: 90%;
    max-width: 800px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 5px 15px rgba(0,0,0,0.7);
    position: relative;
}

.close-legal-modal {
    position: absolute;
    top: 10px;
    right: 10px;
    background: none;
    border: none;
    color: var(--gold-soft);
    font-size: 24px;
    cursor: pointer;
    z-index: 1013;
}

.legal-modal-title {
    font-family: "Stardos Stencil", serif;
    font-size: 22px;
    color: var(--red-x);
    margin: 0 0 10px 0;
    text-align: center;
}

.legal-modal-subtitle {
    font-family: "Rationale", sans-serif;
    font-size: 16px;
    color: var(--gold-soft);
    margin: 0 0 20px 0;
    text-align: center;
}

.legal-content-section {
    margin-bottom: 20px;
}

.legal-content-section .subhead {
    color: var(--gold-soft);
    margin-bottom: 10px;
    font-size: 18px;
}

.legal-content-section p {
    margin: 10px 0;
    line-height: 1.6;
}

.legal-content-section ul {
    margin: 10px 0;
    padding-left: 20px;
}

.legal-content-section li {
    margin: 8px 0;
    color: var(--eggshell);
}

.legal-table-container {
    width: 100%;
    overflow-x: auto;
    margin: 15px 0;
    scrollbar-width: thin;
    scrollbar-color: var(--red-x) var(--charcoal);
}

.legal-table-container::-webkit-scrollbar {
    height: 8px;
}

.legal-table-container::-webkit-scrollbar-track {
    background: var(--charcoal);
    border-radius: 4px;
}

.legal-table-container::-webkit-scrollbar-thumb {
    background: var(--red-x);
    border-radius: 4px;
}

.legal-table {
    width: 100%;
    border-collapse: collapse;
    min-width: 600px;
    background: linear-gradient(180deg, var(--card-bg-top), var(--card-bg-btm));
}

.legal-table th,
.legal-table td {
    padding: 10px 12px;
    text-align: left;
    border: 1px solid #333;
    font-size: 14px;
}

.legal-table th {
    background: linear-gradient(180deg, #2a2a2a, #1a1a1a);
    color: var(--gold-soft);
    font-weight: bold;
}

.legal-table tr:nth-child(even) {
    background: rgba(255,255,255,0.05);
}

.legal-table tr:hover {
    background: rgba(255,255,255,0.1);
}

.legal-notes-section {
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid var(--bronze);
}

.legal-notes-section .subhead {
    color: var(--gold-soft);
    margin-bottom: 10px;
}

.legal-notes-textarea {
    width: 100%;
    min-height: 120px;
    resize: vertical;
    border: 1px solid #3a3a3a;
    padding: 12px;
    margin-bottom: 10px;
    background: linear-gradient(180deg,#0f0f0f 0%,#161616 100%);
    color: var(--eggshell);
    font-family: "Share", serif;
    font-size: 16px;
}

.legal-notes-actions {
    display: flex;
    justify-content: space-between;
    gap: 10px;
}

.legal-notes-actions button {
    flex: 1;
    padding: 10px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-family: "Rationale", sans-serif;
    font-weight: bold;
    transition: all 0.3s ease;
}

.btn-save-notes {
    background: linear-gradient(135deg, var(--bronze), var(--charcoal-light));
    color: white;
}

.btn-save-notes:hover {
    background: linear-gradient(135deg, var(--gold-soft), var(--bronze));
    transform: translateY(-2px);
}

.btn-send-notes {
    background: linear-gradient(135deg, var(--red-x), #3a0b16);
    color: white;
}

.btn-send-notes:hover {
    background: linear-gradient(135deg, #ff3333, #4a0f1c);
    transform: translateY(-2px);
}

/* Make all text boxes charcoal color */
input[type="text"], 
input[type="date"], 
textarea, 
.form-control, 
.initials-box {
    background: #1a1a1a !important;
    border: 1px solid #555 !important;
    color: var(--eggshell) !important;
    padding: 10px 12px !important;
    border-radius: 4px;
    font-size: 16px;
    font-family: "Share", serif;
}

/* Focus states */
input[type="text"]:focus, 
input[type="date"]:focus, 
textarea:focus, 
.form-control:focus, 
.initials-box:focus {
    outline: none;
    border-color: var(--gold-soft) !important;
    box-shadow: 0 0 5px rgba(183, 155, 108, 0.5);
}

/* Fix checkbox sizing - ensure consistent size */
.chk {
    appearance: none;
    width: 32px !important;
    height: 32px !important;
    min-width: 32px !important;
    min-height: 32px !important;
    cursor: pointer;
    border: 2px solid var(--gold-soft) !important;
    background: #1a1a1a !important;
    box-shadow: 0 3px 6px rgba(0,0,0,0.8), inset 0 1px 0 rgba(255,255,255,0.15) !important;
    display: inline-block;
    vertical-align: middle;
    border-radius: 0;
    margin: 0;
    flex-shrink: 0; /* Prevent squishing */
}

/* When checked → larger, thicker red X */
.chk:checked {
    background: #1a1a1a url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='28' height='28' viewBox='0 0 28 28'%3E%3Cpath fill='none' stroke='%23ff0000' stroke-width='6' d='M4,4 L24,24 M24,4 L4,24'/%3E%3C/svg%3E") no-repeat center center !important;
    background-size: 24px 24px !important;
    border: 2px solid var(--gold-soft) !important;
    box-shadow: 0 6px 12px rgba(0,0,0,0.9) !important;
}

/* Ensure checkbox containers don't compress the checkboxes */
.checks li {
    display: grid;
    grid-template-columns: 32px 1fr;
    gap: 12px;
    margin: 8px 0;
    align-items: center;
}

/* Fix for waiver checkboxes specifically */
.waiver-checkbox input[type="checkbox"] {
    width: 24px !important;
    height: 24px !important;
    min-width: 24px !important;
    min-height: 24px !important;
    flex-shrink: 0;
}

/* Ensure check-all checkbox is proper size */
.check-all-checkbox {
    width: 32px !important;
    height: 32px !important;
    min-width: 32px !important;
    min-height: 32px !important;
}

/* ===== WAIVERS CARD STYLES ===== */
.waivers-card {
    background: linear-gradient(145deg, #2c2c2c 0%, #1f1f1f 100%);
    border: 1px solid var(--bronze);
    border-radius: 8px;
    overflow: hidden;
    transition: all 0.3s ease;
    position: relative;
    cursor: pointer;
    padding: 20px;
}

.waivers-card:hover {
    transform: translateY(-5px);
    border-color: var(--gold-soft);
}

.waivers-card-header {
    margin-bottom: 15px;
    text-align: center;
}

.waivers-card-title {
    font-family: "Stardos Stencil", serif;
    font-size: 22px;
    color: var(--red-x);
    margin: 0 0 5px 0;
}

.waivers-card-subtitle {
    font-family: "Rationale", sans-serif;
    font-size: 16px;
    color: var(--gold-soft);
    margin: 0;
}

.waivers-card-content {
    margin-bottom: 15px;
    text-align: center;
}

.waivers-card-progress {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    margin-bottom: 15px;
}

.waivers-progress-wheel-container {
    position: relative;
    width: 80px;
    height: 80px;
}

.waivers-progress-wheel {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background: conic-gradient(
        var(--red-x) 0deg, 
        var(--red-x) var(--progress, 0deg), 
        var(--charcoal-lighter) var(--progress, 0deg), 
        var(--charcoal-lighter) 360deg
    );
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
}

.waivers-progress-wheel::before {
    content: '';
    position: absolute;
    width: 60px;
    height: 60px;
    background: linear-gradient(180deg, var(--card-bg-top), var(--card-bg-btm));
    border-radius: 50%;
    z-index: 1;
}

.waivers-progress-percentage {
    position: relative;
    z-index: 2;
    font-family: "Rationale", sans-serif;
    font-size: 16px;
    font-weight: bold;
    color: var(--eggshell);
    text-shadow: 0 2px 4px rgba(0,0,0,.9);
}

.waivers-card-footer {
    display: flex;
    justify-content: center;
    margin-top: 15px;
}

.waivers-card-btn {
    background: linear-gradient(135deg, var(--bronze), var(--charcoal-light));
    color: white;
    border: none;
    padding: 10px 18px;
    border-radius: 4px;
    cursor: pointer;
    font-family: "Rationale", sans-serif;
    font-weight: bold;
    transition: all 0.3s ease;
    font-size: 14px;
}

.waivers-card-btn:hover {
    background: linear-gradient(135deg, var(--gold-soft), var(--bronze));
    transform: translateY(-2px);
}

/* Close buttons for waivers section */
.waivers-close-btn {
    background: #000;
    color: white;
    border: 1px solid var(--bronze);
    border-radius: 50%;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-family: "Rationale", sans-serif;
    font-weight: bold;
    transition: all 0.3s ease;
    margin: 10px auto;
}

.waivers-close-btn:hover {
    background: var(--red-x);
    transform: scale(1.1);
}

/* ===== FIXED Drills PHASE CARD STYLES - CHARCOAL GRADIENT ===== */
.phase-card {
    background: linear-gradient(145deg, #2c2c2c 0%, #1f1f1f 100%);
    border: 1px solid var(--bronze);
    border-radius: 8px;
    overflow: hidden;
    transition: all 0.3s ease;
    position: relative;
}

.phase-card:hover {
    transform: translateY(-5px);
    border-color: var(--gold-soft);
}

.phase-card-header {
    background: linear-gradient(135deg, var(--charcoal), var(--charcoal-light));
    padding: 15px 20px;
    border-bottom: 1px solid var(--bronze);
    position: relative;
    overflow: hidden;
}

.phase-card-title {
    font-family: "Stardos Stencil", serif;
    font-size: 18px;
    color: var(--red-x);
    margin: 0 0 5px 0;
}

.phase-card-subtitle {
    font-size: 13px;
    color: #aaa;
    margin: 0;
}

.phase-card-progress {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 5px;
}

.phase-progress-wheel-container {
    position: relative;
    width: 57.5px;
    height: 57.5px;
}

.phase-progress-wheel {
    width: 57.5px;
    height: 57.5px;
    border-radius: 50%;
    background: conic-gradient(var(--bronze) var(--progress), #333 0deg);
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
}

.phase-progress-wheel::before {
    content: '';
    position: absolute;
    width: 46px;
    height: 46px;
    background: linear-gradient(145deg, #2c2c2c 0%, #1f1f1f 100%);
    border-radius: 50%;
}

.phase-progress-percentage {
    position: relative;
    font-size: 13.8px;
    font-weight: bold;
    color: var(--bronze);
    z-index: 1;
}

.phase-card-progress span {
    font-size: 11px;
    color: #aaa;
    text-transform: uppercase;
    letter-spacing: 1px;
}

/* Phase card actions - CHANGED: Push buttons to bottom */
.phase-card-actions {
    display: flex;
    gap: 10px;
    justify-content: center;
    width: 100%;
    margin-top: auto; /* ONLY CHANGE 1: Push buttons to bottom */
}

/* Remove any green gradient styles - NO CHANGES */
.phase-card .phase-card-content {
    background: linear-gradient(145deg, #47483d 0%, #303129 100%) !important;
}

.phase-card .phase-card-footer {
    background: linear-gradient(145deg, #2c2c2c 0%, #1f1f1f 100%) !important;
}
/* PHASE CARDS*/
.phase-card-features li {
    position: relative;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    margin-bottom: 8px;
}

/* DARK GRADIENT (from course cards) */
.phase-card-features li::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(
        to right,
        rgba(0,0,0,0.6) 0%,
        rgba(0,0,0,0.3) 15%,
        rgba(255,255,255,0.1) 30%,
        rgba(255,255,255,0.15) 50%,
        rgba(255,255,255,0.1) 70%,
        rgba(0,0,0,0.3) 85%,
        rgba(0,0,0,0.6) 100%
    );
    opacity: 0.4;
    pointer-events: none;
    z-index: 0;
    transition: opacity 0.3s ease;
}

.phase-card:hover .phase-card-features li::after {
    opacity: 0.6;
}

/* METALLIC SHIMMER (from course cards - on even items) */
.phase-card-features li:nth-child(even)::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(120deg, #111, #eee, #fff, #eee, #111);
    background-size: 300% 300%;
    opacity: 0;
    z-index: 0;
    transition: opacity 0.3s ease-in-out;
}

.phase-card:hover .phase-card-features li:nth-child(even)::before {
    opacity: 0.5;
    animation: shine 2.5s linear infinite;
}

.phase-card-features li:nth-child(even)::before {
    color: #ffffff !important;
    text-shadow: 
        0 0 8px rgba(255,255,255,0.9),
        0 1px 0 #000,
        0 -1px 0 rgba(0,0,0,0.5);
}

.phase-card-features li:nth-child(odd)::before {
    color: #ffffff !important;
    text-shadow: 
        0 0 6px rgba(0,0,0,0.8),
        0 1px 0 rgba(255,255,255,0.3);
}

/* KEEP TEXT ABOVE */
.phase-card-features li > * {
    position: relative;
    z-index: 2;
}

/* SHINE ANIMATION */
@keyframes shine {
    0% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

/* Drills Fix progress wheel positioning */
.phase-card-progress {
    display: flex;
    align-items: center;
    gap: 12px;
}

.phase-progress-wheel-container {
    position: relative;
    width: 60px;
    height: 60px;
    margin-right: 5px;
    /* ADD GREY OUTLINE TO CONTAINER */
    box-shadow: 0 0 0 2px #000000;
    border-radius: 50%;
    padding: 1px; /* creates space between wheel and outline */
}

/* DRILLS/PHASE PROGRESS WHEEL - UPDATED */
.phase-progress-wheel {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    /* ENHANCED DARK DROP SHADOW WITH WHITE HIGHLIGHTS */
     box-shadow: 
        0 3px 8px rgba(0,0,0,0.7),     /* was 0 4px 12px */
        0 5px 15px rgba(0,0,0,0.5),    /* was 0 8px 20px */
        0 8px 25px rgba(0,0,0,0.3),    /* was 0 12px 30px */
        /* keep white accents */
        0 0 0 1px rgba(255,255,255,0.1),
        inset 0 0 0 1px rgba(255,255,255,0.05),
        /* keep inner shadows */
        inset 0 0 15px rgba(0,0,0,0.6),
        inset 0 0 25px rgba(0,0,0,0.3);
}
/* RED RIBBON WITH TRACED BLACK LINES & GLOW - UPDATED */
.phase-progress-wheel::after {
    content: '';
    position: absolute;
    top: -2px;
    left: -2px;
    right: -2px;
    bottom: -2px;
    border-radius: 50%;
    /* WITNESS RED PROGRESS RIBBON WITH GLOW */
    background: conic-gradient(
        var(--red-x) 0deg, 
        var(--red-x) var(--progress, 0deg), 
        transparent var(--progress, 0deg), 
        transparent 360deg
    );
    /* MASK FOR OUTER RIBBON */
    -webkit-mask: radial-gradient(
        circle,
        transparent 55%,
        black 56%,
        black 82%,
        transparent 83%
    );
    mask: radial-gradient(
        circle,
        transparent 55%,
        black 56%,
        black 82%,
        transparent 83%
    );
    z-index: 0;
    /* TRACED BLACK LINES FOR DEPTH */
    box-shadow: 
        /* INNER BLACK LINE (inside ribbon) */
        inset 0 0 0 1px rgba(0,0,0,0.9),
        /* OUTER BLACK LINE (outside ribbon) */
        0 0 0 1px rgba(0,0,0,0.9),
        /* SUBTLE WHITE HIGHLIGHTS FOR 3D */
        inset 0 1px 0 rgba(255,255,255,0.15),
        inset 0 -1px 0 rgba(0,0,0,0.8);
    /* RED GLOW THAT INCREASES WITH PROGRESS */
    filter: drop-shadow(0 0 2px rgba(255,0,0,0.3))
            drop-shadow(0 0 4px rgba(255,0,0,calc(var(--progress, 0deg) / 720)));
    pointer-events: none;
    transition: filter 0.5s ease;
}

/* PERCENTAGE TEXT - ENHANCED WITH WHITE ACCENTS */
.phase-progress-percentage {
    position: relative;
    z-index: 2;
    font-family: "Rationale", sans-serif;
    font-size: 18px;
    font-weight: bold;
    color: #ffffff !important;
    /* WHITE ACCENT FOR 3D TEXT */
    text-shadow: 
        /* Black outline for depth */
        0 1px 0 #000,
        0 2px 0 #000,
        /* White highlight on top */
        0 -1px 0 rgba(255,255,255,0.2),
        /* Red glow */
        0 0 4px rgba(255,0,0,0.5),
        0 0 8px rgba(255,0,0,0.3),
        0 0 12px rgba(255,0,0,0.1);
    letter-spacing: 0.5px;
    pointer-events: none;
}

/* GLOW ANIMATION FOR PROGRESS */
@keyframes ribbon-glow {
    0%, 100% { 
        filter: drop-shadow(0 0 2px rgba(255,0,0,0.3))
                drop-shadow(0 0 4px rgba(255,0,0,0.2));
    }
    50% { 
        filter: drop-shadow(0 0 4px rgba(255,0,0,0.6))
                drop-shadow(0 0 8px rgba(255,0,0,0.4));
    }
}

/* APPLY GLOW WHEN PROGRESS > 0 */
.phase-progress-wheel[style*="--progress"]:not([style*="--progress: 0deg"])::after {
    animation: ribbon-glow 2s infinite;
}

/* Drills Phase card buttons - ENHANCED WITH WHITE ACCENTS */
.phase-card-btn {
    background: linear-gradient(135deg, var(--bronze), var(--charcoal-light));
    color: white;
    border: none;
    padding: 10px 18px;
    border-radius: 4px;
    cursor: pointer;
    font-family: "Rationale", sans-serif;
    font-weight: bold;
    transition: all 0.3s ease;
    font-size: 14px;
    margin-left: 10px;
    /* WHITE ACCENT BORDER */
    border: 1px solid rgba(255,255,255,0.1);
    box-shadow: 
        0 2px 4px rgba(0,0,0,0.5),
        inset 0 1px 0 rgba(255,255,255,0.1);
}

.phase-card-btn:hover {
    background: #000 !important;
    border-color: #ff0000 !important;
    color: #ff0000 !important;
    transform: translateY(-2px);
}

.dynamic-ds-btn:hover {
    border-color: #ff0000 !important;
    color: #ff0000 !important;
}

/* PROGRESS WHEEL BORDER */
.phase-card-features li:nth-child(even)::before {
    color: #ffffff !important;
    /* BLACK OUTLINE FOR CONTRAST */
    text-shadow: 
        0 0 5px rgba(255,255,255,0.7),
        0 1px 0 #000,
        0 -1px 0 rgba(0,0,0,0.5);
}

/* ===== PHASE CARD FEATURES - EXACT MATCH TO COURSE CARDS ===== */
.phase-card-features li:nth-child(odd)::before {
    color: #ffffff !important;
    text-shadow: 
        0 0 6px rgba(0,0,0,0.8),
        0 1px 0 rgba(255,255,255,0.3);
    font-size: 20px !important;
    font-weight: 900;
}

.phase-card-features li:nth-child(even)::before {
    color: #ffffff !important;
    text-shadow: 
        0 0 8px rgba(255,255,255,0.9),
        0 1px 0 #000,
        0 -1px 0 rgba(0,0,0,0.5);
    font-size: 20px !important;
    font-weight: 900;
}

/* STATIC GRADIENT - EXACT COPY FROM COURSE CARDS */
.phase-card-features li {
    position: relative;
    overflow: hidden;
    padding: 8px 0;
    border-bottom: 1px solid rgba(255,255,255,0.07);
    display: flex;
    align-items: center;
}

.phase-card-features li::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(
        to right,
        rgba(0,0,0,0.6) 0%,
        rgba(0,0,0,0.3) 15%,
        rgba(255,255,255,0.1) 30%,
        rgba(255,255,255,0.15) 50%,
        rgba(255,255,255,0.1) 70%,
        rgba(0,0,0,0.3) 85%,
        rgba(0,0,0,0.6) 100%
    );
    opacity: 0.4;
    pointer-events: none;
    z-index: 0;
    transition: opacity 0.3s ease;
}

.phase-card:hover .phase-card-features li::after {
    opacity: 0.6;
}

/* METALLIC SHIMMER ON HOVER - EXACT COPY FROM COURSE CARDS */
.phase-card-features li:nth-child(even)::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(120deg, #111, #eee, #fff, #eee, #111);
    background-size: 300% 300%;
    opacity: 0;
    z-index: 0;
    transition: opacity 0.3s ease-in-out;
}

.phase-card:hover .phase-card-features li:nth-child(even)::before {
    opacity: 0.5;
    animation: shine 2.5s linear infinite;
}

/* TEXT ABOVE EFFECTS WITH DROPSHADOW */
.phase-card-features li > * {
    position: relative;
    z-index: 1;
    text-shadow: 0 1px 3px rgba(0,0,0,0.5);
}

.phase-card:hover .phase-card-features li > * {
    text-shadow: 0 2px 6px rgba(0,0,0,0.8), 0 0 10px rgba(0,0,0,0.4);
}

/* SHINE ANIMATION */
@keyframes shine {
    0% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}


/* Phase card actions - NO CHANGES */
.phase-card-actions {
    display: flex;
    gap: 10px;
}

/* Remove any green gradient styles - NO CHANGES */
.phase-card .phase-card-content {
    background: linear-gradient(145deg, #47483d 0%, #303129 100%) !important;
}

.phase-card .phase-card-footer {
    background: linear-gradient(145deg, #2c2c2c 0%, #1f1f1f 100%) !important;
}

/* Ensure grid cells maintain equal width regardless of content */
.phase-card-footer {
    display: grid !important;
    grid-template-columns: minmax(0, 1fr) minmax(0, 1fr) !important; /* Equal, content-contained columns */
    grid-template-rows: 3fr .7fr !important;
    gap: 15px !important;
    padding: 15px !important;
    min-height: 200px !important;
    box-sizing: border-box !important;
}

/* ALIEN VIDEO GAME STYLE PROGRESS BARS - SOLID RED ONLY */
.phase-progress-bars-vertical {
    display: flex !important;
    flex-direction: row !important;
    gap: 10px !important;
    align-items: flex-end !important;
    justify-content: center !important;
    height: 100% !important;
    width: 100% !important;
    padding: 10px !important;
}

/* Individual Alien Bar - Clean Solid Design */
.progress-bar {
    width: 16px !important;
    height: 80px !important;
    background: rgba(10, 10, 10, 0.95) !important; /* Deep space black */
 border: 2px solid #c0c0c0 !important; /* CHANGED: Chrome/silver border */
    border-radius: 0px !important; /* Sharp tech edges */
    position: relative !important;
    overflow: hidden !important;
    box-shadow: 
        0 0 10px rgba(192, 192, 192, 0.3), /* Chrome glow */
        inset 0 0 15px rgba(0, 0, 0, 0.9) !important;
}

/* Progress Fill - SOLID BRIGHT RED */
.progress-bar::after {
    content: '' !important;
    position: absolute !important;
    bottom: 0 !important;
    left: 0 !important;
    width: 100% !important;
    height: var(--progress, 50%) !important;
    
    /* PURE SOLID ALIEN RED */
    background: #fe0100 !important;
    
    /* Subtle alien glow */
    box-shadow: 
        inset 0 0 15px rgba(255, 50, 50, 0.6),
        inset 0 0 5px rgba(255, 255, 255, 0.2),
        0 0 10px rgba(254, 1, 0, 0.5) !important;
    
    transition: height 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) !important;
}

/* Active pulse when progress increases */
.progress-bar.progress-increasing::after {
    animation: redPulse 0.8s ease !important;
}

@keyframes redPulse {
    0% { box-shadow: 0 0 5px rgba(254, 1, 0, 0.5); }
    50% { 
        box-shadow: 
            0 0 20px rgba(254, 1, 0, 0.9),
            0 0 10px rgba(192, 192, 192, 0.3); /* Add chrome glow */
    }
    100% { box-shadow: 0 0 10px rgba(254, 1, 0, 0.5); }
}

/* Optional: Add a faint grid pattern for alien tech feel */
.progress-bar::before {
    content: '' !important;
    position: absolute !important;
    top: 0 !important;
    left: 0 !important;
    width: 100% !important;
    height: 100% !important;
    background-image: 
        linear-gradient(to bottom, 
            transparent 95%, 
           rgba(192, 192, 192, 0.1) 100% /* Chrome highlight */
        ) !important;
    background-size: 100% 10px !important;
    pointer-events: none !important;
    z-index: 1 !important;
}


/* Progress wheel container */
.phase-card-progress {
    display: flex !important;
    flex-direction: column !important;
    align-items: center !important;
    justify-content: center !important;
    gap: 10px !important;
    padding: 10px !important;
    margin-top: 30px !important; /* Pushes entire container down */
    margin-left: 20px !important;
}

/* ===== EXACT MATCH OF YOUR WORKING WHEEL ===== */
.phase-progress-wrapper {
    position: relative;
    width: 60px;
    height: 60px;
    flex-shrink: 0;
    margin-right: 15px;
}

.tactical-progress-wheel {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background: none !important;
    border: 4px solid #1a1a1a !important;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    box-shadow: 
        inset 0 0 15px rgba(0,0,0,0.8),
        0 4px 10px rgba(0,0,0,0.6),
        0 0 0 1px #555,
        0 0 20px rgba(0,0,0,0.5) !important;
}

/* Center - FROM YOUR APP line 1584+ */
.tactical-progress-wheel::before {
    content: '';
    position: absolute;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    background: radial-gradient(
        circle at center,
        #6a613c 0%,
        #59521c 40%,
        #3d3713 60%,
        #1a1a1a 80%,
        #000000 95%
    );
    background-image: 
        radial-gradient(
            circle at 40% 40%,
            rgba(255, 255, 220, 0.25) 0%,
            rgba(255, 255, 200, 0.15) 10%,
            transparent 25%
        ),
        linear-gradient(
            135deg,
            rgba(255, 255, 255, 0.15) 0%,
            rgba(255, 255, 255, 0.05) 30%,
            transparent 50%,
            rgba(255, 255, 255, 0.05) 70%,
            rgba(255, 255, 255, 0.15) 100%
        ),
        radial-gradient(
            circle at 60% 60%,
            rgba(0, 0, 0, 0.3) 0%,
            transparent 30%
        );
    z-index: 1;
    box-shadow: 
        inset 0 0 15px rgba(89, 82, 28, 0.4),
        inset 0 0 25px rgba(106, 97, 60, 0.2),
        inset 0 2px 2px rgba(255, 255, 255, 0.2),
        inset 0 -2px 2px rgba(0, 0, 0, 0.8),
        0 0 0 1px rgba(0, 0, 0, 0.9),
        0 0 0 2px rgba(89, 82, 28, 0.3);
    pointer-events: none;
}

/* RED RIBBON WITH TRACED BLACK LINES & GLOW - FIXED */
.phase-progress-wheel::after {
    content: '';
    position: absolute;
    top: -2px;
    left: -2px;
    right: -2px;
    bottom: -2px;
    border-radius: 50%;
    /* WITNESS RED PROGRESS RIBBON WITH GLOW */
    background: conic-gradient(
        var(--red-x) 0deg, 
        var(--red-x) var(--progress, 0deg), 
        transparent var(--progress, 0deg), 
        transparent 360deg
    );
    /* MASK FOR OUTER RIBBON */
    -webkit-mask: radial-gradient(
        circle,
        transparent 55%,
        black 56%,
        black 82%,
        transparent 83%
    );
    mask: radial-gradient(
        circle,
        transparent 55%,
        black 56%,
        black 82%,
        transparent 83%
    );
    z-index: 0;
    /* TRACED BLACK LINES FOR DEPTH */
    box-shadow: 
        /* INNER BLACK LINE (inside ribbon) */
        inset 0 0 0 1px rgba(0,0,0,0.9),
        /* OUTER BLACK LINE (outside ribbon) */
        0 0 0 1px rgba(0,0,0,0.9),
        /* SUBTLE WHITE HIGHLIGHTS FOR 3D */
        inset 0 1px 0 rgba(255,255,255,0.15),
        inset 0 -1px 0 rgba(0,0,0,0.8);
    /* FIXED: RED GLOW THAT INCREASES WITH PROGRESS */
    filter: drop-shadow(0 0 2px rgba(255,0,0,0.3))
            drop-shadow(0 0 4px rgba(255,0,0,calc(var(--progress, 0) / 100)));
    pointer-events: none;
    transition: filter 0.5s ease;
}

/* Keep everything else exactly as you have it */
/* Buttons */
.dynamic-ds-btn, .phase-card-btn {
    background: linear-gradient(135deg, var(--charcoal-light), var(--charcoal)) !important;
    color: var(--red-x) !important;
    border: 1px solid rgba(255,255,255,0.1) !important;
    padding: 10px 18px !important;
    border-radius: 4px !important;
    font-family: "Stardos Stencil", serif !important;
    font-size: 14px !important;
    font-weight: bold !important;
    cursor: pointer !important;
    transition: all 0.3s ease !important;
    text-transform: uppercase !important;
    letter-spacing: 1px !important;
    min-width: 140px !important;
    box-shadow: 
        0 2px 4px rgba(0,0,0,0.5),
        inset 0 1px 0 rgba(255,255,255,0.1) !important;
}


/* Remove any green gradient styles */
.phase-card .phase-card-content {
    background: linear-gradient(145deg, #47483d 0%, #303129 100%) !important;
}

.phase-card .phase-card-footer {
    background: linear-gradient(145deg, #2c2c2c 0%, #1f1f1f 100%) !important;
}
/* Extended Drills Button - ENHANCED */
.extended-drills-btn {
    display: flex;
    justify-content: center;
    margin: 20px 0;
}

.extended-drills-btn button {
    background: linear-gradient(135deg, var(--red-x), #3a0b16);
    color: white;
    border: none;
    padding: 10px 18px;
    border-radius: 4px;
    cursor: pointer;
    font-family: "Rationale", sans-serif;
    font-weight: bold;
    transition: all 0.3s ease;
    width: 100%;
    max-width: 300px;
    /* WHITE ACCENT BORDER */
    border: 1px solid rgba(255,255,255,0.1);
    box-shadow: 
        0 2px 4px rgba(0,0,0,0.5),
        inset 0 1px 0 rgba(255,255,255,0.1);
}

.extended-drills-btn button:hover {
    background: linear-gradient(135deg, #ff3333, #4a0f1c);
    transform: translateY(-2px);
    border: 1px solid rgba(255,255,255,0.2);
    box-shadow: 
        0 4px 8px rgba(0,0,0,0.6),
        inset 0 1px 0 rgba(255,255,255,0.2);
}

/* Drill Cards in Modal - ENHANCED WITH WHITE ACCENTS */
.drill-cards-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 15px;
    margin: 20px 0;
}

.drill-card-modal {
    background: linear-gradient(145deg, #2c2c2c 0%, #1f1f1f 100%);
    border: 1px solid var(--bronze);
    border-radius: 8px;
    overflow: hidden;
    transition: all 0.3s ease;
    position: relative;
    padding: 15px;
    /* WHITE ACCENT BORDER HIGHLIGHTS */
    border: 1px solid rgba(192,192,192,0.3);
    box-shadow: 
        0 4px 12px rgba(0,0,0,0.5),
        inset 0 0 0 1px rgba(255,255,255,0.05);
}

.drill-card-modal:hover {
    transform: translateY(-5px);
    border-color: var(--gold-soft);
    /* ENHANCED WHITE HIGHLIGHTS ON HOVER */
    border: 1px solid rgba(255,255,255,0.4);
    box-shadow: 
        0 8px 20px rgba(0,0,0,0.6),
        0 0 0 1px rgba(255,255,255,0.1);
}

.drill-card-modal-header {
    background: #191919 !important;
    margin-bottom: 10px;
    position: relative;
    overflow: hidden;
    /* WHITE TOP HIGHLIGHT */
    border-bottom: 1px solid rgba(255,255,255,0.1);
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.05);
}

/* Drill card modal title - ENHANCED */
.drill-card-modal-title {
    font-family: "Stardos Stencil", serif;
    font-size: 20px !important;
    color: var(--red-x);
    margin: 0 0 8px 0;
    line-height: 1.2;
    /* WHITE TEXT ACCENTS */
    text-shadow: 
        0 1px 0 #000,
        0 2px 2px rgba(0,0,0,0.8),
        0 -1px 0 rgba(255,255,255,0.1);
}

/* Drill card modal subtitle - ENHANCED */
.drill-card-modal-subtitle {
    font-family: "Rationale", sans-serif;
    font-size: 15px !important;
    color: var(--gold-soft);
    margin: 0;
    font-weight: 500;
    /* WHITE ACCENT SHADOW */
    text-shadow: 
        0 1px 0 rgba(0,0,0,0.5),
        0 -1px 0 rgba(255,255,255,0.05);
}

.drill-card-modal-content {
    margin-bottom: 10px;
}

.drill-card-modal-details {
    list-style: none;
    padding: 0;
    margin: 0 0 10px 0;
}

.drill-card-modal-details li {
    padding: 6px 0 !important;
    border-bottom: 1px solid var(--charcoal-lighter);
    display: flex;
    align-items: center;
    color: var(--eggshell);
    font-size: 15px !important;
    line-height: 1.4;
    /* WHITE BORDER HIGHLIGHT */
    border-bottom: 1px solid rgba(255,255,255,0.05);
}

.drill-card-modal-details li strong {
    color: var(--gold-soft);
    margin-right: 8px;
    font-weight: bold;
    font-size: 15px;
    min-width: 70px;
    display: inline-block;
    /* WHITE TEXT ACCENT */
    text-shadow: 0 1px 0 rgba(0,0,0,0.5);
}

.drill-card-modal-footer {
    display: flex;
    justify-content: flex-end;
    /* WHITE TOP BORDER */
    border-top: 1px solid rgba(255,255,255,0.05);
    padding-top: 10px;
}

.drill-card-modal-btn {
    background: linear-gradient(135deg, var(--bronze), var(--charcoal-light));
    color: white;
    border: none;
    padding: 6px 10px;
    border-radius: 4px;
    cursor: pointer;
    font-family: "Rationale", sans-serif;
    font-weight: bold;
    transition: all 0.3s ease;
    font-size: 11px;
    /* WHITE ACCENT BORDER */
    border: 1px solid rgba(255,255,255,0.1);
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.05);
}

.drill-card-modal-btn:hover {
    background: linear-gradient(135deg, var(--gold-soft), var(--bronze));
    transform: translateY(-2px);
    /* ENHANCED WHITE HIGHLIGHT */
    border: 1px solid rgba(255,255,255,0.2);
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.1);
}

/* ===== DRILL CARD MODAL SHIMMER EFFECTS - FIXED ===== */

.drill-card-modal {
    position: relative;
    overflow: hidden;
}

.drill-card-modal-header {
    position: relative;
    overflow: hidden;
}

/* FIXED: Shimmer should be BEHIND text */
.drill-card-modal-header::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(120deg, 
        rgba(17, 17, 17, 0.1) 0%, 
        rgba(238, 238, 238, 0.4) 25%, 
        rgba(255, 255, 255, 0.6) 50%, 
        rgba(238, 238, 238, 0.4) 75%, 
        rgba(17, 17, 17, 0.1) 100%);
    background-size: 300% 300%;
    opacity: 0;
    z-index: 0; /* BEHIND text */
    transition: opacity 0.3s ease-in-out;
    pointer-events: none;
}

.drill-card-modal:hover .drill-card-modal-header::before {
    opacity: 0.3;
    animation: shine 2.5s linear infinite;
}

/* FIXED: Text should be ABOVE shimmer */
.drill-card-modal-title,
.drill-card-modal-subtitle {
    position: relative;
    z-index: 1; /* ABOVE shimmer */
}

/* Also fix the list items shimmer */
.drill-card-modal-details li:nth-child(odd) {
    position: relative;
    overflow: hidden;
}

.drill-card-modal-details li:nth-child(odd)::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(120deg, #111, #eee, #fff, #eee, #111);
    background-size: 300% 300%;
    opacity: 0;
    z-index: 0; /* BEHIND text */
    transition: opacity 0.3s ease-in-out;
    pointer-events: none;
}

.drill-card-modal:hover .drill-card-modal-details li:nth-child(odd)::before {
    opacity: 0.2;
    animation: shine 2.5s linear infinite;
}

/* FIXED: List item text ABOVE shimmer */
.drill-card-modal-details li:nth-child(odd) {
    position: relative;
}

.drill-card-modal-details li:nth-child(odd) > * {
    position: relative;
    z-index: 1; /* ABOVE shimmer */
}

.drill-card-modal-details li:nth-child(odd) > * {
    position: relative;
    z-index: 1;
}


/* ===== RECOMMENDATIONS SECTION STYLES ===== */
.recommendation-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-bottom: 20px;
}

.recommendation-card {
    background: linear-gradient(145deg, #2c2c2c 0%, #1f1f1f 100%);
    border: 1px solid var(--bronze);
    border-radius: 8px;
    overflow: hidden;
    transition: all 0.3s ease;
    position: relative;
}

.recommendation-card:hover {
    transform: translateY(-5px);
    border-color: var(--gold-soft);
}

.recommendation-card-header {
    background: linear-gradient(135deg, var(--charcoal), var(--charcoal-light));
    padding: 15px 20px;
    border-bottom: 1px solid var(--bronze);
    position: relative;
    overflow: hidden;
}

.recommendation-card-title {
    font-family: "Stardos Stencil", serif;
    font-size: 18px;
    color: var(--red-x);
    margin: 0 0 5px 0;
}

.recommendation-card-subtitle {
    font-size: 13px;
    color: #aaa;
    margin: 0;
}

.recommendation-card-body { 
    padding: 20px; 
}

.recommendation-features {
    list-style: none;
    padding: 0;
    margin: 0 0 20px 0;
}

.recommendation-features li {
    padding: 6px 0;
    border-bottom: 1px solid var(--charcoal-lighter);
    display: flex;
    align-items: center;
    color: var(--eggshell);
}

.recommendation-features li:last-child { border-bottom: none; }
.recommendation-features li::before {
    content: "•";
    color: var(--bronze);
    font-weight: bold;
    margin-right: 10px;
    font-size: 14px;
}

.recommendation-card-actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.recommendation-card-actions button {
    flex: 1;
    min-width: 120px;
}


/* ===== SKILL ASSESSMENT SECTION STYLES ===== */
.skill-rating-container {
    margin: 15px 0;
}

.skill-item {
    display: flex;
    flex-direction: column;
    margin-bottom: 15px;
    padding-bottom: 15px;
    border-bottom: 1px solid #333;
}

.skill-name {
    font-weight: bold;
    color: var(--eggshell);
    margin-bottom: 10px;
}

.rating-scale {
    display: flex;
    justify-content: space-between;
    gap: 5px;
}

.rating-option {
    flex: 1;
    text-align: center;
    padding: 8px 5px;
    background: #1a1a1a;
    border: 1px solid #555;
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 14px;
    color: var(--eggshell);
}

.rating-option:hover {
    background: #2a2a2a;
    border-color: var(--bronze);
}

.rating-option.selected {
    background: var(--red-x);
    color: white;
    border-color: var(--red-x);
}

/* ===== TRAINING GOALS SECTION STYLES ===== */
.training-goals-container {
    margin: 15px 0;
}

.goals-list {
    margin-bottom: 15px;
}

.goal-item {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
    padding: 8px 0;
}

.goal-label {
    margin-left: 10px;
    color: var(--eggshell);
    font-size: 14px;
}

.days-selection {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 10px;
}

.day-option {
    display: flex;
    align-items: center;
}

.day-label {
    margin-left: 5px;
    color: var(--eggshell);
    font-size: 14px;
}

.form-columns {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    margin-bottom: 15px;
}

@media (max-width: 768px) {
    .form-columns {
        grid-template-columns: 1fr;
    }
}


/* ===== DRILL CARD STYLES ===== */
.drill-card {
    background: linear-gradient(145deg, #2c2c2c 0%, #1f1f1f 100%);
    border: 1px solid var(--bronze);
    border-radius: 8px;
    overflow: hidden;
    transition: all 0.3s ease;
    position: relative;
}

.drill-card:hover {
    transform: translateY(-5px);
    border-color: var(--gold-soft);
}

.drill-card-header {
    background: linear-gradient(135deg, var(--charcoal), var(--charcoal-light));
    padding: 15px 20px;
    border-bottom: 1px solid var(--bronze);
    position: relative;
    overflow: hidden;
}

/* Metallic effect for drill card header */
.drill-card-header::before {
    content: "";
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background: linear-gradient(120deg, #111, #eee, #fff, #eee, #111);
    background-size: 300% 300%;
    opacity: 0;
    z-index: 0;
    transition: opacity 0.3s ease-in-out;
}

.drill-card:hover .drill-card-header::before {
    opacity: 0.3;
    animation: shine 2.5s linear infinite;
}

.drill-card-header > * {
    position: relative;
    z-index: 1;
}

.drill-card-title {
    font-family: "Stardos Stencil", serif;
    font-size: 16px;
    color: var(--red-x);
    margin: 0 0 5px 0;
}

.drill-card-subtitle {
    font-size: 12px;
    color: #aaa;
    margin: 0;
}

.drill-card-body { 
    padding: 20px;
    background: linear-gradient(145deg, #211f10 0%, #2c2a16 50%, #3b381e 100%);
}

.drill-details {
    list-style: none;
    padding: 0;
    margin: 0 0 15px 0;
}

.drill-details li {
    padding: 6px 0;
    border-bottom: 1px solid #444;
    display: flex;
    align-items: center;
    color: var(--eggshell);
    font-size: 14px;
}

.drill-details li:last-child { border-bottom: none; }
.drill-details li::before {
    content: "•";
    color: var(--bronze);
    font-weight: bold;
    margin-right: 10px;
    font-size: 14px;
}
/* FORCE DRILL MODAL SHIMMER */
.drill-card-modal-header::before {
    display: block !important;
}

/* ===== THIN DROP SHADOW FOR ALL TEXT AND NUMBERS - MORE SPECIFIC ===== */
body, 
.title-text, .subtitle, .subhead,
.sub-subtitle, .hint,
.card p, .card span, .checks li span,
.phase-card-title, .phase-card-subtitle,
.drill-card-modal-title, .drill-card-modal-subtitle,
..legal-modal-title, .legal-modal-subtitle,
.course-card-title, .course-card-subtitle, .recommendation-card-title, .recommendation-card-subtitle,
.progress-percentage, .phase-progress-percentage, .waivers-progress-percentage,
.progress-percent, .progress-title, .progress-text, .progress-note,
.course-detail-value, .course-detail-label,
.bang-bag-package-price, .bang-bag-package-title,
.battle-bag-item-name, .battle-bag-item-desc,
.cartridge-type-title, .cartridge-specs li,
.skill-name, .rating-bubble,
.btn, .btn-reset, .btn-email, .btn-close, .btn-save, .btn-save-assessment,
.menu-btn, .course-option, .phase-card-btn,
.drill-card-modal-btn, .btn-legal, .btn-save-notes, .btn-send-notes,
.save-notes-btn, .print-btn, .email-btn,
.nav-item span, .banner,
.panel-header, .title-inner *,
.waiver-checkbox label, .form-group label,
input[type="text"], input[type="date"], textarea, .form-control, .initials-box,
.lesson-flow-table th, .lesson-flow-table td,
.legal-table th, .legal-table td,
.supply-list th, .supply-list td,
.rating-option, .goal-label, .day-label,
.modal-title, .modal-list li,
.step-description,
.rating-bubble {
    text-shadow: 0 0.75px 1.5px rgba(0, 0, 0, 0.55) !important;
}

/* Specific for numbers - slightly larger shadow for better visibility */
.rating-bubble,
.progress-percentage,
.phase-progress-percentage,
.waivers-progress-percentage,
.bang-bag-package-price,
.course-detail-value,
.rating-bubble.selected {
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.65) !important;
}

/* Override any existing text-shadows that might be conflicting */
.title-text {
    text-shadow: 0 0.75px 1.5px rgba(0, 0, 0, 0.55) !important;
}

.subtitle {
    text-shadow: 0 0.75px 1.5px rgba(0, 0, 0, 0.55) !important;
}

.subhead {
    text-shadow: 0 0.75px 1.5px rgba(0, 0, 0, 0.55) !important;
}

.card p, .card span {
    text-shadow: 0 0.75px 1.5px rgba(0, 0, 0, 0.55) !important;
}

.panel-header {
    text-shadow: 0 0.75px 1.5px rgba(0, 0, 0, 0.55) !important;
}

/* For white text on dark backgrounds - needs stronger shadow */
.title-text,
.subtitle,
.banner,
.btn, .btn-reset, .btn-email,
.menu-btn, .course-option,
.nav-item span,
.progress-percentage,
.phase-progress-percentage,
.waivers-progress-percentage {
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.7) !important; /* Even darker for contrast */
}

/* For black assessment bubbles specifically - needs strong shadow for white text */
.rating-bubble {
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8) !important; /* Very dark for max contrast */
}

.rating-bubble.selected {
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.9) !important; /* Darkest for selected */
}

/* ===== LEGAL MODAL CLOSE BUTTON STYLES - MATCHING APP STYLE ===== */
.legal-modal-actions {
    display: flex;
    justify-content: center;
    margin-top: 30px;
    padding-top: 25px;
    border-top: 1px solid #444;
}

.legal-modal-actions .btn-close {
    position: relative;
    cursor: pointer;
    border: none;
    border-radius: 6px;
    padding: 14px 40px;
    background: linear-gradient(135deg, #666, #333);
    color: #fff;
    font: 600 16px "Share", serif;
    text-shadow: 0 2px 3px #000;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.7);
    transition: transform .08s ease-in-out, background .25s ease;
    overflow: hidden;
    isolation: isolate;
    min-width: 180px;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.legal-modal-actions .btn-close:active {
    transform: translateY(1px);
}

.legal-modal-actions .btn-close::after {
    content: "";
    position: absolute;
    top: 0;
    left: -45%;
    width: 40%;
    height: 100%;
    background: linear-gradient(120deg, transparent, rgba(255, 255, 255, .65), transparent);
    transform: skewX(-25deg);
    opacity: 0;
    transition: left .4s ease, opacity .25s ease;
    pointer-events: none;
}

.legal-modal-actions .btn-close:hover {
    background: linear-gradient(135deg, #777, #444);
}

.legal-modal-actions .btn-close:hover::after {
    left: 120%;
    opacity: 1;
}
/* ===== UNIFIED BUTTON SYSTEM - BLACK DEFAULT WITH COLOR REVEAL ON HOVER ===== */
/* Apply to ALL buttons in the app */
button,
.btn,
.btn-reset,
.btn-email,
.btn-close,
.btn-save,
.btn-save-assessment,
.btn-assess,
.menu-btn,
.course-option,
.phase-card-btn,
.drill-card-modal-btn,
.btn-legal,
.btn-save-notes,
.btn-send-notes,
.save-notes-btn,
.print-btn,
.email-btn,
.extended-drills-btn button,
.grading-toggle button,
.full-course-toggle button,
.waivers-card-btn,
.drill-card-modal-btn,
.stage-drill-actions button,
.skills-assessment-actions button,
.legal-notes-actions button,
.course-modal-actions button,
.legal-modal-actions button {
    /* DEFAULT STATE: BLACK WITH WHITE BORDER & TEXT */
    background: #000 !important;
    border: 1px solid #c0c0c0 !important;
    color: #fff !important;
    
    /* NO GLOW EFFECTS */
    box-shadow: none !important;
    text-shadow: 0 1px 1px rgba(0, 0, 0, 0.7) !important;
    
    /* CONSISTENT TYPOGRAPHY */
    font-family: "Rationale", sans-serif !important;
    font-weight: bold !important;
    text-transform: uppercase !important;
    letter-spacing: 1px !important;
    
    /* CONSISTENT PADDING & SIZING */
    padding: 10px 18px !important;
    border-radius: 4px !important;
    font-size: 14px !important;
    min-height: 40px !important;
    
    /* POSITIONING FOR SHINE EFFECT */
    position: relative !important;
    overflow: hidden !important;
    isolation: isolate !important;
    
    /* TRANSITIONS */
    transition: all 0.3s ease !important;
    cursor: pointer !important;
    
    /* REMOVE DEFAULT BUTTON STYLES */
    background-image: none !important;
}


/* ===== BUTTON ACTIVE STATES ===== */
button:active,
.btn:active,
.btn-reset:active,
.btn-email:active,
.btn-close:active,
.btn-save:active,
.btn-save-assessment:active,
.btn-assess:active,
.menu-btn:active,
.course-option:active,
.phase-card-btn:active,
.drill-card-modal-btn:active,
.btn-legal:active,
.btn-save-notes:active,
.btn-send-notes:active,
.save-notes-btn:active,
.print-btn:active,
.email-btn:active,
.extended-drills-btn button:active,
.grading-toggle button:active,
.full-course-toggle button:active,
.waivers-card-btn:active {
    transform: translateY(1px) !important;
    transition: transform 0.08s ease-in-out !important;
}

/* ===== SPECIFIC BUTTON OVERRIDES ===== */

/* Phase card buttons - ensure proper sizing */
.phase-card-btn {
    padding: 8px 12px !important;
    font-size: 12px !important;
}

/* Drill card modal buttons - ensure proper sizing */
.drill-card-modal-btn {
    padding: 6px 10px !important;
    font-size: 11px !important;
}

/* Legal modal close button - ensure it matches */
.legal-modal-actions .btn-close {
    min-width: 180px !important;
    padding: 14px 40px !important;
    font-size: 16px !important;
}

/* Stage drill modal buttons */
.stage-drill-actions button {
    padding: 14px !important;
    font-size: 16px !important;
}

/* Skills assessment modal buttons */
.skills-assessment-actions button {
    padding: 14px 28px !important;
    font-size: 16px !important;
}

/* Make sure text stays white and visible */
button *,
.btn *,
.btn-reset *,
.btn-email *,
.btn-close *,
.btn-save *,
.btn-save-assessment *,
.btn-assess *,
.menu-btn *,
.course-option *,
.phase-card-btn *,
.drill-card-modal-btn *,
.btn-legal *,
.btn-save-notes *,
.btn-send-notes *,
.save-notes-btn *,
.print-btn *,
.email-btn *,
.extended-drills-btn button *,
.grading-toggle button *,
.full-course-toggle button *,
.waivers-card-btn * {
    color: #fff !important;
}

/* ===== REPLACE BRONZE BORDERS WITH WHITE BORDERS (EXCEPT LEGAL CARDS) ===== */

/* Replace bronze borders in these elements */
.card,
.notes-card,
.course-card,
.recommendation-card,
.phase-card,
.drill-card,
.drill-card-modal,
.waivers-card,
.note-item,
.course-overview-item,
.course-detail-item,
.battle-bag-item,
.cartridge-type,
.bang-bag-package,
.instructor-snapshot,
.client-info,
.supply-list th,
.supply-list td,
.lesson-flow-table th,
.lesson-flow-table td,
.legal-table th,
.legal-table td,
.grading-window,
.full-course-window,
.extended-drills-window,
.modal-content,
.course-modal-content,
.drills-modal-content,
.stage-drill-modal-content,
.skills-assessment-modal-content,
.battle-bag-modal-content,
.bang-bag-modal-content {
    border-color: #c0c0c0 !important;
}

/* Replace bronze borders in banners */
.banner {
    border-color: #c0c0c0 !important;
}

/* Replace bronze borders in panel headers */
.panel-header {
    border-bottom-color: #c0c0c0 !important;
}

/* Replace bronze borders in course card headers */
.course-card-header,
.recommendation-card-header,
.phase-card-header,
.drill-card-header {
    border-bottom-color: #c0c0c0 !important;
}

/* Replace bronze borders in navigation */
.bottom-nav {
    border-top-color: #c0c0c0 !important;
}

/* EXCEPTION: Keep legal cards with their original styling */
.legal-card {
    border-color: var(--charcoal) !important; /* Keep original border */
}

.legal-card-header {
    background: var(--charcoal) !important; /* Keep original header */
    border-bottom-color: var(--charcoal) !important; /* Keep original border */
}

/* EXCEPTION: Keep hamburger menu with bronze */
.hamburger-menu {
    background: var(--bronze) !important;
    border: none !important;
}

/* ===== ENSURE BORDER CONSISTENCY IN MODALS ===== */

/* Stage drill modal - ensure silver borders */
.stage-drill-modal .stage-drill-steps,
.stage-drill-modal .step-item {
    border-color: #c0c0c0 !important;
}


.skill-assessment-item {
    border-bottom-color: #c0c0c0 !important;
}

/* Drills modal - ensure silver borders */
.drills-modal .drill-card-modal {
    border-color: #c0c0c0 !important;
}

.drills-modal .drill-card-modal-content {
    border-top-color: #c0c0c0 !important;
    border-bottom-color: #c0c0c0 !important;
}

.drills-modal .drill-card-modal-details li {
    border-bottom-color: #c0c0c0 !important;
}

/* Rating bubbles - keep their bronze border but add silver on hover */
.rating-bubble {
    border-color: var(--bronze) !important;
}

.rating-bubble:hover {
    border-color: #c0c0c0 !important;
}

/* ===== MAINTAIN SEPARATORS ===== */
/* Keep some separators with bronze for visual hierarchy */
.divider,
.bottom-divider {
    background: linear-gradient(to right, transparent 0%, #000 12%, #000 88%, transparent 100%) !important;
}

/* ===== REMOVE ANY REMAINING GLOW EFFECTS ===== */
/* Remove all glow/box-shadow effects from buttons and interactive elements */
button:hover,
.btn:hover,
.btn-reset:hover,
.btn-email:hover,
.btn-close:hover,
.btn-save:hover,
.btn-save-assessment:hover,
.btn-assess:hover,
.menu-btn:hover,
.course-option:hover,
.phase-card-btn:hover,
.drill-card-modal-btn:hover,
.btn-legal:hover,
.btn-save-notes:hover,
.btn-send-notes:hover,
.save-notes-btn:hover,
.print-btn:hover,
.email-btn:hover,
.extended-drills-btn button:hover,
.grading-toggle button:hover,
.full-course-toggle button:hover,
.waivers-card-btn:hover {
    box-shadow: none !important;
}

/* Remove glow from rating bubbles */
.rating-bubble.selected {
    box-shadow: none !important;
}

/* Remove glow from selected rating options */
.rating-option.selected {
    box-shadow: none !important;
}

/* ===== ENSURE BUTTON TEXT REMAINS VISIBLE IN BLACK DEFAULT STATE ===== */
/* Add a subtle text shadow for better readability on black background */
button,
.btn,
.btn-reset,
.btn-email,
.btn-close,
.btn-save,
.btn-save-assessment,
.btn-assess,
.menu-btn,
.course-option,
.phase-card-btn,
.drill-card-modal-btn,
.btn-legal,
.btn-save-notes,
.btn-send-notes,
.save-notes-btn,
.print-btn,
.email-btn,
.extended-drills-btn button,
.grading-toggle button,
.full-course-toggle button,
.waivers-card-btn {
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.9) !important;
}


/* Green Checkmarks */
.checkmark {
    color: #9b9065 !important; /* Bronze color */
    font-weight: bold;
    font-size: 16px;
    min-width: 20px;
    display: inline-block;
    margin-right: 10px;
    text-shadow: 0 0 5px rgba(205, 127, 50, 0.7);
}

/* For any existing card items - just add this class */
.card-item {
    display: flex;
    align-items: center;
    margin-bottom: 8px;
}

/* If you need to adjust list item alignment */
.course-features li {
    display: flex;
    align-items: flex-start;
    margin-bottom: 10px;
}

/* ===== CORRECT 3D TACTICAL PROGRESS WHEEL ===== */
.phase-progress-wheel-container {
    position: relative;
    width: 78px; /* 30% bigger: 60px × 1.3 = 78px */
    height: 78px;
    pointer-events: none;
}

.phase-progress-wheel {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    /* 3D OD GREEN BASE - KEEPING YOUR STYLE */
    background: radial-gradient(
        circle at 30% 30%,
        #455831 0%,
        #3a4a2a 15%,
        #2c3a1f 40%,
        #1e2615 70%,
        #0a0a0a 100%
    );
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    /* 3D BORDER - KEEPING YOUR STYLE */
    border: 4px solid;
    border-color: #1a1a1a #000 #000 #1a1a1a;
    box-shadow: 
        inset 3px 3px 8px rgba(0, 0, 0, 0.8),
        inset -3px -3px 8px rgba(255, 255, 255, 0.05),
        4px 4px 12px rgba(0, 0, 0, 0.7),
        -2px -2px 6px rgba(255, 255, 255, 0.03),
        0 0 0 1px #333;
}

/* RED RIBBON HIGHLIGHT - USING ORIGINAL MATHEMATICAL STRUCTURE */
.phase-progress-wheel::after {
    content: '';
    position: absolute;
    top: -4px; /* -2px original × 2 (30% bigger) = -4px */
    left: -4px;
    right: -4px;
    bottom: -4px;
    border-radius: 50%;
    /* ORIGINAL CONIC GRADIENT MATH - PROVEN WORKING */
    background: conic-gradient(
        var(--red-x) 0deg, 
        var(--red-x) var(--progress, 0deg), 
        transparent var(--progress, 0deg), 
        transparent 360deg
    );
    /* ORIGINAL MASK MATH - PROVEN WORKING (scaled 30%) */
    -webkit-mask: radial-gradient(
        circle,
        transparent 55%,    /* Same percentages - mask scales with element */
        black 56%,
        black 82%,
        transparent 83%
    );
    mask: radial-gradient(
        circle,
        transparent 55%,
        black 56%,
        black 82%,
        transparent 83%
    );
    z-index: 0;
    /* ORIGINAL BLACK LINES FOR DEPTH */
    box-shadow: 
        inset 0 0 0 1px rgba(0,0,0,0.9),
        0 0 0 1px rgba(0,0,0,0.9),
        inset 0 1px 0 rgba(255,255,255,0.15),
        inset 0 -1px 0 rgba(0,0,0,0.8);
    /* ORIGINAL RED GLOW MATH - PROVEN WORKING */
    filter: drop-shadow(0 0 2px rgba(255,0,0,0.3))
            drop-shadow(0 0 4px rgba(255,0,0,calc(var(--progress, 0) / 100)));
    pointer-events: none;
    transition: filter 0.5s ease;
}

/* CENTER CAP - KEEPING YOUR 3D STYLE BUT PROPER SIZE */
.phase-progress-wheel::before {
    content: '';
    position: absolute;
    width: 45px; /* Original was 45px on 60px wheel = 75% */
    height: 45px;
    border-radius: 50%;
    /* YOUR 3D METAL STYLE */
    background: radial-gradient(
        circle at 30% 30%,
        #8a8a8a 0%,
        #6b6b6b 25%,
        #4a4a4a 50%,
        #2a2a2a 75%,
        #1a1a1a 100%
    );
    z-index: 1;
    /* YOUR 3D BORDER */
    border: 3px solid;
    border-color: #555 #222 #222 #555;
    box-shadow: 
        inset -2px -2px 6px rgba(255, 255, 255, 0.15),
        inset 2px 2px 6px rgba(0, 0, 0, 0.8),
        0 0 0 1px #333,
        0 2px 4px rgba(0, 0, 0, 0.6),
        0 0 15px rgba(255, 0, 0, 0.2);
    pointer-events: none;
}

/* PERCENTAGE TEXT - YOUR STYLE WITH ORIGINAL MATH */
.phase-progress-percentage {
    position: relative;
    z-index: 2;
    font-family: "Rationale", sans-serif;
    font-size: 18px; /* Original 14px × 1.3 = 18.2px ≈ 18px */
    font-weight: bold;
    color: #ffffff !important;
    /* YOUR 3D TEXT STYLE */
    text-shadow: 
        1px 1px 0 #000,
        2px 2px 2px rgba(0, 0, 0, 0.7),
        -1px -1px 0 rgba(255, 255, 255, 0.2),
        /* Original red glow math */
        0 0 15px rgba(255, 0, 0, calc(var(--progress, 0) / 50)),
        0 0 25px rgba(255, 0, 0, calc(var(--progress, 0) / 100));
    letter-spacing: 0.5px;
    pointer-events: none;
}

/* ORIGINAL GLOW ANIMATION - KEEP IF PROGRESS > 0 */
@keyframes ribbon-glow {
    0%, 100% { 
        filter: drop-shadow(0 0 2px rgba(255,0,0,0.3))
                drop-shadow(0 0 4px rgba(255,0,0,0.2));
    }
    50% { 
        filter: drop-shadow(0 0 4px rgba(255,0,0,0.6))
                drop-shadow(0 0 8px rgba(255,0,0,0.4));
    }
}

/* APPLY GLOW WHEN PROGRESS > 0 - ORIGINAL LOGIC */
.phase-progress-wheel[style*="--progress"]:not([style*="--progress: 0deg"])::after {
    animation: ribbon-glow 2s infinite;
}

/* WHEEL GLOW - YOUR STYLE WITH ORIGINAL PROGRESS MATH */
.phase-progress-wheel {
    box-shadow: 
        inset 3px 3px 8px rgba(0, 0, 0, 0.8),
        inset -3px -3px 8px rgba(255, 255, 255, 0.05),
        4px 4px 12px rgba(0, 0, 0, 0.7),
        -2px -2px 6px rgba(255, 255, 255, 0.03),
        0 0 0 1px #333,
        /* Original progress-based glow math */
        0 0 25px rgba(255, 0, 0, calc(var(--progress, 0) / 200));
}

/* UPDATE COURSE ACTION ROW - WHEEL ON LEFT, BIGGER */
.course-action-row {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-top: 20px;
    padding-top: 15px;
    border-top: 1px solid #c0c0c0;
    position: relative;
    flex-direction: row; /* Ensure horizontal layout */
}

/* Button takes remaining space and sits above wheel */
.course-action-row .btn {
    flex: 1;
    position: relative;
    z-index: 2; /* Higher than wheel */
}

/* Make sure button is fully clickable */
.open-course-modal {
    cursor: pointer !important;
    pointer-events: auto !important;
}

/* ===== DRILLS/PHASE PROGRESS WHEEL (78px) ===== */
.phase-progress-wheel[style*="--progress"]:not([style*="--progress: 0deg"])::after {
    animation: ribbon-glow 2s infinite;
}

.phase-progress-wheel {
    box-shadow: 
        inset 3px 3px 8px rgba(0, 0, 0, 0.8),
        inset -3px -3px 8px rgba(255, 255, 255, 0.05),
        4px 4px 12px rgba(0, 0, 0, 0.7),
        -2px -2px 6px rgba(255, 255, 255, 0.03),
        0 0 0 1px #333,
        0 0 25px rgba(255, 0, 0, calc(var(--progress, 0) / 200));
}

/* ===== COURSE SECTION PROGRESS WHEEL (55px) - CORRECTED NAMES ===== */
/* CONTAINER - 55px */
.phase-progress-wrapper {
    position: relative;
    width: 55px !important; /* CHANGED FROM: course-progress-wheel-container */
    height: 55px !important;
    flex-shrink: 0;
    order: 1;
    pointer-events: none;
}

.phase-progress-container {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 1;
    pointer-events: none;
}

/* WHEEL - 3D TACTICAL STYLING */
.tactical-progress-wheel {
    width: 100%;
    height: 100%;
    border-radius: 50%;
    background: radial-gradient(
        circle at 30% 30%,
        #455831 0%,
        #3a4a2a 15%,
        #2c3a1f 40%,
        #1e2615 70%,
        #0a0a0a 100%
    ) !important; /* CHANGED FROM: course-progress-wheel */
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    border: 2px solid !important;
    border-color: #1a1a1a #000 #000 #1a1a1a !important;
    box-shadow: 
        inset 2px 2px 6px rgba(0, 0, 0, 0.8),
        inset -2px -2px 6px rgba(255, 255, 255, 0.05),
        3px 3px 9px rgba(0, 0, 0, 0.7),
        -1px -1px 4px rgba(255, 255, 255, 0.03),
        0 0 0 1px #333,
        0 0 18px rgba(255, 0, 0, calc(var(--progress, 0) / 200)) !important;
    pointer-events: none;
}

/* RED RIBBON */
.tactical-progress-wheel::after {
    content: '';
    position: absolute;
    top: -2px;
    left: -2px;
    right: -2px;
    bottom: -2px;
    border-radius: 50%;
    background: conic-gradient(
        var(--red-x) 0deg, 
        var(--red-x) var(--progress, 0deg), 
        transparent var(--progress, 0deg), 
        transparent 360deg
    );
    -webkit-mask: radial-gradient(
        circle,
        transparent 55%,
        black 56%,
        black 82%,
        transparent 83%
    );
    mask: radial-gradient(
        circle,
        transparent 55%,
        black 56%,
        black 82%,
        transparent 83%
    );
    z-index: 0;
    box-shadow: 
        inset 0 0 0 1px rgba(0,0,0,0.9),
        0 0 0 1px rgba(0,0,0,0.9),
        inset 0 1px 0 rgba(255,255,255,0.15),
        inset 0 -1px 0 rgba(0,0,0,0.8);
    filter: drop-shadow(0 0 2px rgba(255,0,0,0.3))
            drop-shadow(0 0 4px rgba(255,0,0,calc(var(--progress, 0) / 100)));
    pointer-events: none;
    transition: filter 0.5s ease;
}

/* CENTER CAP */
.tactical-progress-wheel::before {
    content: '';
    position: absolute;
    width: 35px;
    height: 35px;
    border-radius: 50%;
    background: radial-gradient(
        circle at 30% 30%,
        #8a8a8a 0%,
        #6b6b6b 25%,
        #4a4a4a 50%,
        #2a2a2a 75%,
        #1a1a1a 100%
    );
    z-index: 1;
    border: 1px solid #333;
    box-shadow: 
        inset -1px -1px 3px rgba(255, 255, 255, 0.1),
        inset 1px 1px 3px rgba(0, 0, 0, 0.7);
    pointer-events: none;
}

/* PERCENTAGE TEXT */
.tactical-progress-percentage {
    position: relative;
    z-index: 2;
    font-family: "Rationale", sans-serif;
    font-size: 13px;
    font-weight: bold;
    color: #ffffff !important; /* CHANGED FROM: course-progress-percentage */
    text-shadow: 
        1px 1px 0 #000,
        2px 2px 2px rgba(0, 0, 0, 0.7),
        -1px -1px 0 rgba(255, 255, 255, 0.2),
        0 0 10px rgba(255, 0, 0, calc(var(--progress, 0) / 50)),
        0 0 18px rgba(255, 0, 0, calc(var(--progress, 0) / 100));
    letter-spacing: 0.5px;
    pointer-events: none;
}

/* GLOW ANIMATION FOR COURSE WHEEL */
.tactical-progress-wheel[style*="--progress"]:not([style*="--progress: 0deg"])::after {
    animation: ribbon-glow 2s infinite;
}

/* Remove pointer-events from ALL progress wheel containers */
.phase-progress-wrapper,
.phase-progress-container,
.tactical-progress-wheel,
.tactical-progress-wheel::before,
.tactical-progress-wheel::after,
.tactical-progress-percentage {
    pointer-events: none;
}

/* KEEP ALL ANIMATIONS AND OTHER STYLES BELOW - UNCHANGED */
@keyframes pulse-glow {
    0%, 100% { opacity: 0.3; }
    50% { opacity: 0.6; }
}

@keyframes progress-pulse {
    0% { 
        transform: scale(1);
        box-shadow: 
            inset 0 0 15px rgba(0,0,0,0.8),
            0 4px 10px rgba(0,0,0,0.6),
            0 0 0 1px #555,
            0 0 15px rgba(255, 0, 0, 0.3); /* KEEP GLOW */
    }
    50% { 
        transform: scale(1.02);
        box-shadow: 
            inset 0 0 20px rgba(255,0,0,0.4),
            0 6px 15px rgba(255,0,0,0.3),
            0 0 0 1px var(--red-x),
            0 0 25px rgba(255,0,0,0.5); /* BRIGHTER GLOW */
    }
    100% { 
        transform: scale(1);
        box-shadow: 
            inset 0 0 15px rgba(0,0,0,0.8),
            0 4px 10px rgba(0,0,0,0.6),
            0 0 0 1px #555,
            0 0 15px rgba(255, 0, 0, 0.3); /* KEEP GLOW */
    }
}

/* Add pulse animation class to progress wheels */
.progress-pulse {
    animation: progress-pulse 0.5s ease;
}

/* ===== PROGRESS WHEEL ANIMATIONS ===== */
@keyframes progress-pulse {
    0% { 
        transform: scale(1);
        box-shadow: 
            inset 0 0 15px rgba(0,0,0,0.8),
            0 4px 10px rgba(0,0,0,0.6),
            0 0 0 1px #555,
            0 0 15px rgba(255, 0, 0, 0.3); /* KEEP GLOW */
    }
    50% { 
        transform: scale(1.02);
        box-shadow: 
            inset 0 0 20px rgba(255,0,0,0.4),
            0 6px 15px rgba(255,0,0,0.3),
            0 0 0 1px var(--red-x),
            0 0 25px rgba(255,0,0,0.5); /* BRIGHTER GLOW */
    }
    100% { 
        transform: scale(1);
        box-shadow: 
            inset 0 0 15px rgba(0,0,0,0.8),
            0 4px 10px rgba(0,0,0,0.6),
            0 0 0 1px #555,
            0 0 15px rgba(255, 0, 0, 0.3); /* KEEP GLOW */
    }
}

/* Progress pulse class */
.progress-pulse {
    animation: progress-pulse 0.5s ease !important;
}

/* Real-time progress in assessment modal */
.real-time-progress {
    background: linear-gradient(180deg, #1a1a1a, #111);
    border: 1px solid var(--bronze);
    border-radius: 6px;
    padding: 15px;
    margin-bottom: 20px;
    text-align: center;
}

.progress-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
    font-family: "Rationale", sans-serif;
    font-size: 16px;
    color: var(--eggshell);
}

.progress-header strong {
    color: var(--red-x);
    font-size: 18px;
}

.progress-note {
    font-size: 14px;
    color: var(--gold-soft);
    font-style: italic;
}

.skill-number {
    color: var(--red-x);
    font-weight: bold;
    margin-right: 8px;
    font-family: "Share Tech Mono", monospace;
}

/* Pulse animation for progress text */
@keyframes count-up {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
}

#phase-progress {
    display: inline-block;
    transition: all 0.3s ease;
}

#phase-progress.updating {
    animation: count-up 0.5s ease;
    color: var(--hud-green) !important;
}

/* Make the red brighter when updating */
.tactical-progress-wheel.updated {
    filter: brightness(1.2);
}

/* Percentage text animation */
.tactical-progress-percentage {
    transition: color 0.3s ease, text-shadow 0.3s ease;
}

.tactical-progress-percentage.updating {
    color: #f70c0c !important;
    text-shadow: 
        0 0 10px rgba(255,51,51,0.8),
        0 0 5px rgba(0,0,0,0.9),
        0 1px 0 #000 !important;
}

@keyframes progress-pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

.tactical-progress-wheel.progress-pulse {
    animation: progress-pulse 0.5s ease;
}
/* Style for all SVG icons */
.nav-item svg {
  width: 28px;
  height: 28px;
  margin-bottom: 4px;
  filter: drop-shadow(0 1px 2px rgba(0,0,0,.7));
  transition: all 0.3s ease;
}

/* Larger home icon */
.nav-item.center svg {
  width: 46px;
  height: 46px;
  margin-top: -8px;
}

/* Active state styling */
.nav-item.active svg {
  filter: drop-shadow(0 0 5px rgba(183, 155, 108, 0.7));
}

.nav-item.active svg path {
  stroke: var(--gold-soft) !important; /* Override stroke color */
}

/* Hover effects */
.nav-item:hover svg {
  transform: translateY(-2px);
}
/* ===== TABLE MODAL STYLES ===== */
.table-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.85);
    z-index: 1000;
    justify-content: center;
    align-items: center;
    overflow: hidden;
}

.table-modal-content {
    background: linear-gradient(180deg, var(--charcoal-light), var(--charcoal));
    border: 1px solid #fff;
    border-radius: 8px;
    padding: 20px;
    width: 95%;
    max-width: 800px;
    max-height: 80vh;
    overflow-y: auto; /* CHANGED from 'hidden' */
    overflow-x: hidden; /* ADD THIS */
    box-shadow: 0 5px 15px rgba(0,0,0,0.7);
    position: relative;
}

.table-modal-header {
    margin-bottom: 20px;
    text-align: center;
    position: relative;
    padding: 0 10px; /* Add padding so line doesn't touch edges */
}

.table-modal-header h3 {
    font-family: "Stardos Stencil", serif;
    font-size: 20px;
    color: var(--red-x);
    margin: 0 0 2px 0; /* Reduced bottom margin */
    text-shadow: 0 2px 4px rgba(0,0,0,0.8);
}

.table-modal-subtitle {
    font-family: "Rationale", sans-serif;
    font-size: 13px;
    color: var(--gold-soft);
    margin: 3px 0 8px 0; /* Reduced margins for tight spacing */
}

/* Bronze line - positioned as top border of subtitle */
.table-modal-subtitle::before {
    content: '';
    position: absolute;
    top: 0;
    left: 15%;
    right: 15%;
    height: 2px;
    background: #6a613c;
    opacity: 0.9;
    border-radius: 1px;
}
.table-modal-body {
    overflow: hidden;
    margin-bottom: 20px;
    position: relative;
}

.table-container {
    width: 100%;
    max-height: 400px;
    overflow-x: auto;
    overflow-y: auto;
    border: 1px solid #cfcece;
    border-radius: 4px;
}

/* Witness Red scrollbar */
.table-container::-webkit-scrollbar {
    height: 6px;
    width: 6px;
}

.table-container::-webkit-scrollbar-track {
    background: var(--charcoal-lighter);
    border-radius: 3px;
}

.table-container::-webkit-scrollbar-thumb {
    background: var(--red-x);
    border-radius: 3px;
}

.table-container::-webkit-scrollbar-thumb:hover {
    background: #eb1110;
}

.interactive-table {
    width: 100%;
    border-collapse: collapse;
    min-width: 600px;
    background: linear-gradient(180deg, var(--card-bg-top), var(--card-bg-btm));
}

.interactive-table th,
.interactive-table td {
    padding: 12px 15px;
    text-align: left;
    border: 1px solid #514f4f;
    font-size: 14px;
    color: var(--eggshell);
    vertical-align: top;
}

.interactive-table th {
    background: linear-gradient(180deg, #2b2b2b, #2d2c2c);
    color: var(--red-x);
    font-family: "Stardos Stencil", serif;
    font-size: 16px;
    font-weight: bold;
    position: sticky;
    top: 0;
    z-index: 10;
}

.interactive-table tr:nth-child(even) {
    background: rgba(255,255,255,0.05);
}

.interactive-table tr:hover {
    background: rgba(255,255,255,0.1);
}

/* Column widths */
.checkbox-col {
    width: 60px;
    text-align: center;
    vertical-align: middle;
}

.name-col {
    width: 200px;
    font-weight: bold;
    color: var(--eggshell);
}

.desc-col {
    width: auto;
    color: var(--eggshell);
}

/* Checkbox styling for table */
.table-checkbox {
    appearance: none;
    width: 24px;
    height: 24px;
    cursor: pointer;
    border: 2px solid var(--gold-soft);
    background: #1a1a1a;
    box-shadow: 0 3px 6px rgba(0,0,0,0.8), inset 0 1px 0 rgba(255,255,255,0.15);
    display: inline-block;
    vertical-align: middle;
    border-radius: 0;
    margin: 0;
    position: relative;
}

/* Red checkmark for table checkboxes */
.table-checkbox:checked {
    background: #1a1a1a url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='28' height='28' viewBox='0 0 28 28'%3E%3Cpath fill='none' stroke='%23ff0000' stroke-width='6' d='M4,4 L24,24 M24,4 L4,24'/%3E%3C/svg%3E") no-repeat center center !important;
    background-size: 16px 16px !important;
    border: 2px solid var(--gold-soft) !important;
    box-shadow: 0 6px 12px rgba(0,0,0,0.9) !important;
}

.table-modal-footer {
    display: flex;
    justify-content: space-between;
    gap: 15px;
    margin-top: 20px;
    padding-top: 20px;
    border-top: 1px solid var(--bronze);
}

.table-modal-footer .btn-close,
.table-modal-footer .btn-clear {
    flex: 1;
    padding: 12px 20px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-family: "Rationale", sans-serif;
    font-weight: bold;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.table-modal-footer .btn-close {
    background: #000 !important;
    border: 1px solid #c0c0c0 !important;
    color: #fff !important;
}

.table-modal-footer .btn-clear {
    background: #000 !important;
    border: 1px solid #c0c0c0 !important;
    color: #fff !important;
    position: relative;
}

/* Clear All button turns red when any checkbox is checked */
.btn-clear.has-checked {
    background: var(--red-x) !important;
    border-color: var(--red-x) !important;
    color: white !important;
}

/* Referred Selections List */
.referred-selections {
    margin: 20px 0;
    padding: 15px;
    background: linear-gradient(180deg, #1a1a1a, #111);
    border: 1px solid var(--bronze);
    border-radius: 6px;
    display: none;
}

.referred-selections-title {
    font-family: "Stardos Stencil", serif;
    font-size: 18px;
    color: var(--red-x);
    margin: 0 0 10px 0;
    text-align: center;
}

.referred-selections-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.referred-selections-list li {
    padding: 8px 0;
    border-bottom: 1px solid #333;
    color: var(--eggshell);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.referred-selections-list li:last-child {
    border-bottom: none;
}

.remove-selection {
    background: none;
    border: 1px solid var(--bronze);
    color: var(--red-x);
    width: 24px;
    height: 24px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
}

.remove-selection:hover {
    background: var(--red-x);
    color: white;
}


/* ===== BLACK TACTICAL COMBAT UI - OPTIMIZED ===== */
/* UPDATED: Smaller cards, phone-friendly, added flicker animation */

/* PREVENT PHONE TEXT SCALING ISSUES */
html, body {
    -webkit-text-size-adjust: 100% !important;
    text-size-adjust: 100% !important;
    -moz-text-size-adjust: 100% !important;
}

* {
    max-height: 1000000px; /* Prevents font boosting on Android */
}

:root {
    --tactical-red: #ff2a2a;
    --tactical-blue: #00a8ff;
    --hud-green: #00ff88;
    --ammo-gold: #ffaa00;
    --glow-red: rgba(255, 42, 42, 0.6);
    --glow-blue: rgba(0, 168, 255, 0.6);
    --silver-white: #f0f0f0;
    --silver-light: #d0d0d0;
    --silver-medium: #c0c0c0;
    --silver-bright: #f8f8f8;
}

/* ===== SHARED ANIMATIONS ===== */

@keyframes pulse {
    0%, 100% { opacity: 0.3; }
    50% { opacity: 1; }
}

@keyframes scan {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}

@keyframes priceGlow {
    0%, 100% { opacity: 0.6; }
    50% { opacity: 1; }
}

/* NEW: HUD Flicker Animation for Price Containers */
@keyframes hudFlicker {
    0%, 18%, 22%, 25%, 53%, 57%, 100% {
        opacity: 1;
        box-shadow: 
            inset 0 0 15px rgba(0, 0, 0, 0.5),
            0 0 20px rgba(255, 42, 42, 0.15);
    }
    20%, 24%, 55% {
        opacity: 0.9;
        box-shadow: 
            inset 0 0 15px rgba(0, 0, 0, 0.5),
            0 0 25px rgba(255, 42, 42, 0.3);
    }
}

@keyframes hudFlickerBlue {
    0%, 18%, 22%, 25%, 53%, 57%, 100% {
        opacity: 1;
        box-shadow: 
            inset 0 0 15px rgba(0, 0, 0, 0.5),
            0 0 20px rgba(0, 168, 255, 0.15);
    }
    20%, 24%, 55% {
        opacity: 0.9;
        box-shadow: 
            inset 0 0 15px rgba(0, 0, 0, 0.5),
            0 0 25px rgba(0, 168, 255, 0.3);
    }
}

/* ===== SECTION 1: BATTLE BAG - OPTIMIZED ===== */

.battle-bag-card {
    background: linear-gradient(160deg,
        #0a0a0a 0%,
        #131313 30%,
        #1a1a1a 60%,
        #131313 90%,
        #0a0a0a 100%) !important;
    border: 1px solid;
    border-image: linear-gradient(
        to right,
        transparent 0%,
        var(--tactical-red) 10%,
        var(--tactical-bronze) 20%,
        #1a1a1a 80%,
        transparent 100%
    ) 1;
    border-radius: 0;
    position: relative;
    margin: 20px 0 !important; /* Reduced margin */
    overflow: hidden;
    transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
}

/* SHEEN ANIMATION ON CARD - SLOWER FOR MOBILE */
.battle-bag-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg,
        transparent,
        rgba(255, 42, 42, 0.25),
        rgba(255, 42, 42, 0.4),
        rgba(255, 42, 42, 0.25),
        transparent);
    transition: left 1.8s ease; /* Slower for visibility */
    pointer-events: none;
    z-index: 1;
}

.battle-bag-card:hover::before,
.battle-bag-card:active::before {
    left: 100%;
}

/* Combat Grid Overlay */
.battle-bag-card::after {
    content: '';
    position: absolute;
    inset: 0;
    background-image: 
        linear-gradient(rgba(255, 42, 42, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(255, 42, 42, 0.03) 1px, transparent 1px);
    background-size: 20px 20px;
    opacity: 0;
    transition: opacity 0.4s ease;
    pointer-events: none;
    z-index: 0;
}

.battle-bag-card:hover::after {
    opacity: 0.5;
}

/* Status Indicator */
.battle-bag-card .status-indicator {
    content: '';
    position: absolute;
    top: 12px;
    right: 12px;
    width: 6px;
    height: 6px;
    background: var(--tactical-red);
    border-radius: 50%;
    box-shadow: 
        0 0 8px var(--tactical-red),
        0 0 15px var(--tactical-red);
    animation: pulse 2s infinite;
    z-index: 3;
}

/* Active Combat State */
.battle-bag-card:hover {
    border-image-source: linear-gradient(
        to right,
        transparent 0%,
        var(--tactical-red) 15%,
        var(--tactical-bronze) 30%,
        var(--hud-green) 50%,
        var(--tactical-bronze) 70%,
        var(--tactical-red) 85%,
        transparent 100%
    );
    transform: translateY(-3px); /* Reduced lift */
}

/* BATTLE BAG HEADER - SMALLER */
.battle-bag-header {
    background: linear-gradient(to bottom,
        rgba(10, 10, 10, 0.95) 0%,
        rgba(19, 19, 19, 0.85) 100%) !important;
    padding: 22px 25px 18px !important; /* Reduced padding */
    border-bottom: 1px solid rgba(255, 42, 42, 0.1) !important;
    position: relative;
    text-align: left !important;
    z-index: 2;
}

/* ENHANCED: Battle Bag Scan Line - BRIGHTER RED */
.battle-bag-header::after {
    content: '';
    position: absolute;
    bottom: -1px;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg,
        transparent 0%,
        rgba(255, 42, 42, 0.9) 25%,
        rgba(255, 42, 42, 1) 50%,
        rgba(255, 42, 42, 0.9) 75%,
        transparent 100%);
    animation: scan 2.5s linear infinite;
    z-index: 2;
    filter: drop-shadow(0 0 3px rgba(255, 42, 42, 0.7));
}

/* Combat Designation - WITH SPACING FIX */
.battle-bag-header::before {
    content: 'OPERATION';
    font-family: "Orbitron", sans-serif;
    font-size: 0.8rem !important; /* Smaller */
    color: var(--hud-green);
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-bottom: 10px !important; /* Reduced spacing */
    font-weight: 500;
    display: block;
    z-index: 2;
}

/* BATTLE BAG TITLE - SMALLER WITH RESPONSIVE SIZING */
.battle-bag-title {
    font-family: "Rajdhani", "Orbitron", Arial, sans-serif !important;
    font-size: 1.8rem !important; /* Reduced from 2.2rem */
    font-size: clamp(1.5rem, 6vw, 1.8rem) !important; /* Responsive */
    color: var(--silver-white) !important;
    margin: 0 0 4px 0 !important;
    letter-spacing: 0.8px;
    font-weight: 700 !important;
    text-transform: uppercase;
    text-shadow: 
        0 1px 2px rgba(0, 0, 0, 0.9),
        0 2px 4px rgba(0, 0, 0, 0.7),
        0 0 15px rgba(240, 240, 240, 0.4) !important;
    position: relative;
    z-index: 2;
}

.battle-bag-subtitle {
    font-family: "Share Tech Mono", monospace !important;
    font-size: 0.85rem !important; /* Smaller */
    color: var(--silver-light) !important;
    letter-spacing: 1.2px;
    font-weight: 400;
    opacity: 0.9;
    margin-top: 6px !important;
    text-shadow: 
        0 1px 1px rgba(0, 0, 0, 0.8),
        0 0 8px rgba(240, 240, 240, 0.2);
    position: relative;
    z-index: 2;
}

/* BATTLE BAG BODY - SMALLER */
.battle-bag-body {
    padding: 25px !important; /* Reduced from 35px */
    background: linear-gradient(180deg,
        rgba(19, 19, 19, 0.6) 0%,
        rgba(13, 13, 13, 0.8) 100%) !important;
    position: relative;
    z-index: 1;
}

/* BATTLE BAG FEATURES - COMPACT */
.battle-bag-features {
    list-style: none;
    padding: 0;
    margin: 0 0 25px 0 !important; /* Reduced margin */
}

.battle-bag-features li {
    padding: 14px 0 14px 35px !important; /* Reduced padding */
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    color: var(--silver-medium) !important;
    font-family: "Rajdhani", sans-serif;
    font-size: 0.95rem !important; /* Slightly smaller */
    position: relative;
    transition: all 0.2s ease;
    z-index: 2;
    box-shadow: 0 1px 1px rgba(0, 0, 0, 0.2);
}

.battle-bag-features li:last-child {
    border-bottom: none;
}

.battle-bag-features li::before {
    content: '■';
    position: absolute;
    left: 0;
    top: 14px;
    color: var(--tactical-red);
    font-size: 0.7rem;
    margin-right: 12px;
    transition: all 0.2s ease;
    text-shadow: 0 0 6px rgba(255, 42, 42, 0.5);
}

.battle-bag-features li:hover {
    color: #ffffff !important;
    padding-left: 38px !important;
}

.battle-bag-features li:hover::before {
    color: var(--hud-green);
    transform: scale(1.2);
    text-shadow: 0 0 10px rgba(0, 255, 136, 0.7);
}

/* BATTLE BAG PRICE - WITH FLICKER ANIMATION */
.battle-bag-price {
    background: rgba(10, 10, 10, 0.7) !important;
    border: 1px solid rgba(255, 42, 42, 0.3) !important;
    padding: 18px !important; /* Reduced from 25px */
    margin: 25px 0 20px 0 !important; /* Reduced margins */
    position: relative;
    overflow: visible !important; /* Changed for text overflow */
    border-radius: 0 !important;
    animation: hudFlicker 6s infinite !important; /* Added flicker */
    word-break: keep-all !important;
    white-space: nowrap !important;
    z-index: 2;
}

.battle-bag-price::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg,
        transparent 0%,
        rgba(255, 42, 42, 0.6) 20%,
        rgba(255, 42, 42, 0.9) 50%,
        rgba(255, 42, 42, 0.6) 80%,
        transparent 100%);
    animation: priceGlow 3s ease-in-out infinite;
}

.battle-bag-price::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg,
        transparent 0%,
        rgba(255, 42, 42, 0.6) 20%,
        rgba(255, 42, 42, 0.9) 50%,
        rgba(255, 42, 42, 0.6) 80%,
        transparent 100%);
    animation: priceGlow 3s ease-in-out infinite reverse;
}

.battle-bag-price .price-amount {
    font-family: "Orbitron", "Courier New", monospace !important; /* Added fallback */
    font-size: 2.8rem !important; /* Reduced from 3.5rem */
    font-size: clamp(2.2rem, 8vw, 2.8rem) !important; /* Responsive sizing */
    color: var(--silver-bright) !important;
    text-align: center;
    margin: 0;
    font-weight: 700;
    text-shadow: 
        0 1px 2px rgba(0, 0, 0, 0.9),
        0 2px 4px rgba(0, 0, 0, 0.7),
        0 0 12px rgba(248, 248, 248, 0.5) !important;
    letter-spacing: 1.5px;
    position: relative;
    z-index: 2;
}

.battle-bag-price .price-label {
    font-family: "Share Tech Mono", monospace !important;
    font-size: 0.85rem !important; /* Smaller */
    color: var(--silver-light) !important;
    text-align: center;
    margin-top: 6px;
    text-transform: uppercase;
    letter-spacing: 2.5px;
    opacity: 1;
    text-shadow: 
        0 1px 1px rgba(0, 0, 0, 0.8),
        0 0 6px rgba(224, 224, 224, 0.3);
    position: relative;
    z-index: 2;
}

/* BATTLE BAG BUTTON - SMALLER */
.battle-bag-card .btn-details {
    background: linear-gradient(135deg,
        rgba(26, 26, 26, 0.95) 0%,
        rgba(19, 19, 19, 0.95) 100%) !important;
    border: 1px solid rgba(255, 42, 42, 0.8) !important;
    color: #ffffff !important;
    font-family: "Orbitron", "Courier New", monospace !important; /* Fallback */
    font-size: 0.95rem !important; /* Smaller */
    font-weight: 600 !important;
    text-transform: uppercase !important;
    letter-spacing: 2px !important; /* Reduced */
    padding: 16px 40px !important; /* Smaller */
    border-radius: 0 !important;
    position: relative;
    overflow: visible;
    transition: all 0.3s ease;
    min-width: 220px !important; /* Smaller */
    max-width: 100%;
    box-shadow: 
        0 3px 12px rgba(0, 0, 0, 0.5),
        0 0 15px var(--glow-red),
        inset 0 0 0 1px rgba(255, 255, 255, 0.1) !important;
    z-index: 2;
}

.battle-bag-card .btn-details:hover {
    background: linear-gradient(135deg,
        rgba(34, 34, 34, 0.95) 0%,
        rgba(26, 26, 26, 0.95) 100%) !important;
    border-color: var(--hud-green) !important;
    color: var(--hud-green) !important;
    letter-spacing: 2.2px !important;
    box-shadow: 
        0 5px 15px rgba(0, 0, 0, 0.6),
        0 0 25px rgba(0, 255, 136, 0.4),
        inset 0 0 0 1px rgba(255, 255, 255, 0.15) !important;
}

.battle-bag-card .btn-details:active {
    transform: translateY(1px);
}

/* ===== SECTION 2: BATTLE BADGE - OPTIMIZED ===== */

.battle-badge-card {
    background: linear-gradient(160deg,
        #0a0a0a 0%,
        #131313 30%,
        #1a1a1a 60%,
        #131313 90%,
        #0a0a0a 100%) !important;
    border: 1px solid;
    border-image: linear-gradient(
        to right,
        transparent 0%,
        var(--tactical-blue) 10%,
        var(--tactical-bronze) 20%,
        #1a1a1a 80%,
        transparent 100%
    ) 1;
    border-radius: 0;
    position: relative;
    margin: 20px 0 !important; /* Reduced margin */
    overflow: hidden;
    transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
}

/* SHEEN ANIMATION ON CARD (BLUE VERSION) */
.battle-badge-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg,
        transparent,
        rgba(0, 168, 255, 0.25),
        rgba(0, 168, 255, 0.4),
        rgba(0, 168, 255, 0.25),
        transparent);
    transition: left 1.8s ease;
    pointer-events: none;
    z-index: 1;
}

.battle-badge-card:hover::before,
.battle-badge-card:active::before {
    left: 100%;
}

/* Combat Grid Overlay */
.battle-badge-card::after {
    content: '';
    position: absolute;
    inset: 0;
    background-image: 
        linear-gradient(rgba(0, 168, 255, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0, 168, 255, 0.03) 1px, transparent 1px);
    background-size: 20px 20px;
    opacity: 0;
    transition: opacity 0.4s ease;
    pointer-events: none;
    z-index: 0;
}

.battle-badge-card:hover::after {
    opacity: 0.5;
}

/* Status Indicator */
.battle-badge-card .status-indicator {
    content: '';
    position: absolute;
    top: 12px;
    right: 12px;
    width: 6px;
    height: 6px;
    background: var(--tactical-blue);
    border-radius: 50%;
    box-shadow: 
        0 0 8px var(--tactical-blue),
        0 0 15px var(--tactical-blue);
    animation: pulse 2s infinite;
    z-index: 3;
}

/* Active Combat State */
.battle-badge-card:hover {
    border-image-source: linear-gradient(
        to right,
        transparent 0%,
        var(--tactical-blue) 15%,
        var(--tactical-bronze) 30%,
        var(--hud-green) 50%,
        var(--tactical-bronze) 70%,
        var(--tactical-blue) 85%,
        transparent 100%
    );
    transform: translateY(-3px);
}

/* BATTLE BADGE HEADER - SMALLER */
.battle-badge-header {
    background: linear-gradient(to bottom,
        rgba(10, 10, 10, 0.95) 0%,
        rgba(19, 19, 19, 0.85) 100%) !important;
    padding: 22px 25px 18px !important;
    border-bottom: 1px solid rgba(0, 168, 255, 0.1) !important;
    position: relative;
    text-align: left !important;
    z-index: 2;
}

/* ENHANCED: Battle Badge Scan Line - BRIGHTER BLUE */
.battle-badge-header::after {
    content: '';
    position: absolute;
    bottom: -1px;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg,
        transparent 0%,
        rgba(0, 168, 255, 0.9) 25%,
        rgba(0, 168, 255, 1) 50%,
        rgba(0, 168, 255, 0.9) 75%,
        transparent 100%);
    animation: scan 2.5s linear infinite;
    z-index: 2;
    filter: drop-shadow(0 0 3px rgba(0, 168, 255, 0.7));
}

/* Combat Designation - WITH SPACING FIX */
.battle-badge-header::before {
    content: 'IDENTIFICATION';
    font-family: "Orbitron", sans-serif;
    font-size: 0.8rem !important;
    color: var(--hud-green);
    letter-spacing: 2px;
    text-transform: uppercase;
    margin-bottom: 10px !important;
    font-weight: 500;
    display: block;
    z-index: 2;
}

/* BATTLE BADGE TITLE - SMALLER WITH RESPONSIVE SIZING */
.battle-badge-title {
    font-family: "Rajdhani", "Orbitron", Arial, sans-serif !important;
    font-size: 1.8rem !important;
    font-size: clamp(1.5rem, 6vw, 1.8rem) !important;
    color: var(--silver-white) !important;
    margin: 0 0 4px 0 !important;
    letter-spacing: 0.8px;
    font-weight: 700 !important;
    text-transform: uppercase;
    text-shadow: 
        0 1px 2px rgba(0, 0, 0, 0.9),
        0 2px 4px rgba(0, 0, 0, 0.7),
        0 0 15px rgba(240, 240, 240, 0.4) !important;
    position: relative;
    z-index: 2;
}

/* BATTLE BADGE SUBTITLE - SMALLER */
.battle-badge-subtitle {
    font-family: "Share Tech Mono", monospace !important;
    font-size: 0.85rem !important;
    color: var(--silver-light) !important;
    letter-spacing: 1.2px;
    font-weight: 400;
    opacity: 0.9;
    margin-top: 6px !important;
    text-shadow: 
        0 1px 1px rgba(0, 0, 0, 0.8),
        0 0 8px rgba(240, 240, 240, 0.2);
    position: relative;
    z-index: 2;
}

/* BATTLE BADGE BODY - SMALLER */
.battle-badge-body {
    padding: 25px !important;
    background: linear-gradient(180deg,
        rgba(19, 19, 19, 0.6) 0%,
        rgba(13, 13, 13, 0.8) 100%) !important;
    position: relative;
    z-index: 1;
}

/* BATTLE BADGE FEATURES - COMPACT */
.battle-badge-features {
    list-style: none;
    padding: 0;
    margin: 0 0 25px 0 !important;
}

.battle-badge-features li {
    padding: 14px 0 14px 35px !important;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    color: var(--silver-medium) !important;
    font-family: "Rajdhani", sans-serif;
    font-size: 0.95rem !important;
    position: relative;
    transition: all 0.2s ease;
    z-index: 2;
    box-shadow: 0 1px 1px rgba(0, 0, 0, 0.2);
}

.battle-badge-features li:last-child {
    border-bottom: none;
}

.battle-badge-features li::before {
    content: '■';
    position: absolute;
    left: 0;
    top: 14px;
    color: var(--tactical-blue);
    font-size: 0.7rem;
    margin-right: 12px;
    transition: all 0.2s ease;
    text-shadow: 0 0 6px rgba(0, 168, 255, 0.5);
}

.battle-badge-features li:hover {
    color: #ffffff !important;
    padding-left: 38px !important;
}

.battle-badge-features li:hover::before {
    color: var(--hud-green);
    transform: scale(1.2);
    text-shadow: 0 0 10px rgba(0, 255, 136, 0.7);
}

/* BATTLE BADGE PRICE - WITH BLUE FLICKER ANIMATION */
.battle-badge-price {
    background: rgba(10, 10, 10, 0.7) !important;
    border: 1px solid rgba(0, 168, 255, 0.3) !important;
    padding: 18px !important;
    margin: 25px 0 20px 0 !important;
    position: relative;
    overflow: visible !important;
    border-radius: 0 !important;
    animation: hudFlickerBlue 6s infinite !important; /* Blue flicker */
    word-break: keep-all !important;
    white-space: nowrap !important;
    z-index: 2;
}

.battle-badge-price::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg,
        transparent 0%,
        rgba(0, 168, 255, 0.6) 20%,
        rgba(0, 168, 255, 0.9) 50%,
        rgba(0, 168, 255, 0.6) 80%,
        transparent 100%);
    animation: priceGlow 3s ease-in-out infinite;
}

.battle-badge-price::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg,
        transparent 0%,
        rgba(0, 168, 255, 0.6) 20%,
        rgba(0, 168, 255, 0.9) 50%,
        rgba(0, 168, 255, 0.6) 80%,
        transparent 100%);
    animation: priceGlow 3s ease-in-out infinite reverse;
}

.battle-badge-price .price-amount {
    font-family: "Orbitron", "Courier New", monospace !important;
    font-size: 2.8rem !important;
    font-size: clamp(2.2rem, 8vw, 2.8rem) !important;
    color: var(--silver-bright) !important;
    text-align: center;
    margin: 0;
    font-weight: 700;
    text-shadow: 
        0 1px 2px rgba(0, 0, 0, 0.9),
        0 2px 4px rgba(0, 0, 0, 0.7),
        0 0 12px rgba(248, 248, 248, 0.5) !important;
    letter-spacing: 1.5px;
    position: relative;
    z-index: 2;
}

.battle-badge-price .price-label {
    font-family: "Share Tech Mono", monospace !important;
    font-size: 0.85rem !important;
    color: var(--silver-light) !important;
    text-align: center;
    margin-top: 6px;
    text-transform: uppercase;
    letter-spacing: 2.5px;
    opacity: 1;
    text-shadow: 
        0 1px 1px rgba(0, 0, 0, 0.8),
        0 0 6px rgba(224, 224, 224, 0.3);
    position: relative;
    z-index: 2;
}

/* BATTLE BADGE BUTTON - SMALLER */
.battle-badge-card .btn-details {
    background: linear-gradient(135deg,
        rgba(26, 26, 26, 0.95) 0%,
        rgba(19, 19, 19, 0.95) 100%) !important;
    border: 1px solid rgba(0, 168, 255, 0.8) !important;
    color: #ffffff !important;
    font-family: "Orbitron", "Courier New", monospace !important;
    font-size: 0.95rem !important;
    font-weight: 600 !important;
    text-transform: uppercase !important;
    letter-spacing: 2px !important;
    padding: 16px 40px !important;
    border-radius: 0 !important;
    position: relative;
    overflow: visible;
    transition: all 0.3s ease;
    min-width: 220px !important;
    max-width: 100%;
    box-shadow: 
        0 3px 12px rgba(0, 0, 0, 0.5),
        0 0 15px var(--glow-blue),
        inset 0 0 0 1px rgba(255, 255, 255, 0.1) !important;
    z-index: 2;
}

.battle-badge-card .btn-details:hover {
    background: linear-gradient(135deg,
        rgba(34, 34, 34, 0.95) 0%,
        rgba(26, 26, 26, 0.95) 100%) !important;
    border-color: var(--hud-green) !important;
    color: var(--hud-green) !important;
    letter-spacing: 2.2px !important;
    box-shadow: 
        0 5px 15px rgba(0, 0, 0, 0.6),
        0 0 25px rgba(0, 255, 136, 0.4),
        inset 0 0 0 1px rgba(255, 255, 255, 0.15) !important;
}

.battle-badge-card .btn-details:active {
    transform: translateY(1px);
}

/* ===== RESPONSIVE OPTIMIZATIONS ===== */
@media (max-width: 768px) {
    /* Cards become more compact on mobile */
    .battle-bag-card,
    .battle-badge-card {
        margin: 15px 0 !important;
    }
    
    .battle-bag-header,
    .battle-badge-header {
        padding: 18px 20px 15px !important;
    }
    
    .battle-bag-body,
    .battle-badge-body {
        padding: 20px !important;
    }
    
    .battle-bag-features,
    .battle-badge-features {
        margin: 0 0 20px 0 !important;
    }
    
    .battle-bag-features li,
    .battle-badge-features li {
        padding: 12px 0 12px 30px !important;
        font-size: 0.9rem !important;
    }
    
    .battle-bag-price,
    .battle-badge-price {
        padding: 15px !important;
        margin: 20px 0 15px 0 !important;
    }
    
    .battle-bag-card .btn-details,
    .battle-badge-card .btn-details {
        padding: 14px 30px !important;
        min-width: 200px !important;
        font-size: 0.9rem !important;
    }
    
    /* Sheen triggers on touch for mobile */
    .battle-bag-card:active::before,
    .battle-badge-card:active::before {
        left: 100%;
    }
}

@media (max-width: 480px) {
    /* Extra small devices */
    .battle-bag-title,
    .battle-badge-title {
        font-size: 1.5rem !important;
        letter-spacing: 0.5px;
    }
    
    .battle-bag-price .price-amount,
    .battle-badge-price .price-amount {
        font-size: 2.2rem !important;
        letter-spacing: 1px;
    }
    
    .battle-bag-card .btn-details,
    .battle-badge-card .btn-details {
        width: 100% !important;
        min-width: auto !important;
        padding: 14px 20px !important;
    }
}

/* SCROLL FIXES FOR ALL MODAL TYPES */
.drills-modal-content,
.stage-drill-modal-content,
.skills-assessment-modal-content,
.legal-modal-content,
.course-modal-content,
.table-modal-content,
.modal-content,
.course-selection-content {
    max-height: 85vh !important;
    overflow-y: auto !important;
}

/* ENSURE CLOSE BUTTONS ARE VISIBLE */
.close-drills-modal,
.close-stage-drill-modal,
.close-legal-modal,
.close-course-modal,
.close-course-selection,
.close-modal {
    position: sticky !important;
    top: 10px !important;
    z-index: 1010 !important;
    background: rgba(0,0,0,0.8) !important;
    border-radius: 50% !important;
    width: 40px !important;
    height: 40px !important;
    display: flex !important;
    align-items: center !important;
    justify-content: center !important;
}

/* === NEW RULE FOR HORIZONTAL CARDS === */
.dynamic-analysis-grid .dynamic-analysis-card {
    flex: 0 0 auto;     /* Don't grow or shrink */
    width: 320px;       /* Fixed width for horizontal cards */
    margin-right: 25px; /* Space between cards (replaces gap for flex) */
/* === ADD THIS NEW LINE === */
    scroll-snap-align: start; /* Tells the browser to snap to this card's edge */
}

/* Remove margin from the last card */
.dynamic-analysis-grid .dynamic-analysis-card:last-child {
    margin-right: 0;
}
</style>
</head>
<body>
<div class="stage">

  <!-- Hamburger Menu -->
  <div class="hamburger-menu">
    <span></span>
    <span></span>
    <span></span>
  </div>

  <div class="menu-overlay">
    <div class="menu-content">
      <button class="close-menu">×</button>
      <h3>APP ACTIONS</h3>
      <button class="menu-btn" id="menu-save-offline">Save for Offline Use</button>
      <button class="menu-btn" id="menu-print-current">Print Current Page</button>
      <button class="menu-btn" id="menu-compile-send">Compile & Send</button>
    </div>
  </div>

    <!-- Course Selection Modal -->
<div class="course-selection-modal">
  <div class="course-selection-content">
    <button class="close-course-selection">×</button>
    <h3>SELECT COURSE</h3>
    <button class="course-option" data-course="1">Course 1: Principles</button>
    <button class="course-option" data-course="2">Course 2: Integration</button>
    <button class="course-option" data-course="3">Course 3: Mastery</button>
    <button class="course-option" data-course="4">Course 4: Concealed Carry</button>
    <button class="course-option" data-course="5">Course 5: Qualification</button>
    <button class="course-option" data-course="all">All Courses</button>
  </div>
</div>

<!-- Course Modals - 3-SECTION HORIZONTAL SNAP SCROLLING -->
<div class="course-modal" id="course1-modal">
  <div class="course-modal-content">
    <!-- SNAP SECTION 1: Title + Details + Objectives -->
    <div class="course-snap-section course-snap-1">
      <div class="red-arrow-indicator">→</div>
      <div class="snap-inner-container">
        <div class="course-title-container">
          <div class="title-text">PHASE 1: Principles</div>
          <div class="course-subtitle">Building Your Defensive Platform</div>
        </div>
        
        <div class="course-details-compact">
          <div class="course-detail-item">
            <div class="course-detail-label">Duration</div>
            <div class="course-detail-value">1.5 hours</div>
          </div>
          <div class="course-detail-item">
            <div class="course-detail-label">Ammunition</div>
            <div class="course-detail-value">30 rounds</div>
          </div>
          <div class="course-detail-item">
            <div class="course-detail-label">Fee</div>
            <div class="course-detail-value">$125</div>
          </div>
          <div class="course-detail-item">
            <div class="course-detail-label">Targets</div>
            <div class="course-detail-value">1-2 B-27 + 3" circles</div>
          </div>
        </div>
        
        <div class="class-grid">
          <div class="card">
            <div class="subhead">Session Objectives</div>
            <ul class="checks">
              <li><input class="chk" type="checkbox" data-phase="1" data-type="objective"><span>Establish firearm safety as continuous awareness</span></li>
              <li><input class="chk" type="checkbox" data-phase="1" data-type="objective"><span>Develop natural point of aim and proper grip</span></li>
              <li><input class="chk" type="checkbox" data-phase="1" data-type="objective"><span>Build accurate shot placement fundamentals</span></li>
              <li><input class="chk" type="checkbox" data-phase="1" data-type="objective"><span>Understand Idaho self-defense law foundation</span></li>
              <li><input class="chk" type="checkbox" data-phase="1" data-type="objective"><span>Create mental framework for defensive shooting</span></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    
    <!-- SNAP SECTION 2: Lesson Flow -->
    <div class="course-snap-section course-snap-2">
      <div class="red-arrow-indicator">→</div>
      <div class="snap-inner-container">
        <div class="class-grid">
          <div class="card">
            <div class="subhead">Lesson Flow</div>
            <div class="lesson-flow-table">
              <div class="table-container">
                <table>
                  <thead>
                    <tr>
                      <th>Segment</th>
                      <th>Time</th>
                      <th>Focus</th>
                      <th>Key Points</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>1. Welcome & Safety Brief</td>
                      <td>15 min</td>
                      <td>Orientation</td>
                      <td>Range rules, safety protocols</td>
                    </tr>
                    <tr>
                      <td>2. Weapon Familiarization</td>
                      <td>20 min</td>
                      <td>Handling</td>
                      <td>Parts, operation, safe handling</td>
                    </tr>
                    <tr>
                      <td>3. Grip & Stance Fundamentals</td>
                      <td>20 min</td>
                      <td>Fundamentals</td>
                      <td>Proper form, sight picture</td>
                    </tr>
                    <tr>
                      <td>4. Sight Alignment & Trigger Control</td>
                      <td>15 min</td>
                      <td>Fundamentals</td>
                      <td>Sight picture, trigger press</td>
                    </tr>
                    <tr>
                      <td>5. Initial Live Fire</td>
                      <td>15 min</td>
                      <td>Application</td>
                      <td>First shots, basic accuracy</td>
                    </tr>
                    <tr>
                      <td>6. Live Fire Skill Building</td>
                      <td>20 min</td>
                      <td>Refinement</td>
                      <td>Follow-up shots, consistency</td>
                    </tr>
                    <tr>
                      <td>7. Idaho Self-Defense Law Foundation</td>
                      <td>15 min</td>
                      <td>Legal</td>
                      <td>Basic self-defense principles</td>
                    </tr>
                    <tr>
                      <td>8. Shoot/Don't Shoot Decision Foundation</td>
                      <td>10 min</td>
                      <td>Decision-making</td>
                      <td>Threat identification, judgment</td>
                    </tr>
                    <tr>
                      <td>9. Debrief & Phase 1 Completion</td>
                      <td>10 min</td>
                      <td>Review</td>
                      <td>Progress assessment, next steps</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- SNAP SECTION 3: Notes + Close -->
    <div class="course-snap-section course-snap-3">
      <div class="snap-inner-container">
        <div class="class-grid">
          <div class="notes-card">
            <div class="subhead">Phase 1 Notes</div>
            <textarea placeholder="Instructor notes for Phase 1..."></textarea>
            <button class="save-notes-btn" data-phase="1" data-type="course">Save Notes</button>
            <div class="hint">Saved with the rest of the client's progress.</div>
          </div>
          
          <div class="course-modal-actions">
            <button class="btn-close">Close</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Phase 2 Modal -->
<div class="course-modal" id="course2-modal">
  <div class="course-modal-content">
    <!-- SNAP SECTION 1: Title + Details + Objectives -->
    <div class="course-snap-section course-snap-1">
      <div class="red-arrow-indicator">→</div>
      <div class="snap-inner-container">
        <div class="course-title-container">
          <div class="title-text">PHASE 2: INTEGRATION</div>
          <div class="course-subtitle">Skills Under Pressure</div>
        </div>
        
        <div class="course-details-compact">
          <div class="course-detail-item">
            <div class="course-detail-label">Duration</div>
            <div class="course-detail-value">1.5 hours</div>
          </div>
          <div class="course-detail-item">
            <div class="course-detail-label">Ammunition</div>
            <div class="course-detail-value">30 rounds</div>
          </div>
          <div class="course-detail-item">
            <div class="course-detail-label">Fee</div>
            <div class="course-detail-value">$125</div>
          </div>
          <div class="course-detail-item">
            <div class="course-detail-label">Targets</div>
            <div class="course-detail-value">2-3 B-27 per Client</div>
          </div>
        </div>
        
        <div class="class-grid">
          <div class="card">
            <div class="subhead">Session Objectives</div>
            <ul class="checks">
              <li><input class="chk" type="checkbox" data-phase="2" data-type="objective"><span>Maintain accuracy while moving</span></li>
              <li><input class="chk" type="checkbox" data-phase="2" data-type="objective"><span>Execute efficient multiple-target transitions</span></li>
              <li><input class="chk" type="checkbox" data-phase="2" data-type="objective"><span>Perform emergency reloads</span></li>
              <li><input class="chk" type="checkbox" data-phase="2" data-type="objective"><span>Clear basic malfunctions</span></li>
              <li><input class="chk" type="checkbox" data-phase="2" data-type="objective"><span>Shoot with one hand (strong and support)</span></li>
              <li><input class="chk" type="checkbox" data-phase="2" data-type="objective"><span>Understand post-incident legal protocol</span></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    
    <!-- SNAP SECTION 2: Lesson Flow -->
    <div class="course-snap-section course-snap-2">
      <div class="red-arrow-indicator">→</div>
      <div class="snap-inner-container">
        <div class="class-grid">
          <div class="card">
            <div class="subhead">Lesson Flow</div>
            <div class="lesson-flow-table">
              <div class="table-container">
                <table>
                  <thead>
                    <tr>
                      <th>Segment</th>
                      <th>Time</th>
                      <th>Focus</th>
                      <th>Key Points</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>1. Phase 1 Review & Warm-up</td>
                      <td>15 min</td>
                      <td>Review</td>
                      <td>Fundamentals confirmation</td>
                    </tr>
                    <tr>
                      <td>2. Shooting While Moving</td>
                      <td>25 min</td>
                      <td>Movement</td>
                      <td>Lateral movement, stable platform</td>
                    </tr>
                    <tr>
                      <td>3. Multiple Target Engagement</td>
                      <td>20 min</td>
                      <td>Transitions</td>
                      <td>Vision-lead concept, smooth transitions</td>
                    </tr>
                    <tr>
                      <td>4. Malfunction Clearances</td>
                      <td>20 min</td>
                      <td>Problem-solving</td>
                      <td>Tap-rack-assess, Type 1 & 2 malfunctions</td>
                    </tr>
                    <tr>
                      <td>5. Reload Techniques</td>
                      <td>15 min</td>
                      <td>Skills</td>
                      <td>Emergency reload procedures</td>
                    </tr>
                    <tr>
                      <td>6. One-Handed Shooting</td>
                      <td>10 min</td>
                      <td>Adaptability</td>
                      <td>Strong/support hand only techniques</td>
                    </tr>
                    <tr>
                      <td>7. Post-Incident Legal Protocol</td>
                      <td>15 min</td>
                      <td>Legal</td>
                      <td>911 calls, police interaction</td>
                    </tr>
                    <tr>
                      <td>8. Debrief & Phase 2 Completion</td>
                      <td>10 min</td>
                      <td>Review</td>
                      <td>Progress assessment, next steps</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- SNAP SECTION 3: Notes + Close -->
    <div class="course-snap-section course-snap-3">
      <div class="snap-inner-container">
        <div class="class-grid">
          <div class="notes-card">
            <div class="subhead">Phase 2 Notes</div>
            <textarea placeholder="Instructor notes for Phase 2..."></textarea>
            <button class="save-notes-btn" data-phase="2" data-type="course">Save Notes</button>
            <div class="hint">Saved with the rest of the client's progress.</div>
          </div>
          
          <div class="course-modal-actions">
            <button class="btn-close">Close</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Phase 3 Modal -->
<div class="course-modal" id="course3-modal">
  <div class="course-modal-content">
    <!-- SNAP SECTION 1: Title + Details + Objectives -->
    <div class="course-snap-section course-snap-1">
      <div class="red-arrow-indicator">→</div>
      <div class="snap-inner-container">
        <div class="course-title-container">
          <div class="title-text">PHASE 3: MASTERY</div>
          <div class="course-subtitle">Complete Defensive Integration</div>
        </div>
        
        <div class="course-details-compact">
          <div class="course-detail-item">
            <div class="course-detail-label">Duration</div>
            <div class="course-detail-value">1.5 hours</div>
          </div>
          <div class="course-detail-item">
            <div class="course-detail-label">Ammunition</div>
            <div class="course-detail-value">30 rounds</div>
          </div>
          <div class="course-detail-item">
            <div class="course-detail-label">Fee</div>
            <div class="course-detail-value">$125</div>
          </div>
          <div class="course-detail-item">
            <div class="course-detail-label">Targets</div>
            <div class="course-detail-value">3-4 B-27 (THREAT/INNOCENT)</div>
          </div>
        </div>
        
        <div class="class-grid">
          <div class="card">
            <div class="subhead">Session Objectives</div>
            <ul class="checks">
              <li><input class="chk" type="checkbox" data-phase="3" data-type="objective"><span>Apply shoot/no-shoot discrimination</span></li>
              <li><input class="chk" type="checkbox" data-phase="3" data-type="objective"><span>Shoot from compromised positions</span></li>
              <li><input class="chk" type="checkbox" data-phase="3" data-type="objective"><span>Integrate technical skills with legal knowledge</span></li>
              <li><input class="chk" type="checkbox" data-phase="3" data-type="objective"><span>Complete performance assessment</span></li>
              <li><input class="chk" type="checkbox" data-phase="3" data-type="objective"><span>Understand criminal vs. civil liability</span></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    
    <!-- SNAP SECTION 2: Lesson Flow -->
    <div class="course-snap-section course-snap-2">
      <div class="red-arrow-indicator">→</div>
      <div class="snap-inner-container">
        <div class="class-grid">
          <div class="card">
            <div class="subhead">Lesson Flow</div>
            <div class="lesson-flow-table">
              <div class="table-container">
                <table>
                  <thead>
                    <tr>
                      <th>Segment</th>
                      <th>Time</th>
                      <th>Focus</th>
                      <th>Key Points</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>1. Phase 1 & 2 Integration Review</td>
                      <td>15 min</td>
                      <td>Review</td>
                      <td>Transitions and reload review</td>
                    </tr>
                    <tr>
                      <td>2. Shoot/No-Shoot Discrimination</td>
                      <td>25 min</td>
                      <td>Decision-making</td>
                      <td>Threat assessment, legal justification</td>
                    </tr>
                    <tr>
                      <td>3. Shooting from Compromised Positions</td>
                      <td>25 min</td>
                      <td>Adaptability</td>
                      <td>Seated, kneeling positions</td>
                    </tr>
                    <tr>
                      <td>4. Performance Assessment</td>
                      <td>20 min</td>
                      <td>Evaluation</td>
                      <td>Accuracy baseline, skill measurement</td>
                    </tr>
                    <tr>
                      <td>5. Legal Liability Deep Dive</td>
                      <td>20 min</td>
                      <td>Legal</td>
                      <td>Criminal vs. civil liability</td>
                    </tr>
                    <tr>
                      <td>6. Holster Discussion</td>
                      <td>10 min</td>
                      <td>Equipment</td>
                      <td>Holster selection, no live fire</td>
                    </tr>
                    <tr>
                      <td>7. Debrief & Phase 3 Completion</td>
                      <td>5 min</td>
                      <td>Review</td>
                      <td>Progress assessment, next steps</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- SNAP SECTION 3: Notes + Close -->
    <div class="course-snap-section course-snap-3">
      <div class="snap-inner-container">
        <div class="class-grid">
          <div class="notes-card">
            <div class="subhead">Phase 3 Notes</div>
            <textarea placeholder="Instructor notes for Phase 3..."></textarea>
            <button class="save-notes-btn" data-phase="3" data-type="course">Save Notes</button>
            <div class="hint">Saved with the rest of the client's progress.</div>
          </div>
          
          <div class="course-modal-actions">
            <button class="btn-close">Close</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Phase 4 Modal -->
<div class="course-modal" id="course4-modal">
  <div class="course-modal-content">
    <!-- SNAP SECTION 1: Title + Details + Objectives -->
    <div class="course-snap-section course-snap-1">
      <div class="red-arrow-indicator">→</div>
      <div class="snap-inner-container">
        <div class="course-title-container">
          <div class="title-text">PHASE 4: CONCEALED CARRY</div>
          <div class="course-subtitle">Armed Citizenship & Public Responsibility</div>
        </div>
        
        <div class="course-details-compact">
          <div class="course-detail-item">
            <div class="course-detail-label">Duration</div>
            <div class="course-detail-value">1.5 hours</div>
          </div>
          <div class="course-detail-item">
            <div class="course-detail-label">Ammunition</div>
            <div class="course-detail-value">30 rounds</div>
          </div>
          <div class="course-detail-item">
            <div class="course-detail-label">Fee</div>
            <div class="course-detail-value">$125</div>
          </div>
          <div class="course-detail-item">
            <div class="course-detail-label">Targets</div>
            <div class="course-detail-value">3 B-27 (mixed threat/innocent)</div>
          </div>
        </div>
        
        <div class="class-grid">
          <div class="card">
            <div class="subhead">Session Objectives</div>
            <ul class="checks">
              <li><input class="chk" type="checkbox" data-phase="4" data-type="objective"><span>Develop concealed carry mindset</span></li>
              <li><input class="chk" type="checkbox" data-phase="4" data-type="objective"><span>Understand concealment and clothing strategies</span></li>
              <li><input class="chk" type="checkbox" data-phase="4" data-type="objective"><span>Master law enforcement interaction protocols</span></li>
              <li><input class="chk" type="checkbox" data-phase="4" data-type="objective"><span>Expand legal knowledge (duty to retreat, defense of others, property)</span></li>
              <li><input class="chk" type="checkbox" data-phase="4" data-type="objective"><span>Navigate public space threat assessment</span></li>
              <li><input class="chk" type="checkbox" data-phase="4" data-type="objective"><span>Prepare for Phase 5 qualification</span></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    
    <!-- SNAP SECTION 2: Lesson Flow -->
    <div class="course-snap-section course-snap-2">
      <div class="red-arrow-indicator">→</div>
      <div class="snap-inner-container">
        <div class="class-grid">
          <div class="card">
            <div class="subhead">Lesson Flow</div>
            <div class="lesson-flow-table">
              <div class="table-container">
                <table>
                  <thead>
                    <tr>
                      <th>Segment</th>
                      <th>Time</th>
                      <th>Focus</th>
                      <th>Key Points</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>1. Mindset Shift - Home to Public</td>
                      <td>20 min</td>
                      <td>Mindset</td>
                      <td>Responsibility vs. rights, conflict avoidance</td>
                    </tr>
                    <tr>
                      <td>2. Concealment & Clothing</td>
                      <td>15 min</td>
                      <td>Practical</td>
                      <td>Printing awareness, clothing strategies</td>
                    </tr>
                    <tr>
                      <td>3. Idaho Concealed Carry Law</td>
                      <td>20 min</td>
                      <td>Legal</td>
                      <td>Standard vs. Enhanced CWL, prohibited locations</td>
                    </tr>
                    <tr>
                      <td>4. Law Enforcement Interaction</td>
                      <td>20 min</td>
                      <td>Protocols</td>
                      <td>Traffic stops, post-shooting interaction</td>
                    </tr>
                    <tr>
                      <td>5. Expanded Legal Scenarios</td>
                      <td>20 min</td>
                      <td>Legal</td>
                      <td>Defense of others, property, duty to retreat</td>
                    </tr>
                    <tr>
                      <td>6. Public Space Considerations</td>
                      <td>15 min</td>
                      <td>Practical</td>
                      <td>Prohibited locations, vehicle carry, awareness</td>
                    </tr>
                    <tr>
                      <td>7. Concealed Carry Dry Practice</td>
                      <td>10 min</td>
                      <td>Skills</td>
                      <td>Draw mechanics (dry fire only)</td>
                    </tr>
                    <tr>
                      <td>8. Debrief & Phase 4 Completion</td>
                      <td>10 min</td>
                      <td>Review</td>
                      <td>Progress assessment, Phase 5 preparation</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- SNAP SECTION 3: Notes + Close -->
    <div class="course-snap-section course-snap-3">
      <div class="snap-inner-container">
        <div class="class-grid">
          <div class="notes-card">
            <div class="subhead">Phase 4 Notes</div>
            <textarea placeholder="Instructor notes for Phase 4..."></textarea>
            <button class="save-notes-btn" data-phase="4" data-type="course">Save Notes</button>
            <div class="hint">Saved with the rest of the client's progress.</div>
          </div>
          
          <div class="course-modal-actions">
            <button class="btn-close">Close</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Phase 5 Modal -->
<div class="course-modal" id="course5-modal">
  <div class="course-modal-content">
    <!-- SNAP SECTION 1: Title + Details + Objectives -->
    <div class="course-snap-section course-snap-1">
      <div class="red-arrow-indicator">→</div>
      <div class="snap-inner-container">
        <div class="course-title-container">
          <div class="title-text">PHASE 5: QUALIFICATION</div>
          <div class="course-subtitle">Idaho CWL Concealed Carry Certification</div>
        </div>
        
        <div class="course-details-compact">
          <div class="course-detail-item">
            <div class="course-detail-label">Duration</div>
            <div class="course-detail-value">1.5 hours</div>
          </div>
          <div class="course-detail-item">
            <div class="course-detail-label">Ammunition</div>
            <div class="course-detail-value">30 rounds</div>
          </div>
          <div class="course-detail-item">
            <div class="course-detail-label">Fee</div>
            <div class="course-detail-value">$125</div>
          </div>
          <div class="course-detail-item">
            <div class="course-detail-label">Targets</div>
            <div class="course-detail-value">2-3 B-27 per Client</div>
          </div>
        </div>
        
        <div class="class-grid">
          <div class="card">
            <div class="subhead">Session Objectives</div>
            <ul class="checks">
              <li><input class="chk" type="checkbox" data-phase="5" data-type="objective"><span>Complete formal qualification shoot (timed, scored, documented)</span></li>
              <li><input class="chk" type="checkbox" data-phase="5" data-type="objective"><span>Pass legal knowledge oral examination</span></li>
              <li><input class="chk" type="checkbox" data-phase="5" data-type="objective"><span>Execute final integrated scenario</span></li>
              <li><input class="chk" type="checkbox" data-phase="5" data-type="objective"><span>Review complete training record (all 5 phases)</span></li>
              <li><input class="chk" type="checkbox" data-phase="5" data-type="objective"><span>Receive Idaho CWL Concealed Carry certification</span></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    
    <!-- SNAP SECTION 2: Qualification Structure -->
    <div class="course-snap-section course-snap-2">
      <div class="red-arrow-indicator">→</div>
      <div class="snap-inner-container">
        <div class="class-grid">
          <div class="card">
            <div class="subhead">Qualification Structure</div>
            <div class="lesson-flow-table">
              <div class="table-container">
                <table>
                  <thead>
                    <tr>
                      <th>Stage</th>
                      <th>Rounds</th>
                      <th>Focus</th>
                      <th>Passing Score</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>Stage 1: Accuracy</td>
                      <td>15</td>
                      <td>Fundamental marksmanship</td>
                      <td>70%</td>
                    </tr>
                    <tr>
                      <td>Stage 2: Skills Integration</td>
                      <td>10</td>
                      <td>Multiple targets, reloads</td>
                      <td>70%</td>
                    </tr>
                    <tr>
                      <td>Stage 3: Final Scenario</td>
                      <td>5</td>
                      <td>Home defense integration</td>
                      <td>70%</td>
                    </tr>
                    <tr>
                      <td>Legal Knowledge Assessment</td>
                      <td>N/A</td>
                      <td>10-question oral exam</td>
                      <td>70%</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- SNAP SECTION 3: Notes + Close -->
    <div class="course-snap-section course-snap-3">
      <div class="snap-inner-container">
        <div class="class-grid">
          <div class="notes-card">
            <div class="subhead">Phase 5 Notes & Certification</div>
            <textarea placeholder="Certification notes, client performance, recommendations..."></textarea>
            <button class="save-notes-btn" data-phase="5" data-type="course">Save Notes</button>
            <div class="hint">Saved with the rest of the client's progress and certification records.</div>
          </div>
          
          <div class="course-modal-actions">
            <button class="btn-close">Close</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

  <!-- Drills Modals -->
  <div class="drills-modal" id="course1-drills-modal">
    <div class="drills-modal-content">
      <div class="title-text">PHASE 1: Principles DRILLS</div>
      <div class="subtitle">Building Your Defensive Platform</div>
      
      <div class="drills-grid">
        <!-- Drill cards will be populated by JavaScript -->
      </div>
      
      <!-- Extended Drills Button -->
      <div class="drills-buttons-container">
  <button class="btn-extended-drills" id="extended-drills-btn-1">Extended Drills</button>
  <button class="btn-close close-drills-bottom">Close</button>
</div>
    </div>
  </div>
</div>


  <div class="drills-modal" id="course2-drills-modal">
    <div class="drills-modal-content">
      <div class="title-text">PHASE 2: INTEGRATION DRILLS</div>
      <div class="subtitle">Skills Under Pressure</div>
      
      <div class="drills-grid">
        <!-- Drill cards will be populated by JavaScript -->
      </div>
      
      <!-- Extended Drills Button -->
       <div class="drills-buttons-container">
  <button class="btn-extended-drills" id="extended-drills-btn-2">Extended Drills</button>
  <button class="btn-close close-drills-bottom">Close</button>
</div>
    </div>
  </div>
</div>



  <div class="drills-modal" id="course3-drills-modal">
    <div class="drills-modal-content">
      <div class="title-text">PHASE 3: MASTERY DRILLS</div>
      <div class="subtitle">Complete Defensive Integration</div>
      
      <div class="drills-grid">
        <!-- Drill cards will be populated by JavaScript -->
      </div>
      
      <!-- Extended Drills Button -->
      <div class="drills-buttons-container">
  <button class="btn-extended-drills" id="extended-drills-btn-3">Extended Drills</button>
  <button class="btn-close close-drills-bottom">Close</button>
</div>
    </div>
  </div>
</div>



  <div class="drills-modal" id="course4-drills-modal">
    <div class="drills-modal-content">
      <div class="title-text">PHASE 4: CONCEALED CARRY DRILLS</div>
      <div class="subtitle">Armed Citizenship & Public Responsibility</div>
      
      <div class="drills-grid">
        <!-- Drill cards will be populated by JavaScript -->
      </div>
      
      <!-- Extended Drills Button -->
       <div class="drills-buttons-container">
  <button class="btn-extended-drills" id="extended-drills-btn-4">Extended Drills</button>
  <button class="btn-close close-drills-bottom">Close</button>
</div>
    </div>
  </div>
</div>



  <div class="drills-modal" id="course5-drills-modal">
    <div class="drills-modal-content">
      <div class="title-text">PHASE 5: QUALIFICATION DRILLS</div>
      <div class="subtitle">Idaho CWL Concealed Carry Certification</div>
      
      <div class="drills-grid">
        <!-- Drill cards will be populated by JavaScript -->
      </div>
      
      <!-- Extended Drills Button -->
       <div class="drills-buttons-container">
  <button class="btn-extended-drills" id="extended-drills-btn-5">Extended Drills</button>
  <button class="btn-close close-drills-bottom">Close</button>
</div>
    </div>
  </div>
</div>


  <!-- Stage Drill Modal -->
  <div class="stage-drill-modal" id="stage-drill-modal">
    <div class="stage-drill-modal-content">
      <div class="title-text" id="stage-drill-title">Drill Title</div>
      <div class="subtitle" id="stage-drill-subtitle">Drill Focus</div>
      
      <div class="stage-drill-steps" id="stage-drill-steps">
        <!-- Drill steps will be populated by JavaScript -->
      </div>
      
      <div class="stage-drill-actions">
        <button class="btn-close">Close</button>
        <button class="btn-assess" id="open-assessment">Assess</button>
      </div>
    </div>
  </div>

  <!-- Skills Assessment Modal -->
  <div class="skills-assessment-modal" id="skills-assessment-modal">
    <div class="skills-assessment-modal-content">
      <div class="title-text">SKILLS ASSESSMENT</div>
      <div class="subtitle">Rate Performance for Each Skill</div>
      
      <div class="skills-list" id="skills-assessment-list">
        <!-- Skills will be populated by JavaScript -->
      </div>
      
      <div class="skills-assessment-actions">
        <button class="btn-close">Close</button>
        <button class="btn-save-assessment" id="save-assessment">Save Assessment</button>
      </div>
    </div>
  </div>

 <!-- ===== DYNAMIC ANALYSIS MODAL ===== -->
<div class="dynamic-analysis-modal" id="dynamic-analysis-modal">
  <div class="dynamic-analysis-modal-content">
    <div class="title-text">DYNAMIC ANALYSIS</div>
    <div class="subtitle" id="dynamic-analysis-subtitle">PHASE 1: PRINCIPLES</div>
    
    <div class="dynamic-analysis-grid" id="dynamic-analysis-grid">
      <!-- Cards will be populated by JavaScript based on phase -->
    </div>
    
    <!-- PHASE NAVIGATION SECTION REMOVED -->
    
    <div class="dynamic-analysis-actions">
      <!-- NEW LEFT ARROW BUTTON -->
      <button class="nav-arrow-btn" id="scroll-left-btn" aria-label="Scroll cards left">
        <span class="nav-arrow">◄</span>
      </button>
      
      <!-- EXISTING CLOSE BUTTON -->
      <button class="btn-close">Close Analysis</button>
      
      <!-- NEW RIGHT ARROW BUTTON -->
      <button class="nav-arrow-btn" id="scroll-right-btn" aria-label="Scroll cards right">
        <span class="nav-arrow">►</span>
      </button>
    </div>
  </div>
</div>


  <!-- Legal Modals -->
  <div class="legal-modal" id="legal1-modal">
    <div class="legal-modal-content">
      <div class="legal-modal-title">PHASE 1: FOUNDATIONAL LEGAL PRINCIPLES</div>
      <div class="legal-modal-subtitle">Idaho Self-Defense Law</div>
      
      <div class="legal-content-section">
        <div class="subhead">Idaho Self-Defense Law Foundation</div>
        <p>This section lays the groundwork for understanding the legal aspects of self-defense in Idaho, focusing on core principles and initial decision-making.</p>
        
        <div class="subhead">Castle Doctrine (Idaho Code §18-4009)</div>
        <ul>
          <li><strong>No Duty to Retreat:</strong> In Idaho, you have no legal duty to retreat if you are in your home, vehicle, or place of work when confronted with a threat.</li>
          <li><strong>Presumption of Reasonable Fear:</strong> The law presumes you have a reasonable fear of death or great bodily harm if someone unlawfully enters your home, vehicle, or workplace.</li>
          <li><strong>Articulation of Threat:</strong> Despite the presumption, you must still be able to clearly articulate the specific threat you faced and why you believed it was necessary to use force.</li>
        </ul>
        
        <div class="subhead">Use of Force Standards</div>
        <p>The core principle is that any force used must be REASONABLE given the totality of the circumstances at the time of the incident.</p>
        <p><strong>Four Key Questions to Determine Justification:</strong></p>
        <ul>
          <li>Was there an imminent threat of death or great bodily harm?</li>
          <li>Would a reasonable person believe this?</li>
          <li>Were there reasonable alternatives?</li>
          <li>Was it immediately necessary?</li>
        </ul>
        
        <div class="subhead">Post-Incident Basics</div>
        <div class="legal-table-container">
          <table class="legal-table">
            <thead>
              <tr>
                <th>Action</th>
                <th>Detail</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Call 911 Immediately</td>
                <td>Be the first to report the incident.</td>
              </tr>
              <tr>
                <td>Declare Self-Defense</td>
                <td>State clearly: "I was attacked and defended myself."</td>
              </tr>
              <tr>
                <td>Request Medical</td>
                <td>Ask for an ambulance for anyone injured.</td>
              </tr>
              <tr>
                <td>Point Out Evidence</td>
                <td>Identify relevant evidence and any witnesses to authorities.</td>
              </tr>
              <tr>
                <td>Request Attorney</td>
                <td>State: "I will cooperate fully after consulting with my attorney."</td>
              </tr>
            </tbody>
          </table>
        </div>
       <!-- ADD THIS CLOSE BUTTON AT THE BOTTOM -->
    <div class="legal-modal-actions">
      <button class="btn-close close-legal-bottom">Close</button>
    </div>
  </div>
</div>
   
        </div>
      </div>
    </div>
  </div>

  <div class="legal-modal" id="legal2-modal">
    <div class="legal-modal-content">
      <div class="legal-modal-title">PHASE 2: POST-INCIDENT LEGAL PROTOCOL</div>
      <div class="legal-modal-subtitle">Immediate Actions & Law Enforcement Interaction</div>
      
      <div class="legal-content-section">
        <div class="subhead">Post-Incident Legal Protocol</div>
        <p>Effective management of the scene and your communication in the aftermath of a defensive shooting are paramount for your legal defense.</p>
        
        <div class="subhead">Immediate Actions After Defensive Shooting</div>
        <ul>
          <li><strong>Assess Ongoing Threat:</strong> Immediately determine if the initial threat is stopped. Look for additional threats.</li>
          <li><strong>Move to Safety/Cover:</strong> If possible and safe, reposition yourself to a place of tactical advantage.</li>
          <li><strong>Call 911 Immediately:</strong> It is imperative that you are the one who calls emergency services first.</li>
        </ul>
        
        <div class="subhead">What to Say to 911</div>
        <div class="legal-table-container">
          <table class="legal-table">
            <thead>
              <tr>
                <th>DO SAY (Concise & Factual)</th>
                <th>DO NOT SAY (Avoid Details & Speculation)</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>"I was attacked and defended myself."</td>
                <td>A detailed play-by-play of the incident.</td>
              </tr>
              <tr>
                <td>"Send police and ambulance to [specific location/address]."</td>
                <td>Declarations like "I had to kill him."</td>
              </tr>
              <tr>
                <td>"The suspect is [brief description/current condition]."</td>
                <td>Jokes or casual comments about the situation.</td>
              </tr>
              <tr>
                <td>"I will cooperate fully after speaking with my attorney."</td>
                <td>Anything inconsistent or uncertain.</td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <div class="subhead">What to Say to Police (Upon Arrival)</div>
        <div class="legal-table-container">
          <table class="legal-table">
            <thead>
              <tr>
                <th>DO (Comply & Control Information)</th>
                <th>DO NOT (Resist or Give Unadvised Statements)</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Follow all commands immediately and without argument.</td>
                <td>Give a detailed statement without your attorney present.</td>
              </tr>
              <tr>
                <td>Keep your hands visible at all times.</td>
                <td>Sign any documents or waivers without legal counsel.</td>
              </tr>
              <tr>
                <td>State clearly: "I want to cooperate fully, but I need to speak with my attorney first."</td>
                <td>Answer "Why did you shoot?" or similar investigative questions.</td>
              </tr>
              <tr>
                <td>Point out evidence and witnesses to the officers.</td>
                <td>Let them search your person or property without a warrant.</td>
              </tr>
            </tbody>
          </table>
        </div>
       <div class="legal-modal-actions">
            <button class="btn-close close-legal-bottom">Close</button>
        </div>
    </div>
</div>
        </div>
      </div>
    </div>
  </div>

  <div class="legal-modal" id="legal3-modal">
    <div class="legal-modal-content">
      <div class="legal-modal-title">PHASE 3: LEGAL LIABILITY & PROTECTION</div>
      <div class="legal-modal-subtitle">Criminal vs. Civil Liability & Self-Protection</div>
      
      <div class="legal-content-section">
        <div class="subhead">Criminal vs. Civil Liability</div>
        <p>Understanding the dual nature of legal consequences—criminal prosecution and civil lawsuits—is vital, as winning one does not guarantee winning the other.</p>
        
        <div class="subhead">Criminal Prosecution</div>
        <ul>
          <li><strong>Parties Involved:</strong> The State (e.g., District Attorney, Prosecutor) brings charges against you.</li>
          <li><strong>Burden of Proof:</strong> The State must prove your guilt "beyond a reasonable doubt."</li>
          <li><strong>Potential Outcomes:</strong> If convicted, this can result in severe penalties including prison time, substantial fines, and permanent loss of certain civil rights.</li>
        </ul>
        
        <div class="subhead">Civil Lawsuit</div>
        <ul>
          <li><strong>Parties Involved:</strong> The family of the deceased or injured individual can sue you directly.</li>
          <li><strong>Burden of Proof:</strong> The standard of proof is much lower: "preponderance of evidence" (51%).</li>
          <li><strong>Potential Outcomes:</strong> You can be found criminally justified but still lose a civil lawsuit, facing significant financial damages.</li>
          <li><strong>Asset Risk:</strong> Your personal assets, including savings, property, and future earnings, are at significant risk.</li>
        </ul>
        
        <div class="subhead">How to Protect Yourself</div>
        <ul>
          <li><strong>Training Documentation:</strong> Maintain meticulous records of all firearms training to demonstrate responsibility.</li>
          <li><strong>CCW Insurance/Legal Defense Plans:</strong> Specialized plans offer crucial protection by providing pre-paid legal representation.</li>
          <li><strong>Good Shoot Articulation:</strong> Be prepared to articulate precisely why you feared for your life.</li>
          <li><strong>Character Witnesses:</strong> Your reputation matters in court; have individuals who can testify to your responsible character.</li>
        </ul>
      </div>
       <div class="legal-modal-actions">
            <button class="btn-close close-legal-bottom">Close</button>
        </div>
    </div>
</div>
  
        </div>
      </div>
    </div>
  </div>

  <div class="legal-modal" id="legal4-modal">
    <div class="legal-modal-content">
      <div class="legal-modal-title">PHASE 4: STANDARD CONCEALED CARRY READINESS</div>
      <div class="legal-modal-subtitle">Idaho Standard CWL Laws & Public Responsibility</div>
      
      <div class="legal-content-section">
        <div class="subhead">Idaho Standard Concealed Carry Law</div>
        <p>This section explores the crucial mindset shift required for concealed carry and the specifics of the Standard Idaho CWL.</p>
        
        <div class="subhead">Mindset Shift - Home to Public</div>
        <ul>
          <li><strong>Responsibility vs. Rights:</strong> Carrying a firearm in public demands a significant shift in mindset from home defense.</li>
          <li><strong>Why Get a Standard Idaho CWL?:</strong> Demonstrates commitment to responsible gun ownership and provides legal framework.</li>
          <li><strong>The Gray Man Concept:</strong> Blend in and avoid drawing attention; concealed means CONCEALED.</li>
          <li><strong>Conflict Avoidance Hierarchy:</strong> AVOID → EVADE → VERBALLY DE-ESCALATE → PHYSICAL DEFENSE → DEADLY FORCE</li>
        </ul>
        
        <div class="subhead">Where You CANNOT Carry (with a Standard CWL)</div>
        <div class="legal-table-container">
          <table class="legal-table">
            <thead>
              <tr>
                <th>Location</th>
                <th>Specific Notes</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>K-12 Schools</td>
                <td>Prohibited inside school buildings and on school grounds.</td>
              </tr>
              <tr>
                <td>Federal Buildings</td>
                <td>Federal law prohibits firearms in most federal buildings.</td>
              </tr>
              <tr>
                <td>Secure Airport Areas</td>
                <td>Beyond TSA checkpoints in airports.</td>
              </tr>
              <tr>
                <td>Courthouses</td>
                <td>Generally prohibited.</td>
              </tr>
              <tr>
                <td>Private Property</td>
                <td>Property owners retain the right to prohibit firearms.</td>
              </tr>
              <tr>
                <td>City/County Government Buildings</td>
                <td>Generally prohibited for Standard CWL holders.</td>
              </tr>
              <tr>
                <td>Public Parks and Recreation Areas</td>
                <td>Generally prohibited for Standard CWL holders.</td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <div class="subhead">Law Enforcement Interaction</div>
        <p><strong>Traffic Stop Protocol:</strong></p>
        <ul>
          <li>Pull over safely and turn off your engine.</li>
          <li>Place both hands on the steering wheel where visible.</li>
          <li>FIRST words to officer: "Officer, I have a concealed carry permit and I'm currently armed. The firearm is [specific location]. How would you like me to proceed?"</li>
          <li>Narrate all movements and follow officer's instructions exactly.</li>
        </ul>
      </div>
       <div class="legal-modal-actions">
            <button class="btn-close close-legal-bottom">Close</button>
        </div>
    </div>
</div>
    
        </div>
      </div>
    </div>
  </div>

  <div class="legal-modal" id="legal5-modal">
    <div class="legal-modal-content">
      <div class="legal-modal-title">PHASE 5: STANDARD CWL QUALIFICATION & CERTIFICATION</div>
      <div class="legal-modal-subtitle">Idaho CWL Legal Knowledge Assessment & Certification</div>
      
      <div class="legal-content-section">
        <div class="subhead">Legal Knowledge Assessment (Oral Examination Examples)</div>
        <p>The oral examination assesses your understanding of Idaho's self-defense and concealed carry laws.</p>
        
        <div class="subhead">Sample Questions & Required Answers</div>
        <ul>
          <li><strong>Q1: "Explain Idaho's Castle Doctrine. Where does it apply and what does it allow?"</strong><br>
          Required Answer: The Castle Doctrine (Idaho Code §18-4009) states that you have no duty to retreat if you are in your home, vehicle, or workplace when confronted with a threat. It also establishes a presumption of reasonable fear of death or great bodily harm if someone unlawfully enters these locations.</li>
          
          <li><strong>Q2: "What four elements must be present to legally justify use of deadly force?"</strong><br>
          Required Answer: 1) Imminent threat of death or great bodily harm, 2) A reasonable person would believe this threat existed, 3) No reasonable alternatives available, 4) Use of force was immediately necessary.</li>
          
          <li><strong>Q3: "You've just been involved in a defensive shooting. Police arrive. What should you say and what should you NOT say?"</strong><br>
          Required "Should Say": "I was attacked and defended myself," "Send an ambulance," "I will cooperate fully after speaking with my attorney."<br>
          Required "Should NOT Say": Detailed play-by-play, "I had to kill him," anything inconsistent.</li>
        </ul>
        
        <div class="subhead">Idaho Standard CWL Permit Certification</div>
        <p><strong>Training Certification:</strong> Upon successful completion of Phase 5, you will receive an official certification stating that your training meets and exceeds Idaho CWL requirements.</p>
        
        <div class="subhead">Permit Application Process</div>
        <ul>
          <li>Gather Required Documents: Training certificate, photo ID, proof of residency, fee.</li>
          <li>Visit County Sheriff's Office: Complete application, fingerprinting, and photo.</li>
          <li>Submit and Wait: Background check process (typically 30-45 days).</li>
          <li>Receive License: Valid for 5 years.</li>
        </ul>
        
        <div class="subhead">Disqualifying Factors for Idaho CWL</div>
        <ul>
          <li>Felony conviction</li>
          <li>Domestic violence conviction</li>
          <li>Active protective order</li>
          <li>Illegal alien status</li>
          <li>Fugitive from justice</li>
          <li>Unlawful drug user</li>
          <li>Adjudicated mental defective</li>
          <li>Dishonorably discharged from military</li>
        </ul>
      </div>
       <div class="legal-modal-actions">
            <button class="btn-close close-legal-bottom">Close</button>
        </div>
    </div>
</div>
 
        </div>
      </div>
    </div>
  </div>

 

<!-- Bottom Navigation -->
<div class="bottom-nav">
  <!-- COURSES - Replace with your courses vector -->
  <div class="nav-item" data-section="courses">
    <img src="images/courses-icon.svg" alt="Courses" width="28" height="28">
    <span>Courses</span>
  </div>

  <!-- DRILLS - Replace with your drills vector -->
  <div class="nav-item" data-section="drills">
    <svg width="28" height="28" viewBox="0 0 24 24">
      <!-- YOUR DRILLS ICON VECTOR -->
      <path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z" 
            stroke="#f0eade" stroke-width="2"/>
      <path d="M12 6v6l4 2" 
            stroke="#f0eade" stroke-width="2" stroke-linecap="round"/>
    </svg>
    <span>Drills</span>
  </div>

  <!-- HOME - Larger center icon -->
  <div class="nav-item center active" data-section="home">
    <svg width="46" height="46" viewBox="0 0 24 24">
      <!-- YOUR HOME ICON VECTOR -->
      <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" 
            fill="none" stroke="#f0eade" stroke-width="2"/>
      <path d="M9 22V12h6v10" 
            fill="none" stroke="#f0eade" stroke-width="2"/>
    </svg>
    <span>Home</span>
  </div>

  <!-- RECOMMENDATIONS - Replace with your recommendations vector -->
  <div class="nav-item" data-section="recommendations">
    <svg width="28" height="28" viewBox="0 0 24 24">
      <!-- YOUR RECOMMENDATIONS ICON VECTOR -->
      <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" 
            fill="none" stroke="#f0eade" stroke-width="2" stroke-linecap="round"/>
      <path d="M22 4L12 14.01l-3-3" 
            fill="none" stroke="#f0eade" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
    <span>Recommendations</span>
  </div>

  <!-- NOTES - Replace with your notes vector -->
  <div class="nav-item" data-section="notes">
    <svg width="28" height="28" viewBox="0 0 24 24">
      <!-- YOUR NOTES ICON VECTOR -->
      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" 
            fill="none" stroke="#f0eade" stroke-width="2"/>
      <path d="M14 2v6h6M16 13H8M16 17H8M10 9H8" 
            fill="none" stroke="#f0eade" stroke-width="2" stroke-linecap="round"/>
    </svg>
    <span>Notes</span>
  </div>
</div>

  <!-- Home Section -->
  <div class="app-section active" id="home-section">
    <!-- Title -->
    <div class="title-panel">
      <div class="title-inner">
        <div class="logo"><img src="data:image/png;base64,==" alt="Witness Defense Logo"></div>
        <div class="title-text"><span class="decor">W</span>ITNESS | <span class="decor">D</span>EFENSE</div>
        <div class="subtitle" id="client-welcome-subtitle">CLIENT ONBOARDING & TRAINING PORTAL</div>
        <hr class="divider">
        <div class="sub-subtitle">Complete your onboarding, waivers, and training documentation in one secure portal</div>
      </div>
    </div>

    <!-- Progress Bar -->
    <div class="progress-container">
      <div class="progress-bar" id="progressBar"></div>
    </div>

    <!-- ===== WAIVERS CARD SECTION ===== -->
    <div class="waivers-card" id="waivers-card">
      <div class="waivers-card-header">
        <div class="waivers-card-title">WAIVERS & CLIENT INTAKE</div>
        <div class="waivers-card-subtitle">Complete your onboarding forms to begin training</div>
      </div>
      <div class="waivers-card-content">
        <p>Tap to open and complete all required waivers and intake forms</p>
      </div>
      <div class="waivers-card-progress">
        <div class="waivers-progress-wheel-container">
          <div class="waivers-progress-wheel" id="waivers-progress-wheel" style="--progress: 0deg">
            <div class="waivers-progress-percentage">0%</div>
          </div>
        </div>
        <span>Completion Progress</span>
      </div>
      <div class="waivers-card-footer">
        <button class="waivers-card-btn" id="open-waivers-btn">Open Waivers</button>
      </div>
    </div>

    <!-- ===== WAIVERS SECTION (HIDDEN BY DEFAULT) ===== -->
    <div id="waivers-section" style="display: none;">
      <button class="waivers-close-btn" id="close-waivers-top">×</button>
      
      <div class="banner">WAIVERS & CLIENT INTAKE</div>
      <div class="track-body" style="display: block;">
        <div id="waivers-intake-panel" class="panel">
          <div class="panel-header open">Onboarding Forms & Information</div>
          <div class="panel-body">
            <div class="intake-grid">
              <!-- Progress Card -->
              <div class="card progress-card">
                <div class="progress-title">ONBOARDING PROGRESS</div>
                <div class="progress-wheel-container">
                  <div class="progress-wheel" id="onboarding-progress-wheel" style="--progress: 0deg">
                    <div class="progress-percentage">0%</div>
                  </div>
                </div>
                <p class="progress-text">Complete all required waivers and intake forms to begin training.</p>
                <p class="progress-note">Progress updates automatically as you complete forms</p>
              </div>

              <!-- WAIVER 1: LIABILITY WAIVER -->
              <div class="card waiver-section">
                <div class="subhead">1. WAIVER OF LIABILITY & ASSUMPTION OF RISK</div>
                <div class="waiver-content">
                  <p><strong>WAIVER OF LIABILITY, ASSUMPTION OF RISK, AND INDEMNIFICATION AGREEMENT</strong></p>
                  <p>I, the undersigned, in consideration for being permitted to participate in firearms training provided by Witness|Defense, hereby agree as follows:</p>
                  
                  <p><strong>1. ACKNOWLEDGMENT OF RISKS:</strong> I understand and acknowledge that firearms training involves inherent risks, dangers, and hazards including, but not limited to:</p>
                  <ul>
                    <li>Risk of serious bodily injury, permanent disability, paralysis, or death</li>
                    <li>Risk of hearing damage from loud noises</li>
                    <li>Risk of eye injury from ejected casings or debris</li>
                    <li>Risk of lead exposure from ammunition</li>
                    <li>Risk of burns from hot firearms or ejected casings</li>
                    <li>Risk of injury from malfunctioning equipment</li>
                    <li>Risk of injury from other participants</li>
                  </ul>
                  
                  <p><strong>2. ASSUMPTION OF RISK:</strong> I voluntarily assume all risks, known and unknown, of injuries, however caused, even if caused in whole or in part by the action, inaction, or negligence of the Released Parties.</p>
                  
                  <p><strong>3. WAIVER OF LIABILITY:</strong> I hereby release, waive, discharge, and covenant not to sue Witness|Defense, its owners, employees, instructors, agents, and affiliates (the "Released Parties") from any and all liability, claims, demands, actions, and causes of action whatsoever arising out of or related to any loss, damage, or injury, including death, that may be sustained by me, or to any property belonging to me, whether caused by the negligence of the Released Parties or otherwise, while participating in firearms training.</p>
                  
                  <p><strong>4. INDEMNIFICATION:</strong> I agree to indemnify, defend, and hold harmless the Released Parties from any and all claims, actions, suits, procedures, costs, expenses, damages, and liabilities, including attorney's fees, brought as a result of my involvement in firearms training.</p>
                  
                  <p><strong>5. MEDICAL TREATMENT:</strong> I authorize and consent to emergency medical treatment in the event of injury or illness.</p>
                  
                  <p><strong>6. GOVERNING LAW:</strong> This Agreement shall be governed by the laws of the State of Idaho.</p>
                  
                  <p>I HAVE READ THIS WAIVER OF LIABILITY, FULLY UNDERSTAND ITS TERMS, AND SIGN IT FREELY AND VOLUNTARILY WITHOUT ANY INDUCEMENT.</p>
                </div>
                <div class="waiver-checkbox">
                  <input type="checkbox" id="liability-consent" class="chk">
                  <label for="liability-consent">I HAVE READ, UNDERSTAND, AND VOLUNTARILY AGREE TO ALL TERMS OF THIS LIABILITY WAIVER</label>
                </div>
                <div class="form-group">
                  <label class="form-group">Signature <input type="text" class="form-control" id="liability-signature"></label>
                </div>
                <div class="form-group">
                  <label class="form-group">Date <input type="text" class="form-control" id="liability-date"></label>
                </div>
              </div>

              <!-- WAIVER 2: RANGE SAFETY AGREEMENT -->
              <div class="card waiver-section">
                <div class="subhead">2. RANGE SAFETY AGREEMENT</div>
                <div class="waiver-content">
                  <p>I agree to abide by all range safety rules and instructor commands at all times during training. I understand that:</p>
                  <ul>
                    <li>Treat every firearm as if it is loaded.</li>
                    <li>Never point a firearm at anything you are not willing to destroy.</li>
                    <li>Keep your finger off the trigger and on the frame until you have made the decision to shoot.</li>
                    <li>Be sure of your target and what is beyond it.</li>
                    <li>Follow all instructor commands immediately and without question.</li>
                    <li>Unsafe behavior may result in immediate dismissal without refund.</li>
                  </ul>
                </div>
                <div class="waiver-checkbox">
                  <input type="checkbox" id="safety-consent" class="chk">
                  <label for="safety-consent">I AGREE TO ABIDE BY ALL RANGE SAFETY RULES AND INSTRUCTOR COMMANDS</label>
                </div>
                <div class="form-group">
                  <label class="form-group">Initials <input type="text" class="form-control initials-box" id="safety-initials"></label>
                </div>
              </div>

              <!-- WAIVER 3: MEDICAL RELEASE -->
              <div class="card waiver-section">
                <div class="subhead">3. MEDICAL RELEASE / EMERGENCY CARE AUTHORIZATION</div>
                <div class="waiver-content">
                  <p>In the event of a medical emergency, I authorize Witness|Defense staff to render basic first aid and/or arrange emergency medical transport. I assume responsibility for any medical expenses incurred.</p>
                </div>
                <div class="waiver-checkbox">
                  <input type="checkbox" id="medical-consent" class="chk">
                  <label for="medical-consent">I AUTHORIZE EMERGENCY MEDICAL CARE AND ASSUME RESPONSIBILITY FOR EXPENSES</label>
                </div>
                <div class="form-group">
                  <label class="form-group">Initials <input type="text" class="form-control initials-box" id="medical-initials"></label>
                </div>
              </div>

              <!-- WAIVER 4: MEDIA RELEASE - MODIFIED WITH OPTIONAL "DO NOT CONSENT" CHECKBOX -->
              <div class="card waiver-section">
                <div class="subhead">4. MEDIA RELEASE</div>
                <div class="waiver-content">
                  <p>I grant Witness|Defense permission to record photo and/or video during training sessions. These materials may be used for marketing, educational, or internal purposes.</p>
                </div>
                <div class="waiver-checkbox">
                  <input type="checkbox" id="media-consent" class="chk">
                  <label for="media-consent">I CONSENT TO PHOTO/VIDEO USE FOR MARKETING AND EDUCATIONAL PURPOSES</label>
                </div>
                <div class="waiver-checkbox">
                  <input type="checkbox" id="media-no-consent" class="chk">
                  <label for="media-no-consent">I DO NOT CONSENT TO PHOTO/VIDEO USE</label>
                </div>
                <div class="form-group">
                  <label class="form-group">Initials <input type="text" class="form-control initials-box" id="media-initials"></label>
                </div>
              </div>

              <!-- PERSONAL INFORMATION -->
              <div class="card">
                <div class="subhead">5. PERSONAL INFORMATION</div>
                <div class="form-group">
                  <label class="form-group">Full Name <input type="text" class="form-control" id="client-full-name"></label>
                </div>
                <div class="form-columns">
                  <div>
                    <div class="form-group">
                      <label class="form-group">Date of Birth <input type="text" class="form-control" id="client-dob"></label>
                    </div>
                    <div class="form-group">
                      <label class="form-group">Address <input type="text" class="form-control" id="client-address"></label>
                    </div>
                    <div class="form-group">
                      <label class="form-group">City <input type="text" class="form-control" id="client-city"></label>
                    </div>
                    <div class="form-group">
                      <label class="form-group">Phone <input type="text" class="form-control" id="client-phone"></label>
                    </div>
                  </div>
                  <div>
                    <div class="form-group">
                      <label class="form-group">Email <input type="text" class="form-control" id="client-email"></label>
                    </div>
                    <div class="form-group">
                      <label class="form-group">Emergency Contact Name <input type="text" class="form-control" id="emergency-name"></label>
                    </div>
                    <div class="form-group">
                      <label class="form-group">Relationship <input type="text" class="form-control" id="emergency-relationship"></label>
                    </div>
                    <div class="form-group">
                      <label class="form-group">Emergency Phone <input type="text" class="form-control" id="emergency-phone"></label>
                    </div>
                  </div>
                </div>
              </div>

              <!-- ELIGIBILITY VERIFICATION -->
              <div class="card">
                <div class="subhead">6. ELIGIBILITY VERIFICATION</div>
                <p>By signing below, I affirm under penalty of perjury that I am legally eligible to own, handle, and train with firearms under federal and state law. I am not prohibited from firearm possession due to felony convictions, domestic violence convictions, restraining orders, or other disqualifying factors.</p>
                <div class="form-group">
                  <label class="form-group">Signature <input type="text" class="form-control" id="eligibility-signature"></label>
                </div>
                <div class="form-group">
                  <label class="form-group">Date <input type="text" class="form-control" id="eligibility-date"></label>
                </div>
                <div class="form-group">
                  <label class="form-group">Initials <input type="text" class="form-control initials-box" id="eligibility-initials"></label>
                </div>
              </div>

              <!-- FIREARMS EXPERIENCE -->
              <div class="card">
                <div class="subhead">7. FIREARMS EXPERIENCE & TRAINING GOALS</div>
                <div class="form-group">
                  <label class="form-group">Years of Firearms Experience <input type="text" class="form-control" id="experience-years"></label>
                </div>
                <div class="form-group">
                  <label class="form-group">Previous Training (if any) <input type="text" class="form-control" id="previous-training"></label>
                </div>
                <div class="form-group">
                  <label class="form-group">Primary Firearm for Training <input type="text" class="form-control" id="primary-firearm"></label>
                </div>
                <div class="form-group">
                  <label class="form-group">Training Goals/Objectives <input type="text" class="form-control" id="training-goals"></label>
                </div>
              </div>

              <!-- MEDICAL INFORMATION -->
              <div class="card">
                <div class="subhead">8. MEDICAL INFORMATION (Optional)</div>
                <p>This information is collected for safety purposes only and will be kept confidential. If you have any health issues that may effect training, notify Wintess Defense prior to going out to the shooting range.</p>
                <div class="form-group">
                  <label class="form-group">Medical Conditions (if any) <input type="text" class="form-control" id="medical-conditions"></label>
                </div>
                <div class="form-group">
                  <label class="form-group">Allergies <input type="text" class="form-control" id="allergies"></label>
                </div>
                <div class="form-group">
                  <label class="form-group">Medications <input type="text" class="form-control" id="medications"></label>
                </div>
                <div class="form-group">
                  <label class="form-group">Other Health Considerations <input type="text" class="form-control" id="other-health"></label>
                </div>
              </div>

              <!-- SKILL ASSESSMENT SECTION -->
              <div class="card">
                <div class="subhead">9. SKILL ASSESSMENT</div>
                <p>Please rate your current proficiency with the following skills. This helps us understand your strengths and areas for improvement.</p>
                
                <div class="skill-rating-container">
                  <div class="skill-item">
                    <div class="skill-name">Firearm Safety Knowledge</div>
                    <div class="rating-scale">
                      <div class="rating-option" data-skill="safety" data-value="1">1</div>
                      <div class="rating-option" data-skill="safety" data-value="2">2</div>
                      <div class="rating-option" data-skill="safety" data-value="3">3</div>
                      <div class="rating-option" data-skill="safety" data-value="4">4</div>
                      <div class="rating-option" data-skill="safety" data-value="5">5</div>
                    </div>
                  </div>
                  
                  <div class="skill-item">
                    <div class="skill-name">Basic Marksmanship</div>
                    <div class="rating-scale">
                      <div class="rating-option" data-skill="marksmanship" data-value="1">1</div>
                      <div class="rating-option" data-skill="marksmanship" data-value="2">2</div>
                      <div class="rating-option" data-skill="marksmanship" data-value="3">3</div>
                      <div class="rating-option" data-skill="marksmanship" data-value="4">4</div>
                      <div class="rating-option" data-skill="marksmanship" data-value="5">5</div>
                    </div>
                  </div>
                  
                  <div class="skill-item">
                    <div class="skill-name">Weapon Manipulation (Loading/Unloading)</div>
                    <div class="rating-scale">
                      <div class="rating-option" data-skill="manipulation" data-value="1">1</div>
                      <div class="rating-option" data-skill="manipulation" data-value="2">2</div>
                      <div class="rating-option" data-skill="manipulation" data-value="3">3</div>
                      <div class="rating-option" data-skill="manipulation" data-value="4">4</div>
                      <div class="rating-option" data-skill="manipulation" data-value="5">5</div>
                    </div>
                  </div>
                  
                  <div class="skill-item">
                    <div class="skill-name">Malfunction Clearing</div>
                    <div class="rating-scale">
                      <div class="rating-option" data-skill="malfunction" data-value="1">1</div>
                      <div class="rating-option" data-skill="malfunction" data-value="2">2</div>
                      <div class="rating-option" data-skill="malfunction" data-value="3">3</div>
                      <div class="rating-option" data-skill="malfunction" data-value="4">4</div>
                      <div class="rating-option" data-skill="malfunction" data-value="5">5</div>
                    </div>
                  </div>
                  
                  <div class="skill-item">
                    <div class="skill-name">Shooting Under Time Pressure</div>
                    <div class="rating-scale">
                      <div class="rating-option" data-skill="time-pressure" data-value="1">1</div>
                      <div class="rating-option" data-skill="time-pressure" data-value="2">2</div>
                      <div class="rating-option" data-skill="time-pressure" data-value="3">3</div>
                      <div class="rating-option" data-skill="time-pressure" data-value="4">4</div>
                      <div class="rating-option" data-skill="time-pressure" data-value="5">5</div>
                    </div>
                  </div>
                  
                  <div class="skill-item">
                    <div class="skill-name">One-Handed Shooting</div>
                    <div class="rating-scale">
                      <div class="rating-option" data-skill="one-handed" data-value="1">1</div>
                      <div class="rating-option" data-skill="one-handed" data-value="2">2</div>
                      <div class="rating-option" data-skill="one-handed" data-value="3">3</div>
                      <div class="rating-option" data-skill="one-handed" data-value="4">4</div>
                      <div class="rating-option" data-skill="one-handed" data-value="5">5</div>
                    </div>
                  </div>
                </div>
                
                <div class="form-group">
                  <label>Additional Skill Information:</label>
                  <textarea class="form-control" id="additional-skill-info" placeholder="Please provide any additional information about your skills, strengths, or areas where you'd like to improve..." rows="4"></textarea>
                </div>
              </div>

              <!-- TRAINING GOALS SECTION -->
              <div class="card">
                <div class="subhead">10. TRAINING GOALS</div>
                <p>What are your primary goals for firearms training? This helps us tailor the program to meet your specific needs.</p>
                
                <div class="training-goals-container">
                  <div class="check-all-container">
                    <input type="checkbox" id="check-all-goals" class="chk check-all-checkbox">
                    <label for="check-all-goals" class="check-all-label">CHECK ALL</label>
                  </div>
                  
                  <div class="goals-list">
                    <div class="goal-item">
                      <input type="checkbox" id="goal-home-defense" class="chk training-goal">
                      <label for="goal-home-defense" class="goal-label">Home Defense Preparedness</label>
                    </div>
                    
                    <div class="goal-item">
                      <input type="checkbox" id="goal-concealed-carry" class="chk training-goal">
                      <label for="goal-concealed-carry" class="goal-label">Concealed Carry Proficiency</label>
                    </div>
                    
                    <div class="goal-item">
                      <input type="checkbox" id="goal-marksmanship" class="chk training-goal">
                      <label for="goal-marksmanship" class="goal-label">Improved Marksmanship</label>
                    </div>
                    
                    <div class="goal-item">
                      <input type="checkbox" id="goal-competition" class="chk training-goal">
                      <label for="goal-competition" class="goal-label">Competition Shooting</label>
                    </div>
                    
                    <div class="goal-item">
                      <input type="checkbox" id="goal-hunting" class="chk training-goal">
                      <label for="goal-hunting" class="goal-label">Hunting Applications</label>
                    </div>
                    
                    <div class="goal-item">
                      <input type="checkbox" id="goal-recreational" class="chk training-goal">
                      <label for="goal-recreational" class="goal-label">Recreational Shooting</label>
                    </div>
                    
                    <div class="goal-item">
                      <input type="checkbox" id="goal-professional" class="chk training-goal">
                      <label for="goal-professional" class="goal-label">Professional Development</label>
                    </div>
                    
                    <div class="goal-item">
                      <input type="checkbox" id="goal-other" class="chk training-goal">
                      <label for="goal-other" class="goal-label">Other Goals (please specify below)</label>
                    </div>
                  </div>
                  
                  <div class="form-group">
                    <label>Goal Details:</label>
                    <textarea class="form-control" id="goal-details" placeholder="Please provide additional details about your training goals and what you hope to achieve..." rows="4"></textarea>
                  </div>
                  
                  <div class="form-columns">
                    <div class="form-group">
                      <label>Training Timeline</label>
                      <select id="training-timeline">
                        <option value="">Select Timeline</option>
                        <option value="immediately">Immediately</option>
                        <option value="1-month">Within 1 Month</option>
                        <option value="3-months">Within 3 Months</option>
                        <option value="6-months">Within 6 Months</option>
                        <option value="flexible">Flexible / No Specific Timeline</option>
                      </select>
                    </div>
                    
                    <div class="form-group">
                      <label>How often do you anticipate training?</label>
                      <select id="training-frequency">
                        <option value="">Select Frequency</option>
                        <option value="weekly">Weekly</option>
                        <option value="bi-weekly">Every 2 Weeks</option>
                        <option value="monthly">Monthly</option>
                        <option value="quarterly">Quarterly</option>
                        <option value="as-needed">As Needed / Occasional</option>
                      </select>
                    </div>
                  </div>
                  
                  <div class="form-group">
                    <label>Training Preferences</label>
                    <select id="training-setting">
                      <option value="">Select Setting</option>
                      <option value="indoor">Indoor Range</option>
                      <option value="outdoor">Outdoor Range</option>
                      <option value="private">Private Property</option>
                      <option value="no-preference">No Preference</option>
                    </select>
                  </div>
                  
                  <div class="form-group">
                    <label>Preferred Days:</label>
                    <div class="days-selection">
                      <div class="day-option">
                        <input type="checkbox" id="day-monday" class="chk">
                        <label for="day-monday" class="day-label">Monday</label>
                      </div>
                      <div class="day-option">
                        <input type="checkbox" id="day-tuesday" class="chk">
                        <label for="day-tuesday" class="day-label">Tuesday</label>
                      </div>
                      <div class="day-option">
                        <input type="checkbox" id="day-wednesday" class="chk">
                        <label for="day-wednesday" class="day-label">Wednesday</label>
                      </div>
                      <div class="day-option">
                        <input type="checkbox" id="day-thursday" class="chk">
                        <label for="day-thursday" class="day-label">Thursday</label>
                      </div>
                      <div class="day-option">
                        <input type="checkbox" id="day-friday" class="chk">
                        <label for="day-friday" class="day-label">Friday</label>
                      </div>
                      <div class="day-option">
                        <input type="checkbox" id="day-any" class="chk">
                        <label for="day-any" class="day-label">Any day</label>
                      </div>
                    </div>
                  </div>
                  
                  <div class="form-group">
                    <label>Preferred Time:</label>
                    <select id="training-time">
                      <option value="">Select Time</option>
                      <option value="morning">Morning (8am-12pm)</option>
                      <option value="afternoon">Afternoon (12pm-5pm)</option>

                      <option value="flexible">Flexible / Any Time</option>
                    </select>
                  </div>
                </div>
              </div>

              <!-- EMAIL WAIVERS & INTAKE BUTTON -->
              <div class="card">
                <div class="subhead">SUBMIT ALL ONBOARDING FORMS</div>
                <p>Once all waivers and intake information are completed, click below to email them directly to Witness Defense for processing.</p>
                <button class="email-btn" id="email-onboarding-btn">Email All Forms to Instructor</button>
                <p class="hint">Forms will be sent to: cricket.lord@witnessdefense.com</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <button class="waivers-close-btn" id="close-waivers-bottom">×</button>
    </div>

    <!-- ===== LEGAL CARDS SECTION ===== -->
    <div class="legal-cards-section">
      <div class="banner">CWL LEGAL INFORMATION</div>
      <div class="track-body" style="display: block;">
        <div class="legal-cards-container">
          <!-- Phase 1 Legal Card -->
          <div class="legal-card">
            <div class="legal-card-header">
              <div class="legal-card-title">PHASE 1: PRINCIPLES</div>
            </div>
            <div class="legal-card-body">
              <ul class="legal-card-features">
                <li>Castle Doctrine & No Duty to Retreat</li>
                <li>Use of Force Standards</li>
                <li>Shoot/Don't Shoot Decision Framework</li>
              </ul>
              <div class="legal-card-actions">
                <button class="btn-legal open-legal-modal" data-phase="1">CWL LEGAL</button>
              </div>
            </div>
          </div>

          <!-- Phase 2 Legal Card -->
          <div class="legal-card">
            <div class="legal-card-header">
              <div class="legal-card-title">PHASE 2: INTEGRATION</div>
            </div>
            <div class="legal-card-body">
              <ul class="legal-card-features">
                <li>Immediate Actions After Shooting</li>
                <li>911 Call Protocols</li>
                <li>Police Interaction Guidelines</li>
              </ul>
              <div class="legal-card-actions">
                <button class="btn-legal open-legal-modal" data-phase="2">CWL LEGAL</button>
              </div>
            </div>
          </div>

          <!-- Phase 3 Legal Card -->
          <div class="legal-card">
            <div class="legal-card-header">
              <div class="legal-card-title">PHASE 3: MASTERY</div>
            </div>
            <div class="legal-card-body">
              <ul class="legal-card-features">
                <li>Criminal vs. Civil Liability</li>
                <li>CCW Insurance Options</li>
                <li>Training Documentation</li>
              </ul>
              <div class="legal-card-actions">
                <button class="btn-legal open-legal-modal" data-phase="3">CWL LEGAL</button>
              </div>
            </div>
          </div>

          <!-- Phase 4 Legal Card -->
          <div class="legal-card">
            <div class="legal-card-header">
              <div class="legal-card-title">PHASE 4: STANDARD CARRY</div>
            </div>
            <div class="legal-card-body">
              <ul class="legal-card-features">
                <li>Standard CWL Requirements</li>
                <li>Prohibited Locations</li>
                <li>Law Enforcement Interaction</li>
              </ul>
              <div class="legal-card-actions">
                <button class="btn-legal open-legal-modal" data-phase="4">CWL LEGAL</button>
              </div>
            </div>
          </div>

          <!-- Phase 5 Legal Card -->
          <div class="legal-card">
            <div class="legal-card-header">
              <div class="legal-card-title">PHASE 5: QUALIFICATION</div>
            </div>
            <div class="legal-card-body">
              <ul class="legal-card-features">
                <li>Legal Knowledge Assessment</li>
                <li>Permit Application Process</li>
                <li>Disqualifying Factors</li>
              </ul>
              <div class="legal-card-actions">
                <button class="btn-legal open-legal-modal" data-phase="5">CWL LEGAL</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Bottom Buttons -->
    <div class="controls">
      <button class="btn" id="reset-all">Reset All</button>
    </div>
  </div>

  <!-- Courses Section -->
  <div class="app-section" id="courses-section">
    <div class="title-panel">
      <div class="title-inner">
        <div class="title-text">COURSES</div>
        <div class="subtitle">5-Phase Comprehensive Training Program</div>
      </div>
    </div>

    <!-- Client Information -->
    <div class="client-info">
      <div class="subhead">CLIENT INFORMATION</div>
      <div class="client-info-form">
        <div class="form-group">
          <label for="client-name">Client Name</label>
          <input type="text" id="client-name" name="client-name" placeholder="Enter client name">
        </div>
        <div class="form-group">
          <label for="course-date">Course Date</label>
          <input type="date" id="course-date" name="course-date">
        </div>
      </div>
    </div>

   <!-- phase Cards in Courses Section -->
<div class="course-card" data-phase="1">
    <div class="course-card-header">
        <div class="course-card-title">PHASE 1: PRINCIPLES</div>
        <div class="course-card-subtitle">Building Your Defensive Platform</div>
    </div>
    <div class="course-card-body">
        <ul class="course-features">
            <li>Focus: Recoil management, sight alignment maintained, trigger press confirmation, overcoming anticipation/flinch.</li>
            <li><span class="checkmark bronze-green">✓</span> Rounds: 10</li>
            <li>Par Time: No Time Limit</li>
            <li><span class="checkmark bronze-green">✓</span> Target: B-27 target</li>
            <li>Distance: 3 yards</li>
            <li><span class="checkmark bronze-green">✓</span> Standard Drills: 4 (P1-D1 to P1-D4)</li>
        </ul>
        <div class="course-action-row">
            <!-- Moved progress wheel inside its own container with lower z-index -->
            <div class="phase-progress-wrapper">
                <div class="phase-progress-container">
                    <div class="tactical-progress-wheel" data-phase="1" style="--progress: 0deg">
                        <div class="tactical-progress-percentage" id="progress-phase-1">0%</div>
                    </div>
                </div>
            </div>
            <!-- Button with higher z-index -->
            <button class="btn open-course-modal" data-course="1" style="position: relative; z-index: 100;">Open Course</button>
        </div>
    </div>
</div>
      
      <div class="course-card" data-course="2">
        <div class="course-card-header">
          <div class="course-card-title">PHASE 2: INTEGRATION</div>
          <div class="course-card-subtitle">Skills Under Pressure</div>
        </div>
        <div class="course-card-body">
          <ul class="course-features">
            <li>Focus: Confirming Phase 1 skills (grip, stance, sight alignment, trigger control) under a slight distance increase.</li>
            <li><span class="checkmark bronze-green">✓</span> Rounds: 5</li>
            <li>Par Time: No Time Limit (Slow Fire)</li>
            <li><span class="checkmark bronze-green">✓</span> Target: B-27 target</li>
            <li>Distance: 5 yards</li>
            <li><span class="checkmark bronze-green">✓</span> Standard Drills: 5 (P2-D1 to P2-D5) + 2 Optional Outdoor</li>
          </ul>
         <div class="course-action-row">
            <!-- Moved progress wheel inside its own container with lower z-index -->
            <div class="phase-progress-wrapper">
                <div class="phase-progress-container">
                    <div class="tactical-progress-wheel" data-phase="2" style="--progress: 0deg">
                        <div class="tactical-progress-percentage" id="progress-phase-2">0%</div>
                    </div>
                </div>
            </div>
            <!-- Button with higher z-index -->
            <button class="btn open-course-modal" data-course="2" style="position: relative; z-index: 100;">Open Course</button>
        </div>
    </div>
</div>

      
      <div class="course-card" data-course="3">
        <div class="course-card-header">
          <div class="course-card-title">PHASE 3: MASTERY</div>
          <div class="course-card-subtitle">Complete Defensive Integration</div>
        </div>
        <div class="course-card-body">
          <ul class="course-features">
            <li>Focus: Integration of Phase 2 skills (multi-target transitions and emergency reloads), maintaining accuracy.</li>
            <li><span class="checkmark bronze-green">✓</span> Rounds: 5</li>
            <li>Par Time: No Time Limit (Controlled Pace)</li>
            <li><span class="checkmark bronze-green">✓</span> Target: 2 B-27 targets</li>
            <li>Distance: 5 yards</li>
            <li><span class="checkmark bronze-green">✓</span> Standard Drills: 4 (P3-D1 to P3-D4) + 2 Optional Outdoor</li>
          </ul>
         <div class="course-action-row">
            <!-- Moved progress wheel inside its own container with lower z-index -->
            <div class="phase-progress-wrapper">
                <div class="phase-progress-container">
                    <div class="tactical-progress-wheel" data-phase="3" style="--progress: 0deg">
                        <div class="tactical-progress-percentage" id="progress-phase-3">0%</div>
                    </div>
                </div>
            </div>
            <!-- Button with higher z-index -->
            <button class="btn open-course-modal" data-course="3" style="position: relative; z-index: 100;">Open Course</button>
        </div>
    </div>
</div>

      
      <div class="course-card" data-course="4">
        <div class="course-card-header">
          <div class="course-card-title">PHASE 4: CONCEALED CARRY READINESS</div>
          <div class="course-card-subtitle">Armed Citizenship & Public Responsibility</div>
        </div>
        <div class="course-card-body">
          <ul class="course-features">
            <li>Focus: Engaging ONLY justified threats in complex legal scenarios, understanding the consequences of innocent hits.</li>
            <li><span class="checkmark bronze-green">✓</span> Rounds: 15</li>
            <li>Par Time: No Time Limit (Focus on decision, then deliberate execution)</li>
            <li><span class="checkmark bronze-green">✓</span> Target: 1 THREAT (armed) B-27 target, 2 INNOCENT B-27 targets</li>
            <li>Distance: 7 yards</li>
            <li><span class="checkmark bronze-green">✓</span> Standard Drills: 2 (P4-D1 to P4-D2) + 1 Vehicle Optional</li>
          </ul>
         <div class="course-action-row">
            <!-- Moved progress wheel inside its own container with lower z-index -->
            <div class="phase-progress-wrapper">
                <div class="phase-progress-container">
                    <div class="tactical-progress-wheel" data-phase="4" style="--progress: 0deg">
                        <div class="tactical-progress-percentage" id="progress-phase-4">0%</div>
                    </div>
                </div>
            </div>
            <!-- Button with higher z-index -->
            <button class="btn open-course-modal" data-course="4" style="position: relative; z-index: 100;">Open Course</button>
        </div>
    </div>
</div>

      
      <div class="course-card" data-course="5">
        <div class="course-card-header">
          <div class="course-card-title">PHASE 5: QUALIFICATION & CERTIFICATION</div>
          <div class="course-card-subtitle">Idaho CWL Concealed Carry Certification</div>
        </div>
        <div class="course-card-body">
          <ul class="course-features">
            <li>Purpose: Demonstrate fundamental marksmanship skills.</li>
            <li><span class="checkmark bronze-green">✓</span> Rounds: 15 (7+4+4)</li>
            <li>Par Time: No time limit, slow fire</li>
            <li><span class="checkmark bronze-green">✓</span> Target: B-27 center mass</li>
            <li>Distance: 7 yards (String 1), 5 yards (Strings 2 & 3)</li>
            <li><span class="checkmark bronze-green">✓</span> Qualification Stages: 3 (S5-Q1 to S5-Q3)</li>
          </ul>
         <div class="course-action-row">
            <!-- Moved progress wheel inside its own container with lower z-index -->
            <div class="phase-progress-wrapper">
                <div class="phase-progress-container">
                    <div class="tactical-progress-wheel" data-phase="5" style="--progress: 0deg">
                        <div class="tactical-progress-percentage" id="progress-phase-5">0%</div>
                    </div>
                </div>
            </div>
            <!-- Button with higher z-index -->
            <button class="btn open-course-modal" data-course="5" style="position: relative; z-index: 100;">Open Course</button>
        </div>
    </div>
</div>

    <button class="print-btn">Print Course Content</button>
</div>
    </div>
</div>

 <!-- Drills Section -->
<div class="app-section" id="drills-section">
  <div class="title-panel">
    <div class="title-inner">
      <div class="title-text">DRILLS</div>
      <div class="subtitle">Training Drills for All 5 Phases</div>
    </div>
  </div>

  <!-- NEW DRILLS CARDS SECTION -->
<div class="drills-cards-section">
  <div class="drills-cards-container">
    <!-- Phase 1 Card -->
    <div class="phase-card" data-phase="1">
      <div class="phase-card-header">
        <div class="phase-card-title">PHASE 1: PRINCIPLES</div>
        <div class="phase-card-subtitle">Building Your Defensive Platform</div>
      </div>
      <div class="phase-card-content">
        <ul class="phase-card-features">
          <li><span class="checkmark bronze-green">✓</span>Drills: 4 standard drills, 3 extended drills</li>
          <li>Round Count: 30 rounds</li>
          <li><span class="checkmark bronze-green">✓</span>Extended: 3 outdoor drills</li>
        </ul>
      </div>
     <div class="phase-card-footer">
  <!-- Top Left: 5 Progress Bars -->
  <div class="phase-progress-bars-vertical">
    <div class="progress-bar" style="--progress: 25%;"></div>
    <div class="progress-bar" style="--progress: 50%;"></div>
    <div class="progress-bar" style="--progress: 75%;"></div>
    <div class="progress-bar" style="--progress: 40%;"></div>
    <div class="progress-bar" style="--progress: 90%;"></div>
  </div>
  
  <!-- Top Right: Progress Wheel -->
  <div class="phase-card-progress">
    <div class="phase-progress-wheel-container">
      <div class="phase-progress-wheel" id="phase1-progress-wheel" style="--progress: 0deg">
        <div class="phase-progress-percentage">0%</div>
      </div>
    </div>
  </div>
  
  <!-- Bottom Left: DYNAMIC ANALYSIS Button -->
  <div class="phase-card-actions">
    <button class="btn dynamic-ds-btn" data-phase="1">DYNAMIC ANALYSIS</button>
  </div>
  
  <!-- Bottom Right: VIEW DRILLS Button -->
  <div class="phase-card-actions">
    <button class="phase-card-btn open-drills-modal" data-course="1">VIEW DRILLS</button>
   </div>
      </div>
    </div>

        <!-- Phase 2 Card -->
        <div class="phase-card" data-phase="2">
          <div class="phase-card-header">
            <div class="phase-card-title">PHASE 2: INTEGRATION</div>
            <div class="phase-card-subtitle">Skills Under Pressure</div>
          </div>
          <div class="phase-card-content">
            <ul class="phase-card-features">
              <li><span class="checkmark bronze-green">✓</span>Drills: 5 standard drills, 2 extended drills</li>
              <li>Round Count: 30 rounds</li>
              <li><span class="checkmark bronze-green">✓</span>Extended: 2 outdoor drills</li>
            </ul>
          </div>
             <div class="phase-card-footer">
  <!-- Top Left: 5 Progress Bars -->
  <div class="phase-progress-bars-vertical">
    <div class="progress-bar" style="--progress: 25%;"></div>
    <div class="progress-bar" style="--progress: 50%;"></div>
    <div class="progress-bar" style="--progress: 75%;"></div>
    <div class="progress-bar" style="--progress: 40%;"></div>
    <div class="progress-bar" style="--progress: 90%;"></div>
  </div>
  
  <!-- Top Right: Progress Wheel -->
  <div class="phase-card-progress">
    <div class="phase-progress-wheel-container">
      <div class="phase-progress-wheel" id="phase2-progress-wheel" style="--progress: 0deg">
        <div class="phase-progress-percentage">0%</div>
      </div>
    </div>
  </div>
  
  <!-- Bottom Left: DYNAMIC ANALYSIS Button -->
  <div class="phase-card-actions">
    <button class="btn dynamic-ds-btn" data-phase="2">DYNAMIC ANALYSIS</button>
  </div>
  
  <!-- Bottom Right: VIEW DRILLS Button -->
  <div class="phase-card-actions">
    <button class="phase-card-btn open-drills-modal" data-course="2">VIEW DRILLS</button>
   </div>
      </div>
    </div>

        <!-- Phase 3 Card -->
        <div class="phase-card" data-phase="3">
          <div class="phase-card-header">
            <div class="phase-card-title">PHASE 3: MASTERY</div>
            <div class="phase-card-subtitle">Complete Defensive Integration</div>
          </div>
          <div class="phase-card-content">
            <ul class="phase-card-features">
              <li><span class="checkmark bronze-green">✓</span>Drills: 4 standard drills, 2 extended drills</li>
              <li>Round Count: 30 rounds</li>
              <li><span class="checkmark bronze-green">✓</span>Extended: 2 outdoor drills</li>
            </ul>
          </div>
             <div class="phase-card-footer">
  <!-- Top Left: 5 Progress Bars -->
  <div class="phase-progress-bars-vertical">
    <div class="progress-bar" style="--progress: 25%;"></div>
    <div class="progress-bar" style="--progress: 50%;"></div>
    <div class="progress-bar" style="--progress: 75%;"></div>
    <div class="progress-bar" style="--progress: 40%;"></div>
    <div class="progress-bar" style="--progress: 90%;"></div>
  </div>
  
  <!-- Top Right: Progress Wheel -->
  <div class="phase-card-progress">
    <div class="phase-progress-wheel-container">
      <div class="phase-progress-wheel" id="phase3-progress-wheel" style="--progress: 0deg">
        <div class="phase-progress-percentage">0%</div>
      </div>
    </div>
  </div>
  
  <!-- Bottom Left: DYNAMIC ANALYSIS Button -->
  <div class="phase-card-actions">
    <button class="btn dynamic-ds-btn" data-phase="3">DYNAMIC ANALYSIS</button>
  </div>
  
  <!-- Bottom Right: VIEW DRILLS Button -->
  <div class="phase-card-actions">
    <button class="phase-card-btn open-drills-modal" data-course="3">VIEW DRILLS</button>
   </div>
      </div>
    </div>

 <!-- Phase 4 Card -->
        <div class="phase-card" data-phase="4">
          <div class="phase-card-header">
            <div class="phase-card-title">PHASE 4: CONCEALED CARRY</div>
            <div class="phase-card-subtitle">Armed Citizenship & Public Responsibility</div>
          </div>
          <div class="phase-card-content">
            <ul class="phase-card-features">
              <li><span class="checkmark bronze-green">✓</span>Drills: 2 standard drills, 1 extended drill</li>
              <li>Round Count: 30 rounds</li>
              <li><span class="checkmark bronze-green">✓</span>Extended: 1 outdoor drill</li>
            </ul>
          </div>
             <div class="phase-card-footer">
  <!-- Top Left: 5 Progress Bars -->
  <div class="phase-progress-bars-vertical">
    <div class="progress-bar" style="--progress: 25%;"></div>
    <div class="progress-bar" style="--progress: 50%;"></div>
    <div class="progress-bar" style="--progress: 75%;"></div>
    <div class="progress-bar" style="--progress: 40%;"></div>
    <div class="progress-bar" style="--progress: 90%;"></div>
  </div>
  
  <!-- Top Right: Progress Wheel -->
  <div class="phase-card-progress">
    <div class="phase-progress-wheel-container">
      <div class="phase-progress-wheel" id="phase4-progress-wheel" style="--progress: 0deg">
        <div class="phase-progress-percentage">0%</div>
      </div>
    </div>
  </div>
  
  <!-- Bottom Left: DYNAMIC ANALYSIS Button -->
  <div class="phase-card-actions">
    <button class="btn dynamic-ds-btn" data-phase="4">DYNAMIC ANALYSIS</button>
  </div>
  
  <!-- Bottom Right: VIEW DRILLS Button -->
  <div class="phase-card-actions">
    <button class="phase-card-btn open-drills-modal" data-course="4">VIEW DRILLS</button>
   </div>
      </div>
    </div>

<!-- Phase 5 Card -->
        <div class="phase-card" data-phase="5">
          <div class="phase-card-header">
            <div class="phase-card-title">PHASE 5: QUALIFICATION</div>
            <div class="phase-card-subtitle">Idaho CWL Concealed Carry Certification</div>
          </div>
          <div class="phase-card-content">
            <ul class="phase-card-features">
              <li><span class="checkmark bronze-green">✓</span>Drills: 3 qualification stages</li>
              <li>Round Count: 30 rounds</li>
              <li><span class="checkmark bronze-green">✓</span>Extended: Legal knowledge assessment</li>
            </ul>
          </div>
              <div class="phase-card-footer">
  <!-- Top Left: 5 Progress Bars -->
  <div class="phase-progress-bars-vertical">
    <div class="progress-bar" style="--progress: 25%;"></div>
    <div class="progress-bar" style="--progress: 50%;"></div>
    <div class="progress-bar" style="--progress: 75%;"></div>
    <div class="progress-bar" style="--progress: 40%;"></div>
    <div class="progress-bar" style="--progress: 90%;"></div>
  </div>
  
  <!-- Top Right: Progress Wheel -->
  <div class="phase-card-progress">
    <div class="phase-progress-wheel-container">
      <div class="phase-progress-wheel" id="phase5-progress-wheel" style="--progress: 0deg">
        <div class="phase-progress-percentage">0%</div>
      </div>
    </div>
  </div>
  
  <!-- Bottom Left: DYNAMIC ANALYSIS Button -->
  <div class="phase-card-actions">
    <button class="btn dynamic-ds-btn" data-phase="5">DYNAMIC ANALYSIS</button>
  </div>
  
  <!-- Bottom Right: VIEW DRILLS Button -->
  <div class="phase-card-actions">
    <button class="phase-card-btn open-drills-modal" data-course="5">VIEW DRILLS</button>
   </div>
      </div>
    </div>

    <button class="print-btn">Print Drills Content</button>
   </div>
</div>
   </div>
</div>



  <!-- Recommendations Section -->
  <div class="app-section" id="recommendations-section">
    <div class="title-panel">
      <div class="title-inner">
        <div class="title-text">RECOMMENDATIONS</div>
        <div class="subtitle">New Firearm Owner Guidance & Resources</div>
      </div>
    </div>

    <div class="recommendation-cards">
        <!-- Firearms Recommendation Card -->
        <div class="recommendation-card">
            <div class="recommendation-card-header">
                <h3 class="recommendation-card-title">FIREARM RECOMMENDATION</h3>
                <p class="recommendation-card-subtitle">Based on Skill Level & Goals</p>
            </div>
            <div class="recommendation-card-body">
                <ul class="recommendation-features">
                    <li>Caliber: 9mm recommended for balance</li>
                    <li>Size: Compact for concealed carry</li>
                    <li>Action: Striker-fired for simplicity</li>
                    <li>Brand: Glock, Smith & Wesson, Sig Sauer</li>
                </ul>
                <div class="recommendation-card-actions">

	<!-- NEW FORMAT (opens table modal) -->
	<button class="btn open-table-modal" data-table="first-time-buying-table">FIRST TIME BUYING</button>
                    <button class="btn open-modal" data-modal="take-us-with-you">TAKE US WITH YOU</button>
                </div>
            </div>
        </div>
        
        <!-- Holster Recommendation Card -->
        <div class="recommendation-card">
            <div class="recommendation-card-header">
                <h3 class="recommendation-card-title">HOLSTER RECOMMENDATION</h3>
                <p class="recommendation-card-subtitle">Safe & Comfortable Carry Options</p>
            </div>
            <div class="recommendation-card-body">
                <ul class="recommendation-features">
                    <li>Type: Inside Waistband (IWB)</li>
                    <li>Material: Kydex for durability</li>
                    <li>Position: 3-4 o'clock or appendix</li>
                    <li>Brand: Vedder, CrossBreed, Alien Gear</li>
                </ul>
                <div class="recommendation-card-actions">
                    <button class="btn open-modal" data-modal="holster-guide">WHAT TO LOOK FOR</button>
                </div>
            </div>
        </div>
        
        <!-- Ammunition Recommendation Card -->
        <div class="recommendation-card">
            <div class="recommendation-card-header">
                <h3 class="recommendation-card-title">AMMUNITION RECOMMENDATION</h3>
                <p class="recommendation-card-subtitle">Training & Defense Rounds</p>
            </div>
            <div class="recommendation-card-body">
                <ul class="recommendation-features">
                    <li>Training: 115gr or 124gr FMJ</li>
                    <li>Defense: 124gr or 147gr JHP</li>
                    <li>Brand: Federal, Speer, Hornady</li>
                    <li>Quantity: 1000 rounds for proficiency</li>
                </ul>
                <div class="recommendation-card-actions">
<button class="btn open-table-modal" data-table="ammo-types-table">AMMO TYPES</button>
                </div>
            </div>
        </div>
        
        <!-- Training Schedule Card -->
        <div class="recommendation-card">
            <div class="recommendation-card-header">
                <h3 class="recommendation-card-title">TRAINING SCHEDULE</h3>
                <p class="recommendation-card-subtitle">Optimal Progression Plan</p>
            </div>
            <div class="recommendation-card-body">
                <ul class="recommendation-features">
                    <li>Frequency: Weekly sessions</li>
                    <li>Duration: 1.5 hours per session</li>
                    <li>Practice: 30 minutes dry fire daily</li>
                    <li>Range: Monthly live fire maintenance</li>
                </ul>
                <div class="recommendation-card-actions">
                    <button class="btn open-modal" data-modal="training-details">VIEW DETAILS</button>
                </div>
            </div>
        </div>
        
        <!-- Essential Gear Card -->
        <div class="recommendation-card">
            <div class="recommendation-card-header">
                <h3 class="recommendation-card-title">ESSENTIAL GEAR</h3>
                <p class="recommendation-card-subtitle">Must-Have Accessories</p>
            </div>
            <div class="recommendation-card-body">
                <ul class="recommendation-features">
                    <li>Hearing Protection: Electronic muffs</li>
                    <li>Eye Protection: Wraparound safety glasses</li>
                    <li>Cleaning Kit: Basic maintenance tools</li>
                    <li>Range Bag: Organized carry solution</li>
                </ul>
                <div class="recommendation-card-actions">
                    <button class="btn" id="open-battle-bag-modal">WITNESS BATTLE BAG</button>
	<button class="btn open-table-modal" data-table="gear-list-table">GEAR LIST</button>
                </div>
            </div>
        </div>
        
        <!-- Legal Protection Card -->
        <div class="recommendation-card">
            <div class="recommendation-card-header">
                <h3 class="recommendation-card-title">LEGAL PROTECTION</h3>
                <p class="recommendation-card-subtitle">Self-Defense Insurance Options</p>
            </div>
            <div class="recommendation-card-body">
                <ul class="recommendation-features">
                    <li>Coverage: Criminal & civil defense</li>
                    <li>Providers: USCCA, CCW Safe, ACLDN</li>
                    <li>Features: 24/7 legal hotline</li>
                    <li>Cost: $30-50 per month</li>
                </ul>
                <div class="recommendation-card-actions">
                    <button class="btn open-table-modal" data-table="uscca-info-table">USCCA</button>
                </div>
            </div>
        </div>
    </div>
    
<div class="referred-selections" id="referred-selections">
    <h3 class="referred-selections-title">REFERRED SELECTIONS</h3>
    <ul class="referred-selections-list" id="referred-selections-list">
        <!-- Selected items will appear here -->
    </ul>
</div>



<!-- Add these cards to your Recommendations section after the existing cards -->

<!-- WITNESS BATTLE BAG Card -->
<div class="recommendation-card battle-bag-card">
    <div class="battle-bag-header">
        <div class="battle-bag-title">WITNESS DEFENSE BATTLE BAG</div>
        <div class="battle-bag-subtitle">Complete Range & Training Package</div>
    </div>
    <div class="battle-bag-body">
        <ul class="battle-bag-features">
            <li>Stitched Witness Canvas Gear Bag</li>
            <li>Box of Ammunition (50 rounds 9mm)</li>
            <li>One Complimentary Range Pass</li>
            <li>Custom Engraved Witness Pen</li>
            <li>Witness Notebook & Field Journal</li>
            <li>Witness Keychain with Cross Emblem</li>
            <li>Additional Training Accessories</li>
        </ul>
        <div class="battle-bag-price">
            <div class="price-amount">$85.00</div>
            <div class="price-label">Complete Package</div>
        </div>
        <div class="battle-bag-action">
            <button class="btn-details" id="open-battle-bag-details">VIEW DETAILS</button>
        </div>
    </div>
</div>

<!-- WITNESS BATTLE BADGE Card -->
<div class="recommendation-card battle-badge-card">
    <div class="battle-badge-header">
        <div class="battle-badge-title">WITNESS DEFENSE BATTLE BADGE</div>
        <div class="battle-badge-subtitle">Ammunition & Range Package Deals</div>
    </div>
    <div class="battle-badge-body">
        <ul class="battle-badge-features">
            <li>4 Tiered Package Options</li>
            <li>Progressive Value & Volume Discounts</li>
            <li>Range Sessions Included</li>
            <li>Paper Targets for All Packages</li>
            <li>Premium Protective Gear</li>
            <li>Cleaning Equipment & Accessories</li>
            <li>Personalized Range Box (Elite Pack)</li>
        </ul>
        <div class="battle-badge-price">
            <div class="price-amount">FROM $45.00</div>
            <div class="price-label">Packages Starting At</div>
        </div>
        <div class="battle-badge-action">
            <button class="btn-details" id="open-battle-badge-details">VIEW PACKAGES</button>
        </div>
    </div>
</div>


<button class="print-btn">Print Recommendations</button>
  </div>


<!-- ===== TABLE RECOMMENDATION MODALS (Interactive Tables) ===== -->

<!-- First Time Buying Table Modal -->
<div id="first-time-buying-table" class="modal table-modal">
    <div class="table-modal-content">
        <div class="table-modal-header">
            <h3>FIRST TIME FIREARM GUIDE</h3>
            <p>Essential Items for New Owners - Check items you'd like to add to your list</p>
        </div>
        <div class="table-modal-body">
            <div class="table-container">
                <table class="interactive-table" id="first-time-table">
                    <thead>
                        <tr>
                            <th class="checkbox-col">Select</th>
                            <th class="name-col">Item Name</th>
                            <th class="desc-col">Details / Description</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="9mm-handgun" data-table="first-time-table"></td>
                            <td class="name-col">Reliable 9mm Handgun</td>
                            <td class="desc-col">Glock 19, Smith & Wesson M&P, Sig Sauer P320 - Proven platforms with excellent reliability and accessory support</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="kydex-holster" data-table="first-time-table"></td>
                            <td class="name-col">Kydex Holster</td>
                            <td class="desc-col">Full trigger guard coverage, proper retention - Vedder, CrossBreed, Tier 1 Concealed</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="gun-belt" data-table="first-time-table"></td>
                            <td class="name-col">Quality Gun Belt</td>
                            <td class="desc-col">Rigid leather or reinforced nylon - Supports weight, prevents sagging, essential for carry</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="spare-mags" data-table="first-time-table"></td>
                            <td class="name-col">Spare Magazines (2-3)</td>
                            <td class="desc-col">Factory or reputable aftermarket - For training and emergency reloads</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="eye-protection" data-table="first-time-table"></td>
                            <td class="name-col">Eye Protection</td>
                            <td class="desc-col">ANSI Z87.1 rated - Wraparound design, polycarbonate lenses</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="ear-protection" data-table="first-time-table"></td>
                            <td class="name-col">Ear Protection</td>
                            <td class="desc-col">Electronic muffs (Walker's, Howard Leight) - Allows conversation while blocking gunshots</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="cleaning-kit" data-table="first-time-table"></td>
                            <td class="name-col">Cleaning Kit</td>
                            <td class="desc-col">Bore brush, cleaning rod, patches, solvent, lubricant - Regular maintenance prevents malfunctions</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="jhp-ammo" data-table="first-time-table"></td>
                            <td class="name-col">Defensive JHP Ammunition</td>
                            <td class="desc-col">124gr or 147gr JHP - Federal HST, Speer Gold Dot, Hornady Critical Defense</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="fmj-ammo" data-table="first-time-table"></td>
                            <td class="name-col">FMJ Practice Ammunition</td>
                            <td class="desc-col">1000 rounds minimum - For skill development and regular training</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="storage-case" data-table="first-time-table"></td>
                            <td class="name-col">Lockable Storage Case</td>
                            <td class="desc-col">Hard-sided case with lock or small handgun safe - Secure storage required by law</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="table-modal-footer">
            <button class="btn-close close-table-modal">Close</button>
            <button class="btn-clear" data-table="first-time-table">Clear All</button>
        </div>
    </div>
</div>

<!-- Ammo Types Table Modal -->
<div id="ammo-types-table" class="modal table-modal">
    <div class="table-modal-content">
        <div class="table-modal-header">
            <h3>AMMUNITION TYPES & RECOMMENDATIONS</h3>
            <p>Training vs. Defense Rounds - Select for your needs list</p>
        </div>
        <div class="table-modal-body">
            <div class="table-container">
                <table class="interactive-table" id="ammo-table">
                    <thead>
                        <tr>
                            <th class="checkbox-col">Select</th>
                            <th class="name-col">Ammo Type</th>
                            <th class="desc-col">Purpose & Details</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="9mm-fmj" data-table="ammo-table"></td>
                            <td class="name-col">9mm FMJ (Training)</td>
                            <td class="desc-col">115gr or 124gr Full Metal Jacket - High volume practice, fundamentals, recoil management, range sessions</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="9mm-jhp" data-table="ammo-table"></td>
                            <td class="name-col">9mm JHP (Defense)</td>
                            <td class="desc-col">124gr or 147gr Jacketed Hollow Point - Expands on impact, reduces overpenetration, consistent ignition</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="test-ammo" data-table="ammo-table"></td>
                            <td class="name-col">Defense Ammo Test Box</td>
                            <td class="desc-col">50 rounds minimum - Test JHP in your specific firearm for feeding reliability before carry</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="22lr-training" data-table="ammo-table"></td>
                            <td class="name-col">.22 LR (Beginner)</td>
                            <td class="desc-col">Low recoil, inexpensive - Ideal for fundamentals, grip development, trigger control</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="38special" data-table="ammo-table"></td>
                            <td class="name-col">.38 Special (Revolver)</td>
                            <td class="desc-col">Simple manual of arms - Moderate recoil, reliable for defensive use in revolvers</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="brass-only" data-table="ammo-table"></td>
                            <td class="name-col">Brass Cased Only</td>
                            <td class="desc-col">Avoid aluminum/steel - More reliable extraction, better for semi-autos</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="table-modal-footer">
            <button class="btn-close close-table-modal">Close</button>
            <button class="btn-clear" data-table="ammo-table">Clear All</button>
        </div>
    </div>
</div>

<!-- Gear List Table Modal -->
<div id="gear-list-table" class="modal table-modal">
    <div class="table-modal-content">
        <div class="table-modal-header">
            <h3>ESSENTIAL GEAR CHECKLIST</h3>
            <p>Complete Setup for New Defensive Shooters</p>
        </div>
        <div class="table-modal-body">
            <div class="table-container">
                <table class="interactive-table" id="gear-table">
                    <thead>
                        <tr>
                            <th class="checkbox-col">Select</th>
                            <th class="name-col">Gear Item</th>
                            <th class="desc-col">Function & Importance</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="range-bag" data-table="gear-table"></td>
                            <td class="name-col">Range Bag</td>
                            <td class="desc-col">Organized carry for all gear - Separate compartments for ammo, ears, eyes, tools</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="shot-timer" data-table="gear-table"></td>
                            <td class="name-col">Shot Timer</td>
                            <td class="desc-col">PACT, CED, Competition Electronics - Measures split times, par times, objective feedback</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="snap-caps" data-table="gear-table"></td>
                            <td class="name-col">Snap Caps/Dummy Rounds</td>
                            <td class="desc-col">Safe dry fire practice - Malfunction drills, loading/unloading practice</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="mag-loader" data-table="gear-table"></td>
                            <td class="name-col">Magazine Loader</td>
                            <td class="desc-col">Uplula, ETS - Saves fingers during high round count sessions</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="targets" data-table="gear-table"></td>
                            <td class="name-col">Various Targets</td>
                            <td class="desc-col">B-27, reduced-size, reactive - Different drills require different target types</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="tools" data-table="gear-table"></td>
                            <td class="name-col">Gun-Specific Tools</td>
                            <td class="desc-col">Sight adjustment, grip screws, takedown tools - Field maintenance capability</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="first-aid" data-table="gear-table"></td>
                            <td class="name-col">Range First Aid Kit</td>
                            <td class="desc-col">Trauma focused - Tourniquet, chest seals, gauze, gloves, shears</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="notebook" data-table="gear-table"></td>
                            <td class="name-col">Training Notebook</td>
                            <td class="desc-col">Track progress, record drills, note improvements and areas for work</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="table-modal-footer">
            <button class="btn-close close-table-modal">Close</button>
            <button class="btn-clear" data-table="gear-table">Clear All</button>
        </div>
    </div>
</div>

<!-- USCCA Info Table Modal -->
<div id="uscca-info-table" class="modal table-modal">
    <div class="table-modal-content">
        <div class="table-modal-header">
            <h3>USCCA PROTECTION PLAN FEATURES</h3>
            <p>Self-Defense Liability Coverage Components</p>
        </div>
        <div class="table-modal-body">
            <div class="table-container">
                <table class="interactive-table" id="uscca-table">
                    <thead>
                        <tr>
                            <th class="checkbox-col">Select</th>
                            <th class="name-col">Coverage Feature</th>
                            <th class="desc-col">Details & Protection</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="24-7-response" data-table="uscca-table"></td>
                            <td class="name-col">24/7 Critical Response</td>
                            <td class="desc-col">Immediate attorney access after incident - Legal guidance from first moments</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="criminal-defense" data-table="uscca-table"></td>
                            <td class="name-col">Criminal Defense Coverage</td>
                            <td class="desc-col">Up to $2 million - Attorney fees, expert witnesses, investigation costs</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="civil-defense" data-table="uscca-table"></td>
                            <td class="name-col">Civil Defense Coverage</td>
                            <td class="desc-col">Up to $2 million - Defense against lawsuits from attacker's family</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="bail-bond" data-table="uscca-table"></td>
                            <td class="name-col">Bail Bond Funding</td>
                            <td class="desc-col">Up to $25,000 - Immediate funds for release if arrested</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="attorney-retainer" data-table="uscca-table"></td>
                            <td class="name-col">Attorney Retainer</td>
                            <td class="desc-col">Pre-paid legal retainer - No upfront costs for representation</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="training-resources" data-table="uscca-table"></td>
                            <td class="name-col">Training Resources</td>
                            <td class="desc-col">Online training, magazine, educational materials - Continuous skill development</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="psychological-support" data-table="uscca-table"></td>
                            <td class="name-col">Psychological Support</td>
                            <td class="desc-col">Counseling services - Post-incident trauma care for you and family</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="multi-state" data-table="uscca-table"></td>
                            <td class="name-col">Multi-State Coverage</td>
                            <td class="desc-col">Valid in all 50 states - Protection while traveling throughout US</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="table-modal-footer">
            <button class="btn-close close-table-modal">Close</button>
            <button class="btn-clear" data-table="uscca-table">Clear All</button>
        </div>
    </div>
</div>

<!-- ===== SIMPLE MODALS CONVERTED TO TABLE MODALS ===== -->

<!-- Take Us With You Modal (TWO COLUMNS, NO CHECKBOXES) -->
<div id="take-us-with-you" class="modal table-modal">
    <div class="table-modal-content">
        <div class="table-modal-header">
            <h3>What We'll Do Together</h3>
            <p>Comprehensive firearm selection assistance and guidance</p>
        </div>
        <div class="table-modal-body">
            <div class="table-container">
                <table class="interactive-table" id="take-us-table">
                    <thead>
                        <tr>
                            <th class="name-col">Activity Phase</th>
                            <th class="desc-col">Description & Details</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="name-col">Clarify Firearm Purpose</td>
                            <td class="desc-col">Determine whether the pistol is for home defense, concealed carry, range use, or general training. Discuss your daily routine and lifestyle to identify the best fit.</td>
                        </tr>
                        <tr>
                            <td class="name-col">Evaluate Your Priorities</td>
                            <td class="desc-col">Size and concealability vs. shootability and capacity. Ease of operation for your experience level. Budget for the firearm plus necessary accessories.</td>
                        </tr>
                        <tr>
                            <td class="name-col">Handle & Compare Options</td>
                            <td class="desc-col">Visit local dealers together to handle different models. Test ergonomics, controls, and natural point of aim. Compare features, reliability, and aftermarket support.</td>
                        </tr>
                        <tr>
                            <td class="name-col">Complete the Purchase</td>
                            <td class="desc-col">Ensure proper paperwork and background check completion. Discuss safe storage solutions for your situation. Plan initial familiarization and safety training.</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="table-modal-footer">
            <button class="btn-close close-table-modal">Close</button>
        </div>
    </div>
</div>

<!-- Holster Guide Modal (CONVERTED TO TABLE WITH CHECKBOXES) -->
<div id="holster-guide" class="modal table-modal">
    <div class="table-modal-content">
        <div class="table-modal-header">
            <h3>Holster Selection Guide</h3>
            <p>Essential factors for choosing the right holster - Check items to add to your list</p>
        </div>
        <div class="table-modal-body">
            <div class="table-container">
                <table class="interactive-table" id="holster-table">
                    <thead>
                        <tr>
                            <th class="checkbox-col">Select</th>
                            <th class="name-col">Feature/Consideration</th>
                            <th class="desc-col">Details & Importance</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="material-kydex" data-table="holster-table"></td>
                            <td class="name-col">Material Selection</td>
                            <td class="desc-col">Kydex offers excellent retention and durability; leather molds comfortably over time; hybrid designs combine both materials effectively</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="retention-level" data-table="holster-table"></td>
                            <td class="name-col">Retention Level</td>
                            <td class="desc-col">Choose between passive retention (friction fit) and active retention (mechanisms like hoods, buttons, or rotation locks)</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="concealment-ability" data-table="holster-table"></td>
                            <td class="name-col">Concealment Ability</td>
                            <td class="desc-col">The holster should minimize printing and be comfortable for all-day wear in various clothing and positions</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="safety-features" data-table="holster-table"></td>
                            <td class="name-col">Safety Features</td>
                            <td class="desc-col">Look for holsters that completely cover the trigger guard to prevent accidental discharge during carry and re-holstering</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="carry-position" data-table="holster-table"></td>
                            <td class="name-col">Carry Position Options</td>
                            <td class="desc-col">Consider appendix (AIWB), strong-side hip (3-4 o'clock), or small of back based on your comfort and accessibility needs</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="belt-compatibility" data-table="holster-table"></td>
                            <td class="name-col">Belt Compatibility</td>
                            <td class="desc-col">Ensure the holster works with a proper gun belt designed for carry weight, typically 1.5" width with rigid support</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="draw-efficiency" data-table="holster-table"></td>
                            <td class="name-col">Draw Efficiency</td>
                            <td class="desc-col">Practice your draw to ensure smooth, consistent presentation from the holster without snagging or excessive movement</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="training-integration" data-table="holster-table"></td>
                            <td class="name-col">Training Integration</td>
                            <td class="desc-col">Your holster should support both dry fire practice and live fire training sessions for consistent skill development</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="table-modal-footer">
            <button class="btn-close close-table-modal">Close</button>
            <button class="btn-clear" data-table="holster-table">Clear All</button>
        </div>
    </div>
</div>

<!-- Training Details Modal (CONVERTED TO TABLE WITH CHECKBOXES) -->
<div id="training-details" class="modal table-modal">
    <div class="table-modal-content">
        <div class="table-modal-header">
            <h3>Optimal Training Schedule & Components</h3>
            <p>Training elements for skill development - Select items for your training plan</p>
        </div>
        <div class="table-modal-body">
            <div class="table-container">
                <table class="interactive-table" id="training-table">
                    <thead>
                        <tr>
                            <th class="checkbox-col">Select</th>
                            <th class="name-col">Training Component</th>
                            <th class="desc-col">Details & Implementation</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="weekly-sessions" data-table="training-table"></td>
                            <td class="name-col">Weekly Training Sessions</td>
                            <td class="desc-col">1.5 hours dedicated training maintains skill progression and muscle memory development</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="daily-dry-fire" data-table="training-table"></td>
                            <td class="name-col">Daily Dry Fire Practice</td>
                            <td class="desc-col">30 minutes focused on fundamentals: draw stroke, sight alignment, trigger control, reload drills</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="monthly-live-fire" data-table="training-table"></td>
                            <td class="name-col">Monthly Live Fire Validation</td>
                            <td class="desc-col">Minimum once per month to validate dry fire practice and maintain live fire proficiency</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="skill-progression" data-table="training-table"></td>
                            <td class="name-col">Structured Skill Progression</td>
                            <td class="desc-col">Start with safety and fundamentals, then add complexity: movement, multiple targets, low-light scenarios</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="scenario-training" data-table="training-table"></td>
                            <td class="name-col">Scenario-Based Training</td>
                            <td class="desc-col">Incorporate realistic scenarios: home defense, vehicle, public spaces with shoot/no-shoot decisions</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="progress-documentation" data-table="training-table"></td>
                            <td class="name-col">Progress Documentation</td>
                            <td class="desc-col">Keep a training log tracking rounds fired, drills completed, skill improvements, and areas needing work</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="professional-instruction" data-table="training-table"></td>
                            <td class="name-col">Professional Instruction</td>
                            <td class="desc-col">Quarterly sessions with an instructor to correct habits and learn advanced techniques</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="mental-preparation" data-table="training-table"></td>
                            <td class="name-col">Mental Preparation Exercises</td>
                            <td class="desc-col">Include visualization, decision-making exercises, and stress inoculation in your routine</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="table-modal-footer">
            <button class="btn-close close-table-modal">Close</button>
            <button class="btn-clear" data-table="training-table">Clear All</button>
        </div>
    </div>
</div>

<!-- Battle Bag Modal (CONVERTED TO TABLE WITH CHECKBOXES) -->
<div id="battle-bag-modal" class="modal table-modal">
    <div class="table-modal-content">
        <div class="table-modal-header">
            <h3>Witness Battle Bag Contents</h3>
            <p>Essential gear for range and training - Select items for your kit</p>
        </div>
        <div class="table-modal-body">
            <div class="table-container">
                <table class="interactive-table" id="battlebag-table">
                    <thead>
                        <tr>
                            <th class="checkbox-col">Select</th>
                            <th class="name-col">Gear Item</th>
                            <th class="desc-col">Function & Details</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="medical-trauma-kit" data-table="battlebag-table"></td>
                            <td class="name-col">Medical Trauma Kit</td>
                            <td class="desc-col">Tourniquet, chest seals, compression gauze, gloves - Essential for range safety and emergency response</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="tools-maintenance" data-table="battlebag-table"></td>
                            <td class="name-col">Tools & Maintenance Kit</td>
                            <td class="desc-col">Multi-tool, cleaning kit, spare parts, lubricant - For field maintenance and adjustments</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="shooting-accessories" data-table="battlebag-table"></td>
                            <td class="name-col">Shooting Accessories</td>
                            <td class="desc-col">Extra magazines, magazine loader, ear protection, eye protection - Essential range equipment</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="documentation-materials" data-table="battlebag-table"></td>
                            <td class="name-col">Documentation Materials</td>
                            <td class="desc-col">Range cards, training logs, pen, notebook - For tracking progress and recording data</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="miscellaneous-gear" data-table="battlebag-table"></td>
                            <td class="name-col">Miscellaneous Gear</td>
                            <td class="desc-col">Batteries, flashlight, paracord, tape, markers - Utility items for various situations</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="hydration-nutrition" data-table="battlebag-table"></td>
                            <td class="name-col">Hydration & Nutrition</td>
                            <td class="desc-col">Water bottle, snacks, electrolyte supplements - For extended training sessions</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="personal-items" data-table="battlebag-table"></td>
                            <td class="name-col">Personal Items</td>
                            <td class="desc-col">Sunscreen, insect repellent, hat, gloves, change of clothes - Comfort and protection items</td>
                        </tr>
                        <tr>
                            <td class="checkbox-col"><input type="checkbox" class="table-checkbox" data-item="communications-gear" data-table="battlebag-table"></td>
                            <td class="name-col">Communications Gear</td>
                            <td class="desc-col">Whistle, signal mirror, small radio, backup cell phone battery - Emergency communication tools</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="table-modal-footer">
            <button class="btn-close close-table-modal">Close</button>
            <button class="btn-clear" data-table="battlebag-table">Clear All</button>
        </div>
    </div>
</div>

  <!-- Notes Section -->
  <div class="app-section" id="notes-section">
    <div class="title-panel">
      <div class="title-inner">
        <div class="title-text">NOTES</div>
        <div class="subtitle">Training Notes & Documentation</div>
      </div>
    </div>

    <div class="notes-section">
      <div class="subhead">TRAINING NOTES</div>
      <div class="notes-list">
        <div class="note-item">
          <div class="note-date">December 11, 2023</div>
          <div class="note-content">Client showed excellent progress in Phase 1 fundamentals. Good natural point of aim and safety awareness.</div>
        </div>
        <div class="note-item">
          <div class="note-date">December 18, 2023</div>
          <div class="note-content">Phase 2 integration went well. Client needs more practice with emergency reloads but shows good movement fundamentals.</div>
        </div>
      </div>
      
      <div class="notes-card">
        <div class="subhead">ADD NEW NOTE</div>
        <textarea placeholder="Enter your training notes here..."></textarea>
        <button class="save-notes-btn">Save Note</button>
        <div class="hint">Notes are saved locally to your device</div>
      </div>
    </div>

    <button class="print-btn">Print Notes</button>
  </div>

  <!-- Recommendation Modals -->
  <div id="first-time-buying" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Essential Tips for Choosing the Right Pistol</h3>
        </div>
        <div class="modal-body">
            <ul class="modal-list">
                <li><strong>Know Your Purpose</strong> - Decide whether the pistol is for defense, target shooting, or other use. Your purpose narrows your options.</li>
                <li><strong>Compare Calibers</strong> - Look into recoil, stopping power, and capacity. Pick a caliber that fits your needs and shooting style.</li>
                <li><strong>Choose the Right Size/Weight</strong> - Compact guns conceal better; full-size guns handle and shoot easier. Match the pistol's size to its role.</li>
                <li><strong>Check Safety Features</strong> - Select a pistol with reliable safeties—manual safeties, firing-pin blocks, etc.—to help prevent accidents.</li>
                <li><strong>Test the Grip</strong> - Pick a pistol that fits your hand comfortably and naturally. Good ergonomics improve control and accuracy.</li>
                <li><strong>Ensure Accessory Support</strong> - If you want lights, optics, or lasers, choose a pistol with rails or mounting points.</li>
                <li><strong>Get Expert Input</strong> - Ask instructors or experienced shooters for advice to guide your choice.</li>
                <li><strong>Train Regularly</strong> - Learn your pistol, practice often, and stay proficient to ensure safe, responsible ownership.</li>
            </ul>
        </div>
<div class="course-modal-actions">
    <button class="btn-close close-modal">Close</button>
</div>
    </div>
  </div>

  <div id="take-us-with-you" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">What We'll Do Together</h3>
        </div>
        <div class="modal-body">
            <div class="modal-section">
                <h4 class="modal-section-title">Clarify the Firearm's Purpose</h4>
                <ul class="modal-list">
                    <li>Determine whether the pistol is for home defense, concealed carry, range use, or general training.</li>
                    <li>Discuss your daily routine and lifestyle to identify the best fit.</li>
                    <li>Consider factors like family safety, travel needs, and storage options.</li>
                </ul>
                
                <h4 class="modal-section-title">Evaluate Your Priorities</h4>
                <ul class="modal-list">
                    <li>Size and concealability vs. shootability and capacity</li>
                    <li>Ease of operation for your experience level</li>
                    <li>Budget for the firearm plus necessary accessories</li>
                    <li>Future training and skill development plans</li>
                </ul>
                
                <h4 class="modal-section-title">Handle and Compare Options</h4>
                <ul class="modal-list">
                    <li>We'll visit local dealers together to handle different models</li>
                    <li>Test ergonomics, controls, and natural point of aim</li>
                    <li>Compare features, reliability, and aftermarket support</li>
                    <li>Consider reputable brands with proven track records</li>
                </ul>
                
                <h4 class="modal-section-title">Complete the Purchase</h4>
                <ul class="modal-list">
                    <li>Ensure proper paperwork and background check completion</li>
                    <li>Discuss safe storage solutions for your situation</li>
                    <li>Plan initial familiarization and safety training</li>
                    <li>Schedule follow-up range sessions for skill development</li>
                </ul>
            </div>
 </div>
<div class="course-modal-actions">
    <button class="btn-close close-modal">Close</button>
</div>
        </div>
    </div>
  </div>

  <div id="holster-guide" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Holster Selection Guide</h3>
        </div>
        <div class="modal-body">
            <ul class="modal-list">
                <li><strong>Material Matters</strong> - Kydex offers excellent retention and durability; leather molds comfortably over time; hybrid designs combine both.</li>
                <li><strong>Retention Level</strong> - Choose between passive retention (friction fit) and active retention (mechanisms like hoods or buttons).</li>
                <li><strong>Concealment Ability</strong> - The holster should minimize printing and be comfortable for all-day wear.</li>
                <li><strong>Safety Features</strong> - Look for holsters that completely cover the trigger guard to prevent accidental discharge.</li>
                <li><strong>Carry Position</strong> - Consider appendix (AIWB), strong-side hip (3-4 o'clock), or small of back based on your comfort and accessibility needs.</li>
                <li><strong>Belt Compatibility</strong> - Ensure the holster works with a proper gun belt designed for carry weight.</li>
                <li><strong>Draw Efficiency</strong> - Practice your draw to ensure smooth, consistent presentation from the holster.</li>
                <li><strong>Training Integration</strong> - Your holster should support both dry fire practice and live fire training.</li>
            </ul>
          </div>
<div class="course-modal-actions">
    <button class="btn-close close-modal">Close</button>
</div>
        </div>
    </div>
  </div>

  <div id="ammo-types" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Ammunition Types Explained</h3>
        </div>
        <div class="modal-body">
            <ul class="modal-list">
                <li><strong>Full Metal Jacket (FMJ)</strong> - Best for training: affordable, reliable, reduced ricochet risk, minimal barrel wear.</li>
                <li><strong>Jacketed Hollow Point (JHP)</strong> - Designed for self-defense: expands on impact, creates larger wound channels, reduces over-penetration.</li>
                <li><strong>Grain Weight</strong> - Lighter grains (115gr) = higher velocity, flatter trajectory. Heavier grains (147gr) = less recoil, better barrier penetration.</li>
                <li><strong+Powder Charge</strong> - Standard pressure for general use, +P for increased velocity and energy (check firearm compatibility).</li>
                <li><strong>Brand Consistency</strong> - Stick with reputable manufacturers for reliable performance: Federal, Speer, Hornady, Winchester.</li>
                <li><strong>Function Testing</strong> - Always test your chosen defense ammunition in your specific firearm to ensure reliability.</li>
                <li><strong>Storage Considerations</strong> - Store ammunition in cool, dry conditions away from moisture and extreme temperatures.</li>
                <li><strong>Rotation Practice</strong> - Regularly rotate stored ammunition and replace defense rounds annually for optimal reliability.</li>
            </ul>
        </div>
<div class="course-modal-actions">
    <button class="btn-close close-modal">Close</button>
</div>
        </div>
    </div>
  </div>

  <div id="training-details" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Optimal Training Schedule</h3>
        </div>
        <div class="modal-body">
            <ul class="modal-list">
                <li><strong>Weekly Sessions</strong> - 1.5 hours dedicated training maintains skill progression and muscle memory.</li>
                <li><strong>Daily Dry Fire</strong> - 30 minutes focused on fundamentals: draw, sight alignment, trigger control, reloads.</li>
                <li><strong>Monthly Live Fire</strong> - Minimum once per month to validate dry fire practice and maintain proficiency.</li>
                <li><strong>Skill Progression</strong> - Start with safety and fundamentals, then add complexity: movement, multiple targets, low-light.</li>
                <li><strong>Scenario Training</strong> - Incorporate realistic scenarios: home defense, vehicle, public spaces with shoot/no-shoot decisions.</li>
                <li><strong>Document Progress</strong> - Keep a training log tracking rounds fired, drills completed, and skill improvements.</li>
                <li><strong>Professional Instruction</strong> - Quarterly sessions with an instructor to correct habits and learn advanced techniques.</li>
                <li><strong>Mental Preparation</strong> - Include visualization and decision-making exercises in your routine.</li>
            </ul>
        </div>
<div class="course-modal-actions">
    <button class="btn-close close-modal">Close</button>
</div>
        </div>
    </div>
  </div>

  <div id="gear-list" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Essential Training Gear</h3>
        </div>
        <div class="modal-body">
            <ul class="modal-list">
                <li><strong>Hearing Protection</strong> - Electronic muffs allow normal conversation while protecting hearing from gunshots.</li>
                <li><strong>Eye Protection</strong> - Wrap-around safety glasses with impact rating for full coverage.</li>
                <li><strong>Cleaning Kit</strong> - Rods, brushes, patches, solvent, and lubricant specific to your firearm caliber.</li>
                <li><strong>Range Bag</strong> - Organized carry for firearms, ammunition, ears, eyes, tools, and accessories.</li>
                <li><strong>Targets</strong> - Various types: bullseye, silhouette, reactive, and reduced-size for precision work.</li>
                <li><strong>Tools</strong> - Multi-tool, screwdrivers, allen wrenches, and sight adjustment tools.</li>
                <li><strong>First Aid Kit</strong> - Trauma-focused including tourniquet, chest seals, gauze, and gloves.</li>
                <li><strong>Training Aids</strong> - Snap caps, laser trainers, shot timers, and dummy rounds for malfunction drills.</li>
            </ul>
        </div>
<div class="course-modal-actions">
    <button class="btn-close close-modal">Close</button>
</div>
        </div>
    </div>
  </div>

  <div id="uscca-info" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">USCCA Self-Defense Protection</h3>
        </div>
        <div class="modal-body">
            <ul class="modal-list">
                <li><strong>24/7 Critical Response</strong> - Immediate access to attorneys after a self-defense incident.</li>
                <li><strong>Criminal Defense Coverage</strong> - Up to $2 million for legal defense if criminally charged.</li>
                <li><strong>Civil Defense Coverage</strong> - Up to $2 million for civil lawsuit defense.</li>
                <li><strong>Bail Bond Funding</strong> - Up to $25,000 for bail bonds if arrested.</li>
                <li><strong>Attorney Retainer</strong> - Pre-paid legal retainer for immediate representation.</li>
                <li><strong>Training Resources</strong> - Access to online training, magazine, and educational materials.</li>
                <li><strong>Psychological Support</strong> - Counseling services for post-incident trauma.</li>
                <li><strong>Multi-State Coverage</strong> - Protection valid across all 50 states during travel.</li>
            </ul>
        </div>
<div class="course-modal-actions">
    <button class="btn-close close-modal">Close</button>
</div>
        </div>
    </div>
  </div>

</div>

<script>

// ===== MAIN JAVASCRIPT FOR WITNESS DEFENSE PORTAL =====
// Handle new table modal buttons
document.addEventListener('click', function(e) {
    if (e.target.classList.contains('open-table-modal')) {
        e.preventDefault();
        const tableId = e.target.getAttribute('data-table');
        const modal = document.getElementById(tableId);
        if (modal) {
            modal.style.display = 'flex';
        }
    }
});

// Close table modals (same as other modals)
document.addEventListener('click', function(e) {
    if (e.target.classList.contains('close-table-modal')) {
        e.preventDefault();
        const modal = e.target.closest('.table-modal');
        if (modal) modal.style.display = 'none';
    }
});

// Clear All buttons for table modals
document.addEventListener('click', function(e) {
    if (e.target.classList.contains('btn-clear')) {
        e.preventDefault();
        const tableId = e.target.getAttribute('data-table');
        const table = document.getElementById(tableId);
        if (table) {
            table.querySelectorAll('.table-checkbox').forEach(cb => {
                cb.checked = false;
            });
            e.target.classList.remove('has-checked');
            showNotification('All selections cleared', 'success');
        }
    }
});

// Update Clear All button state when checkboxes are checked
document.addEventListener('change', function(e) {
    if (e.target.classList.contains('table-checkbox')) {
        const tableId = e.target.getAttribute('data-table');
        const table = document.getElementById(tableId);
        const clearBtn = document.querySelector(`.btn-clear[data-table="${tableId}"]`);
        
        if (table && clearBtn) {
            const anyChecked = Array.from(table.querySelectorAll('.table-checkbox')).some(cb => cb.checked);
            clearBtn.classList.toggle('has-checked', anyChecked);
        }
    }
});

document.addEventListener('DOMContentLoaded', function() {
    console.log('Witness Defense Portal - Initializing...');
    
    // ===== GLOBAL STATE =====
    let appState = {
        currentSection: 'home',
        waiverProgress: 0,
        courseProgress: {1: 0, 2: 0, 3: 0, 4: 0, 5: 0},
        drillProgress: {1: 0, 2: 0, 3: 0, 4: 0, 5: 0},
        savedData: {},
        checkboxStates: {},
        inputValues: {}
    };

    // ===== DRILLS PROGRESS MATH =====
    const phasePointsPerSkill = {
        1: 3.125,  // 100 ÷ (4 drills × 8 skills) = 3.13%
        2: 2.5,    // 100 ÷ (5 drills × 8 skills) = 2.5%
        3: 3.125,  // 100 ÷ (4 drills × 8 skills) = 3.13%
        4: 6.25,   // 100 ÷ (2 drills × 8 skills) = 6.25%
        5: 4.17   // 100 ÷ (3 drills × 8 skills) = 4.17%
    };

// ===== SIMPLE LICENSE SYSTEM =====
const LicenseManager = {
    STORAGE_KEY: 'witnessDefenseLicense',
    DEMO_MODE: true,
    
    init() {
        // Check for valid license
        const license = this.getLicense();
        
        if (!license || !this.isValid(license)) {
            // No valid license - start in demo mode
            this.setDemoMode();
            this.showLicenseScreen();
            return false;
        }
        
        // Valid license found
        console.log('Valid license:', license);
        return true;
    },
    
    getLicense() {
        const saved = localStorage.getItem(this.STORAGE_KEY);
        return saved ? JSON.parse(saved) : null;
    },
    
    isValid(license) {
        if (!license || !license.key) return false;
        
        // Check expiration
        if (license.expires && new Date(license.expires) < new Date()) {
            this.showExpiredModal();
            return false;
        }
        
        // Simple format check (adjust based on your key format)
        const isValidFormat = /^WD-[A-Z0-9]{4}-[A-Z0-9]{4}-[A-Z0-9]{4}$/.test(license.key);
        
        return isValidFormat;
    },
    
    activate(key) {
        // Generate license data
        const licenseData = {
            key: key,
            activated: new Date().toISOString(),
            expires: this.calculateExpiry(365), // 1 year default
            customer: 'Paid Customer'
        };
        
        // Save
        localStorage.setItem(this.STORAGE_KEY, JSON.stringify(licenseData));
        
        // Reload app
        location.reload();
        return true;
    },
    
    setDemoMode() {
        // Set demo license (7 days)
        const demoLicense = {
            key: 'DEMO-7DAY-TRIAL-XXXX',
            activated: new Date().toISOString(),
            expires: this.calculateExpiry(7),
            customer: 'Demo User',
            demo: true
        };
        
        localStorage.setItem(this.STORAGE_KEY, JSON.stringify(demoLicense));
    },
    
    calculateExpiry(days) {
        const date = new Date();
        date.setDate(date.getDate() + days);
        return date.toISOString();
    },
    
    showLicenseScreen() {
        // Create overlay that blocks the app
        const overlay = document.createElement('div');
        overlay.id = 'license-overlay';
        overlay.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: sans-serif;
        `;
        
        overlay.innerHTML = `
            <div style="background: #1a1a1a; padding: 40px; border-radius: 12px; border: 2px solid #fe0100; max-width: 500px; text-align: center;">
                <h2 style="color: #fe0100; margin-bottom: 20px;">Witness Defense Portal</h2>
                <p style="color: #fff; margin-bottom: 30px;">Enter your license key to continue</p>
                
                <input type="text" id="license-input" 
                       placeholder="WD-XXXX-XXXX-XXXX" 
                       style="padding: 15px; width: 100%; margin-bottom: 15px; font-size: 16px; text-align: center; letter-spacing: 1px;">
                
                <button id="activate-btn" 
                        style="background: #fe0100; color: white; border: none; padding: 15px 30px; font-size: 16px; cursor: pointer; width: 100%; margin-bottom: 20px;">
                    Activate License
                </button>
                
                <div style="color: #aaa; font-size: 14px;">
                    <p>Need a license? <a href="https://witnessdefense.com/purchase" style="color: #fe0100;">Purchase here</a></p>
                    <p>Demo mode: Limited features, expires in 7 days</p>
                </div>
            </div>
        `;
        
        document.body.appendChild(overlay);
        
        // Add event listeners
        document.getElementById('activate-btn').addEventListener('click', () => {
            const key = document.getElementById('license-input').value.trim();
            if (this.activate(key)) {
                overlay.remove();
            } else {
                alert('Invalid license key. Format: WD-XXXX-XXXX-XXXX');
            }
        });
        
        // Enter key to activate
        document.getElementById('license-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                document.getElementById('activate-btn').click();
            }
        });
    },
    
    showExpiredModal() {
        alert('Your license has expired. Please renew at witnessdefense.com');
    },
    
    isDemo() {
        const license = this.getLicense();
        return license && license.demo === true;
    },
    
    getRemainingDays() {
        const license = this.getLicense();
        if (!license || !license.expires) return 0;
        
        const now = new Date();
        const expires = new Date(license.expires);
        const diffTime = expires - now;
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        
        return Math.max(0, diffDays);
    }
};

// Make it globally accessible
window.LicenseManager = LicenseManager;

 // ===== PHASE PROGRESS CALCULATION & UPDATE =====
    function updatePhaseProgress(phaseNumber) {
    console.log(`Updating Phase ${phaseNumber} progress...`);
    
    let totalAssessedSkills = 0;
    
    // Get drills for this phase
    const drills = window.drillData[phaseNumber] || [];
    
    // Check if we have assessments in appState
    if (window.appState && window.appState.savedData && window.appState.savedData.assessments) {
        drills.forEach(drill => {
            // Find assessment for this drill
            const assessment = window.appState.savedData.assessments.find(
                a => a.phase === phaseNumber && a.drillId === drill.id
            );
            
            if (assessment && assessment.skills) {
                // Count rated skills (rating 1-5)
                const ratedSkills = assessment.skills.filter(skill => 
                    skill.rating && skill.rating >= 1 && skill.rating <= 5
                ).length;
                totalAssessedSkills += ratedSkills;
                console.log(`Drill ${drill.id}: ${ratedSkills} rated skills`);
            }
        });
    }
    
    // Calculate percentage
    const percentage = Math.min(100, totalAssessedSkills * phasePointsPerSkill[phaseNumber]);
    console.log(`Phase ${phaseNumber}: ${totalAssessedSkills} skills × ${phasePointsPerSkill[phaseNumber]}% = ${percentage}%`);
    
    // Update wheel
    const wheel = document.querySelector(`.phase-card[data-phase="${phaseNumber}"] .phase-progress-wheel`);
    if (wheel) {
        updateProgressWheel(wheel, percentage);
    }
    
    // Save to appState
    if (!appState.drillProgress) appState.drillProgress = {};
    appState.drillProgress[phaseNumber] = percentage;
    
    return percentage;
}

    function updateAllPhaseProgress() {
        for (let phase = 1; phase <= 5; phase++) {
            updatePhaseProgress(phase);
        }
    }

  function updateProgressWheel(wheelElement, percentage) {
    if (!wheelElement) return;
    
    // Calculate the red fill angle (ensure it's between 0-360)
    const degrees = Math.min(360, Math.max(0, (percentage / 100) * 360));
    
    // Update the CSS variable for the conic gradient
    wheelElement.style.setProperty('--progress', `${degrees}deg`);
    
    // Find the percentage display element
    const percentElement = wheelElement.querySelector('.progress-percentage, .phase-progress-percentage, .waivers-progress-percentage, .tactical-progress-percentage');
    if (percentElement) {
        // Show 1 decimal place for exact percentages like 3.125, 2.5, etc.
        percentElement.textContent = `${percentage.toFixed(1)}%`;
        
        // Add pulse animation when percentage changes
        percentElement.style.animation = 'none';
        setTimeout(() => {
            percentElement.style.animation = 'progress-pulse 0.5s ease';
        }, 10);
    }
    
    // Add glow effect when wheel updates
    wheelElement.classList.remove('progress-pulse');
    setTimeout(() => {
        wheelElement.classList.add('progress-pulse');
        
        // Make the wheel glow red when it has progress
        if (percentage > 0) {
            wheelElement.style.boxShadow = `
                inset 0 0 15px rgba(0,0,0,0.8),
                0 4px 10px rgba(0,0,0,0.6),
                0 0 0 1px #555,
                0 0 20px rgba(255,0,0,0.3)
            `;
        }
    }, 10);
    
    // Reset shadow after animation (optional)
    setTimeout(() => {
        if (percentage > 0) {
            wheelElement.style.boxShadow = `
                inset 0 0 15px rgba(0,0,0,0.8),
                0 4px 10px rgba(0,0,0,0.6),
                0 0 0 1px #555
            `;
        }
    }, 1000);
}

    function saveAppState() {
        try {

            // Collect checkbox states
            const checkboxStates = {};
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                if (cb.id) checkboxStates[cb.id] = cb.checked;
            });
            
            // Collect text input values
            const inputValues = {};
            document.querySelectorAll('input[type="text"], textarea, input[type="date"], select').forEach(input => {
                if (input.id) inputValues[input.id] = input.value;
            });
            
            appState.checkboxStates = checkboxStates;
            appState.inputValues = inputValues;
            appState.waiverProgress = calculateWaiverProgress();
            
        // 🔥 CRITICAL: Merge assessments from window.appState
        if (window.appState && window.appState.savedData && window.appState.savedData.assessments) {
            if (!appState.savedData) appState.savedData = {};
            appState.savedData.assessments = window.appState.savedData.assessments;
        }

            localStorage.setItem('witnessDefenseData', JSON.stringify(appState));
            console.log('App state saved');
        } catch (e) {
            console.error('Error saving app state:', e);
        }
    }

    function loadAppState() {
        try {
            const saved = localStorage.getItem('witnessDefenseData');
            if (saved) {
                const parsed = JSON.parse(saved);
                appState = { ...appState, ...parsed };
                
                // Restore checkbox states
                if (parsed.checkboxStates) {
                    Object.keys(parsed.checkboxStates).forEach(id => {
                        const cb = document.getElementById(id);
                        if (cb) cb.checked = parsed.checkboxStates[id];
                    });
                }
                
                // Restore input values
                if (parsed.inputValues) {
                    Object.keys(parsed.inputValues).forEach(id => {
                        const input = document.getElementById(id);
                        if (input) input.value = parsed.inputValues[id];
                    });
                }
                
                updateAllProgress();
            }
        } catch (e) {
            console.log('No saved data found');
        }
    }

    function calculateWaiverProgress() {
        const waiverCheckboxes = document.querySelectorAll('#waivers-section input[type="checkbox"]');
        const waiverInputs = document.querySelectorAll('#waivers-section input[type="text"], #waivers-section textarea, #waivers-section select');
        const totalElements = waiverCheckboxes.length + waiverInputs.length;
        
        if (totalElements === 0) return 0;
        
        let completed = 0;
        waiverCheckboxes.forEach(cb => { if (cb.checked) completed++; });
        waiverInputs.forEach(input => { if (input.value.trim() !== '') completed++; });
        
        return (completed / totalElements) * 100;
    }

    // ===== NAVIGATION =====
function setupNavigation() {
    // Hamburger Menu
    const hamburgerMenu = document.querySelector('.hamburger-menu');
    const menuOverlay = document.querySelector('.menu-overlay');
    const closeMenu = document.querySelector('.close-menu');
    
    if (hamburgerMenu) {
        hamburgerMenu.addEventListener('click', () => {
            menuOverlay.style.display = 'flex';
        });
    }
    
    if (closeMenu) {
        closeMenu.addEventListener('click', () => {
            menuOverlay.style.display = 'none';
        });
    }
    
    if (menuOverlay) {
        menuOverlay.addEventListener('click', (e) => {
            if (e.target === menuOverlay) {
                menuOverlay.style.display = 'none';
            }
        });
    }

    // Bottom Navigation
    const navItems = document.querySelectorAll('.nav-item');
    const appSections = document.querySelectorAll('.app-section');
    
    navItems.forEach(item => {
        item.addEventListener('click', () => {
            const section = item.getAttribute('data-section');
            if (!section) return;
            
            // Update active states
            navItems.forEach(nav => nav.classList.remove('active'));
            item.classList.add('active');
            
            // Show selected section
            appSections.forEach(sec => {
                sec.classList.remove('active');
                if (sec.id === `${section}-section`) {
                    sec.classList.add('active');
                    
                    // FIX 1: SCROLL SECTION TO TOP
                    setTimeout(() => {
                        sec.scrollTop = 0;
                        // Also scroll window to top as backup
                        window.scrollTo(0, 0);
                    }, 50);
                }
            });
            
            appState.currentSection = section;
            console.log('Switched to section:', section);
        });
    });
}

// ===== BACK BUTTON HANDLING =====
function setupBackButtonHandling() {
    console.log('Setting up complete back button handling system...');
    
    let isProcessing = false;
    
    // ===== 1. CREATE EXIT MODAL =====
    function createExitModal() {
        if (document.getElementById('witness-exit-modal')) return;
        
        const modal = document.createElement('div');
        modal.id = 'witness-exit-modal';
        modal.style.cssText = `
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 10000;
            align-items: center;
            justify-content: center;
        `;
        
        // Updated modal content - SIMPLIFIED: Only Stay or Exit
        modal.innerHTML = `
            <div style="
                background: #1a1a1a;
                border: 2px solid #ff0000;
                border-radius: 12px;
                padding: 30px;
                max-width: 380px;
                width: 90%;
                text-align: center;
                box-shadow: 0 10px 40px rgba(255, 0, 0, 0.2);
            ">
                <!-- Warning Icon -->
                <div style="
                    width: 80px;
                    height: 80px;
                    margin: 0 auto 20px;
                    background: rgba(255, 0, 0, 0.1);
                    border-radius: 50%;
                    border: 3px solid #ff0000;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    font-size: 40px;
                    color: #ff0000;
                ">
                    
                </div>
                
                <h3 style="
                    color: #ff0000;
                    margin: 0 0 15px 0;
                    font-size: 22px;
                    font-weight: bold;
                ">
                    EXIT TRAINING PLATFORM
                </h3>
                
                <p style="
                    color: #fff;
                    margin: 0 0 10px 0;
                    font-size: 16px;
                    line-height: 1.5;
                ">
                    Are you sure you want to exit?
                </p>
                
                <p style="
                    color: #aaa;
                    margin: 0 0 30px 0;
                    font-size: 14px;
                    line-height: 1.4;
                ">
                    Your progress is saved automatically.
                </p>
                
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    <button id="exit-modal-stay" style="
                        padding: 16px;
                        background: #333;
                        color: white;
                        border: 1px solid #555;
                        border-radius: 8px;
                        cursor: pointer;
                        font-weight: bold;
                        font-size: 16px;
                        transition: all 0.2s;
                    ">
                        STAY IN APP
                    </button>
                    
                    <button id="exit-modal-exit" style="
                        padding: 16px;
                        background: #ff0000;
                        color: white;
                        border: none;
                        border-radius: 8px;
                        cursor: pointer;
                        font-weight: bold;
                        font-size: 16px;
                        transition: all 0.2s;
                    ">
                        EXIT APP
                    </button>
                </div>
            </div>
        `;
        
        document.body.appendChild(modal);
        
        // ===== EXIT MODAL EVENT HANDLERS =====
        const stayBtn = document.getElementById('exit-modal-stay');
        const exitBtn = document.getElementById('exit-modal-exit');
        
        // Stay in app - just close modal
        stayBtn.addEventListener('click', function() {
            modal.style.display = 'none';
            history.pushState({}, '', '#home');
        });
        
        // Exit app - FOR BROWSER: Can't force close, but we can try to navigate away
        // FOR MOBILE APPS: Would need platform-specific code
        exitBtn.addEventListener('click', function() {
            // Option 1: For browser - navigate to about:blank
            // window.location.href = 'about:blank';
            
            // Option 2: For browser - just close modal (since we can't force exit)
            modal.style.display = 'none';
            history.pushState({}, '', '#home');
            
            // Option 3: For mobile apps (would need specific implementation)
            // if (window.ReactNativeWebView) {
            //     window.ReactNativeWebView.postMessage('EXIT_APP');
            // } else if (navigator.app && navigator.app.exitApp) {
            //     navigator.app.exitApp();
            // }
            
            console.log('Exit button clicked - app remains open (browser restriction)');
        });
        
        // Close on background click
        modal.addEventListener('click', function(e) {
            if (e.target === this) {
                this.style.display = 'none';
                history.pushState({}, '', '#home');
            }
        });
        
        // Escape key closes modal
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && modal.style.display === 'flex') {
                modal.style.display = 'none';
                history.pushState({}, '', '#home');
            }
        });
        
        // Hover effects
        stayBtn.addEventListener('mouseenter', () => stayBtn.style.opacity = '0.9');
        stayBtn.addEventListener('mouseleave', () => stayBtn.style.opacity = '1');
        exitBtn.addEventListener('mouseenter', () => exitBtn.style.opacity = '0.9');
        exitBtn.addEventListener('mouseleave', () => exitBtn.style.opacity = '1');
    }
    
    // ===== 2. CHECK IF ANY MODAL IS OPEN =====
    function isAnyModalOpen() {
        const modalSelectors = [
            '.modal',
            '.course-modal',
            '.drills-modal',
            '.legal-modal',
            '.stage-drill-modal',
            '.skills-assessment-modal',
            '.battle-bag-modal',
            '.bang-bag-modal',
            '.course-selection-modal',
            '.table-modal',
            '#dynamic-analysis-modal'
        ];
        
        for (const selector of modalSelectors) {
            const elements = document.querySelectorAll(selector);
            for (const element of elements) {
                if (element.id === 'witness-exit-modal') continue;
                const style = window.getComputedStyle(element);
                if (style.display === 'flex' || style.display === 'block') {
                    return true;
                }
            }
        }
        return false;
    }
    
    // ===== 3. CLOSE ALL MODALS =====
    function closeAllModals() {
        const modalSelectors = [
            '.modal',
            '.course-modal',
            '.drills-modal',
            '.legal-modal',
            '.stage-drill-modal',
            '.skills-assessment-modal',
            '.battle-bag-modal',
            '.bang-bag-modal',
            '.course-selection-modal',
            '.table-modal',
            '#dynamic-analysis-modal'
        ];
        
        modalSelectors.forEach(selector => {
            document.querySelectorAll(selector).forEach(modal => {
                if (modal.id !== 'witness-exit-modal') {
                    modal.style.display = 'none';
                }
            });
        });
    }
    
    // ===== 4. CHECK IF ON HOMEPAGE =====
    function isOnHomepage() {
        if (window.appState && window.appState.currentSection) {
            return window.appState.currentSection === 'home';
        }
        const hash = window.location.hash;
        return !hash || hash === '#home' || hash === '';
    }
    
    // ===== 5. SCROLL SECTION TO TOP =====
    function scrollSectionToTop() {
        const activeSection = document.querySelector('.app-section.active');
        if (activeSection) {
            activeSection.scrollTop = 0;
            window.scrollTo(0, 0);
        }
    }
    
    // ===== 6. MAIN BACK BUTTON HANDLER =====
    function handleBackButton(event) {
        if (isProcessing) return;
        isProcessing = true;
        
        console.log('Back button pressed', {
            currentSection: appState?.currentSection,
            onHomepage: isOnHomepage(),
            modalOpen: isAnyModalOpen()
        });
        
        const exitModal = document.getElementById('witness-exit-modal');
        const exitModalOpen = exitModal && exitModal.style.display === 'flex';
        
        // SCENARIO A: Exit modal is open
        if (exitModalOpen) {
            console.log('Closing exit modal');
            exitModal.style.display = 'none';
            history.pushState({}, '', '#home');
            isProcessing = false;
            return;
        }
        
        // SCENARIO B: Any other modal is open
        if (isAnyModalOpen()) {
            console.log('Closing app modal');
            closeAllModals();
            if (appState?.currentSection) {
                history.pushState({}, '', `#${appState.currentSection}`);
            }
            isProcessing = false;
            return;
        }
        
        // SCENARIO C: On homepage
        if (isOnHomepage()) {
            console.log('On homepage - showing exit modal');
            createExitModal();
            document.getElementById('witness-exit-modal').style.display = 'flex';
            history.pushState({ exitModal: true }, '', '#exit-modal');
            isProcessing = false;
            return;
        }
        
        // SCENARIO D: In any other section
        console.log('In section - staying on:', appState?.currentSection);
        
        if (appState?.currentSection && appState.currentSection !== 'home') {
            history.pushState({}, '', `#${appState.currentSection}`);
            setTimeout(scrollSectionToTop, 50);
        }
        
        isProcessing = false;
    }
    
    // ===== 7. ENHANCE EXISTING NAVIGATION =====
    function enhanceNavigation() {
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', function(e) {
                const section = this.getAttribute('data-section');
                if (section) {
                    setTimeout(() => {
                        history.pushState({}, '', `#${section}`);
                    }, 100);
                }
            });
        });
        
        // Scroll to top when sections change
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (mutation.attributeName === 'class') {
                    const target = mutation.target;
                    if (target.classList.contains('app-section') && 
                        target.classList.contains('active')) {
                        setTimeout(scrollSectionToTop, 100);
                    }
                }
            });
        });
        
        document.querySelectorAll('.app-section').forEach(section => {
            observer.observe(section, { attributes: true });
        });
    }
    
    // ===== 8. DESKTOP PROTECTION =====
    function setupDesktopProtection() {
        window.addEventListener('beforeunload', function(e) {
            if (isOnHomepage()) {
                const exitModal = document.getElementById('witness-exit-modal');
                const exitModalOpen = exitModal && exitModal.style.display === 'flex';
                
                if (!exitModalOpen) {
                    e.preventDefault();
                    e.returnValue = 'Are you sure you want to exit? Your progress is saved.';
                    return e.returnValue;
                }
            }
        });
    }
    
    // ===== 9. INITIALIZE =====
    function initialize() {
        console.log('Initializing navigation system...');
        
        createExitModal();
        enhanceNavigation();
        window.addEventListener('popstate', handleBackButton);
        setupDesktopProtection();
        
        const currentHash = window.location.hash;
        if (!currentHash || currentHash === '#') {
            history.replaceState({ section: 'home' }, '', '#home');
        } else if (currentHash === '#exit-modal') {
            history.replaceState({ exitModal: true }, '', '#exit-modal');
            setTimeout(() => {
                document.getElementById('witness-exit-modal').style.display = 'flex';
            }, 500);
        } else {
            history.replaceState({}, '', currentHash);
        }
        
        setTimeout(scrollSectionToTop, 200);
        
        console.log('Navigation system ready');
    }
    
    // ===== START =====
    initialize();
}
// ===== MODAL MANAGEMENT =====
function setupModals() {
    // Close all modals when clicking close buttons
    document.querySelectorAll('.close-course-modal, .close-drills-modal, .close-legal-modal, .close-modal, .close-stage-drill-modal, .close-skills-assessment-modal, .close-battle-bag-modal, .close-bang-bag-modal, .btn-close, .close-course-selection, .close-legal-modal').forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            const modal = this.closest('.modal, .course-modal, .drills-modal, .legal-modal, .stage-drill-modal, .skills-assessment-modal, .battle-bag-modal, .bang-bag-modal, .course-selection-modal, .legal-modal');
            if (modal) {
                modal.style.display = 'none';
                
                // Also scroll active section to top when modal closes
                setTimeout(() => {
                    const activeSection = document.querySelector('.app-section.active');
                    if (activeSection) {
                        activeSection.scrollTop = 0;
                    }
                }, 50);
            }
        });
    });

// LEGAL MODAL CLOSING
document.addEventListener('click', function(e) {
    if (e.target.classList.contains('close-legal-bottom')) {
        e.preventDefault();
        const modal = e.target.closest('.legal-modal');
        if (modal) {
            modal.style.display = 'none';
        }
    }
});

        // Close modals when clicking outside
        document.querySelectorAll('.modal, .course-modal, .drills-modal, .legal-modal, .stage-drill-modal, .skills-assessment-modal, .battle-bag-modal, .bang-bag-modal, .course-selection-modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.style.display = 'none';
                }
            });
        });

        // Course Modals
        document.addEventListener('click', function(e) {
            const target = e.target;
            
            // Course modals
            if (target.classList.contains('open-course-modal')) {
                e.preventDefault();
                const course = target.getAttribute('data-course');
                const modal = document.getElementById(`course${course}-modal`);
                if (modal) {
                    modal.style.display = 'flex';
                    console.log('Opening course modal:', course);
                }
            }
            
            // Drills modals
            if (target.classList.contains('open-drills-modal') || target.classList.contains('phase-card-btn')) {
                e.preventDefault();
                const course = target.getAttribute('data-course');
                const modal = document.getElementById(`course${course}-drills-modal`);
                if (modal) {
                    modal.style.display = 'flex';
                    loadDrillsForCourse(course);
                    console.log('Opening drills modal:', course);
                }
            }
            
            // Legal modals
            if (target.classList.contains('open-legal-modal') || target.classList.contains('btn-legal')) {
                e.preventDefault();
                const phase = target.getAttribute('data-phase');
                const modal = document.getElementById(`legal${phase}-modal`);
                if (modal) {
                    modal.style.display = 'flex';
                    console.log('Opening legal modal:', phase);
                }
            }
            
            // Recommendation modals
            if (target.classList.contains('open-modal')) {
                e.preventDefault();
                const modalId = target.getAttribute('data-modal');
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.style.display = 'flex';
                }
            }
            
            // Battle Bag modal
            if (target.id === 'open-battle-bag-modal' || (target.classList.contains('btn') && target.textContent.includes('BATTLE BAG'))) {
                e.preventDefault();
                const modal = document.getElementById('battle-bag-modal');
                if (modal) modal.style.display = 'flex';
            }
            
            // Bang Bag modal
            if (target.id === 'open-bang-bag') {
                e.preventDefault();
                const modal = document.getElementById('bang-bag-modal');
                if (modal) modal.style.display = 'flex';
            }
        });

        // Course Selection Modal
        const courseSelectionModal = document.querySelector('.course-selection-modal');
        if (courseSelectionModal) {
            document.querySelectorAll('.course-option').forEach(option => {
                option.addEventListener('click', function() {
                    const course = this.getAttribute('data-course');
                    console.log('Selected course:', course);
                    courseSelectionModal.style.display = 'none';
                    
                    // You can add course selection logic here
                    if (course === 'all') {
                        showNotification('All courses selected', 'success');
                    } else {
                        showNotification(`Course ${course} selected`, 'success');
                    }
                });
            });
        }
    }

    // ===== WAIVERS SECTION =====
    function setupWaivers() {
        const openWaiversBtn = document.getElementById('open-waivers-btn');
        const waiversSection = document.getElementById('waivers-section');
        const waiversCard = document.getElementById('waivers-card');
        const closeWaiversTop = document.getElementById('close-waivers-top');
        const closeWaiversBottom = document.getElementById('close-waivers-bottom');
        
        if (openWaiversBtn && waiversSection && waiversCard) {
            openWaiversBtn.addEventListener('click', function(e) {
                e.preventDefault();
                waiversSection.style.display = 'block';
                waiversCard.style.display = 'none';
                updateAllProgress();
                console.log('Opened waivers section');
            });
        }
        
        if (closeWaiversTop) {
            closeWaiversTop.addEventListener('click', function(e) {
                e.preventDefault();
                waiversSection.style.display = 'none';
                if (waiversCard) waiversCard.style.display = 'block';
            });
        }
        
        if (closeWaiversBottom) {
            closeWaiversBottom.addEventListener('click', function(e) {
                e.preventDefault();
                waiversSection.style.display = 'none';
                if (waiversCard) waiversCard.style.display = 'block';
            });
        }
        
        // Media release exclusive checkboxes
        const mediaConsent = document.getElementById('media-consent');
        const mediaNoConsent = document.getElementById('media-no-consent');
        
        if (mediaConsent && mediaNoConsent) {
            mediaConsent.addEventListener('change', function() {
                if (this.checked) {
                    mediaNoConsent.checked = false;
                }
                updateAllProgress();
            });
            
            mediaNoConsent.addEventListener('change', function() {
                if (this.checked) {
                    mediaConsent.checked = false;
                }
                updateAllProgress();
            });
        }
    }

        function updateAllProgress() {
        // Update waiver progress
        const waiverProgress = calculateWaiverProgress();
        appState.waiverProgress = waiverProgress;
        
        // Update waiver wheels
        const waiverWheels = [
            document.getElementById('waivers-progress-wheel'),
            document.getElementById('onboarding-progress-wheel')
        ];
        
        waiverWheels.forEach(wheel => {
            if (wheel) updateProgressWheel(wheel, waiverProgress);
        });
        
        // Update main progress bar
        const progressBar = document.getElementById('progressBar');
        if (progressBar) {
            progressBar.style.width = `${waiverProgress}%`;
        }
        
        // Update DRILLS progress wheels
        updateDrillsProgress();
        
        // Update COURSES progress wheels
        updateCoursesProgress();
        
        saveAppState();
    }

    function updateRealTimeProgress(phase) {
        // Count currently selected skills
        const selectedSkills = document.querySelectorAll('#skills-assessment-modal .rating-bubble.selected').length;
        const totalSkills = 8; // Always 8 skills per drill
        
        // Calculate current progress
        const pointsPerSkill = phasePointsPerSkill[phase];
        const currentProgress = selectedSkills * pointsPerSkill;
        
        // Update display
        const skillsCount = document.getElementById('skills-count');
        const phaseProgress = document.getElementById('phase-progress');
        
        if (skillsCount) skillsCount.textContent = selectedSkills;
        if (phaseProgress) {
            phaseProgress.textContent = `${currentProgress.toFixed(1)}%`;
            
            // Pulse animation for progress update
            phaseProgress.style.animation = 'none';
            setTimeout(() => {
                phaseProgress.style.animation = 'progress-pulse 0.5s ease';
            }, 10);
        }
        
        // Show calculation in console
        console.log(`REAL-TIME: ${selectedSkills} skills × ${pointsPerSkill}% = ${currentProgress.toFixed(1)}%`);
    }

    // ===== COURSES PROGRESS =====
    function calculateCourseProgress(phase) {
        const phaseCheckboxes = document.querySelectorAll(`[data-phase="${phase}"][data-type="objective"]`);
        const totalCheckboxes = phaseCheckboxes.length;
        if (totalCheckboxes === 0) return 0;
        
        let checkedCount = 0;
        phaseCheckboxes.forEach(cb => {
            if (cb.checked) checkedCount++;
        });
        
        return (checkedCount / totalCheckboxes) * 100;
    }

    function updateCoursesProgress() {
        for (let phase = 1; phase <= 5; phase++) {
            const progress = calculateCourseProgress(phase);
            appState.courseProgress[phase] = progress;
            
            // Update the tactical progress wheel in courses section
            const tacticalWheel = document.querySelector(`.tactical-progress-wheel[data-phase="${phase}"]`);
            if (tacticalWheel) {
                updateProgressWheel(tacticalWheel, progress);
                
                // Update the percentage display
                const percentElement = tacticalWheel.querySelector('.tactical-progress-percentage');
                if (percentElement) {
                    percentElement.textContent = `${Math.round(progress)}%`;
                }
            }
        }
    }

    // ===== DRILLS PROGRESS =====
        function calculateDrillsProgress(phase) {
        if (!appState.savedData.assessments) return 0;
        
        let totalPoints = 0;
        let totalAssessedSkills = 0;
        const pointsPerSkill = phasePointsPerSkill[phase];
        
        // Count assessments for this phase
        const phaseAssessments = appState.savedData.assessments.filter(a => a.phase === phase);
        
        phaseAssessments.forEach(assessment => {
            // Count how many skills have a rating (1-5)
            const assessedSkills = assessment.skills.filter(skill => skill.rating !== null && skill.rating !== undefined).length;
            totalAssessedSkills += assessedSkills;
            totalPoints += assessedSkills * pointsPerSkill;
        });
        
        // Cap at 100%
        const progress = Math.min(100, totalPoints);
        
        // Log exact calculation to console
        console.log(`PHASE ${phase} Progress Calculation:`);
        console.log(`- Total skills assessed: ${totalAssessedSkills}`);
        console.log(`- Points per skill: ${pointsPerSkill}%`);
        console.log(`- Calculation: ${totalAssessedSkills} × ${pointsPerSkill} = ${totalPoints}%`);
        console.log(`- Final progress: ${progress.toFixed(2)}%`);
        
        appState.drillProgress[phase] = progress;
        return progress;
    }

        function updateDrillsProgress() {
        for (let phase = 1; phase <= 5; phase++) {
            const progress = calculateDrillsProgress(phase);
            
            // Update the phase card progress wheel in drills section
            const phaseWheel = document.getElementById(`phase${phase}-progress-wheel`);
            if (phaseWheel) {
                updateProgressWheel(phaseWheel, progress);
                
                // Update the percentage display
                const percentElement = phaseWheel.querySelector('.phase-progress-percentage');
                if (percentElement) {
                    percentElement.textContent = `${Math.round(progress)}%`;
                }
                
                // ===== ADD GLOW EFFECT WHEN PROGRESS INCREASES =====
                const oldProgress = appState.drillProgress[phase] || 0;
                if (progress > oldProgress) {
                    // Make the wheel glow red when it updates
                    phaseWheel.style.boxShadow = `
                        inset 0 0 15px rgba(0,0,0,0.8),
                        0 4px 10px rgba(0,0,0,0.6),
                        0 0 0 1px #555,
                        0 0 20px rgba(255,0,0,0.3)
                    `;
                    
                    // Add pulse animation
                    phaseWheel.classList.remove('progress-pulse');
                    setTimeout(() => {
                        phaseWheel.classList.add('progress-pulse');
                    }, 10);
                    
                    // Reset shadow after animation
                    setTimeout(() => {
                        phaseWheel.style.boxShadow = `
                            inset 0 0 15px rgba(0,0,0,0.8),
                            0 4px 10px rgba(0,0,0,0.6),
                            0 0 0 1px #555
                        `;
                    }, 1000);
                    
                    // Log the increase
                    console.log(`Phase ${phase} progress increased: ${oldProgress.toFixed(1)}% → ${progress.toFixed(1)}% (+${(progress - oldProgress).toFixed(1)}%)`);
                }
            }
            
            // Update the tactical progress wheel in courses section
            const tacticalWheel = document.querySelector(`.tactical-progress-wheel[data-phase="${phase}"]`);
            if (tacticalWheel) {
                const courseProgress = appState.courseProgress[phase] || 0;
                const combinedProgress = (courseProgress + progress) / 2;
                
                updateProgressWheel(tacticalWheel, combinedProgress);
                
                // Update the percentage display
                const tacticalPercent = tacticalWheel.querySelector('.tactical-progress-percentage');
                if (tacticalPercent) {
                    tacticalPercent.textContent = `${combinedProgress.toFixed(1)}%`;
                }
            }
        }
    }

    // ===== CHECKBOX FUNCTIONALITY =====
    function setupCheckboxes() {
        // Check-all for training goals
        const checkAllGoals = document.getElementById('check-all-goals');
        const trainingGoals = document.querySelectorAll('.training-goal');
        
        if (checkAllGoals) {
            checkAllGoals.addEventListener('change', function() {
                trainingGoals.forEach(goal => {
                    goal.checked = this.checked;
                });
                updateAllProgress();
            });
        }
        
        // Individual goal checkboxes
        trainingGoals.forEach(goal => {
            goal.addEventListener('change', function() {
                if (checkAllGoals) {
                    const allChecked = Array.from(trainingGoals).every(g => g.checked);
                    checkAllGoals.checked = allChecked;
                }
                updateAllProgress();
            });
        });
        
        // Course objective checkboxes
        document.querySelectorAll('[data-type="objective"]').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                updateAllProgress();
            });
        });

        // All other checkboxes
        document.querySelectorAll('#waivers-section input[type="checkbox"]').forEach(cb => {
            cb.addEventListener('change', updateAllProgress);
        });
    }

    // ===== FORM INPUT HANDLING =====
    function setupFormInputs() {
        // Text inputs and textareas
        document.querySelectorAll('#waivers-section input[type="text"], #waivers-section textarea, #waivers-section select').forEach(input => {
            input.addEventListener('input', updateAllProgress);
            input.addEventListener('change', updateAllProgress);
        });
        
        // Date inputs
        const dateInputs = document.querySelectorAll('input[type="date"]');
        const today = new Date().toISOString().split('T')[0];
        dateInputs.forEach(input => {
            if (!input.value) {
                input.value = today;
            }
            input.addEventListener('change', updateAllProgress);
        });
        
        // Skill ratings
        document.querySelectorAll('.rating-option').forEach(option => {
            option.addEventListener('click', function() {
                const skill = this.getAttribute('data-skill');
                const value = this.getAttribute('data-value');
                
                // Remove selected class from siblings
                const siblings = this.parentElement.querySelectorAll('.rating-option');
                siblings.forEach(sib => sib.classList.remove('selected'));
                
                // Add selected class to clicked option
                this.classList.add('selected');
                
                // Store in app state
                if (!appState.savedData.skillRatings) {
                    appState.savedData.skillRatings = {};
                }
                appState.savedData.skillRatings[skill] = value;
                
                updateAllProgress();
            });
        });
    }


    // ===== DRILLS FUNCTIONALITY =====
function loadDrillsForCourse(courseNumber) {
    console.log('Loading drills for course:', courseNumber);
    
    const drillsGrid = document.querySelector(`#course${courseNumber}-drills-modal .drills-grid`);
    if (!drillsGrid) {
        console.error('Drills grid not found for course:', courseNumber);
        return;
    }
    
    // Clear existing content
    drillsGrid.innerHTML = '';
    
    // Get drill data
    const drills = window.drillData[courseNumber] || [];
    
    drills.forEach((drill, index) => {
        const drillCard = document.createElement('div');
        drillCard.className = 'drill-card-modal';
        drillCard.dataset.drillId = drill.id;
        drillCard.dataset.drillIndex = index;
        
        drillCard.innerHTML = `
            <div class="drill-card-modal-header">
                <div class="drill-card-modal-title">${drill.title}</div>
                <div class="drill-card-modal-subtitle">${drill.subtitle}</div>
            </div>
            <div class="drill-card-modal-content">
                <ul class="drill-card-modal-details">
                    <li><strong>Rounds:</strong> ${drill.rounds}</li>
                    <li><strong>Time:</strong> ${drill.time}</li>
                    <li><strong>Focus:</strong> ${drill.focus}</li>
                </ul>
            </div>
            <div class="drill-card-modal-footer">
                <button class="drill-card-modal-btn start-drill" 
                        data-course="${courseNumber}" 
                        data-drill-index="${index}"
                        data-drill-id="${drill.id}">
                    Start Drill
                </button>
            </div>
        `;
        
        drillsGrid.appendChild(drillCard);
    });
    
    console.log(`Created ${drills.length} drill cards for course ${courseNumber}`);


// ===== UPDATE PHASE PROGRESS =====
function updatePhaseProgress(phase) {
    console.log(`Updating progress for Phase ${phase}`);
    
    // Get all skills assessments for this phase from localStorage
    let totalAssessedSkills = 0;
    let totalPossibleSkills = 0;
    
    // Get drills for this phase
    const drills = window.drillData[phase] || [];
    
    drills.forEach((drill, drillIndex) => {
        const drillKey = `phase${phase}_drill${drillIndex}_assessment`;
        const savedAssessment = localStorage.getItem(drillKey);
        
        if (savedAssessment) {
            const assessmentData = JSON.parse(savedAssessment);
            // Count how many skills have a rating (1-5)
            const assessedSkills = Object.values(assessmentData).filter(rating => 
                rating && rating >= 1 && rating <= 5
            ).length;
            totalAssessedSkills += assessedSkills;
        }
        
        // Each drill has 8 skills to assess
        totalPossibleSkills += 8;
    });
    
    console.log(`Phase ${phase}: ${totalAssessedSkills}/${totalPossibleSkills} skills assessed`);
    
    // Calculate progress percentage
    let progressPercentage = 0;
    if (totalPossibleSkills > 0) {
        // Each assessed skill adds points
        progressPercentage = totalAssessedSkills * phasePointsPerSkill[phase];
        // Cap at 100%
        progressPercentage = Math.min(progressPercentage, 100);
    }
    
    // Update the progress wheel for this phase
    updateProgressWheel(phase, progressPercentage);
    
    // Save progress to localStorage
    localStorage.setItem(`phase${phase}_progress`, progressPercentage.toFixed(1));
    
    // Return progress for use in other functions
    return progressPercentage;
}

// ===== UPDATE PROGRESS WHEEL VISUALLY =====
function updateProgressWheel(phase, percentage) {
    console.log(`Setting Phase ${phase} progress wheel to ${percentage}%`);
    
    const progressWheel = document.querySelector(`.phase-card[data-phase="${phase}"] .phase-progress-wheel`);
    if (!progressWheel) {
        console.warn(`Progress wheel not found for Phase ${phase}`);
        return;
    }
    
    // Convert percentage to degrees (360° circle)
    const degrees = (percentage / 100) * 360;
    
    // Set CSS custom property for conic gradient
    progressWheel.style.setProperty('--progress', `${degrees}deg`);
    
    // Update percentage text
    const percentageText = progressWheel.querySelector('.phase-progress-percentage');
    if (percentageText) {
        percentageText.textContent = `${percentage.toFixed(1)}%`;
    }
    
    // Add glow animation when progress > 0
    if (percentage > 0) {
        progressWheel.classList.add('has-progress');
    } else {
        progressWheel.classList.remove('has-progress');
    }
}
    // Add click handlers to drill buttons
    drillsGrid.querySelectorAll('.start-drill').forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            const course = this.getAttribute('data-course');
            const drillIndex = this.getAttribute('data-drill-index');
            const drillId = this.getAttribute('data-drill-id');
            openStageDrillModal(course, drillIndex, drillId);
        });
    });
}

function openStageDrillModal(courseNumber, drillIndex, drillId) {
    const modal = document.getElementById('stage-drill-modal');
    const title = document.getElementById('stage-drill-title');
    const subtitle = document.getElementById('stage-drill-subtitle');
    const stepsContainer = document.getElementById('stage-drill-steps');
    
    if (!modal || !title || !subtitle || !stepsContainer) return;
    
    // Get drill data
    const drill = window.drillData[courseNumber][drillIndex];
    
    if (!drill) {
        console.error('Drill not found:', courseNumber, drillIndex);
        return;
    }
    
    title.textContent = drill.title;
    subtitle.textContent = drill.subtitle;
    
    // Create steps
    stepsContainer.innerHTML = '';
    drill.steps.forEach(step => {
        if (step.trim() === '') {
            stepsContainer.appendChild(document.createElement('br'));
        } else {
            const stepElement = document.createElement('div');
            stepElement.className = 'step-item';
            stepElement.innerHTML = `
                <div class="step-description">${step}</div>
            `;
            stepsContainer.appendChild(stepElement);
        }
    });
    
    // Store current drill info for assessment
    const assessBtn = document.getElementById('open-assessment');
    if (assessBtn) {
        assessBtn.dataset.currentCourse = courseNumber;
        assessBtn.dataset.currentDrillIndex = drillIndex;
        assessBtn.dataset.currentDrillId = drillId;
    }
    
    // Close current drills modal
    const currentDrillsModal = document.getElementById(`course${courseNumber}-drills-modal`);
    if (currentDrillsModal) {
        currentDrillsModal.style.display = 'none';
    }
    
    modal.style.display = 'flex';
}

// Initialize drill data globally BEFORE the functions are called
window.drillData = {
    1: [
        {
            id: 'P1-D1',
            title: 'First Shots',
            subtitle: 'Recoil management fundamentals',
            rounds: 10,
            time: '15 min',
            focus: 'Recoil management, sight alignment, trigger press confirmation',
            category: 'standard',
            steps: [
                "1. Load 1 round into your magazine",
                "2. Assume proper shooting grip and stance",
                "3. Present pistol and fire 1 round at target's center mass",
                "4. Repeat this process 10 times, loading one round for each shot"
            ],
            assessment: ['Recoil Management', 'Sight Alignment', 'Trigger Press', 'Shot Anticipation', 'Grip Pressure', 'Stance Stability', 'Follow Through', 'Breathing Control']
        },
        {
            id: 'P1-D2',
            title: 'Single Shot Fundamentals',
            subtitle: 'Consistent mechanics',
            rounds: 5,
            time: '10 min',
            focus: 'Consistent mechanics, sight picture, trigger press',
            category: 'standard',
            steps: [
                "1. Load 5 rounds into your magazine",
                "2. Assume proper shooting grip and stance",
                "3. Present pistol and fire 1 round at target's center mass",
                "4. Assess shot placement, reset grip and stance",
                "5. Repeat for total of 5 shots"
            ],
            assessment: ['Recoil Management', 'Sight Alignment', 'Trigger Press', 'Shot Anticipation', 'Grip Pressure', 'Stance Stability', 'Follow Through', 'Breathing Control']
        },
        {
            id: 'P1-D3',
            title: 'Two-Shot Groups',
            subtitle: 'Shot-to-shot consistency',
            rounds: 10,
            time: '15 min',
            focus: 'Shot-to-shot consistency, smooth trigger press',
            category: 'standard',
            steps: [
                "1. Load 10 rounds into your magazine",
                "2. Assume proper shooting grip and stance",
                "3. Present pistol and fire 2 rounds at target's center mass",
                "4. Assess hits for both rounds, reset",
                "5. Repeat for 5 pairs (10 rounds total)"
            ],
            assessment: ['Recoil Management', 'Sight Alignment', 'Trigger Press', 'Shot Anticipation', 'Grip Pressure', 'Stance Stability', 'Follow Through', 'Breathing Control']
        },
        {
            id: 'P1-D4',
            title: 'Accuracy Challenge',
            subtitle: 'Precision shot placement',
            rounds: 5,
            time: '10 min',
            focus: 'Precision shot placement, sight alignment, trigger control',
            category: 'standard',
            steps: [
                "1. Load 5 rounds into your magazine",
                "2. Assume proper shooting grip and stance",
                "3. Present pistol and fire all 5 rounds at small target",
                "4. Take your time for maximum accuracy"
            ],
            assessment: ['Recoil Management', 'Sight Alignment', 'Trigger Press', 'Shot Anticipation', 'Grip Pressure', 'Stance Stability', 'Follow Through', 'Breathing Control']
        }
    ],
    2: [
        {
            id: 'P2-D1',
            title: 'Fundamentals Confirmation',
            subtitle: 'Phase 1 skills under pressure',
            rounds: 5,
            time: '10 min',
            focus: 'Confirming Phase 1 skills with distance increase',
            category: 'standard',
            steps: [
                "1. Load 5 rounds into your magazine",
                "2. Assume proper shooting grip and stance",
                "3. Present pistol and fire 5 rounds, one at a time",
                "4. Focus on center mass accuracy"
            ],
            assessment: ['Grip', 'Stance', 'Sight Alignment', 'Trigger Control', 'Shot Placement', 'Consistency', 'Muzzle Control', 'Presentation']
        },
        {
            id: 'P2-D2',
            title: 'Lateral Movement',
            subtitle: 'Shooting while moving',
            rounds: 5,
            time: '15 min',
            focus: 'Smooth movement, stable platform while moving',
            category: 'standard',
            steps: [
                "1. Load 5 rounds into your magazine",
                "2. Take one controlled step sideways",
                "3. Stop, present pistol, and fire 1 round",
                "4. Take another controlled step sideways",
                "5. Stop, present pistol, and fire 1 round",
                "6. Continue for 5 repetitions"
            ],
            assessment: ['Grip', 'Stance', 'Sight Alignment', 'Trigger Control', 'Shot Placement', 'Consistency', 'Muzzle Control', 'Presentation']
        },
        {
            id: 'P2-D3',
            title: 'Two-Target Transitions',
            subtitle: 'Multiple target engagement',
            rounds: 10,
            time: '15 min',
            focus: 'Smooth transitions, eyes lead the gun',
            category: 'standard',
            steps: [
                "1. Load 10 rounds into your magazine",
                "2. Present pistol and fire 1 round at left target",
                "3. Shift eyes to right target, move pistol to follow",
                "4. Fire 1 round at right target",
                "5. Repeat sequence 5 times (10 rounds total)"
            ],
            assessment: ['Grip', 'Stance', 'Sight Alignment', 'Trigger Control', 'Shot Placement', 'Consistency', 'Muzzle Control', 'Presentation']
        },
        {
            id: 'P2-D4',
            title: 'Induced Malfunction',
            subtitle: 'Failure clearance drills',
            rounds: 5,
            time: '15 min',
            focus: 'Type 1 & 2 malfunction recognition and clearance',
            category: 'standard',
            steps: [
                "1. Present pistol and fire at target",
                "2. If malfunction occurs:",
                "   • For 'click' (no bang): Tap-Rack-Assess",
                "   • For 'stovepipe': Aggressively rack slide",
                "3. After clearing, resume firing",
                "4. Continue until 5 live rounds fired"
            ],
            assessment: ['Grip', 'Stance', 'Sight Alignment', 'Trigger Control', 'Shot Placement', 'Consistency', 'Muzzle Control', 'Presentation']
        },
        {
            id: 'P2-D5',
            title: 'Emergency Reload',
            subtitle: 'Speed reload under pressure',
            rounds: 5,
            time: '15 min',
            focus: 'Efficient emergency reload procedure',
            category: 'standard',
            steps: [
                "1. Load one magazine with 2 rounds",
                "2. Have fresh, fully loaded spare magazine ready",
                "3. Present pistol and fire both 2 rounds",
                "4. Perform emergency reload",
                "5. Once reloaded, fire 3 more rounds",
                "6. Repeat full sequence once"
            ],
            assessment: ['Grip', 'Stance', 'Sight Alignment', 'Trigger Control', 'Shot Placement', 'Consistency', 'Muzzle Control', 'Presentation']
        }
    ],
    3: [
        {
            id: 'P3-D1',
            title: 'Transitions + Reload Review',
            subtitle: 'Integrated Phase 2 skills',
            rounds: 5,
            time: '15 min',
            focus: 'Multi-target transitions with emergency reloads',
            category: 'standard',
            steps: [
                "1. Load magazine with 1 round",
                "2. Have fresh, fully loaded spare magazine ready",
                "3. Present pistol and fire 1 round at one target",
                "4. Perform emergency reload",
                "5. Fire 3 more rounds, alternating between two targets",
                "6. Repeat sequence once"
            ],
            assessment: ['Emergency Reload', 'Multi-Target Transitions', 'Accuracy', 'Fluidity', 'Magazine Insertion', 'Slide Lock Awareness', 'Target Engagement', 'Speed']
        },
        {
            id: 'P3-D2',
            title: 'Decision-Making Under Pressure',
            subtitle: 'Shoot/no-shoot discrimination',
            rounds: 12,
            time: '20 min',
            focus: 'Applying shoot/no-shoot discrimination',
            category: 'standard',
            steps: [
                "1. Load your magazines",
                "2. Listen to scenario description",
                "3. Quickly decide if shooting is legally justified",
                "4. If justified: fire 2 rounds at THREAT target(s)",
                "5. Do NOT shoot INNOCENT targets",
                "6. Repeat for multiple scenarios"
            ],
            assessment: ['Emergency Reload', 'Multi-Target Transitions', 'Accuracy', 'Fluidity', 'Magazine Insertion', 'Slide Lock Awareness', 'Target Engagement', 'Speed']
        },
        {
            id: 'P3-D3',
            title: 'Position 1 - Seated',
            subtitle: 'Extreme muzzle discipline',
            rounds: 6,
            time: '15 min',
            focus: 'Shooting from seated position',
            category: 'standard',
            steps: [
                "1. Load 6 rounds into your magazine",
                "2. Present pistol from seated position",
                "3. Fire 2 rounds at target's center mass",
                "4. Repeat 3 times (6 rounds total)"
            ],
            assessment: ['Emergency Reload', 'Multi-Target Transitions', 'Accuracy', 'Fluidity', 'Magazine Insertion', 'Slide Lock Awareness', 'Target Engagement', 'Speed']
        },
        {
            id: 'P3-D4',
            title: 'Position 2 - Kneeling',
            subtitle: 'Stable platform from kneeling',
            rounds: 7,
            time: '15 min',
            focus: 'Shooting from kneeling position',
            category: 'standard',
            steps: [
                "1. Load 7 rounds into your magazine",
                "2. Transition into kneeling position",
                "3. Present pistol and fire 2-3 rounds",
                "4. Repeat until all 7 rounds fired"
            ],
            assessment: ['Emergency Reload', 'Multi-Target Transitions', 'Accuracy', 'Fluidity', 'Magazine Insertion', 'Slide Lock Awareness', 'Target Engagement', 'Speed']
        }
    ],
    4: [
        {
            id: 'P4-D1',
            title: 'Legal Decision Making',
            subtitle: 'Complex legal scenarios',
            rounds: 15,
            time: '25 min',
            focus: 'Engaging ONLY justified threats',
            category: 'standard',
            steps: [
                "1. Load your magazines",
                "2. Listen to legal scenario",
                "3. Decide if deadly force is justified",
                "4. If justified: engage ONLY THREAT target(s)",
                "5. Avoid hitting INNOCENT targets",
                "6. Continue through multiple scenarios"
            ],
            assessment: ['Legal Justification', 'Threat Identification', 'Innocent Avoidance', 'Critical Thinking', 'Shot Placement', 'Scenario Analysis', 'Decision Process', 'Time Management']
        },
        {
            id: 'P4-D2',
            title: 'Public Space Scenario',
            subtitle: 'Minimizing risk to innocents',
            rounds: 15,
            time: '20 min',
            focus: 'Rapid engagement in public environment',
            category: 'standard',
            steps: [
                "1. Load 5 rounds into magazine",
                "2. Present pistol and engage ONLY center THREAT target",
                "3. Fire all 5 rounds within 10-second time limit",
                "4. Do NOT hit INNOCENT targets",
                "5. Repeat 3 times (15 rounds total)"
            ],
            assessment: ['Legal Justification', 'Threat Identification', 'Innocent Avoidance', 'Critical Thinking', 'Shot Placement', 'Scenario Analysis', 'Decision Process', 'Time Management']
        }
    ],
    5: [
        {
            id: 'P5-S1',
            title: 'Stage 1: Accuracy',
            subtitle: 'Fundamental marksmanship',
            rounds: 15,
            time: '25 min',
            focus: 'Demonstrate marksmanship fundamentals',
            category: 'qualification',
            steps: [
                "String 1: Precision Baseline (7 yards)",
                "• Load 7 rounds",
                "• Fire all 7 rounds at center mass, no time limit",
                "",
                "String 2: Strong Hand Only (5 yards)",
                "• Load 4 rounds",
                "• Fire using only strong hand",
                "• Support hand behind back/on chest",
                "",
                "String 3: Support Hand Only (5 yards)",
                "• Load 4 rounds",
                "• Fire using only support hand",
                "• Strong hand behind back"
            ],
            assessment: ['Shot Aptitude', 'Precision', 'Strong Hand', 'Support Hand', 'Sight Alignment', 'Trigger Control', 'Grouping', 'Consistency']
        },
        {
            id: 'P5-S2',
            title: 'Stage 2: Skills Integration',
            subtitle: 'Integrated skills under pressure',
            rounds: 10,
            time: '30 min',
            focus: 'Multi-target engagement & emergency reloads',
            category: 'qualification',
            steps: [
                "String 1: Multiple Targets (5 yards)",
                "• Set up two targets side by side",
                "• Load 5 rounds",
                "• Engage first target: 2 rounds",
                "• Transition to second target: 2 rounds",
                "• Final shot on primary target",
                "• Complete within 12 seconds",
                "",
                "String 2: Emergency Reload (5 yards)",
                "• Load magazine with 2 rounds",
                "• Have fresh, loaded spare magazine ready",
                "• Fire 2 rounds (pistol locks open)",
                "• Perform emergency reload",
                "• Fire 3 more rounds",
                "• Complete within 18 seconds"
            ],
            assessment: ['Shot Aptitude', 'Precision', 'Strong Hand', 'Support Hand', 'Sight Alignment', 'Trigger Control', 'Grouping', 'Consistency']
        },
        {
            id: 'P5-S3',
            title: 'Stage 3: Final Scenario',
            subtitle: 'Home Defense - Late Night Intrusion',
            rounds: 5,
            time: '20 min',
            focus: 'Technical skills with legal knowledge',
            category: 'qualification',
            steps: [
                "1. Listen to scenario narrative",
                "2. Answer legal justification questions",
                "3. Move to cover (barricade)",
                "4. Engage two THREAT targets: 2 rounds each",
                "5. Place 1 additional round on primary threat",
                "6. Do NOT hit INNOCENT target",
                "",
                "Post-Incident Response:",
                "• State: 'Threats stopped, moving to cover'",
                "• State: 'Calling 911'",
                "• Demonstrate concise 911 call"
            ],
            assessment: ['Shot Aptitude', 'Precision', 'Strong Hand', 'Support Hand', 'Sight Alignment', 'Trigger Control', 'Grouping', 'Consistency']
        }
    ]
};

           // ===== SKILLS ASSESSMENT =====
    function setupSkillsAssessment() {
        const openAssessmentBtn = document.getElementById('open-assessment');
        if (openAssessmentBtn) {
            openAssessmentBtn.addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('stage-drill-modal').style.display = 'none';
                document.getElementById('skills-assessment-modal').style.display = 'flex';
                populateSkillsAssessment();
            });
        }

// ===== AUTO-SAVE RATING FUNCTION =====
function autoSaveRating(ratingBubble, skillItem) {
    try {
        console.log("🔄 Auto-saving rating...");
        
        // Get current assessment data
        const assessBtn = document.getElementById('open-assessment');
        const course = parseInt(assessBtn.dataset.currentCourse);
        const drillIndex = parseInt(assessBtn.dataset.currentDrillIndex);
        const drillId = assessBtn.dataset.currentDrillId;
        
        // Get rating value
        const rating = parseInt(ratingBubble.getAttribute('data-rating')) || 1;
        
        // Get skill index (0-7)
        const allSkillItems = document.querySelectorAll('#skills-assessment-modal .skill-assessment-item');
        const skillIndex = Array.from(allSkillItems).indexOf(skillItem);
        
        if (skillIndex === -1) {
            console.error("Could not find skill index");
            return false;
        }
        
        // Get skill name
        const skillName = skillItem.querySelector('.skill-name')?.textContent || `Skill ${skillIndex + 1}`;
        const cleanSkillName = skillName.replace(/^\d+\.\s*/, '');
        
        console.log(`💾 Auto-saving: Phase ${course}, Skill ${skillIndex + 1}, Rating ${rating}`);
        
        // Ensure appState structure exists
        if (!window.appState) window.appState = { savedData: {} };
        if (!window.appState.savedData) window.appState.savedData = {};
        if (!window.appState.savedData.assessments) {
            window.appState.savedData.assessments = [];
        }
        
        // Find existing assessment for this drill
        let assessmentIndex = window.appState.savedData.assessments.findIndex(
            a => a.phase === course && a.drillId === drillId
        );
        
        if (assessmentIndex === -1) {
            // Create new assessment with empty skills
            const newAssessment = {
                phase: course,
                drillId: drillId,
                drillIndex: drillIndex,
                skills: Array(8).fill({ name: '', rating: null }),
                timestamp: new Date().toISOString()
            };
            window.appState.savedData.assessments.push(newAssessment);
            assessmentIndex = window.appState.savedData.assessments.length - 1;
            console.log("📝 Created new assessment");
        }
        
        // Update the specific skill
        const assessment = window.appState.savedData.assessments[assessmentIndex];
        assessment.skills[skillIndex] = {
            name: cleanSkillName,
            rating: rating
        };
        assessment.timestamp = new Date().toISOString();
        
        // Save to localStorage
        if (typeof saveAppState === 'function') {
            saveAppState();
            console.log("📁 Auto-saved to localStorage");
        }
        
        // Update count display
        const skillCount = assessment.skills.filter(s => s.rating !== null).length;
        const skillsCountElement = document.getElementById('skills-count');
        if (skillsCountElement) {
            skillsCountElement.textContent = skillCount;
        }
        
        console.log(`✅ Auto-save complete: ${skillCount}/8 skills assessed`);
        return true;
        
    } catch (error) {
        console.error("❌ Auto-save failed:", error);
        return false;
    }
}

               // ===== RATING BUBBLE HANDLER (WITH AUTO-SAVE) =====
document.addEventListener('click', function(e) {
    if (e.target.classList.contains('rating-bubble')) {
        const parent = e.target.closest('.skill-assessment-item');
        if (parent) {
            console.log("Rating bubble clicked");
            
            // 1. Update UI selection (keep your existing visual feedback)
            parent.querySelectorAll('.rating-bubble').forEach(b => b.classList.remove('selected'));
            e.target.classList.add('selected');
            
            // 2. Get current course/phase
            const courseElement = document.getElementById('open-assessment');
            const course = courseElement ? parseInt(courseElement.dataset.currentCourse) : 1;
            
            // 3. AUTO-SAVE THE RATING IMMEDIATELY
            const saveSuccess = autoSaveRating(e.target, parent);
            
            if (saveSuccess) {
                // 4. UPDATE PHASE PROGRESS WHEEL (existing - 3.125%, 2.5%, etc.)
                if (typeof updateRealTimeProgress === 'function') {
                    updateRealTimeProgress(course);
                }
                
                // 5. SAVE TO LOCALSTORAGE (NEW - fixes refresh problem)
                if (typeof saveAppState === 'function') {
                    saveAppState();
                    console.log(" Data saved to localStorage");
                }
                
                // 6. UPDATE DA PROGRESS BARS (NEW - 2.5%, 5%, 7.5%, 10%, 12.5%)
                if (typeof window.refreshDynamicAnalysisModal === 'function') {
                    setTimeout(() => {
                        try {
                            window.refreshDynamicAnalysisModal();
                            console.log("DA progress bars updated");
                        } catch (error) {
                            console.log("DA refresh attempted");
                        }
                    }, 30);
                }
            } else {
                console.warn("Auto-save failed - skipping progress updates");
            }
        }
    }
});


        // Save assessment
        const saveAssessmentBtn = document.getElementById('save-assessment');
        if (saveAssessmentBtn) {
            const newSaveBtn = saveAssessmentBtn.cloneNode(true);
            saveAssessmentBtn.parentNode.replaceChild(newSaveBtn, saveAssessmentBtn);

            newSaveBtn.addEventListener('click', function(e) {
                e.preventDefault();

                const assessBtn = document.getElementById('open-assessment');
                const course = parseInt(assessBtn.dataset.currentCourse);
                const drillIndex = assessBtn.dataset.currentDrillIndex;
                const drillId = assessBtn.dataset.currentDrillId;

                console.log('Saving assessment for Phase', course, 'Drill', drillId);

                const skillItems = document.querySelectorAll('#skills-assessment-modal .skill-assessment-item');
                const skills = [];

                skillItems.forEach((item, index) => {
                    const skillName = item.querySelector('.skill-name').textContent.replace(/^\d+\.\s*/, '');
                    const selectedBubble = item.querySelector('.rating-bubble.selected');
                    const rating = selectedBubble ? parseInt(selectedBubble.getAttribute('data-rating')) : null;

                    skills.push({
                        name: skillName,
                        rating: rating
                    });
                });

                if (!appState.savedData.assessments) {
                    appState.savedData.assessments = [];
                }

                appState.savedData.assessments = appState.savedData.assessments.filter(
                    a => !(a.phase === course && a.drillId === drillId)
                );

                appState.savedData.assessments.push({
                    phase: course,
                    drillId: drillId,
                    drillIndex: drillIndex,
                    skills: skills,
                    timestamp: new Date().toISOString()
                });

                console.log('Saved assessment:', {
                    phase: course,
                    drillId: drillId,
                    skills: skills,
                    totalAssessed: skills.filter(s => s.rating !== null).length
                });

                saveAppState();
                updateAllProgress();
		refreshDynamicAnalysisModal();
                document.getElementById('skills-assessment-modal').style.display = 'none';
                showNotification('Assessment saved! Progress updated.', 'success');
            });
        }
    }

    function populateSkillsAssessment() {
        const skillsList = document.getElementById('skills-assessment-modal');
        if (!skillsList) return;

        const assessBtn = document.getElementById('open-assessment');
        const course = parseInt(assessBtn.dataset.currentCourse);
        const drillIndex = assessBtn.dataset.currentDrillIndex;
        const drillId = assessBtn.dataset.currentDrillId;
        const drill = window.drillData[course][drillIndex];

        if (!drill || !drill.assessment) return;

        skillsList.querySelector('.skills-list').innerHTML = '';

        const progressIndicator = document.createElement('div');
        progressIndicator.className = 'real-time-progress';
        progressIndicator.innerHTML = `
            <div class="progress-header">
                <span>Skills Assessed: <strong id="skills-count">0</strong> / 8</span>
                <span>Phase Progress: <strong id="phase-progress">0.0%</strong></span>
            </div>
            <div class="progress-note">
                Each skill adds ${phasePointsPerSkill[course].toFixed(3)}% to Phase ${course}
            </div>
        `;
        skillsList.querySelector('.skills-list').appendChild(progressIndicator);

        const existingAssessment = appState.savedData.assessments?.find(
            a => a.phase === course && a.drillId === drillId
        );

        drill.assessment.forEach((skill, index) => {
            const skillItem = document.createElement('div');
            skillItem.className = 'skill-assessment-item';

            const existingRating = existingAssessment?.skills[index]?.rating;

            skillItem.innerHTML = `
                <div class="skill-name">
                    <span class="skill-number">${index + 1}.</span> ${skill}
                </div>
                <div class="rating-bubbles">
                    <div class="rating-bubble ${existingRating === 1 ? 'selected' : ''}" data-rating="1">1</div>
                    <div class="rating-bubble ${existingRating === 2 ? 'selected' : ''}" data-rating="2">2</div>
                    <div class="rating-bubble ${existingRating === 3 ? 'selected' : ''}" data-rating="3">3</div>
                    <div class="rating-bubble ${existingRating === 4 ? 'selected' : ''}" data-rating="4">4</div>
                    <div class="rating-bubble ${existingRating === 5 ? 'selected' : ''}" data-rating="5">5</div>
                </div>
            `;
            skillsList.querySelector('.skills-list').appendChild(skillItem);
        });

        updateRealTimeProgress(course);
    }


    // ===== EMAIL FUNCTIONALITY =====
    function setupEmailFunctionality() {
        const emailOnboardingBtn = document.getElementById('email-onboarding-btn');
        if (emailOnboardingBtn) {
            emailOnboardingBtn.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Collect form data
                const formData = {
                    clientName: document.getElementById('client-full-name')?.value || 'Not provided',
                    date: new Date().toLocaleDateString(),
                    waivers: {
                        liability: document.getElementById('liability-consent')?.checked || false,
                        safety: document.getElementById('safety-consent')?.checked || false,
                        medical: document.getElementById('medical-consent')?.checked || false,
                        media: document.getElementById('media-consent')?.checked || false
                    },
                    skills: appState.savedData.skillRatings || {},
                    goals: Array.from(document.querySelectorAll('.training-goal:checked')).map(cb => cb.nextElementSibling?.textContent || 'Unknown'),
                    progress: appState.waiverProgress
                };
                
                // Create email content
                const subject = `Witness Defense Onboarding - ${formData.clientName}`;
                const body = `
Client Onboarding Summary:
----------------------------
Name: ${formData.clientName}
Date: ${formData.date}
Completion: ${Math.round(formData.progress)}%

Waivers Completed:
- Liability Waiver: ${formData.waivers.liability ? 'YES' : 'NO'}
- Safety Agreement: ${formData.waivers.safety ? 'YES' : 'NO'}
- Medical Release: ${formData.waivers.medical ? 'YES' : 'NO'}
- Media Release: ${formData.waivers.media ? 'YES' : 'NO'}

Training Goals:
${formData.goals.map(goal => `• ${goal}`).join('\n')}

Skill Ratings:
${Object.entries(formData.skills).map(([skill, rating]) => `• ${skill}: ${rating}/5`).join('\n') || 'No ratings provided'}

Notes: Form authenticated via the Witness Defense™ Client Portal.
                `.trim();
                
                // Open email client
                window.open(`mailto:cricket.lord@witnessdefense.com?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`);
                
                showNotification('Email client opened with form data', 'success');
            });
        }
    }

    // ===== RESET FUNCTIONALITY =====
    function setupResetFunctionality() {
        const resetAllBtn = document.getElementById('reset-all');
        if (resetAllBtn) {
            resetAllBtn.addEventListener('click', function(e) {
                e.preventDefault();
                if (confirm('Are you sure you want to reset all forms and progress? This cannot be undone.')) {
                    // Reset all checkboxes
                    document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                        cb.checked = false;
                    });
                    
                    // Reset all text inputs
                    document.querySelectorAll('input[type="text"], textarea').forEach(input => {
                        input.value = '';
                    });
                    
                    // Reset skill ratings
                    document.querySelectorAll('.rating-option').forEach(option => {
                        option.classList.remove('selected');
                    });
                    
                    // Reset app state
                    appState.waiverProgress = 0;
                    appState.savedData = {};
                    appState.checkboxStates = {};
                    appState.inputValues = {};
                    
                    // Clear localStorage
                    localStorage.removeItem('witnessDefenseData');
                    
                    // Update UI
                    updateAllProgress();
                    showNotification('All forms have been reset', 'success');
                }
            });
        }
    }

    // ===== MENU FUNCTIONALITY =====
    function setupMenuButtons() {
        const menuSaveOffline = document.getElementById('menu-save-offline');
        const menuPrintCurrent = document.getElementById('menu-print-current');
        const menuCompileSend = document.getElementById('menu-compile-send');
        const menuOverlay = document.querySelector('.menu-overlay');
        
        if (menuSaveOffline) {
            menuSaveOffline.addEventListener('click', function(e) {
                e.preventDefault();
                saveAppState();
                showNotification('Data saved for offline use', 'success');
                if (menuOverlay) menuOverlay.style.display = 'none';
            });
        }
        
        if (menuPrintCurrent) {
            menuPrintCurrent.addEventListener('click', function(e) {
                e.preventDefault();
                window.print();
                if (menuOverlay) menuOverlay.style.display = 'none';
            });
        }
        
        if (menuCompileSend) {
            menuCompileSend.addEventListener('click', function(e) {
                e.preventDefault();
                // Compile all data
                const compiledData = {
                    ...appState,
                    compileDate: new Date().toISOString()
                };
                
                // For now, just show a notification
                showNotification('All data compiled. Ready to send.', 'success');
                if (menuOverlay) menuOverlay.style.display = 'none';
                
                // You could add email functionality here
                console.log('Compiled data:', compiledData);
            });
        }
    }

    // ===== PRINT FUNCTIONALITY =====
    function setupPrintButtons() {
        document.querySelectorAll('.print-btn').forEach(btn => {
            btn.addEventListener('click', function(e) {
                e.preventDefault();
                window.print();
            });
        });
    }

function applyDemoRestrictions() {
    if (!LicenseManager.isDemo()) return;
    
    console.log('Applying demo restrictions');
    
    // Hide all but first phase card
    document.querySelectorAll('.phase-card').forEach((card, index) => {
        if (index > 0) { // Keep first card, hide others
            card.style.display = 'none';
        }
    });
    
    // Hide Dynamic Analysis buttons
    document.querySelectorAll('.dynamic-ds-btn').forEach(btn => {
        btn.style.display = 'none';
    });
    
    // Show demo banner
    const daysLeft = LicenseManager.getRemainingDays();
    const banner = document.createElement('div');
    banner.style.cssText = `
        background: #fe0100;
        color: white;
        padding: 10px;
        text-align: center;
        font-weight: bold;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 1000;
    `;
    banner.innerHTML = `DEMO MODE: ${daysLeft} days remaining - <a href="https://witnessdefense.com/purchase" style="color: white; text-decoration: underline;">Upgrade to Full Version</a>`;
    document.body.appendChild(banner);
}

   // ===== INITIALIZATION =====
function initializeApp() {
    console.log('Initializing Witness Defense Portal...');
    
    // LICENSE CHECK FIRST
    if (!LicenseManager.init()) {
        console.log('App locked - waiting for license');
        return; // Stop here - license screen is showing
    }
    
    // Only run the rest if license is valid
    console.log('License valid, initializing app...');
    
    // APPLY DEMO RESTRICTIONS (if in demo mode)
    applyDemoRestrictions();
    

    // Setup all functionality
    setupBackButtonHandling(); // Move this FIRST
    setupNavigation();
    setupModals();
    setupWaivers();
    setupCheckboxes();
    setupFormInputs();
    setupSkillsAssessment();
    setupEmailFunctionality();
    setupResetFunctionality();
    setupMenuButtons();
    setupPrintButtons();
    setupDynamicAnalysis();
    updateAllProgress();
    
    // Load saved state
    loadAppState();
    
    // Auto-save every 30 seconds
    setInterval(saveAppState, 30000);
    
    // Log initialization complete
    console.log('Witness Defense Portal initialized successfully');
    console.log('Navigation items:', document.querySelectorAll('.nav-item').length);
    console.log('Waivers button:', document.getElementById('open-waivers-btn') ? 'Found' : 'Not found');
    
    showNotification('Portal Onset');
}

// Start the app
initializeApp();
}); // KEEP THIS CLOSING BRACKET AND PARENTHESIS

// Call this from browser console to test: testProgressWheels()
// ===== DYNAMIC ANALYSIS =====
(function() {
    'use strict';
    
    console.log("DYNAMIC ANALYSIS JS LOADED");
    
    // Phase title mapping
    const PHASE_TITLES = {
        1: "PHASE 1: PRINCIPLES",
        2: "PHASE 2: INTEGRATION", 
        3: "PHASE 3: MASTERY",
        4: "PHASE 4: CONCEALED CARRY",
        5: "PHASE 5: QUALIFICATION"
    };
    
    // Rating to percentage mapping (1→2.5%, 2→5%, 3→7.5%, 4→10%, 5→12.5%)
    const RATING_TO_PERCENT = {
        1: 2.5,
        2: 5.0,
        3: 7.5,
        4: 10.0,
        5: 12.5
    };
    
    // DOM Elements cache
    let daModal = null;
    let daGrid = null;
    let daSubtitle = null;
    
    // ===== CORE FUNCTIONS =====
    
    function openDynamicAnalysisModal(phase) {
        if (!daModal) initializeDOMElements();
        if (!daModal || !daGrid || !daSubtitle) return;
        
        console.log(`Opening Dynamic Analysis for Phase ${phase}`);
        
        // Set phase title
        daSubtitle.textContent = PHASE_TITLES[phase] || `PHASE ${phase}: ANALYSIS`;
        
        // Clear and populate grid
        daGrid.innerHTML = '';
        
        const drills = window.drillData && window.drillData[phase];
        if (!drills || drills.length === 0) {
            daGrid.innerHTML = '<div class="no-assessment-data"><div>No drills found for this phase</div></div>';
            daModal.style.display = 'flex';
            return;
        }
        
        // Create drill cards
        drills.forEach((drill, index) => {
            const drillCard = createDynamicAnalysisCard(drill, index, phase);
            if (drillCard) daGrid.appendChild(drillCard);
        });
        
        daModal.style.display = 'flex';
        console.log(`DA modal opened with ${drills.length} drill(s)`);
    }
    
    function createDynamicAnalysisCard(drill, drillIndex, phase) {
        const card = document.createElement('div');
        card.className = 'dynamic-analysis-card';
        card.dataset.drillId = drill.id;
        card.dataset.drillIndex = drillIndex;
        card.dataset.phase = phase;
        
        // Get assessment data
        const assessment = getAssessmentData(phase, drill.id);
        const skillScores = calculateDynamicSkillScores(assessment);
        const totalScore = calculateDynamicTotalScore(skillScores);
        
        // Build skill bars HTML
        const skills = drill.assessment || Array(8).fill().map((_, i) => `Skill ${i + 1}`);
        let skillBarsHTML = '';
        
        for (let i = 0; i < 8; i++) {
            const skillScore = skillScores[i] || 0;
            const fillHeight = skillScore * 8; // Convert 0-12.5% to 0-100% height
            
            skillBarsHTML += `
                <div class="skill-bar-column">
                    <div class="skill-percentage">${skillScore.toFixed(1)}%</div>
                    <div class="skill-bar-vertical">
                        <div class="skill-bar-fill" style="--fill-height: ${fillHeight}%"></div>
                    </div>
                    <div class="skill-number">${i + 1}.</div>
                    <div class="skill-name-vertical" title="${skills[i]}">${skills[i]}</div>
                </div>
            `;
        }
        
        // Build card HTML
        card.innerHTML = `
            <div class="drill-card-header">
                <div class="drill-card-title">${drill.title || 'Untitled Drill'}</div>
                ${drill.subtitle ? `<div class="drill-card-subtitle">${drill.subtitle}</div>` : ''}
            </div>
            <div class="drill-total-score">
                <div class="total-score-label">Total Drill Score</div>
                <div class="total-score-value">${totalScore.toFixed(1)}%</div>
            </div>
            <div class="skill-bars-container">${skillBarsHTML}</div>
        `;
        
        return card;
    }
    
    function getAssessmentData(phase, drillId) {
        try {
            if (!window.appState || !window.appState.savedData || !window.appState.savedData.assessments) {
                return null;
            }
            
            return window.appState.savedData.assessments.find(
                a => a.phase === phase && a.drillId === drillId
            );
        } catch (error) {
            console.error("Error getting assessment data:", error);
            return null;
        }
    }
    
    function calculateDynamicSkillScores(assessment) {
        const scores = Array(8).fill(0);
        
        if (!assessment || !assessment.skills || !Array.isArray(assessment.skills)) {
            return scores;
        }
        
        assessment.skills.forEach((skill, index) => {
            if (index < 8 && skill && typeof skill.rating === 'number') {
                scores[index] = RATING_TO_PERCENT[skill.rating] || 0;
            }
        });
        
        return scores;
    }
    
    function calculateDynamicTotalScore(skillScores) {
        return skillScores.reduce((total, score) => total + score, 0);
    }
    
    function refreshDynamicAnalysisModal() {
        if (!daModal || daModal.style.display !== 'flex') return;
        
        try {
            // Get current phase from first card or subtitle
            const firstCard = daModal.querySelector('.dynamic-analysis-card');
            let phase = null;
            
            if (firstCard && firstCard.dataset.phase) {
                phase = parseInt(firstCard.dataset.phase);
            } else {
                const subtitle = daModal.querySelector('.subtitle');
                const match = subtitle && subtitle.textContent.match(/PHASE (\d+)/);
                phase = match ? parseInt(match[1]) : 1;
            }
            
            if (phase) {
                console.log(`Refreshing DA modal for Phase ${phase}`);
                openDynamicAnalysisModal(phase);
            }
        } catch (error) {
            console.error("Error refreshing DA modal:", error);
        }
    }
    
    // ===== HELPER FUNCTIONS =====
    
    function initializeDOMElements() {
        daModal = document.getElementById('dynamic-analysis-modal');
        daGrid = document.getElementById('dynamic-analysis-grid');
        daSubtitle = document.querySelector('#dynamic-analysis-modal .subtitle');
        
        if (!daModal) console.error("DA modal element not found");
        if (!daGrid) console.error("DA grid element not found");
        if (!daSubtitle) console.error("DA subtitle element not found");
    }
    
    function setupModalCloseHandlers() {
        if (!daModal) return;
        
        // Close button
        const closeBtn = daModal.querySelector('.btn-close');
        if (closeBtn) {
            closeBtn.addEventListener('click', () => {
                daModal.style.display = 'none';
            });
        }
        
        // Click outside to close
        daModal.addEventListener('click', (e) => {
            if (e.target === daModal) {
                daModal.style.display = 'none';
            }
        });
        
        // Escape key to close
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && daModal.style.display === 'flex') {
                daModal.style.display = 'none';
            }
        });
    }
    
    function setupDynamicAnalysisButtons() {
        const buttons = document.querySelectorAll('.dynamic-ds-btn');
        
        if (buttons.length === 0) {
            console.warn("No Dynamic Analysis buttons found");
            return;
        }
        
        buttons.forEach(button => {
            // Remove any existing listeners to prevent duplicates
            const newButton = button.cloneNode(true);
            button.parentNode.replaceChild(newButton, button);
            
            // Add fresh listener
            newButton.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                
                const phase = parseInt(this.getAttribute('data-phase'));
                if (isNaN(phase) || phase < 1 || phase > 5) {
                    console.error("Invalid phase specified:", this.getAttribute('data-phase'));
                    return;
                }
                
                openDynamicAnalysisModal(phase);
            });
        });
        
        console.log(`Setup ${buttons.length} DA button(s)`);
    }
    
    // ===== PUBLIC API =====
    
    window.refreshDynamicAnalysisModal = refreshDynamicAnalysisModal;
    
    function setupDynamicAnalysis() {
        console.log("Setting up Dynamic Analysis...");
        
        initializeDOMElements();
        setupModalCloseHandlers();
        setupDynamicAnalysisButtons();
        
        console.log("Dynamic Analysis setup complete");
    }
    
    // ===== INITIALIZATION =====
    
    // Wait for DOM to be ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', setupDynamicAnalysis);
    } else {
        setupDynamicAnalysis();
    }
    
})();// ===== REFRESH DYNAMIC ANALYSIS MODAL =====
function refreshDynamicAnalysisModal() {
    // Check if dynamic analysis modal is currently open
    const modal = document.getElementById('dynamic-analysis-modal');
    if (modal && modal.style.display === 'flex') {
        // Find which phase is currently being viewed
        const firstCard = modal.querySelector('.dynamic-analysis-card');
        if (firstCard) {
            const phase = parseInt(firstCard.dataset.phase);
            console.log('Refreshing Dynamic Analysis modal for Phase', phase);
            openDynamicAnalysisModal(phase); // This will reload with fresh data
        }
    }
}
// ===== ADD TO INITIALIZATION =====
// In your initializeApp() function, add:
// setupDynamicAnalysis();

</SCRIPT>
</body>
</html>